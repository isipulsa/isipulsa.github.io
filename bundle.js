(()=>{var md=Object.defineProperty;var k=(t,e)=>()=>(t&&(e=t(t=0)),e);var ho=(t,e)=>{for(var n in e)md(t,n,{get:e[n],enumerable:!0})};function fo(t){let e=t.getElementsByTagName("body");if(e.length>0){let n=e[0].textContent;if(console.log("[DEBUG] body:",n),!n.includes("Yth."))return!0;let i=n.match(/Yth\.\s+([^-]+)-\s*([A-Z0-9]+)/),s=i?i[1].trim():"tidak diketahui",r=i?i[2].trim():"tidak diketahui";localStorage.setItem("nama_agen",s),localStorage.setItem("kode_agen",r);let o=n.match(/Saldo\s(-?[\d.]+)/),a=n.match(/Proses\s([\d.]+)/),l=n.match(/Trx\s([\d.]+)/i),c=n.match(/Bonus\s([\d.]+)/),d=n.match(/Poin\s([\d.]+)/i),u=n.match(/Pemakaian\s([\d.]+)/i),h=o?o[1]:"-",f=a?a[1]:"-",p=l?l[1]:"-",g=c?c[1]:"-",m=d?d[1]:"-",v=u?u[1]:"-",E=n.match(/Grup\s+([A-Z0-9]+)/i);if(E){let y=E[1].toUpperCase();localStorage.setItem("tipe_akun",y),console.log("[DEBUG] tipe_akun tersimpan:",y)}document.getElementById("saldoDisplay").innerHTML=`
            <header style="
                margin-bottom:0.5rem;
                display:grid; 
                grid-template-columns: 1fr 1fr; 
                text-align:center;
                gap:0.5rem;
            ">
                <div>\u{1F464} <strong>${s}</strong></div>
                <div>\u{1F194} <strong>${r}</strong></div>
            </header>
            <div style="
                display:grid; 
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
                gap:0.5rem;
            ">
                <div>\u{1F4B0} <strong>Saldo:</strong> ${h}</div>
                <div>\u2699\uFE0F <strong>Proses:</strong> ${f}</div>
                <div>\u{1F4CA} <strong>Jml TRX:</strong> ${p}</div>
                <div>\u{1F381} <strong>Bonus:</strong> ${g}</div>
                <div>\u2B50 <strong>Poin:</strong> ${m}</div>
                <div>\u{1F4C5} <strong>Terpakai:</strong> ${v}</div>
            </div>
        `}return!0}var po=k(()=>{});function Ad(t){return t.startsWith("628")?"0"+t.slice(2):t}function _d(t){let e="",n=Ad(t),i=Object.entries(gd).sort((s,r)=>{let o=Math.max(...s[1].map(l=>l.length));return Math.max(...r[1].map(l=>l.length))-o});for(let[s,r]of i)for(let o of r)if(n.startsWith(o))return s;return e}function go(){let t=At(_e.value.trim());if(!t){te.textContent="",_e.classList.remove("with-operator"),ne.innerHTML="";return}let e=_d(t);e&&e!=="Token Listrik"?(te.textContent=e,_e.classList.add("with-operator")):(te.textContent="",_e.classList.remove("with-operator")),ne.innerHTML=""}function Ri(){mo.style.display=_e.value?"block":"none"}var _e,te,ne,mo,gd,Ao=k(()=>{x();_e=document.getElementById("inputTujuan"),te=document.getElementById("operatorDisplay"),ne=document.getElementById("extraButtons"),mo=document.getElementById("clearInput"),gd={Tsel:["0811","0812","0813","0851","0852","0853","0821","0822","0823","0824"],Isat:["0814","0815","0816","0855","0856","0857","0858"],Axis:["083"],"By.U":["085155","085156","085157","085158","085154","085159","08512"],"Token Listrik":["01","04","05","06","07","09","1","2","3","4","5","6","7","8","9","001","020","03"],Smar:["088"],Tri:["089"],XL:["0817","0818","0819","0859","0878","0877"]};_e.addEventListener("input",()=>{go(),Ri()});mo.addEventListener("click",()=>{_e.value="",go(),Ri(),_e.focus()});Ri()});function H({title:t="",message:e="",buttons:n=[],source:i=""}){let s=document.getElementById("modalOverlay"),r=document.getElementById("modalHeader"),o=document.getElementById("modalMessage"),a=document.getElementById("modalButtons"),l=document.getElementById("modalCloseBtn");r.innerHTML=t,o.innerHTML=e,s.style.display="flex",t==="Koneksi Terputus"?s.style.zIndex="99999":s.style.zIndex="3000",window.modalTerbuka=!0,window.modalSumber=i,history.pushState({modal:!0},null,location.href),a.innerHTML="",t==="Koneksi Terputus"||t==="Transaksi Sedang Diproses"||t==="Transfer Saldo"||t==="SUKSES TRANSFER SALDO"||t==="GAGAL TRANSFER SALDO"||t==="Info Tagihan BPJS Kesehatan"||t==="Info Tagihan PDAM"||t==="Info Tagihan Indihome"||t==="Info Tagihan Telkom"||t==="Info Token Listrik"||t==="Pembayaran PLN Berhasil"||t==="Pembayaran BPJS Berhasil"||t==="Pembayaran PDAM Berhasil"||t==="Pembayaran Indihome Berhasil"||t==="Pembayaran Telkom Berhasil"||t==="Pembayaran Berhasil"||t==="Info Tagihan PLN"?l.style.display="none":l.style.display="block",n.forEach(c=>{let d=document.createElement("button");d.textContent=c.text,d.className=c.className||"modal-ok",c.disabled?(d.disabled=!0,d.style.opacity="0.6",d.style.cursor="not-allowed"):d.onclick=()=>{s.style.display="none",window.modalTerbuka=!1,window.modalSumber=null,c.onClick&&c.onClick()},a.appendChild(d)}),l.onclick=()=>{s.style.display="none",window.modalTerbuka=!1,window.modalSumber==="showHargaItem"&&Promise.resolve().then(()=>(x(),_o)).then(({showToast:c})=>{c("Transaksi dibatalkan","error")}),window.modalSumber=null}}function wn(t,e,n,i,s=""){H({title:t,message:e,source:s,buttons:[{text:"OK",className:"modal-ok",onClick:()=>{window.modalTerbuka=!1,window.modalSumber=null,n&&n()}},{text:"Cancel",className:"modal-cancel",onClick:()=>{window.modalTerbuka=!1,window.modalSumber=null,i&&i()}}]})}var ke=k(()=>{});function G(t){Mi=t}function Io(t){Pi=t}var Mi,Pi,oe=k(()=>{Mi=!1,Pi=""});function yo(t){Mi||(Ut.innerHTML=""),Ut.style.display="block",Ut.className="harga-list";let e=t.split(`
`).map(i=>i.trim()).filter(i=>i),n=!1;e.forEach(i=>{let s=i.split("=");if(s.length>=3){let r=s[0].trim(),o=s[1].trim(),a=s[2].replace(";","").trim();if(/\[K\]|\[G\]/.test(a)||!/^\d+([.,]\d+)?$/.test(a))return;if(!n){let c=document.createElement("div");c.className="menu-item harga-item header-item",c.style.display="flex",c.style.justifyContent="space-between",c.style.alignItems="center",c.style.padding="0.5rem 1rem",c.style.borderBottom="1px solid #ccc",c.innerHTML=`
                <span style="font-weight:bold; color:var(--pico-primary); min-width:50px;">Kode</span>
                <span style="flex:1; margin-left:1rem; margin-right:1rem; font-weight:bold;">Deskripsi</span>
                <span style="font-weight:bold; color:var(--pico-success); min-width:60px; text-align:right;">Harga</span>
            `,Ut.appendChild(c),n=!0}let l=document.createElement("div");l.className="menu-item harga-item",l.style.display="flex",l.style.justifyContent="space-between",l.style.alignItems="center",l.style.padding="0.5rem 1rem",l.innerHTML=`
            <span style="font-weight:bold; color:var(--pico-primary); min-width:50px;">${r}</span>
            <span style="flex:1; margin-left:1rem; margin-right:1rem;">${o}</span>
            <span style="font-weight:bold; color:var(--pico-success); min-width:60px; text-align:right;">Rp${a}</span>
        `,l.addEventListener("click",()=>{let c=Id.value.trim(),d=c;["Pulsa","Paket Data","Paket Nelpon & SMS","Nominal Bebas"].includes(Pi)&&c.startsWith("628")&&(d="0"+c.substring(2));let u=`
                <table class="detail-table-laporan-modal">
                    <tr><td>Kode Produk</td><td>${r}</td></tr>
                    <tr><td>Deskripsi Produk</td><td>${o}</td></tr>
                    <tr><td>Harga Modal</td><td>Rp${a}</td></tr>
                    <tr><td>Nomor Tujuan</td><td>${d}</td></tr>
                </table>
                <div style="font-weight:bold; color:red; text-align:center;">
                    Pastikan Saldo Anda Mencukupi!
                </div>`;wn("KONFIRMASI TRANSAKSI",u,()=>{A(`${r}.${d}`),A("S")},()=>{S("Transaksi dibatalkan","error")},"showHargaItem")}),Ut.appendChild(l)}})}var Ut,Id,Eo=k(()=>{$();x();ke();oe();Ut=document.getElementById("extraButtons"),Id=document.getElementById("inputTujuan")});function To(t,e,n){if(!n||n==="Unknown"){S("Nomor Tujuan Tidak Dikenali untuk Pulsa");return}G(!1);let i=localStorage.getItem("tipe_akun");t.style.display="block",e.textContent=n,n==="Tsel"?(t.appendChild(N("Pulsa Reguler",()=>A(ie("t")))),t.appendChild(N("Tambah Masa Aktif",()=>A(ie("tmat"))))):n==="Isat"?(t.appendChild(N("Pulsa Reguler",()=>A(ie("i")))),t.appendChild(N("Tambah Masa Aktif",()=>A(ie("tmai"))))):n==="XL"?(t.appendChild(N("Pulsa Reguler",()=>A(ie("x")))),t.appendChild(N("Tambah Masa Aktif",()=>A(ie("tmax"))))):n==="Axis"?(t.appendChild(N("Pulsa Reguler",()=>A(ie("a")))),t.appendChild(N("Tambah Masa Aktif",()=>A(ie("tmaa"))))):n==="Tri"?(t.appendChild(N("Pulsa Reguler",()=>A(ie("tr")))),t.appendChild(N("Tambah Masa Aktif",()=>A(ie("tmatri"))))):n==="Smar"&&t.appendChild(N("Pulsa Reguler",()=>A(ie("s"))))}var vo=k(()=>{$();x();oe()});function No(t,e,n){if(!n||n==="Unknown"){S("Nomor Tujuan Tidak Dikenali untuk Paket Data");return}G(!1),t.style.display="block",e.textContent=n,n==="Tsel"?(t.appendChild(N("1 Bulan",()=>A("harga.td"))),t.appendChild(N("Jawa Timur",()=>A("harga.jtm"))),t.appendChild(N("Jawa Tengah",()=>A("harga.jtg"))),t.appendChild(N("Jawa Barat",()=>A("harga.jbr")))):n==="Isat"?(t.appendChild(N("Freedom Internet",()=>A("harga.if"))),t.appendChild(N("Freedom Unlimited",()=>A("harga.iu"))),t.appendChild(N("Freedom Mini",()=>A("harga.im")))):n==="XL"?(t.appendChild(N("Xtra Combo Flex",()=>A("harga.xcf"))),t.appendChild(N("XL Mini",()=>A("harga.xm")))):n==="Axis"?(t.appendChild(N("1 Bulan",()=>A("harga.bro"))),t.appendChild(N("Axis Mini",()=>A("harga.am")))):n==="Tri"?(t.appendChild(N("AON",()=>A("harga.aon"))),t.appendChild(N("Happy",()=>A("harga.hap")))):n==="Smar"&&(t.appendChild(N("Unlimited Harian",()=>A("harga.suh"))),t.appendChild(N("Smartfren Unlimited",()=>A("harga.sun"))),t.appendChild(N("Smartfren Mini",()=>A("harga.sd"))))}var bo=k(()=>{x();$();oe()});function So(t,e,n){if(G(!1),!n||n==="Unknown"){S("Nomor Tujuan Tidak Dikenali untuk Paket Nelpon");return}t.style.display="block",e.textContent=n,n==="Tsel"?t.appendChild(N("Telkomsel Nelpon",()=>A("harga.tn"))):n==="Isat"?t.appendChild(N("Indosat Nelpon",()=>A("harga.in"))):n==="XL"?t.appendChild(N("XL Nelpon",()=>A("harga.xn"))):n==="Axis"?t.appendChild(N("Axis Nelpon",()=>A("harga.an"))):n==="Tri"&&t.appendChild(N("Tri Nelpon",()=>A("harga.trn")))}var wo=k(()=>{x();$();oe()});function Co(t,e,n){G(!1),t.style.display="block",e.textContent=n,t.appendChild(N("Cek Nama Pemilik",()=>A("cektoken."+yd.value))),t.appendChild(N("Beli Token Listrik",()=>A(ie("p"))))}var yd,ko=k(()=>{x();$();oe();yd=document.getElementById("inputTujuan")});function Ro(t,e){if(console.log(e),!e||e==="Unknown"){S("Nomor Tujuan Tidak Dikenali untuk Nominal Bebas");return}G(!0);let n=document.createElement("div");n.className="wrapper-input";let i=document.createElement("div");i.className="row-input";let s=document.createElement("select");s.className="select-provider",["--Pilih--","Telkomsel","Dana","Gopay","ShopeePay"].forEach(f=>{if(f==="Telkomsel"&&e.toLowerCase()!=="tsel")return;let p=document.createElement("option");p.value=f==="--Pilih--"?"":f,p.textContent=f,s.appendChild(p)});let o=document.createElement("div");o.className="input-nominal-wrapper";let a=document.createElement("span");a.textContent="Rp";let l=document.createElement("input");l.type="text",l.placeholder="Masukkan nominal",l.className="input-nominal",l.inputMode="numeric",l.pattern="[0-9]*",l.autocomplete="off",l.style.padding="0 0 0 0.5rem",l.style.margin="0 -0.5rem 0 0",l.disabled=!0;let c=document.createElement("div");c.style.color="red",c.style.fontSize="12px",c.style.margin="4px 0",c.style.display="none";let d=document.createElement("div");d.className="nama-pemilik",d.textContent="\u2013",d.style.display="none";let u=document.createElement("button");u.textContent="Kirim",u.className="btn-kirim",u.disabled=!0;function h(){u.disabled=!s.value||!l.value||c.style.display==="block"}s.addEventListener("change",()=>{if(!s.value){l.disabled=!0,l.value="",c.style.display="none",u.disabled=!0,d.style.display="none";return}l.disabled=!1;let f="";s.value==="Dana"&&(f="d."),s.value==="Gopay"&&(f="gp."),s.value==="ShopeePay"&&(f="sp."),f&&A(f+Cn.value)}),l.addEventListener("input",()=>{let f=l.value.replace(/[^\d]/g,"");if(!f){l.value="",c.style.display="none",h();return}l.value=new Intl.NumberFormat("id-ID").format(f);let p=parseInt(f,10);s.value==="Telkomsel"?p<2e3||p>2e5?(c.textContent="Nominal Telkomsel minimal 2.000 dan maksimal 200.000",c.style.display="block"):p%1e3!==0?(c.textContent="Nominal Telkomsel hanya boleh kelipatan 1.000",c.style.display="block"):c.style.display="none":(s.value==="Dana"||s.value==="Gopay"||s.value==="ShopeePay")&&(p<1e4||p>1e6)?(c.textContent="Nominal minimal 10.000 dan maksimal 1.000.000",c.style.display="block"):c.style.display="none",h()}),u.addEventListener("click",()=>{if(!s.value){s.focus(),S("Pilih provider/dompet terlebih dahulu","error");return}if(!l.value){l.focus(),S("Masukkan nominal terlebih dahulu","error");return}if(!Cn.value){Cn.focus(),S("Masukkan nomor tujuan terlebih dahulu","error");return}let f=parseInt(l.value.replace(/\./g,""),10),p=s.value,g=0,m=localStorage.getItem("tipe_akun");m==="SP"?s.value==="Telkomsel"?g=f+850:s.value==="Dana"?g=f+150:s.value==="Gopay"?g=f+550:s.value==="ShopeePay"&&(g=f+600):s.value==="Telkomsel"?g=f+1e3:(s.value==="Dana"||s.value==="Gopay"||s.value==="ShopeePay")&&(g=f+1250);let v=Cn.value,E=`
    <table class="detail-table-laporan-modal">
        <tr><td>Provider</td><td>${p} Rp${new Intl.NumberFormat("id-ID").format(f)}</td></tr>
        <tr><td>Harga Modal</td><td>Rp${new Intl.NumberFormat("id-ID").format(g)}</td></tr>
        <tr><td>Nomor Tujuan</td><td>${v}</td></tr>
    </table>
    <div style="font-weight:bold; color:red; text-align:center;">
        Pastikan Saldo Anda Mencukupi!
    </div>`;wn("KONFIRMASI TRANSAKSI",E,()=>{if(G(!1),s.value==="Telkomsel"){let y=Math.floor(f/1e3);m==="SP"?A(`kirim.xtelkomsel.${v}.${y}`):A(`kirim.telkomsel.${v}.${y}`)}else s.value==="Dana"?A(`kirim.dana.${v}.${f}`):s.value==="ShopeePay"?A(`kirim.shopee.${v}.${f}`):s.value==="Gopay"&&A(`kirim.gopay.${v}.${f}`)},()=>{S("Transaksi dibatalkan","error")})}),i.appendChild(s),i.appendChild(o),o.appendChild(a),o.appendChild(l),n.appendChild(i),n.appendChild(c),n.appendChild(d),n.appendChild(u),t.appendChild(n),window.addEventListener("updateNamaDompet",f=>{let{nama:p}=f.detail;s.value&&(d.textContent=`${p}`,d.style.display="block",d.style.background=getComputedStyle(document.documentElement).getPropertyValue("--flash-color"),setTimeout(()=>{d.style.background="var(--bg-color)"},1e3))})}var Cn,Mo=k(()=>{oe();x();$();ke();Cn=document.getElementById("inputTujuan")});function Po(t,e,n){G(!1),t.style.display="block",e.textContent=n,t.appendChild(N("Dana",()=>A("harga.d"))),t.appendChild(N("Shopee Pay",()=>A("harga.sp"))),t.appendChild(N("Gopay",()=>A("harga.gp"))),t.appendChild(N("Ovo",()=>A("harga.o"))),t.appendChild(N("Grab",()=>A("harga.gr"))),t.appendChild(N("LinkAja",()=>A("harga.la"))),t.appendChild(N("Mandiri E-Money",()=>A("harga.em"))),t.appendChild(N("BNI TapCash",()=>A("harga.bnitap"))),t.appendChild(N("BRI Bizzi",()=>A("harga.brizzi"))),t.appendChild(N("Maxim",()=>A("harga.max")))}var Lo=k(()=>{x();$();oe()});function Do(t,e,n){G(!1),t.style.display="block",e.textContent=n,t.appendChild(N("Free Fire",()=>A("harga.ff"))),t.appendChild(N("Mobile Legends",()=>A("harga.ml"))),t.appendChild(N("PUBG Mobile",()=>A("harga.pm"))),t.appendChild(N("Point Blank",()=>A("harga.pb")))}var Bo=k(()=>{oe();x();$()});function xo(t,e,n){G(!1),t.style.display="block",e.textContent=n,t.appendChild(N("Nex Parabola",()=>A("harga.nex"))),t.appendChild(N("K-Vision",()=>A("harga.kv"))),t.appendChild(N("Jawara Vision",()=>A("harga.mnc")))}var Mm,Oo=k(()=>{x();$();oe();Mm=document.getElementById("inputTujuan")});function Ko(t,e,n){G(!1),t.style.display="block",e.textContent=n,t.appendChild(N("Cek Tagihan Listrik",()=>A("cpln."+Ed.value)))}var Ed,Fo=k(()=>{oe();x();$();Ed=document.getElementById("inputTujuan")});function Go(t,e,n){G(!1),t.style.display="block",e.textContent=n;let i=N("Cek Tagihan PDAM",()=>{let s=document.createElement("input");s.id="pencarian",s.type="text",s.placeholder="Cari kota PDAM...";let r=document.createElement("div");r.id="daftarKota";let o="";function a(h=""){r.innerHTML="";let f=document.documentElement.getAttribute("data-theme")||"light",p=f==="dark"?"#3a3a3a":"#fff",g=f==="dark"?"#2563eb33":"#e6f0ff",m="var(--modal-text)",v="var(--modal-border)";Object.keys(He).filter(E=>E.toLowerCase().includes(h.toLowerCase())).forEach(E=>{let y=document.createElement("button");y.textContent=E,y.style.padding="0.5rem",y.style.borderRadius="8px",y.style.border=o===E?"2px solid #2563eb":`1px solid ${v}`,y.style.background=o===E?g:p,y.style.color=m,y.style.cursor="pointer",y.style.transition="all 0.2s ease",y.onmouseenter=()=>y.style.background=f==="dark"?"#444":"#f1f1f1",y.onmouseleave=()=>y.style.background=o===E?g:p,y.onclick=()=>{o=E,a(h),u()},r.appendChild(y)})}s.addEventListener("input",h=>a(h.target.value)),a();let l=document.createElement("div");l.appendChild(s),l.appendChild(r),H({title:"Pilih Kota",message:"",buttons:[{text:"OK",className:"modal-ok",disabled:!0,onClick:()=>{if(!o){S("Silakan pilih salah satu PDAM dulu","error");return}let h=He[o];A(`cpam${h}.${Ho.value}`)}},{text:"Cancel",className:"modal-cancel",onClick:()=>{}}]});let c=document.getElementById("modalMessage");c.innerHTML="",c.appendChild(l);let d=document.querySelector("#modalButtons .modal-ok");function u(){d&&(d.disabled=!o,d.style.opacity=o?"1":"0.6",d.style.cursor=o?"pointer":"not-allowed",o&&(d.onclick=()=>{let h=He[o];A(`cpam${h}.${Ho.value}`),document.getElementById("modalOverlay").style.display="none"}))}});t.appendChild(i)}var He,Ho,Li=k(()=>{oe();x();ke();$();He={"PDAM Banjarmasin":"BJMSN","PDAM Kota Bekasi":"BKS","PDAM Buleleng":"BLLG","PDAM Kota Bontang":"BONTG","PDAM Batang":"BTNG","PDAM Deliserdang":"DLSRD","PDAM Gresik":"GRSK","PDAM Jember":"JBR","PDAM Jepara":"JPR","PDAM Kota Cirebon":"KCRBN","PDAM Kendal":"KDL","PDAM Kota Gorontalo":"KGRTLO","PDAM Indramayu":"KIDR","PDAM Kota Madiun":"KMDUN","PDAM Lumajang":"LMJG","PDAM Kota Medan":"MDN","PDAM Kab Mojokerto":"MJK","PDAM Majalengka":"MJLK","PDAM Ngawi":"NGWI","PDAM Jakarta":"PALJ","PDAM Kota Palembang":"PLMBG","PDAM Kota Pontianak":"PTNK","PDAM Kota Surabaya":"SBY","PDAM Kutai Kartanegara":"KUTKRT","PDAM Sidoarjo":"SDRJ"},Ho=document.getElementById("inputTujuan")});function Uo(t,e,n){G(!1),t.style.display="block",e.textContent=n,t.appendChild(N("Cek Tagihan BPJS Kesehatan",()=>A("cbpjsks."+Td.value)))}var Td,$o=k(()=>{oe();x();$();Td=document.getElementById("inputTujuan")});function Wo(t,e,n){G(!1),t.style.display="block",e.textContent=n,t.appendChild(N("Cek Tagihan Indihome",()=>A("cindihome."+vd.value)))}var vd,jo=k(()=>{oe();x();$();vd=document.getElementById("inputTujuan")});function Vo(t,e,n){G(!1),t.style.display="block",e.textContent=n,t.appendChild(N("Cek Tagihan Telkom Telpon Rumah",()=>A("ctelkom."+Nd.value)))}var Nd,Jo=k(()=>{oe();x();$();Nd=document.getElementById("inputTujuan")});function zo(){let t=[{name:"Pulsa",emoji:"\u{1F4F1}"},{name:"Paket Data",emoji:"\u{1F310}"},{name:"Paket Nelpon & SMS",emoji:"\u{1F4DE}"},{name:"Token Listrik",emoji:"\u26A1"},{name:"Nominal Bebas",emoji:"\u270D\uFE0F"},{name:"Dompet Digital",emoji:"\u{1F4B3}"},{name:"Games",emoji:"\u{1F3AE}"},{name:"Paket TV",emoji:"\u{1F4FA}"},{name:"Bayar Listrik",emoji:"\u{1F4A1}"},{name:"Bayar PDAM",emoji:"\u{1F4A7}"},{name:"Bayar BPJS",emoji:"\u{1F3E5}"},{name:"Bayar IndiHome",emoji:"\u{1F4E1}"},{name:"Bayar Telkom",emoji:"\u260E\uFE0F"}];Di&&(Di.innerHTML="",t.forEach(e=>{let n=document.createElement("div");n.className="menu-item",n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="center",n.style.cursor="pointer";let i=document.createElement("span");i.textContent=e.emoji,i.style.fontSize="2rem",i.style.marginBottom="0.5rem";let s=document.createElement("p");s.textContent=e.name,s.style.margin="0",n.appendChild(i),n.appendChild(s),Di.appendChild(n),n.addEventListener("click",()=>bd(e))}))}function bd(t){if(Io(t.name),!_e.value.trim()){S("Masukkan nomor tujuan terlebih dahulu","error"),_e.focus();return}ne.innerHTML="";let e=te.textContent;t.name==="Pulsa"?To(ne,te,e):t.name==="Paket Data"?No(ne,te,e):t.name==="Paket Nelpon & SMS"?So(ne,te,e):t.name==="Token Listrik"?Co(ne,te,e):t.name==="Nominal Bebas"?Ro(ne,e):t.name==="Dompet Digital"?Po(ne,te,e):t.name==="Games"?Do(ne,te,e):t.name==="Paket TV"?xo(ne,te,e):t.name==="Bayar Listrik"?Ko(ne,te,e):t.name==="Bayar PDAM"?Go(ne,te,e):t.name==="Bayar BPJS"?Uo(ne,te,e):t.name==="Bayar IndiHome"?Wo(ne,te,e):t.name==="Bayar Telkom"?Vo(ne,te,e):S("Menu belum siap","error");let n=document.getElementById("homeDisplay");n&&n.scrollIntoView({behavior:"smooth",block:"start"})}var Di,Yo,Bi=k(()=>{$();Ao();Eo();x();vo();bo();wo();ko();Mo();Lo();Bo();Oo();Fo();Li();$o();jo();Jo();oe();Di=document.getElementById("menuGrid"),Yo=qe(t=>{yo(t)})});function Xo(t,e,n){window.laporanTerbuka=!0,e.innerHTML="";let i=document.createElement("div");i.style.display="flex",i.style.flexDirection="column",i.style.alignItems="center",i.style.marginBottom="0.5rem";let s=document.createElement("div");s.textContent="Laporan Transaksi",s.style.fontWeight="bold",s.style.fontSize="1.1rem",s.style.marginBottom="0.3rem",i.appendChild(s);let r=document.createElement("div");r.style.display="flex",r.style.justifyContent="space-between",r.style.alignItems="center",r.style.width="100%";let o=document.createElement("div");o.className="laporan-tanggal-text",o.style.fontWeight="bold",o.textContent=t;let a=document.createElement("div");a.style.display="flex",a.style.gap="0.3rem",a.style.alignItems="center";let l=document.createElement("button");l.textContent="\u{1F4C5}",l.style.fontSize="1.6rem",l.style.border="none",l.style.background="transparent",l.style.cursor="pointer",l.addEventListener("click",()=>{l.disabled=!0,setTimeout(()=>{l.disabled=!1},3e3);let d=document.createElement("div");d.id="datepickerBackdrop";let u=document.createElement("div");u.id="datepickerModal";let h=document.createElement("input");document.body.appendChild(d),document.body.appendChild(u);function f(){u.remove(),d.remove(),window.datepickerTerbuka=!1}window.datepickerTerbuka=!0,history.pushState({datepicker:!0},null,location.href);let p=new Date,g=p.getFullYear(),m=p.getMonth(),v=p.getDate();flatpickr(h,{defaultDate:p,minDate:new Date(g,m,1),maxDate:new Date(g,m,v),inline:!0,appendTo:u,onChange:function(E){if(!E.length)return;let _=E[0].getDate();window.tanggalSekarang=_,A(`laporan.${_}`),f()}})});let c=document.createElement("button");c.innerHTML="\u{1F504}",c.style.fontSize="1.6rem",c.style.cursor="pointer",c.style.border="none",c.style.background="transparent",c.style.padding="0",c.style.margin="0",c.style.outline="none",c.addEventListener("click",()=>{c.disabled=!0,xi(),setTimeout(()=>{c.disabled=!1},3e3)}),a.appendChild(l),a.appendChild(c),r.appendChild(o),r.appendChild(a),i.appendChild(r),e.appendChild(i)}var qo=k(()=>{kn();$()});var _t,Rn=k(()=>{_t={BRO2:"2 GB + KUOTA LOKAL AKTIF 30 HARI",BRO3:"3 GB + KUOTA LOKAL AKTIF 30 HARI",BRO5:"5 GB + KUOTA LOKAL AKTIF 30 HARI",BRO6:"6 GB + KUOTA LOKAL AKTIF 30 HARI",BRO8:"8 GB + KUOTA LOKAL AKTIF 30 HARI",BRO14:"14 GB + KUOTA LOKAL AKTIF 30 HARI",BRO20:"20 GB + KUOTA LOKAL AKTIF 30 HARI",TD50:"50 MB AKTIF 3 HARI",TD100:"100 MB AKTIF 3 HARI",TD250:"250 MB AKTIF 3 HARI",TD500:"500 MB AKTIF 7 HARI",TD750:"750 MB AKTIF 7 HARI",TD1:"1 GB AKTIF 30 HARI",TD2:"2 GB AKTIF 30 HARI",TD3:"3 GB AKTIF 30 HARI",TD4:"4 GB AKTIF 30 HARI",TD5P:"5 GB AKTIF 30 HARI PROMO",TD8:"8 GB AKTIF 30 HARI",TD10P:"10 GB AKTIF 30 HARI PROMO",TD15P:"15 GB AKTIF 30 HARI PROMO",TD28P:"28 GB AKTIF 30 HARI PROMO",TD75P:"75 GB AKTIF 30 HARI PROMO",TD100P:"100 GB AKTIF 30 HARI PROMO",JTM153:"1,5 GB AKTIF 3 HARI",JTM255:"2,5 GB AKTIF 5 HARI",JTM35:"3 GB AKTIF 5 HARI",JTM455:"4,5 GB AKTIF 5 HARI",JTM555:"5,5 GB AKTIF 5 HARI",JTM357:"3,5 GB AKTIF 7 HARI",JTM430:"4 GB AKTIF 30 HARI",JTM730:"7 GB AKTIF 30 HARI",JTM1030:"10 GB AKTIF 30 HARI",JTM1430:"14 GB AKTIF 30 HARI",JTM2030:"20 GB AKTIF 30 HARI",JBR153:"1,5 GB AKTIF 3 HARI",JBR23:"2 GB AKTIF 3 HARI",JBR33:"3 GB AKTIF 3 HARI",JBR255:"2,5 GB AKTIF 5 HARI",JBR35:"3 GB AKTIF 5 HARI",JBR455:"4,5 GB AKTIF 5 HARI",JBR555:"5,5 GB AKTIF 5 HARI",JBR357:"3,5 GB AKTIF 7 HARI",JBR230:"2 GB AKTIF 30 HARI",JBR57:"5 GB AKTIF 7 HARI",JBR430:"4 GB AKTIF 30 HARI",JBR730:"7 GB AKTIF 30 HARI",JTG35:"3,5 GB AKTIF 5 HARI",XCF1:"3,5 GB NASIONAL + KUOTA LOKAL AKTIF 21 HARI",XCF1A:"3,5 GB NASIONAL + KUOTA LOKAL AKTIF 28 HARI",XCF1B:"5 GB NASIONAL + KUOTA LOKAL AKTIF 28 HARI",XCF1S:"7 GB NASIONAL + KUOTA LOKAL AKTIF 28 HARI",XCF2:"10 GB NASIONAL + KUOTA LOKAL AKTIF 28 HARI",XCF2S:"14 GB NASIONAL + KUOTA LOKAL AKTIF 28 HARI",XCF3:"17 GB NASIONAL + KUOTA LOKAL AKTIF 28 HARI",XCF3S:"23 GB NASIONAL + KUOTA LOKAL AKTIF 28 HARI",XCF4:"32 GB NASIONAL + KUOTA LOKAL AKTIF 28 HARI",XCF5:"55 GB NASIONAL + KUOTA LOKAL AKTIF 28 HARI",XCF6:"120 GB NASIONAL + KUOTA LOKAL AKTIF 28 HARI",XM12:"XL 1 GB AKTIF 2 HARI",XM3S:"XL 1,5 GB SAMPAI 2,5 GB AKTIF 3 HARI",XM3M:"XL 2,5 GB SAMPAI 4 GB AKTIF 3 HARI",XM3L:"XL 4,5 GB SAMPAI 6,5 GB AKTIF 3 HARI",XM5S:"XL 2 GB SAMPAI 3,5 GB AKTIF 5 HARI",XM5M:"XL 3 GB SAMPAI 5 GB AKTIF 5 HARI",XM5L:"XL 5,5 GB SAMPAI 8,5 GB AKTIF 5 HARI",XM5007:"XL 500 MB AKTIF 7 HARI",XM7XS:"XL 2 GB SAMPAI 3 GB AKTIF 7 HARI",XM7S:"XL 3 GB SAMPAI 4,5 GB AKTIF 7 HARI",XM7M:"XL 4,5 GB SAMPAI 7,5 GB AKTIF 7 HARI",XM7L:"XL 6,5 GB SAMPAI 11,5 GB AKTIF 7 HARI",XM7XL:"XL 11 GB SAMPAI 20 GB AKTIF 7 HARI",XM10XS:"XL 1,5 GB SAMPAI 5 GB AKTIF 10 HARI",XM10S:"XL 2,5 GB SAMPAI 6,5 GB AKTIF 10 HARI",XM10M:"XL 3,5 GB SAMPAI 9 GB AKTIF 10 HARI",AM151:"1,5 GB + KUOTA LOKAL AKTIF 1 HARI",AM251:"2,5 GB + KUOTA LOKAL AKTIF 1 HARI",AM252:"2,5 GB + KUOTA LOKAL AKTIF 2 HARI",AM23:"2 GB + KUOTA LOKAL AKTIF 3 HARI",AM253:"2,5 GB + KUOTA LOKAL AKTIF 3 HARI",AM33:"3 GB + KUOTA LOKAL AKTIF 3 HARI",AM453:"4,5 GB + KUOTA LOKAL AKTIF 3 HARI",AM93:"9 GB + KUOTA LOKAL AKTIF 3 HARI",AM25:"2 GB + KUOTA LOKAL AKTIF 5 HARI",AM255J:"2,5 GB + KUOTA LOKAL UNTUK JAWA BALI NUSRA AKTIF 5 HARI",AM255S:"2,5 GB + KUOTA LOKAL UNTUK KALISUMAPA AKTIF 5 HARI",AM35:"3 GB + KUOTA LOKAL AKTIF 5 HARI",AM45:"4 GB + KUOTA LOKAL AKTIF 5 HARI",AM755:"7,5 GB + KUOTA LOKAL AKTIF 5 HARI",AM155X:"15 GB + KUOTA LOKAL AKTIF 5 HARI",AM157:"1,5 GB + KUOTA LOKAL AKTIF 7 HARI",AM77:"7 GB + KUOTA LOKAL AKTIF 7 HARI",AM857:"8,5 GB + KUOTA LOKAL AKTIF 7 HARI",AM117:"11 GB + KUOTA LOKAL AKTIF 7 HARI",AM207:"20 GB + KUOTA LOKAL AKTIF 7 HARI",AM515:"5 GB + KUOTA LOKAL AKTIF 15 HARI",AM11515:"11,5 GB + KUOTA LOKAL AKTIF 15 HARI",AM3015:"30 GB + KUOTA LOKAL AKTIF 15 HARI",IU1000:"1 GB + 2 GB APPS AKTIF 6 HARI",IU1:"1 GB + 4,5 GB APPS AKTIF 30 HARI",IU2:"2 GB + 8 GB APPS AKTIF 30 HARI",IU3:"3 GB + 17 GB APPS AKTIF 30 HARI",IU7:"7 GB + 28 GB APPS AKTIF 30 HARI",IU10:"10 GB + 35 GB APPS AKTIF 30 HARI",IF1:"1 GB AKTIF 28 HARI [NOMOR HARUS AKTIF]",IF2:"2 GB AKTIF 28 HARI [NOMOR HARUS AKTIF]",IF3:"3 GB + 1 GB (KOTA TERTENTU) AKTIF 14 HARI",IF6:"6 GB + 2 GB (KOTA TERTENTU) AKTIF 30 HARI",IF65:"6,5 GB AKTIF 28 HARI",IF7:"7 GB AKTIF 28 HARI",IF9:"9 GB AKTIF 28 HARI",IF13:"13 GB AKTIF 28 HARI",IF14:"14 GB AKTIF 38 HARI",IF16:"16 GB AKTIF 28 HARI",IF18:"18 GB AKTIF 28 HARI",IF20:"20 GB AKTIF 28 HARI",IF25:"25 GB AKTIF 28 HARI",IF30:"30 GB AKTIF 28 HARI",IF42:"42 GB AKTIF 28 HARI",IF50:"50 GB AKTIF 28 HARI",IF100:"100 GB AKTIF 28 HARI",IM151:"1,5 GB AKTIF 1 HARI",IM31:"3 GB AKTIF 1 HARI",IM61:"6 GB AKTIF 1 HARI",IM12:"1 GB AKTIF 2 HARI [NO HARUS AKTIF]",IM52:"5 GB AKTIF 2 HARI",IM33:"3 GB AKTIF 3 HARI",IM53:"5 GB AKTIF 3 HARI",IM255:"2,5 GB AKTIF 5 HARI",IM355:"3,5 GB AKTIF 5 HARI",IM55:"5 GB AKTIF 5 HARI",IM155:"15 GB AKTIF 5 HARI",IM17:"1 GB AKTIF 7 HARI",IM47:"4 GB AKTIF 7 HARI",IM77:"7 GB AKTIF 7 HARI",IM157:"15 GB AKTIF 7 HARI",SD1130:"3 GB KUOTA UTAMA + 3 GB CHAT + 5 GB MALAM AKTIF 30 HARI",SD2230:"6 GB KUOTA UTAMA + 6 GB CHAT + 10 GB MALAM AKTIF 30 HARI",SUH11:"UNLIMITED DAPAT 1 GB TIAP HARI AKTIF 1 HARI",SUH13:"UNLIMITED DAPAT 1 GB TIAP HARI AKTIF 3 HARI",SUH17:"DAPAT 1 GB TIAP HARI SELAMA 7 HARI",SUH114:"DAPAT 1 GB TIAP HARI SELAMA 14 HARI",SUH700:"DAPAT 700 MB TIAP HARI SELAMA 28 HARI",SUH228:"DAPAT 2 GB TIAP HARI SELAMA 28 HARI",SUH328:"DAPAT 3 GB TIAP HARI SELAMA 28 HARI",SUN2:"UNLIMITED 2 GB AKTIF 10 HARI",SUN3:"UNLIMITED 3 GB + KUOTA LOKAL AKTIF 14 HARI",SUN6:"UNLIMITED 6 GB + KUOTA LOKAL AKTIF 30 HARI",SUN12:"UNLIMITED 12 GB AKTIF 30 HARI",SUN30:"UNLIMITED 30 GB AKTIF 30 HARI",SUN45:"UNLIMITED 45 GB AKTIF 30 HARI",SUN60:"UNLIMITED 60 GB AKTIF 30 HARI",HAP21:"2 GB AKTIF 1 HARI",HAP31:"3 GB AKTIF 1 HARI",HAP52:"5 GB AKTIF 2 HARI",HAP33:"3 GB + KUOTA LOKAL AKTIF 3 HARI",HAP63:"6 GB AKTIF 3 HARI",HAP15:"1 GB AKTIF 5 HARI",HAP455:"4,5 GB + KUOTA LOKAL AKTIF 5 HARI",HAP65:"6 GB + KUOTA LOKAL AKTIF 5 HARI",HAP157:"1,5 GB + KUOTA LOKAL AKTIF 7 HARI",HAP357:"3,5 GB + KUOTA LOKAL AKTIF 7 HARI",HAP77:"7 GB AKTIF 7 HARI",HAP107:"10 GB 7 HARI",HAP157X:"15 GB + KUOTA LOKAL AKTIF 7 HARI",HAP910:"9 GB AKTIF 10 HARI",HAP1010:"10 GB AKTIF 10 HARI",TRI1:"1 GB AKTIF 30 HARI",TRI2:"2 GB AKTIF 30 HARI",TRI3:"3 GB + KUOTA LOKAL AKTIF 28 HARI",TRI4:"4,5 GB + KUOTA LOKAL AKTIF 28 HARI",TRI7:"7 GB + KUOTA LOKAL AKTIF 28 HARI",TRI11:"11 GB + KUOTA LOKAL AKTIF 28 HARI",TRI13:"13 GB + KUOTA LOKAL AKTIF 28 HARI",TRI14:"14 GB + KUOTA LOKAL AKTIF 28 HARI",TRI18:"18 GB + KUOTA LOKAL AKTIF 28 HARI",TRI30:"30 GB + KUOTA LOKAL AKTIF 28 HARI",TRI42:"42 GB + KUOTA LOKAL AKTIF 28 HARI",TRI55:"55 GB + KUOTA LOKAL AKTIF 28 HARI",TRI100:"100 GB + KUOTA LOKAL AKTIF 28 HARI",TRI22:"22 GB + 30 GB YOUTUBE AKTIF 30 HARI",AON25:"AON 2,5 GB",AON35:"AON 3,5 GB",AON4:"AON 4 GB",AON5:"AON 5 GB",AON6:"AON 6 GB",AON9:"AON 9 GB",AON12:"AON 12 GB",AON40:"AON 40 GB",AON6UN:"6 GB (MASA AKTIF IKUT KARTU) + UNL APK PUKUL 01.00 - 17.00 AKTIF 30 HARI",KV1:"CLING 1 BULAN",KV190:"CLING 3 BULAN",KV1180:"CLING 6 BULAN",KV1360:"CLING 12 BULAN",KV2:"JOSS 1 BULAN",KV3:"JOWO 1 BULAN",KV4:"GILA BOLA 1 BULAN",KV5:"SPOTV 1 BULAN",KV6:"BEIN 1 BULAN",KV7:"FILM 1 BULAN",KV8:"OLAHRAGA 1 BULAN",KV9:"JUARA 1 BULAN",KV10:"TIMNAS JUNI",KV11:"LIGA 1 1 BULAN",KV14:"TIMNAS ASEAN CUP BULAN DESEMBER JANUARI",KV15:"HANACARAKA 1 BULAN",KV12:"KVISION PAKET EURO SAMPAI SELESAI",KV13:"KVISION PAKET AFC U23 QATAR",KV20:"KVISION AFC U20",KV17:"TIMNAS U17",NEX1001:"BASIC 30 HARI",NEX1003:"BASIC 90 HARI",NEX1006:"BASIC 180 HARI",NEX1012:"BASIC 360 HARI",NEX1201:"KIDS 30 HARI",NEX1901:"LIGA INDONESIA + CHAMPION 30 HARI",NEX2501:"CHAMPIONS 30 HARI",NEX2701:"LIGA INGGRIS 30 HARI",NEX2901:"DIAMOND 30 HARI",NEX3001:"VOLI 30 HARI",NEX3501:"PREMIUM SPORT 30 HARI",NEX4001:"JAWA 30 HARI",NEX6901:"LIGA INDONESIA 1 BULAN",NEX6903:"LIGA INDONESIA 3 BULAN",NEX9021:"PIALA PRESIDEN",NEX17:"SIARAN BOLA U17",NEX23:"SIARAN BOLA U23",TN5:"60 - 180 MENIT AKTIF 1 HARI",TN10:"200 - 300 MENIT AKTIF 3 HARI",TN20:"400 MENIT AKTIF 7 HARI",TN25:"400 MENIT + 200 SMS AKTIF 7 HARI",TN50:"1100 MENIT AKTIF 30 HARI",TN100:"2500 MENIT AKTIF 30 HARI",IN0:"NELP UNL SESAMA ISAT & TRI + 10 MENIT ALL OPR AKTIF 1 HARI",IN1:"NELP UNL SESAMA ISAT & TRI 30 HARI",IN2:"NELP UNL SESAMA ISAT & TRI + 30 MENIT ALL OPR AKTIF 7 HARI",IN3:"NELP UNL SESAMA ISAT & TRI + 30 MENIT ALL OPR AKTIF 14 HARI",IN4:"NELP UNL SESAMA ISAT & TRI + 60 MENIT ALL OPR AKTIF 30 HARI",IN5:"NELP UNL SESAMA ISAT & TRI + 250 MENIT ALL OPR AKTIF 30 HARI",AN1:"NELPON SEPUASNYA KE SESAMA AXIS AKTIF 14 HARI",AN2:"30 MENIT KE SEMUA OPERATOR AKTIF 7 HARI",AN3:"100 MENIT KE SEMUA OPERATOR AKTIF 30 HARI",XN10:"400 MENIT AKTIF 7 HARI",XN15:"200 MENIT AKTIF 14 HARI",XN35:"500 MENIT AKTIF 30 HARI",XN35S:"200 MENIT + 400 SMS AKTIF 30 HARI",TRN20:"THREE NELPON 20 MENIT AKTIF 7 HARI",TRN60:"THREE NELPON 60 MENIT 30 HARI",TRN150:"THREE NELPON 150 MENIT 30 HARI",TRN120:"THREE NELPON 120 MENIT AON",TRN375:"THREE NELPON 375 AKTIF 7 HARI",ML3:"3 DIAMOND MOBILE LEGENDS",ML5:"5 DIAMOND MOBILE LEGENDS",ML14:"14 DIAMOND MOBILE LEGENDS",ML28:"28 DIAMOND MOBILE LEGENDS",ML42:"42 DIAMOND MOBILE LEGENDS",ML86:"86 DIAMOND MOBILE LEGENDS",ML172:"172 DIAMOND MOBILE LEGENDS",ML257:"257 DIAMOND MOBILE LEGENDS",ML344:"344 DIAMOND MOBILE LEGENDS",ML429:"429 DIAMOND MOBILE LEGENDS",ML514:"514 DIAMOND MOBILE LEGENDS",ML600:"600 DIAMOND MOBILE LEGENDS",ML706:"706 DIAMOND MOBILE LEGENDS",ML878:"878 DIAMOND MOBILE LEGENDS",ML963:"963 DIAMOND MOBILE LEGENDS",ML1050:"1050 DIAMOND MOBILE LEGENDS",ML1220:"1220 DIAMOND MOBILE LEGENDS",ML1412:"1412 DIAMOND MOBILE LEGENDS",ML1669:"1669 DIAMOND MOBILE LEGENDS",ML2195:"2195 DIAMOND MOBILE LEGENDS",FF5:"5 DIAMOND FREE FIRE",FF10:"10 DIAMOND FREE FIRE",FF20:"20 DIAMOND FREE FIRE",FF50:"50 DIAMOND FREE FIRE",FF70:"70 DIAMOND FREE FIRE",FF100:"100 DIAMOND FREE FIRE",FF140:"140 DIAMOND FREE FIRE",FF210:"210 DIAMOND FREE FIRE",FF280:"280 DIAMOND FREE FIRE",FF355:"355 DIAMOND FREE FIRE",FF425:"425 DIAMOND FREE FIRE",FF545:"545 DIAMOND FREE FIRE",FF635:"635 DIAMOND FREE FIRE",FF720:"720 DIAMOND FREE FIRE",FF790:"790 DIAMOND FREE FIRE",FF860:"860 DIAMOND FREE FIRE",FF930:"930 DIAMOND FREE FIRE",FF1000:"1000 DIAMOND FREE FIRE",FF1075:"1075 DIAMOND FREE FIRE",FF1450:"1450 DIAMOND FREE FIRE",FF2000:"2000 DIAMOND FREE FIRE",FF2180:"2180 DIAMOND FREE FIRE",FF3640:"3640 DIAMOND FREE FIRE",CEKTOKEN:"CEK NAMA PEMILIK",CPLN:"CEK TAGIHAN LISTRIK PLN",PLN:"BAYAR TAGIHAN LISTRIK PLN",CINDIHOME:"CEK TAGIHAN INDIHOME",INDIHOME:"BAYAR TAGIHAN INDIHOME",CTELKOM:"CEK TAGIHAN TELKOM",TELKOM:"BAYAR TAGIHAN TELKOM",CPAMBJMSN:"CEK TAGIHAN PDAM BANJARMASIN",CPAMBKS:"CEK TAGIHAN PDAM KOTA BEKASI",CPAMBLLG:"CEK TAGIHAN PDAM BULELENG",CPAMBONTG:"CEK TAGIHAN PDAM KOTA BONTANG",CPAMBTNG:"CEK TAGIHAN PDAM BATANG",CPAMDLSRD:"CEK TAGIHAN PDAM DELISERDANG",CPAMGRSK:"CEK TAGIHAN PDAM GRESIK",CPAMJBR:"CEK TAGIHAN PDAM JEMBER",CPAMJPR:"CEK TAGIHAN PDAM JEPARA",CPAMKCRBN:"CEK TAGIHAN PDAM KOTA CIREBON",CPAMKDL:"CEK TAGIHAN PDAM KENDAL",CPAMKGRTLO:"CEK TAGIHAN PDAM KOTA GORONTALO",CPAMKIDR:"CEK TAGIHAN PDAM INDRAMAYU",CPAMKMDUN:"CEK TAGIHAN PDAM KOTA MADIUN",CPAMKUTKRT:"CEK TAGIHAN PDAM KUTAI KARTANEGARA",CPAMLMJG:"CEK TAGIHAN PDAM LUMAJANG",CPAMMDN:"CEK TAGIHAN PDAM KOTA MEDAN",CPAMMJK:"CEK TAGIHAN PDAM KAB MOJOKERTO",CPAMMJLK:"CEK TAGIHAN PDAM MAJALENGKA",CPAMNGWI:"CEK TAGIHAN PDAM NGAWI",CPAMPALJ:"CEK TAGIHAN PDAM JAKARTA",CPAMPLMBG:"CEK TAGIHAN PDAM KOTA PALEMBANG",CPAMPTNK:"CEK TAGIHAN PDAM KOTA PONTIANAK",CPAMSBY:"CEK TAGIHAN PDAM KOTA SURABAYA",CPAMSDRJ:"CEK TAGIHAN PDAM SIDOARJO",PAMBJMSN:"BAYAR PDAM BANJARMASIN",PAMBKS:"BAYAR PDAM KOTA BEKASI",PAMBLLG:"BAYAR PDAM BULELENG",PAMBONTG:"BAYAR PDAM BONTANG",PAMBTNG:"BAYAR PDAM BATANG",PAMDLSRD:"BAYAR PDAM PAMDLSRD",PAMGRSK:"BAYAR PDAM GRESIK",PAMJBR:"BAYAR PDAM JEMBER",PAMJPR:"BAYAR PDAM JEPARA",PAMKCRBN:"BAYAR PDAM KOTA CIREBON",PAMKDL:"BAYAR PDAM KENDAL",PAMKGRTLO:"BAYAR PDAM GORONTALO",PAMKIDR:"BAYAR PDAM INDRAMAYU",PAMKMDUN:"BAYAR PDAM KOTA MADIUN",PAMKUTKRT:"BAYAR PDAM KUTAI KARTANEGARA",PAMLMJG:"BAYAR PDAM LUMAJANG",PAMMDN:"BAYAR PDAM KOTA MEDAN",PAMMJK:"BAYAR PDAM KAB MOJOKERTO",PAMMJLK:"BAYAR PDAM MAJALENGKA",PAMNGWI:"BAYAR PDAM NGAWI",PAMPALJ:"BAYAR PDAM JAKARTA",PAMPLMBG:"BAYAR PDAM PALEMBANG",PAMPTNK:"BAYAR PDAM KOTA PONTIANAK",PAMSBY:"BAYAR PDAM SURABAYA",PAMSDRJ:"BAYAR PDAM SIDOARJO"}});async function Qo(t,e,n){try{let i="PRODUK DIGITAL";/^pln/i.test(t.kode)?i="TAGIHAN LISTRIK PLN":/^pam/i.test(t.kode)?i="TAGIHAN PDAM":/^indihome/i.test(t.kode)?i="TAGIHAN INDIHOME":/^(td|jtm|jbr|jtg)/i.test(t.kode)?i="PAKET DATA TELKOMSEL":/^(if|iu|im)/i.test(t.kode)?i="PAKET DATA INDOSAT":/^(xcf|xm)/i.test(t.kode)?i="PAKET DATA XL":/^(bro|am)/i.test(t.kode)?i="PAKET DATA AXIS":/^(hap|tri|aon)/i.test(t.kode)?i="PAKET DATA TRI":/^(sd|suh|sun)/i.test(t.kode)?i="PAKET DATA SMARTFREN":/^kv/i.test(t.kode)?i="PAKET TV KVISION":/^nex/i.test(t.kode)?i="PAKET TV NEX PARABOLA":/^mnc/i.test(t.kode)?i="PAKET TV MNC VISION":/^tn/i.test(t.kode)?i="PAKET NELPON TELKOMSEL":/^in/i.test(t.kode)?i="PAKET NELPON INDOSAT":/^an/i.test(t.kode)?i="PAKET NELPON AXIS":/^xn/i.test(t.kode)?i="PAKET NELPON XL":/^trn/i.test(t.kode)?i="PAKET NELPON TRI":/^ts/i.test(t.kode)?i="PAKET SMS TELKOMSEL":/^is/i.test(t.kode)?i="PAKET SMS INDOSAT":/^tmat/i.test(t.kode)?i="MASA AKTIF TELKOMSEL":/^tmai/i.test(t.kode)?i="MASA AKTIF INDOSAT":/^tmaa/i.test(t.kode)?i="MASA AKTIF AXIS":/^tmax/i.test(t.kode)?i="MASA AKTIF XL":/^tmatri/i.test(t.kode)?i="MASA AKTIF TRI":/^ml/i.test(t.kode)?i="DIAMOND MOBILE LEGENDS":/^ff/i.test(t.kode)?i="DIAMOND FREE FIRE":/^p/i.test(t.kode)?i="TOKEN LISTRIK":/^(tr|trx)/i.test(t.kode)?i="PULSA TRI":/^t/i.test(t.kode)?i="PULSA TELKOMSEL":/^i/i.test(t.kode)?i="PULSA INDOSAT":/^x/i.test(t.kode)?i="PULSA XL":/^a/i.test(t.kode)?i="PULSA AXIS":/^s/i.test(t.kode)&&(i="PULSA SMARTFREN");let s=/^pln/i.test(t.kode)?3e3:0,r=n+s,o=localStorage.getItem("nama_agen")||"",a=18,l=["ID PELANGGAN","NAMA","TARIF/DAYA","JUMLAH KWH","HARGA","ADMIN","TOTAL HARGA"],d=document.createElement("canvas").getContext("2d");d.font=`${a}px monospace`;let u=0;l.forEach(w=>{let X=d.measureText(w).width;X>u&&(u=X)});let h=Math.ceil(u)+10,f=o.length*(a*.6),p=Math.sqrt(f**2+(a*2)**2),g=Math.ceil(p),m=g/2,v=g/2,E=`
<svg xmlns="http://www.w3.org/2000/svg" width="${g}" height="${g}">
  <g transform="rotate(-45, ${m}, ${v})">
    <text x="10" y="${v}" font-size="${a}" font-family="monospace"
          fill="black" fill-opacity="0.12">
      ${o}
    </text>
  </g>
</svg>`,y=encodeURIComponent(E),_=(w,X)=>`
      <div class="kv-row">
        <div class="kv-label">${w}</div>
        <div class="kv-colon">:</div>
        <div class="kv-value">${X??""}</div>
      </div>`,T=w=>`<div class="rp-align"><span class="rp">Rp</span><span class="angka">${Number(w).toLocaleString("id-ID")}</span></div>`,C="";if(i==="TOKEN LISTRIK"){let w=t.sn.split("/"),X=w[0]||"",he=(w[1]||"").trim(),Ae=w[2]&&w[3]?`${w[2]}/${w[3]}`:w[2]||"",le=w[4]||"";C=`
      <div style="display:flex; justify-content:space-between; font-size:${a}px; margin-bottom:6px;">
        <div style="text-align:left;">TGL: ${e}</div>
        <div style="text-align:right;">JAM: ${t.waktu}</div>
      </div>

      <div style="text-align:center; font-weight:bold; font-size:25px; margin-top:6px;">-- STRUK BUKTI PEMBELIAN --</div>
      <div style="text-align:center; font-weight:bold; font-size:25px; margin-bottom:6px;">TOKEN LISTRIK</div>
      <hr style="border:1px solid black; margin:6px 0;">

      ${_("ID PELANGGAN",t.tujuan)}
      ${_("NAMA",he)}
      ${_("TARIF/DAYA",Ae)}
      ${_("JUMLAH KWH",le)}

      <div style="text-align:center; margin-top:8px; font-weight:bold;">---- RINCIAN PEMBAYARAN ----</div>

      ${_("HARGA",T(n))}
      ${_("ADMIN",T(s))}
      ${_("<strong>TOTAL HARGA</strong>",`<strong>${T(r)}</strong>`)}
      <div style="text-align:center; margin:10px 0; font-weight:bold;">-------- KODE TOKEN --------</div>
      <div style="text-align:center; font-size:28px; font-weight:bold; white-space:pre-line; margin-bottom:10px;">${X}</div>
      <hr style="border:1px solid black; margin:8px 0;">

      <div style="text-align:center; font-size:18px;">SIMPANLAH STRUK INI</div>
      <div style="text-align:center; font-size:18px;">SEBAGAI BUKTI PEMBELIAN ANDA</div>
      <div style="text-align:center; font-size:18px;">TERIMA KASIH</div>
      `}else if(i==="TAGIHAN LISTRIK PLN"){let w={};t.sn.split("@").forEach(mt=>{let[Xe,gt]=mt.split("=");Xe&&gt&&(w[Xe.trim()]=gt.trim())});let X=t.tujuan||"-",he=w.NAMA||"-",Ae=w.TD||"-";Ae.includes("/")&&!/va$/i.test(Ae)&&(Ae+="VA");let le=w.PTAG||"-";le.includes("/")&&(le=le.split("/")[0]);let ft={JAN:"JANUARI",FEB:"FEBRUARI",MAR:"MARET",APR:"APRIL",MEI:"MEI",JUN:"JUNI",JUL:"JULI",AGU:"AGUSTUS",SEP:"SEPTEMBER",OKT:"OKTOBER",NOV:"NOVEMBER",DES:"DESEMBER"},pt=le.substring(0,3).toUpperCase(),Fe=ft[pt]||pt,Sn=`20${le.substring(3,5)}`;le=`${Fe} ${Sn}`;let Ye=w.SM||"-",we=parseInt(w.ADM||"0",10),Ce=parseInt(w.DENDA||"0",10),ze=parseInt(w.TTAG||"0",10);C=`
    <div style="display:flex; justify-content:space-between; font-size:${a}px; margin-bottom:6px;">
      <div style="text-align:left;">TGL: ${e}</div>
      <div style="text-align:right;">JAM: ${t.waktu}</div>
    </div>

    <div style="text-align:center; font-weight:bold; font-size:24px; margin-top:6px;">-- STRUK BUKTI PEMBAYARAN --</div>
    <div style="text-align:center; font-weight:bold; font-size:24px; margin-bottom:6px;">TAGIHAN LISTRIK PLN</div>
    <hr style="border:1px solid black; margin:6px 0;">

    ${_("ID PELANGGAN",X)}
    ${_("NAMA",he)}
    ${_("TARIF/DAYA",Ae)}
    ${_("BULAN",le)}
    ${_("STAND METER",Ye)}

    <div style="text-align:center; margin-top:8px; font-weight:bold;">---- RINCIAN PEMBAYARAN ----</div>

    ${_("TAGIHAN",T(n-we-Ce))}
    ${_("ADMIN",T(we))}
    ${_("DENDA",T(Ce))}
    ${_("<strong>TOTAL TAGIHAN</strong>",`<strong>${T(n)}</strong>`)}

    <hr style="border:1px solid black; margin:8px 0;">
    <div style="text-align:center; font-size:18px;">SIMPANLAH STRUK INI</div>
    <div style="text-align:center; font-size:18px;">SEBAGAI BUKTI PEMBAYARAN ANDA</div>
    <div style="text-align:center; font-size:18px;">TERIMA KASIH</div>
  `}else if(i==="TAGIHAN INDIHOME"){let w={};t.sn.split("@").forEach(ze=>{let[mt,Xe]=ze.split("=");mt&&Xe&&(w[mt.trim()]=Xe.trim())});let X=t.tujuan||"-",he=w.NAMA||"-",Ae=w.BILLER||"-",le=w.JBLN||"-",ft=w.PTAG||"",pt=parseInt(w.ADM||"0",10),Fe=parseInt(w.TTAG||"0",10),bn=w.REFF||"-",Sn={JAN:"JANUARI",FEB:"FEBRUARI",MAR:"MARET",APR:"APRIL",MEI:"MEI",JUN:"JUNI",JUL:"JULI",AGU:"AGUSTUS",SEP:"SEPTEMBER",OKT:"OKTOBER",NOV:"NOVEMBER",DES:"DESEMBER"},Ye="-",we="-";if(ft.length>=5){let ze=ft.substring(4,6),mt=ft.substring(0,4),Xe=["JANUARI","FEBRUARI","MARET","APRIL","MEI","JUNI","JULI","AGUSTUS","SEPTEMBER","OKTOBER","NOVEMBER","DESEMBER"],gt=parseInt(ze,10)-1;gt>=0&&gt<12&&(Ye=Xe[gt]),we=mt}let Ce=`${Ye} ${we}`;C=`
  <div style="display:flex; justify-content:space-between; font-size:${a}px; margin-bottom:6px;">
    <div style="text-align:left;">TGL: ${e}</div>
    <div style="text-align:right;">JAM: ${t.waktu}</div>
  </div>

  <div style="text-align:center; font-weight:bold; font-size:24px; margin-top:6px;">-- STRUK BUKTI PEMBAYARAN --</div>
  <div style="text-align:center; font-weight:bold; font-size:24px; margin-bottom:6px;">TAGIHAN INDIHOME</div>
  <hr style="border:1px solid black; margin:6px 0;">

  ${_("ID PELANGGAN",X)}
  ${_("NAMA",he)}
  ${_("BILLER",Ae)}
  ${_("JUMLAH BULAN",le)}
  ${_("BULAN TAGIHAN",Ce)}
  ${_("REFF",bn)}

  <div style="text-align:center; margin-top:8px; font-weight:bold;">---- RINCIAN PEMBAYARAN ----</div>

  ${_("TAGIHAN",T(Fe))}
  ${_("ADMIN",T(n-Fe))}
  ${_("<strong>TOTAL TAGIHAN</strong>",`<strong>${T(n)}</strong>`)}

  <hr style="border:1px solid black; margin:8px 0;">
  <div style="text-align:center; font-size:18px;">SIMPANLAH STRUK INI</div>
  <div style="text-align:center; font-size:18px;">SEBAGAI BUKTI PEMBAYARAN ANDA</div>
  <div style="text-align:center; font-size:18px;">TERIMA KASIH</div>
  `}else if(i==="TAGIHAN PDAM"){let w={};t.sn.split("@").forEach(we=>{let[Ce,ze]=we.split("=");Ce&&ze&&(w[Ce.trim()]=ze.trim())});let X=t.tujuan||"-",he=w.NAMA||"-",Ae=w.JBLN||"-",le=w.PTAG||"",ft=parseInt(w.ADM||"0",10),pt=parseInt(w.TTAG||"0",10),Fe=w.SM||"-";Fe=Fe.split("/")[0].trim();let bn=w.REFF||"-",Sn=["JANUARI","FEBRUARI","MARET","APRIL","MEI","JUNI","JULI","AGUSTUS","SEPTEMBER","OKTOBER","NOVEMBER","DESEMBER"],Ye="-";if(le.length>=6){let we=le.substring(0,4),Ce=parseInt(le.substring(4,6),10)-1;Ye=`${Sn[Ce]} ${we}`}C=`
  <div style="display:flex; justify-content:space-between; font-size:${a}px; margin-bottom:6px;">
    <div style="text-align:left;">TGL: ${e}</div>
    <div style="text-align:right;">JAM: ${t.waktu}</div>
  </div>

  <div style="text-align:center; font-weight:bold; font-size:24px; margin-top:6px;">-- STRUK BUKTI PEMBAYARAN --</div>
  <div style="text-align:center; font-weight:bold; font-size:24px; margin-bottom:6px;">TAGIHAN PDAM</div>
  <hr style="border:1px solid black; margin:6px 0;">

  ${_("ID PELANGGAN",X)}
  ${_("NAMA",he)}
  ${_("JUMLAH BULAN",Ae)}
  ${_("BULAN TAGIHAN",Ye)}
  ${_("STAND METER",Fe)}
  ${_("REFF",bn)}

  <div style="text-align:center; margin-top:8px; font-weight:bold;">---- RINCIAN PEMBAYARAN ----</div>

  ${_("TAGIHAN",T(pt))}
  ${_("ADMIN",T(n-pt))}
  ${_("<strong>TOTAL TAGIHAN</strong>",`<strong>${T(n)}</strong>`)}

  <hr style="border:1px solid black; margin:8px 0;">
  <div style="text-align:center; font-size:18px;">SIMPANLAH STRUK INI</div>
  <div style="text-align:center; font-size:18px;">SEBAGAI BUKTI PEMBAYARAN ANDA</div>
  <div style="text-align:center; font-size:18px;">TERIMA KASIH</div>
  `}else{let w=_t[t.kode]||t.kode,X="NOMINAL";if(/PAKET DATA/i.test(i)&&(X="DESKRIPSI"),/PULSA/i.test(i)){let he=t.kode.match(/(\d+)$/);he&&(w=`PULSA ${(parseInt(he[1],10)*1e3).toLocaleString("id-ID")}`)}C=`
  <div style="display:flex; justify-content:space-between; font-size:${a}px; margin-bottom:6px;">
    <div style="text-align:left;">TGL: ${e}</div>
    <div style="text-align:right;">JAM: ${t.waktu}</div>
  </div>

  <div style="text-align:center; font-weight:bold; font-size:24px; margin:6px 0 0 0;">-- STRUK BUKTI PEMBELIAN --</div>
  <div style="text-align:center; font-weight:bold; font-size:24px; margin-bottom:6px;">${i}</div>
  <hr style="border:1px solid black; margin:6px 0;">

  ${_("NOMOR HP",t.tujuan)}
  ${_(X,w)}
  ${_("SN",t.sn)}

  <div style="text-align:center; margin-top:8px; font-weight:bold;">---- RINCIAN PEMBAYARAN ----</div>

  ${_("HARGA",`Rp ${n.toLocaleString("id-ID")}`)}
  ${_("ADMIN",`Rp ${s.toLocaleString("id-ID")}`)}
  ${_("<strong>TOTAL HARGA</strong>",`<strong>RP ${r.toLocaleString("id-ID")}</strong>`)}

  <hr style="border:1px solid black; margin:8px 0;">
  <div style="text-align:center; font-size:18px;">SIMPANLAH STRUK INI</div>
  <div style="text-align:center; font-size:18px;">SEBAGAI BUKTI PEMBELIAN ANDA</div>
  <div style="text-align:center; font-size:18px;">TERIMA KASIH</div>
  `}let M=document.createElement("div");M.innerHTML=`
      <style>
                /* \u{1F539} Format nilai Rp agar Rp di kiri dan angka rata kanan */
        .rp-align {
          display: flex;
          justify-content: space-between;
          width: 245px; /* atur sesuai lebar kolom kanan */
        }
        .rp {
          text-align: left;
        }
        .angka {
          flex-grow: 1;
          text-align: right;
        }
        .struk { font-family: monospace; font-size:${a}px; width:450px; color:#000; padding:20px; }
        /* grid: [label column] [colon column] [value column] */
        .struk .kv-row { display: grid; grid-template-columns: ${h}px 12px 1fr; column-gap:8px; align-items:start; margin:2px 0; }
        .struk .kv-label { text-align:left; white-space:nowrap; }
        .struk .kv-colon { text-align:left; }
        .struk .kv-value { text-align:left; white-space:pre-wrap; word-break:break-word; }
      </style>

      <div class="struk" style="background: #fff url('data:image/svg+xml,${y}') repeat; background-size: ${g*.6}px ${g*.6}px;">
        ${C}
      </div>
    `,document.body.appendChild(M);let F=await html2canvas(M.querySelector(".struk"),{scale:2,backgroundColor:"#ffffff"});document.body.removeChild(M);let B=F.toDataURL("image/jpeg"),J=await(await fetch(B)).blob(),Z=new File([J],"struk-transaksi.jpeg",{type:"image/jpeg"});navigator.canShare&&navigator.canShare({files:[Z]})?await navigator.share({title:"Struk Transaksi",text:"Berikut struk transaksi Anda",files:[Z]}):navigator.share?await navigator.share({title:"Struk Transaksi",text:`STRUK BUKTI PEMBELIAN
Jenis Produk : ${i}
TGL: ${e} ${t.waktu}
NOMOR : ${t.tujuan}
SN : ${t.sn}
HARGA : Rp${n.toLocaleString("id-ID")}
ADMIN : Rp${s.toLocaleString("id-ID")}
TOTAL : Rp${r.toLocaleString("id-ID")}
SIMPANLAH STRUK INI SEBAGAI BUKTI PEMBELIAN ANDA
TERIMA KASIH`}):S("Gagal Membagikan Struk","error")}catch(i){console.error(i),S("Batal Membagikan Struk","error")}}var Zo=k(()=>{x();Rn()});function ta(t){let e=t+1500,n=500;return Math.ceil(e/n)*n}function na(t,e){if(e===0)return 0;if(ea.hasOwnProperty(t))return ea[t];for(let n of Sd)if(t.startsWith(n)){let i=t.slice(n.length);return/^\d+$/.test(i)?(parseInt(i,10)+3)*1e3:ta(e)}return ta(e)}var ea,Sd,ia=k(()=>{ea={XCF1:24e3,TD2:32e3},Sd=["T","I","A","X","S","TR","B","P","D","SP","GP","O","GR","LA","EM","BNITAP","BRIZZI","MAX"]});async function wd(){Mn=await(await(await(await navigator.bluetooth.requestDevice({filters:[{services:["000018f0-0000-1000-8000-00805f9b34fb"]}]})).gatt.connect()).getPrimaryService("000018f0-0000-1000-8000-00805f9b34fb")).getCharacteristic("00002af1-0000-1000-8000-00805f9b34fb")}async function b(t){Mn||await wd(),Mn&&await Mn.writeValue(t)}async function W(t){let n=new TextEncoder("utf-8").encode(t+`
\r`);await b(n)}function ve(t="-",e=32){return t.repeat(e)+`
`}function It(t,e,n=32){let i=t.length+e.length;if(i>=n)return t+" "+e;let s=n-i;return t+" ".repeat(s)+e}function ae(t,e,n=32){let i=t.padEnd(13," ")+": RP",s=e.toLocaleString("id-ID");return It(i,s,n)}function Cd(t){let e=t.split("-"),n=e.slice(0,3).join("-"),i=e.slice(3).join("-");return[n,i].filter(Boolean).join(`
`)}function Oi(t){if(!t||t==="-")return"-";let e={1:"JANUARI",2:"FEBRUARI",3:"MARET",4:"APRIL",5:"MEI",6:"JUNI",7:"JULI",8:"AGUSTUS",9:"SEPTEMBER",10:"OKTOBER",11:"NOVEMBER",12:"DESEMBER"},n=t.split("/")[0].trim().toUpperCase();if(/^\d{6}$/.test(n)){let c=parseInt(n.substring(0,4),10),d=parseInt(n.substring(4,6),10);return`${e[d]||"-"} ${c}`}let i={JAN:"JANUARI",FEB:"FEBRUARI",MAR:"MARET",APR:"APRIL",MEI:"MEI",JUN:"JUNI",JUL:"JULI",AGU:"AGUSTUS",SEP:"SEPTEMBER",OKT:"OKTOBER",NOV:"NOVEMBER",DES:"DESEMBER"},s=n.substring(0,3),r=n.substring(3),o=parseInt(r,10),a=o<50?2e3+o:1900+o;return`${i[s]||"-"} ${a}`}function $t(t,e,n=32){let i=t.length,s=n-i,r=e.split(" "),o=[],a="";for(let c of r)(a+" "+c).trim().length>s?(o.push(a.trim()),a=c):a+=" "+c;a.trim()&&o.push(a.trim());let l=`${t}${o[0]||""}`;for(let c=1;c<o.length;c++)l+=`
${" ".repeat(i)}${o[c]}`;return l}async function sa(t,e,n){let i=new TextEncoder("utf-8"),s=new Uint8Array([27,33,48]),r=new Uint8Array([27,69,1]),o=new Uint8Array([27,69,0]),a=new Uint8Array([27,33,16]),l=new Uint8Array([27,33,32]),c=new Uint8Array([27,33,0]),d=new Uint8Array([27,97,0]),u=new Uint8Array([27,97,1]),h="PRODUK DIGITAL";/^pln/i.test(t.kode)?h="TAGIHAN LISTRIK PLN":/^pam/i.test(t.kode)?h="PDAM":/^p/i.test(t.kode)?h="TOKEN LISTRIK":/^bpjsks/i.test(t.kode)?h="BPJS KESEHATAN":/^telkom/i.test(t.kode)?h="TELKOM":/^td/i.test(t.kode)?h="PAKET DATA":/^tr/i.test(t.kode)?h="PULSA TRI":/^i/i.test(t.kode)?h="PULSA INDOSAT":/^s/i.test(t.kode)?h="PULSA TFREN":/^x/i.test(t.kode)?h="PULSA XL":/^a/i.test(t.kode)?h="PULSA AXIS":/^t(?!d)/i.test(t.kode)&&(h="PULSA TELKOMSEL");let f=/^pln/i.test(t.kode)?3e3:0,p=n+f,g=localStorage.getItem("nama_agen")||"";try{if(h==="TOKEN LISTRIK"){let m=t.sn.split("/"),v=m[0]||"",E=Cd(v),y=m[1]?.trim()||"",_=m[2]&&m[3]?`${m[2]}/${m[3]}`:"",T=m[4]||"";await W(It(`TGL: ${e}`,`JAM: ${t.waktu}`,32)),await b(u),await b(r),await b(i.encode(`
-- STRUK BUKTI PEMBELIAN --
`)),await b(i.encode(`TOKEN LISTRIK
`)),await b(d),await b(o),await W(`${ve("_",32)}
ID PELANGGAN : ${t.tujuan}
${$t("NAMA         : ",y)}
TARIF/DAYA   : ${_}
JUMLAH KWH   : ${T} KWH`),await b(u),await b(i.encode(`
-- RINCIAN PEMBAYARAN --
`)),await b(d),await W(ae("HARGA",n,32)+`
`+ae("ADMIN",f,32)),await b(r),await W(ae("TOTAL HARGA",p,32)),await b(o),await b(u),await b(i.encode(`
---------- KODE TOKEN ----------

`)),await b(s),await b(i.encode(E+`
`)),await b(c),await W(`${ve("_",32)}
SIMPANLAH STRUK INI
SEBAGAI BUKTI PEMBELIAN ANDA
TERIMA KASIH


`)}else if(h==="TAGIHAN LISTRIK PLN"){let m={};t.sn.split("@").forEach(Z=>{let[w,X]=Z.split("=");w&&X&&(m[w.trim()]=X.trim())});let v=t.tujuan||"-",E=m.NAMA||"-",y=m.TD||"-",_=m.PTAG||"-",T=Oi(_),C=m.JBLN||"-",M=m.SM||"-",F=parseInt(m.ADM||"0",10),B=parseInt(m.DENDA||"0",10),J=parseInt(m.TTAG||"0",10);await W(It(`TGL: ${e}`,`JAM: ${t.waktu}`,32)),await b(u),await b(r),await b(i.encode(`
-- STRUK BUKTI PEMBAYARAN --
TAGIHAN LISTRIK PLN
`)),await b(o),await b(d),await W(`${ve("_",32)}
ID PELANGGAN : ${v}
${$t("NAMA         : ",E)}
TARIF/DAYA   : ${y}VA
BULAN        : ${T}
STAND METER  : ${M}`),await b(u),await b(i.encode(`
-- RINCIAN PEMBAYARAN --
`)),await b(d),await W(ae("TAGIHAN",n-F-B,32)+`
`+ae("ADMIN",F,32)+`
`+ae("DENDA",B,32)),await b(r),await W(ae("TOTAL TAGIHAN",n,32)),await b(o),await b(u),await W(`${ve("_",32)}
SIMPANLAH STRUK INI
SEBAGAI BUKTI PEMBAYARAN ANDA
TERIMA KASIH


`)}else if(h==="BPJS KESEHATAN"){let m={};t.sn.split("@").forEach(B=>{let[J,Z]=B.split("=");J&&Z&&(m[J.trim()]=Z.trim())});let v=t.tujuan||"-",E=m.NAMA||"-",y=m.JBLN||"-",_=m.PS||"-",T=m.CB||"-",C=parseInt(m.ADM||"0",10),M=parseInt(m.TTAG||"0",10),F=m.REFF||"-";await W(It(`TGL: ${e}`,`JAM: ${t.waktu}`,32)),await b(u),await b(r),await b(i.encode(`
-- STRUK BUKTI PEMBAYARAN --
BPJS KESEHATAN
`)),await b(o),await b(d),await W(`${ve("_",32)}
ID PELANGGAN : ${v}
${$t("NAMA         : ",E)}
JUMLAH BULAN : ${y}
PESERTA      : ${_}
CABANG       : ${T}`),await b(u),await b(i.encode(`
-- RINCIAN PEMBAYARAN --
`)),await b(d),await W(ae("TAGIHAN",n-C,32)+`
`+ae("ADMIN",C,32)),await b(r),await W(ae("TOTAL BAYAR",n,32)),await b(o),await b(u),await W(`${ve("_",32)}
SIMPANLAH STRUK INI
SEBAGAI BUKTI PEMBAYARAN ANDA
TERIMA KASIH


`)}else if(h==="PDAM"){let m={};t.sn.split("@").forEach(w=>{let[X,he]=w.split("=");X&&he&&(m[X.trim()]=he.trim())});let E=(_t[t.kode.toUpperCase()]||"PDAM").replace(/^BAYAR\s+PDAM\s*/i,"PDAM "),y=t.tujuan||"-",_=m.NAMA||"-",T=(m.JBLN||"-").replace(/(\d+)\s*BLN/i,"$1 BULAN"),C=m.PTAG||"-",M=Oi(C),F=m.SM||"-",B=parseInt(m.ADM||"0",10),J=parseInt(m.TTAG||"0",10),Z=m.REFF||"-";await W(It(`TGL: ${e}`,`JAM: ${t.waktu}`,32)),await b(u),await b(r),await b(i.encode(`
-- STRUK BUKTI PEMBAYARAN --
${E}
`)),await b(o),await b(d),await W(`${ve("_",32)}
ID PELANGGAN : ${y}
${$t("NAMA         : ",_)}
JUMLAH BULAN : ${T}
PERIODE TAG  : ${M}
STAND METER  : ${F}`),await b(u),await b(i.encode(`
-- RINCIAN PEMBAYARAN --
`)),await b(d),await W(ae("TAGIHAN",n-B,32)+`
`+ae("ADMIN",B,32)),await b(r),await W(ae("TOTAL BAYAR",n,32)),await b(o),await b(u),await W(`${ve("_",32)}
SIMPANLAH STRUK INI
SEBAGAI BUKTI PEMBAYARAN ANDA
TERIMA KASIH


`)}else if(h==="TELKOM"){let m={};t.sn.split("@").forEach(B=>{let[J,Z]=B.split("=");J&&Z&&(m[J.trim()]=Z.trim())});let v=t.tujuan||"-",E=m.NAMA||"-",y=(m.JBLN||"-").replace(/(\d+)\s*BLN?/i,"$1 BULAN"),_=m.PTAG||"-",T=Oi(_),C=parseInt(m.ADM||"0",10),M=parseInt(m.TTAG||"0",10),F=m.REFF||"-";await W(It(`TGL: ${e}`,`JAM: ${t.waktu}`,32)),await b(u),await b(r),await b(i.encode(`
-- STRUK BUKTI PEMBAYARAN --
TELKOM
`)),await b(o),await b(d),await W(`${ve("_",32)}
ID PELANGGAN : ${v}
${$t("NAMA         : ",E)}
JUMLAH BULAN : ${y} BULAN
PERIODE TAG  : ${T}`),await b(u),await b(i.encode(`
-- RINCIAN PEMBAYARAN --
`)),await b(d),await W(ae("TAGIHAN",n-C,32)+`
`+ae("ADMIN",C,32)),await b(r),await W(ae("TOTAL BAYAR",n,32)),await b(o),await b(u),await W(`${ve("_",32)}
SIMPANLAH STRUK INI
SEBAGAI BUKTI PEMBAYARAN ANDA
TERIMA KASIH


`)}else await W(`
${g}
${e} ${t.waktu}
`),await b(u),await b(i.encode(`-- STRUK BUKTI PEMBELIAN --
`)),await b(i.encode(h+`
`)),await b(d),`${t.tujuan}${t.kode}${t.sn}${n.toLocaleString("id-ID")}${f.toLocaleString("id-ID")}${p.toLocaleString("id-ID")}`;S("Struk berhasil dikirim ke printer thermal","success")}catch{S("Batal Print","error")}}var Mn,ra=k(()=>{x();Rn();Mn=null});var oa,aa=k(()=>{oa=()=>{}});function ua(t){return ha(void 0,t)}function ha(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:let n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(let n in e)!e.hasOwnProperty(n)||!Rd(n)||(t[n]=ha(t[n],e[n]));return t}function Rd(t){return t!=="__proto__"}function Md(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}function Bn(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function ma(t){return(await fetch(t,{credentials:"include"})).ok}function ga(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n={alg:"none",type:"JWT"},i=e||"demo-project",s=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o={iss:`https://securetoken.google.com/${i}`,aud:i,iat:s,exp:s+3600,auth_time:s,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}},...t};return[jt(JSON.stringify(n)),jt(JSON.stringify(o)),""].join(".")}function xd(){let t={prod:[],emulator:[]};for(let e of Object.keys(Wt))Wt[e]?t.emulator.push(e):t.prod.push(e);return t}function Od(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}function Aa(t,e){if(typeof window>"u"||typeof document>"u"||!Bn(window.location.host)||Wt[t]===e||Wt[t]||la)return;Wt[t]=e;function n(h){return`__firebase__banner__${h}`}let i="__firebase__banner",r=xd().prod.length>0;function o(){let h=document.getElementById(i);h&&h.remove()}function a(h){h.style.display="flex",h.style.background="#7faaf0",h.style.position="fixed",h.style.bottom="5px",h.style.left="5px",h.style.padding=".5em",h.style.borderRadius="5px",h.style.alignItems="center"}function l(h,f){h.setAttribute("width","24"),h.setAttribute("id",f),h.setAttribute("height","24"),h.setAttribute("viewBox","0 0 24 24"),h.setAttribute("fill","none"),h.style.marginLeft="-6px"}function c(){let h=document.createElement("span");return h.style.cursor="pointer",h.style.marginLeft="16px",h.style.fontSize="24px",h.innerHTML=" &times;",h.onclick=()=>{la=!0,o()},h}function d(h,f){h.setAttribute("id",f),h.innerText="Learn more",h.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",h.setAttribute("target","__blank"),h.style.paddingLeft="5px",h.style.textDecoration="underline"}function u(){let h=Od(i),f=n("text"),p=document.getElementById(f)||document.createElement("span"),g=n("learnmore"),m=document.getElementById(g)||document.createElement("a"),v=n("preprendIcon"),E=document.getElementById(v)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(h.created){let y=h.element;a(y),d(m,g);let _=c();l(E,v),y.append(E,p,m,_),document.body.appendChild(y)}r?(p.innerText="Preview backend disconnected.",E.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(E.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,p.innerText="Preview backend running in this workspace."),p.setAttribute("id",f)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",u):u()}function Kd(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Ui(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Kd())}function _a(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Ne(){return Ki.NODE_CLIENT===!0||Ki.NODE_ADMIN===!0}function Ia(){try{return typeof indexedDB=="object"}catch{return!1}}function ya(){return new Promise((t,e)=>{try{let n=!0,i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(n){e(n)}})}function Hd(t,e){return t.replace(Gd,(n,i)=>{let s=e[i];return s!=null?String(s):`<${i}?>`})}function yt(t){return JSON.parse(t)}function Q(t){return JSON.stringify(t)}function Ie(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function et(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function $i(t){for(let e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Jt(t,e,n){let i={};for(let s in t)Object.prototype.hasOwnProperty.call(t,s)&&(i[s]=e.call(n,t[s],s,t));return i}function Et(t,e){if(t===e)return!0;let n=Object.keys(t),i=Object.keys(e);for(let s of n){if(!i.includes(s))return!1;let r=t[s],o=e[s];if(ca(r)&&ca(o)){if(!Et(r,o))return!1}else if(r!==o)return!1}for(let s of i)if(!n.includes(s))return!1;return!0}function ca(t){return t!==null&&typeof t=="object"}function Na(t){let e=[];for(let[n,i]of Object.entries(t))Array.isArray(i)?i.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function Yt(t,e){return`${t} failed: ${e} argument `}function tt(t){return t&&t._delegate?t._delegate:t}var Ki,I,Ze,da,kd,Dn,Fi,Hi,jt,Pn,Pd,Ld,Dd,fa,Bd,pa,Gi,Re,Wt,la,Fd,Qe,Vt,Gd,Ea,Ta,va,Ln,ba,zt,Pg,Xt=k(()=>{aa();Ki={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};I=function(t,e){if(!t)throw Ze(e)},Ze=function(t){return new Error("Firebase Database ("+Ki.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};da=function(t){let e=[],n=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&i+1<t.length&&(t.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++i)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},kd=function(t){let e=[],n=0,i=0;for(;n<t.length;){let s=t[n++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){let r=t[n++];e[i++]=String.fromCharCode((s&31)<<6|r&63)}else if(s>239&&s<365){let r=t[n++],o=t[n++],a=t[n++],l=((s&7)<<18|(r&63)<<12|(o&63)<<6|a&63)-65536;e[i++]=String.fromCharCode(55296+(l>>10)),e[i++]=String.fromCharCode(56320+(l&1023))}else{let r=t[n++],o=t[n++];e[i++]=String.fromCharCode((s&15)<<12|(r&63)<<6|o&63)}}return e.join("")},Dn={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<t.length;s+=3){let r=t[s],o=s+1<t.length,a=o?t[s+1]:0,l=s+2<t.length,c=l?t[s+2]:0,d=r>>2,u=(r&3)<<4|a>>4,h=(a&15)<<2|c>>6,f=c&63;l||(f=64,o||(h=64)),i.push(n[d],n[u],n[h],n[f])}return i.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(da(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):kd(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();let n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<t.length;){let r=n[t.charAt(s++)],a=s<t.length?n[t.charAt(s)]:0;++s;let c=s<t.length?n[t.charAt(s)]:64;++s;let u=s<t.length?n[t.charAt(s)]:64;if(++s,r==null||a==null||c==null||u==null)throw new Fi;let h=r<<2|a>>4;if(i.push(h),c!==64){let f=a<<4&240|c>>2;if(i.push(f),u!==64){let p=c<<6&192|u;i.push(p)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},Fi=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Hi=function(t){let e=da(t);return Dn.encodeByteArray(e,!0)},jt=function(t){return Hi(t).replace(/\./g,"")},Pn=function(t){try{return Dn.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};Pd=()=>Md().__FIREBASE_DEFAULTS__,Ld=()=>{if(typeof process>"u"||typeof process.env>"u")return;let t=process.env.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},Dd=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=t&&Pn(t[1]);return e&&JSON.parse(e)},fa=()=>{try{return oa()||Pd()||Ld()||Dd()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Bd=t=>fa()?.emulatorHosts?.[t],pa=t=>{let e=Bd(t);if(!e)return;let n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let i=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),i]:[e.substring(0,n),i]},Gi=()=>fa()?.config;Re=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,i)=>{n?this.reject(n):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,i))}}};Wt={};la=!1;Fd="FirebaseError",Qe=class t extends Error{constructor(e,n,i){super(n),this.code=e,this.customData=i,this.name=Fd,Object.setPrototypeOf(this,t.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Vt.prototype.create)}},Vt=class{constructor(e,n,i){this.service=e,this.serviceName=n,this.errors=i}create(e,...n){let i=n[0]||{},s=`${this.service}/${e}`,r=this.errors[e],o=r?Hd(r,i):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new Qe(s,a,i)}};Gd=/\{\$([^}]+)}/g;Ea=function(t){let e={},n={},i={},s="";try{let r=t.split(".");e=yt(Pn(r[0])||""),n=yt(Pn(r[1])||""),s=r[2],i=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:i,signature:s}},Ta=function(t){let e=Ea(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},va=function(t){let e=Ea(t).claims;return typeof e=="object"&&e.admin===!0};Ln=class{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);let i=this.W_;if(typeof e=="string")for(let u=0;u<16;u++)i[u]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let u=0;u<16;u++)i[u]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let u=16;u<80;u++){let h=i[u-3]^i[u-8]^i[u-14]^i[u-16];i[u]=(h<<1|h>>>31)&4294967295}let s=this.chain_[0],r=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],c,d;for(let u=0;u<80;u++){u<40?u<20?(c=a^r&(o^a),d=1518500249):(c=r^o^a,d=1859775393):u<60?(c=r&o|a&(r|o),d=2400959708):(c=r^o^a,d=3395469782);let h=(s<<5|s>>>27)+c+l+d+i[u]&4294967295;l=a,a=o,o=(r<<30|r>>>2)&4294967295,r=s,s=h}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);let i=n-this.blockSize,s=0,r=this.buf_,o=this.inbuf_;for(;s<n;){if(o===0)for(;s<=i;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<n;)if(r[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(r),o=0;break}}else for(;s<n;)if(r[o]=e[s],++o,++s,o===this.blockSize){this.compress_(r),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){let e=[],n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=n&255,n/=256;this.compress_(this.buf_);let i=0;for(let s=0;s<5;s++)for(let r=24;r>=0;r-=8)e[i]=this.chain_[s]>>r&255,++i;return e}};ba=function(t){let e=[],n=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);if(s>=55296&&s<=56319){let r=s-55296;i++,I(i<t.length,"Surrogate pair missing trail surrogate.");let o=t.charCodeAt(i)-56320;s=65536+(r<<10)+o}s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):s<65536?(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},zt=function(t){let e=0;for(let n=0;n<t.length;n++){let i=t.charCodeAt(n);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,n++):e+=3}return e};Pg=14400*1e3;});function Ud(t){return t===nt?void 0:t}function $d(t){return t.instantiationMode==="EAGER"}var Me,nt,xn,qt,Wi=k(()=>{Xt();Me=class{constructor(e,n,i){this.name=e,this.instanceFactory=n,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};nt="[DEFAULT]";xn=class{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){let i=new Re;if(this.instancesDeferred.set(n,i),this.isInitialized(n)||this.shouldAutoInitialize())try{let s=this.getOrInitializeService({instanceIdentifier:n});s&&i.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){let n=this.normalizeInstanceIdentifier(e?.identifier),i=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if($d(e))try{this.getOrInitializeService({instanceIdentifier:nt})}catch{}for(let[n,i]of this.instancesDeferred.entries()){let s=this.normalizeInstanceIdentifier(n);try{let r=this.getOrInitializeService({instanceIdentifier:s});i.resolve(r)}catch{}}}}clearInstance(e=nt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=nt){return this.instances.has(e)}getOptions(e=nt){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:n={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let s=this.getOrInitializeService({instanceIdentifier:i,options:n});for(let[r,o]of this.instancesDeferred.entries()){let a=this.normalizeInstanceIdentifier(r);i===a&&o.resolve(s)}return s}onInit(e,n){let i=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(i)??new Set;s.add(e),this.onInitCallbacks.set(i,s);let r=this.instances.get(i);return r&&e(r,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){let i=this.onInitCallbacks.get(n);if(i)for(let s of i)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:Ud(e),options:n}),this.instances.set(e,i),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=nt){return this.component?this.component.multipleInstances?e:nt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};qt=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let n=new xn(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}});var Wd,U,jd,Vd,Jd,Yd,Tt,ji=k(()=>{Wd=[];(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(U||(U={}));jd={debug:U.DEBUG,verbose:U.VERBOSE,info:U.INFO,warn:U.WARN,error:U.ERROR,silent:U.SILENT},Vd=U.INFO,Jd={[U.DEBUG]:"log",[U.VERBOSE]:"log",[U.INFO]:"info",[U.WARN]:"warn",[U.ERROR]:"error"},Yd=(t,e,...n)=>{if(e<t.logLevel)return;let i=new Date().toISOString(),s=Jd[e];if(s)console[s](`[${i}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},Tt=class{constructor(e){this.name=e,this._logLevel=Vd,this._logHandler=Yd,this._userLogHandler=null,Wd.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in U))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?jd[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,U.DEBUG,...e),this._logHandler(this,U.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,U.VERBOSE,...e),this._logHandler(this,U.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,U.INFO,...e),this._logHandler(this,U.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,U.WARN,...e),this._logHandler(this,U.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,U.ERROR,...e),this._logHandler(this,U.ERROR,...e)}}});function Xd(){return Sa||(Sa=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function qd(){return wa||(wa=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}function Qd(t){let e=new Promise((n,i)=>{let s=()=>{t.removeEventListener("success",r),t.removeEventListener("error",o)},r=()=>{n(be(t.result)),s()},o=()=>{i(t.error),s()};t.addEventListener("success",r),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&Ca.set(n,t)}).catch(()=>{}),zi.set(e,t),e}function Zd(t){if(Ji.has(t))return;let e=new Promise((n,i)=>{let s=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",o),t.removeEventListener("abort",o)},r=()=>{n(),s()},o=()=>{i(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",r),t.addEventListener("error",o),t.addEventListener("abort",o)});Ji.set(t,e)}function Ra(t){Yi=t(Yi)}function eu(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){let i=t.call(On(this),e,...n);return ka.set(i,e.sort?e.sort():[e]),be(i)}:qd().includes(t)?function(...e){return t.apply(On(this),e),be(Ca.get(this))}:function(...e){return be(t.apply(On(this),e))}}function tu(t){return typeof t=="function"?eu(t):(t instanceof IDBTransaction&&Zd(t),zd(t,Xd())?new Proxy(t,Yi):t)}function be(t){if(t instanceof IDBRequest)return Qd(t);if(Vi.has(t))return Vi.get(t);let e=tu(t);return e!==t&&(Vi.set(t,e),zi.set(e,t)),e}var zd,Sa,wa,Ca,Ji,ka,Vi,zi,Yi,On,Xi=k(()=>{zd=(t,e)=>e.some(n=>t instanceof n);Ca=new WeakMap,Ji=new WeakMap,ka=new WeakMap,Vi=new WeakMap,zi=new WeakMap;Yi={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Ji.get(t);if(e==="objectStoreNames")return t.objectStoreNames||ka.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return be(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};On=t=>zi.get(t)});function Pa(t,e,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){let o=indexedDB.open(t,e),a=be(o);return i&&o.addEventListener("upgradeneeded",l=>{i(be(o.result),l.oldVersion,l.newVersion,be(o.transaction),l)}),n&&o.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{r&&l.addEventListener("close",()=>r()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}function Ma(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(qi.get(e))return qi.get(e);let n=e.replace(/FromIndex$/,""),i=e!==n,s=iu.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(s||nu.includes(n)))return;let r=async function(o,...a){let l=this.transaction(o,s?"readwrite":"readonly"),c=l.store;return i&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),s&&l.done]))[0]};return qi.set(e,r),r}var nu,iu,qi,La=k(()=>{Xi();Xi();nu=["get","getKey","getAll","getAllKeys","count"],iu=["put","add","delete","clear"],qi=new Map;Ra(t=>({...t,get:(e,n,i)=>Ma(e,n)||t.get(e,n,i),has:(e,n)=>!!Ma(e,n)||t.has(e,n)}))});function su(t){return t.getComponent()?.type==="VERSION"}function Ba(t,e){try{t.container.addComponent(e)}catch(n){Pe.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Qt(t){let e=t.name;if(ns.has(e))return Pe.debug(`There were multiple attempts to register component ${e}.`),!1;ns.set(e,t);for(let n of Kn.values())Ba(n,t);for(let n of Lu.values())Ba(n,t);return!0}function Fa(t,e){let n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Ha(t){return t==null?!1:t.settings!==void 0}function os(t,e={}){let n=t;typeof e!="object"&&(e={name:e});let i={name:ts,automaticDataCollectionEnabled:!0,...e},s=i.name;if(typeof s!="string"||!s)throw Ge.create("bad-app-name",{appName:String(s)});if(n||(n=Gi()),!n)throw Ge.create("no-options");let r=Kn.get(s);if(r){if(Et(n,r.options)&&Et(i,r.config))return r;throw Ge.create("duplicate-app",{appName:s})}let o=new qt(s);for(let l of ns.values())o.addComponent(l);let a=new is(n,i,o);return Kn.set(s,a),a}function Ua(t=ts){let e=Kn.get(t);if(!e&&t===ts&&Gi())return os();if(!e)throw Ge.create("no-app",{appName:t});return e}function Ue(t,e,n){let i=Pu[t]??t;n&&(i+=`-${n}`);let s=i.match(/\s|\//),r=e.match(/\s|\//);if(s||r){let o=[`Unable to register library "${i}" with version "${e}":`];s&&o.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&r&&o.push("and"),r&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Pe.warn(o.join(" "));return}Qt(new Me(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}function $a(){return Qi||(Qi=Pa(Bu,xu,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Zt)}catch(n){console.warn(n)}}}}).catch(t=>{throw Ge.create("idb-open",{originalErrorMessage:t.message})})),Qi}async function Ou(t){try{let n=(await $a()).transaction(Zt),i=await n.objectStore(Zt).get(Wa(t));return await n.done,i}catch(e){if(e instanceof Qe)Pe.warn(e.message);else{let n=Ge.create("idb-get",{originalErrorMessage:e?.message});Pe.warn(n.message)}}}async function xa(t,e){try{let i=(await $a()).transaction(Zt,"readwrite");await i.objectStore(Zt).put(e,Wa(t)),await i.done}catch(n){if(n instanceof Qe)Pe.warn(n.message);else{let i=Ge.create("idb-set",{originalErrorMessage:n?.message});Pe.warn(i.message)}}}function Wa(t){return`${t.name}!${t.options.appId}`}function Oa(){return new Date().toISOString().substring(0,10)}function Hu(t,e=Ku){let n=[],i=t.slice();for(let s of t){let r=n.find(o=>o.agent===s.agent);if(r){if(r.dates.push(s.date),Ka(n)>e){r.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Ka(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}function Ka(t){return jt(JSON.stringify({version:2,heartbeats:t})).length}function Gu(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let i=1;i<t.length;i++)t[i].date<n&&(n=t[i].date,e=i);return e}function Uu(t){Qt(new Me("platform-logger",e=>new Zi(e),"PRIVATE")),Qt(new Me("heartbeat",e=>new ss(e),"PRIVATE")),Ue(es,Da,t),Ue(es,Da,"esm2020"),Ue("fire-js","")}var Zi,es,Da,Pe,ru,ou,au,lu,cu,du,uu,hu,fu,pu,mu,gu,Au,_u,Iu,yu,Eu,Tu,vu,Nu,bu,Su,wu,Cu,ku,Ru,Mu,ts,Pu,Kn,Lu,ns,Du,Ge,is,Ga,Bu,xu,Zt,Qi,Ku,Fu,ss,rs,Fn=k(()=>{Wi();ji();Xt();Xt();La();Zi=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(su(n)){let i=n.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(n=>n).join(" ")}};es="@firebase/app",Da="0.14.4";Pe=new Tt("@firebase/app"),ru="@firebase/app-compat",ou="@firebase/analytics-compat",au="@firebase/analytics",lu="@firebase/app-check-compat",cu="@firebase/app-check",du="@firebase/auth",uu="@firebase/auth-compat",hu="@firebase/database",fu="@firebase/data-connect",pu="@firebase/database-compat",mu="@firebase/functions",gu="@firebase/functions-compat",Au="@firebase/installations",_u="@firebase/installations-compat",Iu="@firebase/messaging",yu="@firebase/messaging-compat",Eu="@firebase/performance",Tu="@firebase/performance-compat",vu="@firebase/remote-config",Nu="@firebase/remote-config-compat",bu="@firebase/storage",Su="@firebase/storage-compat",wu="@firebase/firestore",Cu="@firebase/ai",ku="@firebase/firestore-compat",Ru="firebase",Mu="12.4.0";ts="[DEFAULT]",Pu={[es]:"fire-core",[ru]:"fire-core-compat",[au]:"fire-analytics",[ou]:"fire-analytics-compat",[cu]:"fire-app-check",[lu]:"fire-app-check-compat",[du]:"fire-auth",[uu]:"fire-auth-compat",[hu]:"fire-rtdb",[fu]:"fire-data-connect",[pu]:"fire-rtdb-compat",[mu]:"fire-fn",[gu]:"fire-fn-compat",[Au]:"fire-iid",[_u]:"fire-iid-compat",[Iu]:"fire-fcm",[yu]:"fire-fcm-compat",[Eu]:"fire-perf",[Tu]:"fire-perf-compat",[vu]:"fire-rc",[Nu]:"fire-rc-compat",[bu]:"fire-gcs",[Su]:"fire-gcs-compat",[wu]:"fire-fst",[ku]:"fire-fst-compat",[Cu]:"fire-vertex","fire-js":"fire-js",[Ru]:"fire-js-all"};Kn=new Map,Lu=new Map,ns=new Map;Du={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ge=new Vt("app","Firebase",Du);is=class{constructor(e,n,i){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Me("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ge.create("app-deleted",{appName:this._name})}};Ga=Mu;Bu="firebase-heartbeat-database",xu=1,Zt="firebase-heartbeat-store",Qi=null;Ku=1024,Fu=30,ss=class{constructor(e){this.container=e,this._heartbeatsCache=null;let n=this.container.getProvider("app").getImmediate();this._storage=new rs(n),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){try{let n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Oa();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(s=>s.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats.length>Fu){let s=Gu(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Pe.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";let e=Oa(),{heartbeatsToSend:n,unsentEntries:i}=Hu(this._heartbeatsCache.heartbeats),s=jt(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return Pe.warn(e),""}}};rs=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ia()?ya().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){let n=await Ou(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){let i=await this.read();return xa(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){let i=await this.read();return xa(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}};Uu("")});var $u,Wu,ja=k(()=>{Fn();Fn();$u="firebase",Wu="12.4.0";Ue($u,Wu,"app")});function ju(t){fr=t}function re(t,e){for(let n in t)t.hasOwnProperty(n)&&e(n,t[n])}function Zu(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");let i=new Error(t+" at "+e._path.toString()+": "+n);return i.code=t.toUpperCase(),i}function sh(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function Fl(t,e,n){I(typeof e=="string","typeof type must == string"),I(typeof n=="object","typeof params must == object");let i;if(e===Ol)i=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===Kl)i=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);sh(t)&&(n.ns=t.namespace);let s=[];return re(n,(r,o)=>{s.push(r+"="+o)}),i+s.join("&")}function gr(t){let e=t.toString();return as[e]||(as[e]=new Es),as[e]}function rh(t,e){let n=t.toString();return ls[n]||(ls[n]=e()),ls[n]}function O(){return new K("")}function P(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Ve(t){return t.pieces_.length-t.pieceNum_}function j(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new K(t.pieces_,e)}function Ar(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function Sh(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function cn(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function jl(t){if(t.pieceNum_>=t.pieces_.length)return null;let e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new K(e,0)}function Y(t,e){let n=[];for(let i=t.pieceNum_;i<t.pieces_.length;i++)n.push(t.pieces_[i]);if(e instanceof K)for(let i=e.pieceNum_;i<e.pieces_.length;i++)n.push(e.pieces_[i]);else{let i=e.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&n.push(i[s])}return new K(n,0)}function D(t){return t.pieceNum_>=t.pieces_.length}function fe(t,e){let n=P(t),i=P(e);if(n===null)return e;if(n===i)return fe(j(t),j(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function wh(t,e){let n=cn(t,0),i=cn(e,0);for(let s=0;s<n.length&&s<i.length;s++){let r=ct(n[s],i[s]);if(r!==0)return r}return n.length===i.length?0:n.length<i.length?-1:1}function _r(t,e){if(Ve(t)!==Ve(e))return!1;for(let n=t.pieceNum_,i=e.pieceNum_;n<=t.pieces_.length;n++,i++)if(t.pieces_[n]!==e.pieces_[i])return!1;return!0}function pe(t,e){let n=t.pieceNum_,i=e.pieceNum_;if(Ve(t)>Ve(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[i])return!1;++n,++i}return!0}function Ch(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=zt(e),Vl(t)}function kh(t){let e=t.parts_.pop();t.byteLength_-=zt(e),t.parts_.length>0&&(t.byteLength_-=1)}function Vl(t){if(t.byteLength_>sl)throw new Error(t.errorPrefix_+"has a key path longer than "+sl+" bytes ("+t.byteLength_+").");if(t.parts_.length>il)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+il+") or object contains a cycle "+it(t))}function it(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}function Dh(t,e){return ct(t.name,e.name)}function Ir(t,e){return ct(t,e)}function Bh(t){ks=t}function xh(t){zl=t}function Oh(t){Xl=t}function ee(t,e=null){if(t===null)return R.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),I(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){let n=t;return new Be(n,ee(e))}if(!(t instanceof Array)&&Fh){let n=[],i=!1;if(re(t,(o,a)=>{if(o.substring(0,1)!=="."){let l=ee(a);l.isEmpty()||(i=i||!l.getPriority().isEmpty(),n.push(new L(o,l)))}}),n.length===0)return R.EMPTY_NODE;let r=zn(n,Dh,o=>o.name,Ir);if(i){let o=zn(n,z.getCompare());return new R(r,ee(e),new Rt({".priority":o},{".priority":z}))}else return new R(r,ee(e),Rt.Default)}else{let n=R.EMPTY_NODE;return re(t,(i,s)=>{if(Ie(t,i)&&i.substring(0,1)!=="."){let r=ee(s);(r.isLeafNode()||!r.isEmpty())&&(n=n.updateImmediateChild(i,r))}}),n.updatePriority(ee(e))}}function ql(t){return{type:"value",snapshotNode:t}}function Mt(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function dn(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function un(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function Gh(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}function Uh(t){return t.loadsAllData()?new hn(t.getIndex()):t.hasLimit()?new Bs(t):new Xn(t)}function ll(t){let e={};if(t.isDefault())return e;let n;if(t.index_===z?n="$priority":t.index_===Hh?n="$value":t.index_===St?n="$key":(I(t.index_ instanceof Ls,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=Q(n),t.startSet_){let i=t.startAfterSet_?"startAfter":"startAt";e[i]=Q(t.indexStartValue_),t.startNameSet_&&(e[i]+=","+Q(t.indexStartName_))}if(t.endSet_){let i=t.endBeforeSet_?"endBefore":"endAt";e[i]=Q(t.indexEndValue_),t.endNameSet_&&(e[i]+=","+Q(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function cl(t){let e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==z&&(e.i=t.index_.toString()),e}function qn(){return{value:null,children:new Map}}function Ql(t,e,n){if(D(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{let i=P(e);t.children.has(i)||t.children.set(i,qn());let s=t.children.get(i);e=j(e),Ql(s,e,n)}}function Fs(t,e,n){t.value!==null?n(e,t.value):$h(t,(i,s)=>{let r=new K(e.toString()+"/"+i);Fs(s,r,n)})}function $h(t,e){t.children.forEach((n,i)=>{e(i,n)})}function yr(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Er(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Tr(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}function Vh(t,e,n,i){let s=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(Gh(o.childName,o.snapshotNode))}),sn(t,s,"child_removed",e,i,n),sn(t,s,"child_added",e,i,n),sn(t,s,"child_moved",r,i,n),sn(t,s,"child_changed",e,i,n),sn(t,s,"value",e,i,n),s}function sn(t,e,n,i,s,r){let o=i.filter(a=>a.type===n);o.sort((a,l)=>Yh(t,a,l)),o.forEach(a=>{let l=Jh(t,a,r);s.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,t.query_))})})}function Jh(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function Yh(t,e,n){if(e.childName==null||n.childName==null)throw Ze("Should only compare child_ events.");let i=new L(e.childName,e.snapshotNode),s=new L(n.childName,n.snapshotNode);return t.index_.compare(i,s)}function ci(t,e){return{eventCache:t,serverCache:e}}function on(t,e,n,i){return ci(new xe(e,n,i),t.serverCache)}function Zl(t,e,n,i){return ci(t.eventCache,new xe(e,n,i))}function Ws(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function lt(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}function an(t,e,n){if(D(e))return new Ee(new ue(n));{let i=t.writeTree_.findRootMostValueAndPath(e);if(i!=null){let s=i.path,r=i.value,o=fe(s,e);return r=r.updateChild(o,n),new Ee(t.writeTree_.set(s,r))}else{let s=new ue(n),r=t.writeTree_.setTree(e,s);return new Ee(r)}}}function js(t,e,n){let i=t;return re(n,(s,r)=>{i=an(i,Y(e,s),r)}),i}function ul(t,e){if(D(e))return Ee.empty();{let n=t.writeTree_.setTree(e,new ue(null));return new Ee(n)}}function Vs(t,e){return dt(t,e)!=null}function dt(t,e){let n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(fe(n.path,e)):null}function hl(t){let e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(z,(i,s)=>{e.push(new L(i,s))}):t.writeTree_.children.inorderTraversal((i,s)=>{s.value!=null&&e.push(new L(i,s.value))}),e}function je(t,e){if(D(e))return t;{let n=dt(t,e);return n!=null?new Ee(new ue(n)):new Ee(t.writeTree_.subtree(e))}}function Js(t){return t.writeTree_.isEmpty()}function Lt(t,e){return ec(O(),t.writeTree_,e)}function ec(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let i=null;return e.children.inorderTraversal((s,r)=>{s===".priority"?(I(r.value!==null,"Priority writes must always be leaf nodes"),i=r.value):n=ec(Y(t,s),r,n)}),!n.getChild(t).isEmpty()&&i!==null&&(n=n.updateChild(Y(t,".priority"),i)),n}}function vr(t,e){return sc(e,t)}function Xh(t,e,n,i,s){I(i>t.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),t.allWrites.push({path:e,snap:n,writeId:i,visible:s}),s&&(t.visibleWrites=an(t.visibleWrites,e,n)),t.lastWriteId=i}function qh(t,e,n,i){I(i>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:e,children:n,writeId:i,visible:!0}),t.visibleWrites=js(t.visibleWrites,e,n),t.lastWriteId=i}function Qh(t,e){for(let n=0;n<t.allWrites.length;n++){let i=t.allWrites[n];if(i.writeId===e)return i}return null}function Zh(t,e){let n=t.allWrites.findIndex(a=>a.writeId===e);I(n>=0,"removeWrite called with nonexistent writeId.");let i=t.allWrites[n];t.allWrites.splice(n,1);let s=i.visible,r=!1,o=t.allWrites.length-1;for(;s&&o>=0;){let a=t.allWrites[o];a.visible&&(o>=n&&ef(a,i.path)?s=!1:pe(i.path,a.path)&&(r=!0)),o--}if(s){if(r)return tf(t),!0;if(i.snap)t.visibleWrites=ul(t.visibleWrites,i.path);else{let a=i.children;re(a,l=>{t.visibleWrites=ul(t.visibleWrites,Y(i.path,l))})}return!0}else return!1}function ef(t,e){if(t.snap)return pe(t.path,e);for(let n in t.children)if(t.children.hasOwnProperty(n)&&pe(Y(t.path,n),e))return!0;return!1}function tf(t){t.visibleWrites=tc(t.allWrites,nf,O()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function nf(t){return t.visible}function tc(t,e,n){let i=Ee.empty();for(let s=0;s<t.length;++s){let r=t[s];if(e(r)){let o=r.path,a;if(r.snap)pe(n,o)?(a=fe(n,o),i=an(i,a,r.snap)):pe(o,n)&&(a=fe(o,n),i=an(i,O(),r.snap.getChild(a)));else if(r.children){if(pe(n,o))a=fe(n,o),i=js(i,a,r.children);else if(pe(o,n))if(a=fe(o,n),D(a))i=js(i,O(),r.children);else{let l=et(r.children,P(a));if(l){let c=l.getChild(j(a));i=an(i,O(),c)}}}else throw Ze("WriteRecord should have .snap or .children")}}return i}function nc(t,e,n,i,s){if(!i&&!s){let r=dt(t.visibleWrites,e);if(r!=null)return r;{let o=je(t.visibleWrites,e);if(Js(o))return n;if(n==null&&!Vs(o,O()))return null;{let a=n||R.EMPTY_NODE;return Lt(o,a)}}}else{let r=je(t.visibleWrites,e);if(!s&&Js(r))return n;if(!s&&n==null&&!Vs(r,O()))return null;{let o=function(c){return(c.visible||s)&&(!i||!~i.indexOf(c.writeId))&&(pe(c.path,e)||pe(e,c.path))},a=tc(t.allWrites,o,e),l=n||R.EMPTY_NODE;return Lt(a,l)}}}function sf(t,e,n){let i=R.EMPTY_NODE,s=dt(t.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(z,(r,o)=>{i=i.updateImmediateChild(r,o)}),i;if(n){let r=je(t.visibleWrites,e);return n.forEachChild(z,(o,a)=>{let l=Lt(je(r,new K(o)),a);i=i.updateImmediateChild(o,l)}),hl(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{let r=je(t.visibleWrites,e);return hl(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function rf(t,e,n,i,s){I(i||s,"Either existingEventSnap or existingServerSnap must exist");let r=Y(e,n);if(Vs(t.visibleWrites,r))return null;{let o=je(t.visibleWrites,r);return Js(o)?s.getChild(n):Lt(o,s.getChild(n))}}function of(t,e,n,i){let s=Y(e,n),r=dt(t.visibleWrites,s);if(r!=null)return r;if(i.isCompleteForChild(n)){let o=je(t.visibleWrites,s);return Lt(o,i.getNode().getImmediateChild(n))}else return null}function af(t,e){return dt(t.visibleWrites,e)}function lf(t,e,n,i,s,r,o){let a,l=je(t.visibleWrites,e),c=dt(l,O());if(c!=null)a=c;else if(n!=null)a=Lt(l,n);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let d=[],u=o.getCompare(),h=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),f=h.getNext();for(;f&&d.length<s;)u(f,i)!==0&&d.push(f),f=h.getNext();return d}else return[]}function cf(){return{visibleWrites:Ee.empty(),allWrites:[],lastWriteId:-1}}function Zn(t,e,n,i){return nc(t.writeTree,t.treePath,e,n,i)}function Nr(t,e){return sf(t.writeTree,t.treePath,e)}function fl(t,e,n,i){return rf(t.writeTree,t.treePath,e,n,i)}function ei(t,e){return af(t.writeTree,Y(t.treePath,e))}function df(t,e,n,i,s,r){return lf(t.writeTree,t.treePath,e,n,i,s,r)}function br(t,e,n){return of(t.writeTree,t.treePath,e,n)}function ic(t,e){return sc(Y(t.treePath,e),t.writeTree)}function sc(t,e){return{treePath:t,writeTree:e}}function uf(t){return{filter:t}}function hf(t,e){I(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),I(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function ff(t,e,n,i,s){let r=new Ys,o,a;if(n.type===ye.OVERWRITE){let c=n;c.source.fromUser?o=Xs(t,e,c.path,c.snap,i,s,r):(I(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!D(c.path),o=ti(t,e,c.path,c.snap,i,s,a,r))}else if(n.type===ye.MERGE){let c=n;c.source.fromUser?o=mf(t,e,c.path,c.children,i,s,r):(I(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=qs(t,e,c.path,c.children,i,s,a,r))}else if(n.type===ye.ACK_USER_WRITE){let c=n;c.revert?o=_f(t,e,c.path,i,s,r):o=gf(t,e,c.path,c.affectedTree,i,s,r)}else if(n.type===ye.LISTEN_COMPLETE)o=Af(t,e,n.path,i,r);else throw Ze("Unknown operation type: "+n.type);let l=r.getChanges();return pf(e,o,l),{viewCache:o,changes:l}}function pf(t,e,n){let i=e.eventCache;if(i.isFullyInitialized()){let s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=Ws(t);(n.length>0||!t.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&n.push(ql(Ws(e)))}}function oc(t,e,n,i,s,r){let o=e.eventCache;if(ei(i,n)!=null)return e;{let a,l;if(D(n))if(I(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=lt(e),d=c instanceof R?c:R.EMPTY_NODE,u=Nr(i,d);a=t.filter.updateFullNode(e.eventCache.getNode(),u,r)}else{let c=Zn(i,lt(e));a=t.filter.updateFullNode(e.eventCache.getNode(),c,r)}else{let c=P(n);if(c===".priority"){I(Ve(n)===1,"Can't have a priority with additional path components");let d=o.getNode();l=e.serverCache.getNode();let u=fl(i,n,d,l);u!=null?a=t.filter.updatePriority(d,u):a=o.getNode()}else{let d=j(n),u;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();let h=fl(i,n,o.getNode(),l);h!=null?u=o.getNode().getImmediateChild(c).updateChild(d,h):u=o.getNode().getImmediateChild(c)}else u=br(i,c,e.serverCache);u!=null?a=t.filter.updateChild(o.getNode(),c,u,d,s,r):a=o.getNode()}}return on(e,a,o.isFullyInitialized()||D(n),t.filter.filtersNodes())}}function ti(t,e,n,i,s,r,o,a){let l=e.serverCache,c,d=o?t.filter:t.filter.getIndexedFilter();if(D(n))c=d.updateFullNode(l.getNode(),i,null);else if(d.filtersNodes()&&!l.isFiltered()){let f=l.getNode().updateChild(n,i);c=d.updateFullNode(l.getNode(),f,null)}else{let f=P(n);if(!l.isCompleteForPath(n)&&Ve(n)>1)return e;let p=j(n),m=l.getNode().getImmediateChild(f).updateChild(p,i);f===".priority"?c=d.updatePriority(l.getNode(),m):c=d.updateChild(l.getNode(),f,m,p,rc,null)}let u=Zl(e,c,l.isFullyInitialized()||D(n),d.filtersNodes()),h=new pn(s,u,r);return oc(t,u,n,s,h,a)}function Xs(t,e,n,i,s,r,o){let a=e.eventCache,l,c,d=new pn(s,e,r);if(D(n))c=t.filter.updateFullNode(e.eventCache.getNode(),i,o),l=on(e,c,!0,t.filter.filtersNodes());else{let u=P(n);if(u===".priority")c=t.filter.updatePriority(e.eventCache.getNode(),i),l=on(e,c,a.isFullyInitialized(),a.isFiltered());else{let h=j(n),f=a.getNode().getImmediateChild(u),p;if(D(h))p=i;else{let g=d.getCompleteChild(u);g!=null?Ar(h)===".priority"&&g.getChild(jl(h)).isEmpty()?p=g:p=g.updateChild(h,i):p=R.EMPTY_NODE}if(f.equals(p))l=e;else{let g=t.filter.updateChild(a.getNode(),u,p,h,d,o);l=on(e,g,a.isFullyInitialized(),t.filter.filtersNodes())}}}return l}function pl(t,e){return t.eventCache.isCompleteForChild(e)}function mf(t,e,n,i,s,r,o){let a=e;return i.foreach((l,c)=>{let d=Y(n,l);pl(e,P(d))&&(a=Xs(t,a,d,c,s,r,o))}),i.foreach((l,c)=>{let d=Y(n,l);pl(e,P(d))||(a=Xs(t,a,d,c,s,r,o))}),a}function ml(t,e,n){return n.foreach((i,s)=>{e=e.updateChild(i,s)}),e}function qs(t,e,n,i,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;D(n)?c=i:c=new ue(null).setTree(n,i);let d=e.serverCache.getNode();return c.children.inorderTraversal((u,h)=>{if(d.hasChild(u)){let f=e.serverCache.getNode().getImmediateChild(u),p=ml(t,f,h);l=ti(t,l,new K(u),p,s,r,o,a)}}),c.children.inorderTraversal((u,h)=>{let f=!e.serverCache.isCompleteForChild(u)&&h.value===null;if(!d.hasChild(u)&&!f){let p=e.serverCache.getNode().getImmediateChild(u),g=ml(t,p,h);l=ti(t,l,new K(u),g,s,r,o,a)}}),l}function gf(t,e,n,i,s,r,o){if(ei(s,n)!=null)return e;let a=e.serverCache.isFiltered(),l=e.serverCache;if(i.value!=null){if(D(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return ti(t,e,n,l.getNode().getChild(n),s,r,a,o);if(D(n)){let c=new ue(null);return l.getNode().forEachChild(St,(d,u)=>{c=c.set(new K(d),u)}),qs(t,e,n,c,s,r,a,o)}else return e}else{let c=new ue(null);return i.foreach((d,u)=>{let h=Y(n,d);l.isCompleteForPath(h)&&(c=c.set(d,l.getNode().getChild(h)))}),qs(t,e,n,c,s,r,a,o)}}function Af(t,e,n,i,s){let r=e.serverCache,o=Zl(e,r.getNode(),r.isFullyInitialized()||D(n),r.isFiltered());return oc(t,o,n,i,rc,s)}function _f(t,e,n,i,s,r){let o;if(ei(i,n)!=null)return e;{let a=new pn(i,e,s),l=e.eventCache.getNode(),c;if(D(n)||P(n)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=Zn(i,lt(e));else{let u=e.serverCache.getNode();I(u instanceof R,"serverChildren would be complete if leaf node"),d=Nr(i,u)}d=d,c=t.filter.updateFullNode(l,d,r)}else{let d=P(n),u=br(i,d,e.serverCache);u==null&&e.serverCache.isCompleteForChild(d)&&(u=l.getImmediateChild(d)),u!=null?c=t.filter.updateChild(l,d,u,j(n),a,r):e.eventCache.getNode().hasChild(d)?c=t.filter.updateChild(l,d,R.EMPTY_NODE,j(n),a,r):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Zn(i,lt(e)),o.isLeafNode()&&(c=t.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||ei(i,O())!=null,on(e,c,o,t.filter.filtersNodes())}}function If(t){return t.viewCache_.serverCache.getNode()}function yf(t,e){let n=lt(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!D(e)&&!n.getImmediateChild(P(e)).isEmpty())?n.getChild(e):null}function gl(t){return t.eventRegistrations_.length===0}function Ef(t,e){t.eventRegistrations_.push(e)}function Al(t,e,n){let i=[];if(n){I(e==null,"A cancel should cancel all event registrations.");let s=t.query._path;t.eventRegistrations_.forEach(r=>{let o=r.createCancelEvent(n,s);o&&i.push(o)})}if(e){let s=[];for(let r=0;r<t.eventRegistrations_.length;++r){let o=t.eventRegistrations_[r];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(t.eventRegistrations_.slice(r+1));break}}t.eventRegistrations_=s}else t.eventRegistrations_=[];return i}function _l(t,e,n,i){e.type===ye.MERGE&&e.source.queryId!==null&&(I(lt(t.viewCache_),"We should always have a full cache before handling merges"),I(Ws(t.viewCache_),"Missing event cache, even though we have a server cache"));let s=t.viewCache_,r=ff(t.processor_,s,e,n,i);return hf(t.processor_,r.viewCache),I(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=r.viewCache,ac(t,r.changes,r.viewCache.eventCache.getNode(),null)}function Tf(t,e){let n=t.viewCache_.eventCache,i=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(z,(r,o)=>{i.push(Mt(r,o))}),n.isFullyInitialized()&&i.push(ql(n.getNode())),ac(t,i,n.getNode(),e)}function ac(t,e,n,i){let s=i?[i]:t.eventRegistrations_;return Vh(t.eventGenerator_,e,n,s)}function vf(t){I(!ni,"__referenceConstructor has already been defined"),ni=t}function Nf(){return I(ni,"Reference.ts has not been loaded"),ni}function bf(t){return t.views.size===0}function Sr(t,e,n,i){let s=e.source.queryId;if(s!==null){let r=t.views.get(s);return I(r!=null,"SyncTree gave us an op for an invalid query."),_l(r,e,n,i)}else{let r=[];for(let o of t.views.values())r=r.concat(_l(o,e,n,i));return r}}function Sf(t,e,n,i,s){let r=e._queryIdentifier,o=t.views.get(r);if(!o){let a=Zn(n,s?i:null),l=!1;a?l=!0:i instanceof R?(a=Nr(n,i),l=!1):(a=R.EMPTY_NODE,l=!1);let c=ci(new xe(a,l,!1),new xe(i,s,!1));return new Qs(e,c)}return o}function wf(t,e,n,i,s,r){let o=Sf(t,e,i,s,r);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),Ef(o,n),Tf(o,n)}function Cf(t,e,n,i){let s=e._queryIdentifier,r=[],o=[],a=Je(t);if(s==="default")for(let[l,c]of t.views.entries())o=o.concat(Al(c,n,i)),gl(c)&&(t.views.delete(l),c.query._queryParams.loadsAllData()||r.push(c.query));else{let l=t.views.get(s);l&&(o=o.concat(Al(l,n,i)),gl(l)&&(t.views.delete(s),l.query._queryParams.loadsAllData()||r.push(l.query)))}return a&&!Je(t)&&r.push(new(Nf())(e._repo,e._path)),{removed:r,events:o}}function lc(t){let e=[];for(let n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function wt(t,e){let n=null;for(let i of t.views.values())n=n||yf(i,e);return n}function cc(t,e){if(e._queryParams.loadsAllData())return di(t);{let i=e._queryIdentifier;return t.views.get(i)}}function dc(t,e){return cc(t,e)!=null}function Je(t){return di(t)!=null}function di(t){for(let e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}function kf(t){I(!ii,"__referenceConstructor has already been defined"),ii=t}function Rf(){return I(ii,"Reference.ts has not been loaded"),ii}function uc(t,e,n,i,s){return Xh(t.pendingWriteTree_,e,n,i,s),s?Ot(t,new Pt(yr(),e,n)):[]}function Pf(t,e,n,i){qh(t.pendingWriteTree_,e,n,i);let s=ue.fromObject(n);return Ot(t,new fn(yr(),e,s))}function $e(t,e,n=!1){let i=Qh(t.pendingWriteTree_,e);if(Zh(t.pendingWriteTree_,e)){let r=new ue(null);return i.snap!=null?r=r.set(O(),!0):re(i.children,o=>{r=r.set(new K(o),!0)}),Ot(t,new Us(i.path,r,n))}else return[]}function ui(t,e,n){return Ot(t,new Pt(Er(),e,n))}function Lf(t,e,n){let i=ue.fromObject(n);return Ot(t,new fn(Er(),e,i))}function Df(t,e){return Ot(t,new Qn(Er(),e))}function Bf(t,e,n){let i=Cr(t,n);if(i){let s=kr(i),r=s.path,o=s.queryId,a=fe(r,e),l=new Qn(Tr(o),a);return Rr(t,r,l)}else return[]}function er(t,e,n,i,s=!1){let r=e._path,o=t.syncPointTree_.get(r),a=[];if(o&&(e._queryIdentifier==="default"||dc(o,e))){let l=Cf(o,e,n,i);bf(o)&&(t.syncPointTree_=t.syncPointTree_.remove(r));let c=l.removed;if(a=l.events,!s){let d=c.findIndex(h=>h._queryParams.loadsAllData())!==-1,u=t.syncPointTree_.findOnPath(r,(h,f)=>Je(f));if(d&&!u){let h=t.syncPointTree_.subtree(r);if(!h.isEmpty()){let f=Kf(h);for(let p=0;p<f.length;++p){let g=f[p],m=g.query,v=pc(t,g);t.listenProvider_.startListening(ln(m),ri(t,m),v.hashFn,v.onComplete)}}}!u&&c.length>0&&!i&&(d?t.listenProvider_.stopListening(ln(e),null):c.forEach(h=>{let f=t.queryToTagMap.get(hi(h));t.listenProvider_.stopListening(ln(h),f)}))}Ff(t,c)}return a}function xf(t,e,n,i){let s=Cr(t,i);if(s!=null){let r=kr(s),o=r.path,a=r.queryId,l=fe(o,e),c=new Pt(Tr(a),l,n);return Rr(t,o,c)}else return[]}function Of(t,e,n,i){let s=Cr(t,i);if(s){let r=kr(s),o=r.path,a=r.queryId,l=fe(o,e),c=ue.fromObject(n),d=new fn(Tr(a),l,c);return Rr(t,o,d)}else return[]}function Il(t,e,n,i=!1){let s=e._path,r=null,o=!1;t.syncPointTree_.foreachOnPath(s,(h,f)=>{let p=fe(h,s);r=r||wt(f,p),o=o||Je(f)});let a=t.syncPointTree_.get(s);a?(o=o||Je(a),r=r||wt(a,O())):(a=new Zs,t.syncPointTree_=t.syncPointTree_.set(s,a));let l;r!=null?l=!0:(l=!1,r=R.EMPTY_NODE,t.syncPointTree_.subtree(s).foreachChild((f,p)=>{let g=wt(p,O());g&&(r=r.updateImmediateChild(f,g))}));let c=dc(a,e);if(!c&&!e._queryParams.loadsAllData()){let h=hi(e);I(!t.queryToTagMap.has(h),"View does not exist, but we have a tag");let f=Hf();t.queryToTagMap.set(h,f),t.tagToQueryMap.set(f,h)}let d=vr(t.pendingWriteTree_,s),u=wf(a,e,n,d,r,l);if(!c&&!o&&!i){let h=cc(a,e);u=u.concat(Gf(t,e,h))}return u}function wr(t,e,n){let s=t.pendingWriteTree_,r=t.syncPointTree_.findOnPath(e,(o,a)=>{let l=fe(o,e),c=wt(a,l);if(c)return c});return nc(s,e,r,n,!0)}function Ot(t,e){return hc(e,t.syncPointTree_,null,vr(t.pendingWriteTree_,O()))}function hc(t,e,n,i){if(D(t.path))return fc(t,e,n,i);{let s=e.get(O());n==null&&s!=null&&(n=wt(s,O()));let r=[],o=P(t.path),a=t.operationForChild(o),l=e.children.get(o);if(l&&a){let c=n?n.getImmediateChild(o):null,d=ic(i,o);r=r.concat(hc(a,l,c,d))}return s&&(r=r.concat(Sr(s,t,i,n))),r}}function fc(t,e,n,i){let s=e.get(O());n==null&&s!=null&&(n=wt(s,O()));let r=[];return e.children.inorderTraversal((o,a)=>{let l=n?n.getImmediateChild(o):null,c=ic(i,o),d=t.operationForChild(o);d&&(r=r.concat(fc(d,a,l,c)))}),s&&(r=r.concat(Sr(s,t,i,n))),r}function pc(t,e){let n=e.query,i=ri(t,n);return{hashFn:()=>(If(e)||R.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return i?Bf(t,n._path,i):Df(t,n._path);{let r=Zu(s,n);return er(t,n,null,r)}}}}function ri(t,e){let n=hi(e);return t.queryToTagMap.get(n)}function hi(t){return t._path.toString()+"$"+t._queryIdentifier}function Cr(t,e){return t.tagToQueryMap.get(e)}function kr(t){let e=t.indexOf("$");return I(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new K(t.substr(0,e))}}function Rr(t,e,n){let i=t.syncPointTree_.get(e);I(i,"Missing sync point for query tag that we're tracking");let s=vr(t.pendingWriteTree_,e);return Sr(i,n,s,null)}function Kf(t){return t.fold((e,n,i)=>{if(n&&Je(n))return[di(n)];{let s=[];return n&&(s=lc(n)),re(i,(r,o)=>{s=s.concat(o)}),s}})}function ln(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(Rf())(t._repo,t._path):t}function Ff(t,e){for(let n=0;n<e.length;++n){let i=e[n];if(!i._queryParams.loadsAllData()){let s=hi(i),r=t.queryToTagMap.get(s);t.queryToTagMap.delete(s),t.tagToQueryMap.delete(r)}}}function Hf(){return Mf++}function Gf(t,e,n){let i=e._path,s=ri(t,e),r=pc(t,n),o=t.listenProvider_.startListening(ln(e),s,r.hashFn,r.onComplete),a=t.syncPointTree_.subtree(i);if(s)I(!Je(a.value),"If we're adding a query, it shouldn't be shadowed");else{let l=a.fold((c,d,u)=>{if(!D(c)&&d&&Je(d))return[di(d).query];{let h=[];return d&&(h=h.concat(lc(d).map(f=>f.query))),re(u,(f,p)=>{h=h.concat(p)}),h}});for(let c=0;c<l.length;++c){let d=l[c];t.listenProvider_.stopListening(ln(d),ri(t,d))}}return o}function Mr(t,e,n){let i=t.getPriority().val(),s=yl(i,e.getImmediateChild(".priority"),n),r;if(t.isLeafNode()){let o=t,a=yl(o.getValue(),e,n);return a!==o.getValue()||s!==o.getPriority().val()?new Be(a,ee(s)):t}else{let o=t;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new Be(s))),o.forEachChild(z,(a,l)=>{let c=Mr(l,e.getImmediateChild(a),n);c!==l&&(r=r.updateImmediateChild(a,c))}),r}}function Pr(t,e){let n=e instanceof K?e:new K(e),i=t,s=P(n);for(;s!==null;){let r=et(i.node.children,s)||{children:{},childCount:0};i=new mn(s,i,r),n=j(n),s=P(n)}return i}function Kt(t){return t.node.value}function Ac(t,e){t.node.value=e,ir(t)}function _c(t){return t.node.childCount>0}function jf(t){return Kt(t)===void 0&&!_c(t)}function fi(t,e){re(t.node.children,(n,i)=>{e(new mn(n,t,i))})}function Ic(t,e,n,i){n&&!i&&e(t),fi(t,s=>{Ic(s,e,!0,i)}),n&&i&&e(t)}function Vf(t,e,n){let i=n?t:t.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function In(t){return new K(t.parent===null?t.name:In(t.parent)+"/"+t.name)}function ir(t){t.parent!==null&&Jf(t.parent,t.name,t)}function Jf(t,e,n){let i=jf(n),s=Ie(t.node.children,e);i&&s?(delete t.node.children[e],t.node.childCount--,ir(t)):!i&&!s&&(t.node.children[e]=n.node,t.node.childCount++,ir(t))}function mi(t,e){let n=null;for(let i=0;i<e.length;i++){let s=e[i],r=s.getPath();n!==null&&!_r(r,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:r}),n.events.push(s)}n&&t.eventLists_.push(n)}function vc(t,e,n){mi(t,n),Nc(t,i=>_r(i,e))}function Te(t,e,n){mi(t,n),Nc(t,i=>pe(i,e)||pe(e,i))}function Nc(t,e){t.recursionDepth_++;let n=!0;for(let i=0;i<t.eventLists_.length;i++){let s=t.eventLists_[i];if(s){let r=s.path;e(r)?(np(t.eventLists_[i]),t.eventLists_[i]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function np(t){for(let e=0;e<t.events.length;e++){let n=t.events[e];if(n!==null){t.events[e]=null;let i=n.getEventRunner();rt&&se("event: "+n.toString()),xt(i)}}}function rp(t,e,n){if(t.stats_=gr(t.repoInfo_),t.forceRestClient_||ih())t.server_=new Os(t.repoInfo_,(i,s,r,o)=>{El(t,i,s,r,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>Tl(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Q(n)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}t.persistentConnection_=new at(t.repoInfo_,e,(i,s,r,o)=>{El(t,i,s,r,o)},i=>{Tl(t,i)},i=>{op(t,i)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(i=>{t.server_.refreshAuthToken(i)}),t.appCheckProvider_.addTokenChangeListener(i=>{t.server_.refreshAppCheckToken(i.token)}),t.statsReporter_=rh(t.repoInfo_,()=>new Gs(t.stats_,t.server_)),t.infoData_=new Ks,t.infoSyncTree_=new si({startListening:(i,s,r,o)=>{let a=[],l=t.infoData_.getNode(i._path);return l.isEmpty()||(a=ui(t.infoSyncTree_,i._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Br(t,"connected",!1),t.serverSyncTree_=new si({startListening:(i,s,r,o)=>(t.server_.listen(i,r,s,(a,l)=>{let c=o(a,l);Te(t.eventQueue_,i._path,c)}),[]),stopListening:(i,s)=>{t.server_.unlisten(i,s)}})}function bc(t){let n=t.infoData_.getNode(new K(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function gi(t){return Uf({timestamp:bc(t)})}function El(t,e,n,i,s){t.dataUpdateCount++;let r=new K(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(s)if(i){let l=Jt(n,c=>ee(c));o=Of(t.serverSyncTree_,r,l,s)}else{let l=ee(n);o=xf(t.serverSyncTree_,r,l,s)}else if(i){let l=Jt(n,c=>ee(c));o=Lf(t.serverSyncTree_,r,l)}else{let l=ee(n);o=ui(t.serverSyncTree_,r,l)}let a=r;o.length>0&&(a=Dt(t,r)),Te(t.eventQueue_,a,o)}function Tl(t,e){Br(t,"connected",e),e===!1&&cp(t)}function op(t,e){re(e,(n,i)=>{Br(t,n,i)})}function Br(t,e,n){let i=new K("/.info/"+e),s=ee(n);t.infoData_.updateSnapshot(i,s);let r=ui(t.infoSyncTree_,i,s);Te(t.eventQueue_,i,r)}function xr(t){return t.nextWriteId_++}function ap(t,e,n,i,s){Ai(t,"set",{path:e.toString(),value:n,priority:i});let r=gi(t),o=ee(n,i),a=wr(t.serverSyncTree_,e),l=gc(o,a,r),c=xr(t),d=uc(t.serverSyncTree_,e,l,c,!0);mi(t.eventQueue_,d),t.server_.put(e.toString(),o.val(!0),(h,f)=>{let p=h==="ok";p||de("set at "+e+" failed: "+h);let g=$e(t.serverSyncTree_,c,!p);Te(t.eventQueue_,e,g),or(t,s,h,f)});let u=Kr(t,e);Dt(t,u),Te(t.eventQueue_,u,[])}function lp(t,e,n,i){Ai(t,"update",{path:e.toString(),value:n});let s=!0,r=gi(t),o={};if(re(n,(a,l)=>{s=!1,o[a]=mc(Y(e,a),ee(l),t.serverSyncTree_,r)}),s)se("update() called with empty data.  Don't do anything."),or(t,i,"ok",void 0);else{let a=xr(t),l=Pf(t.serverSyncTree_,e,o,a);mi(t.eventQueue_,l),t.server_.merge(e.toString(),n,(c,d)=>{let u=c==="ok";u||de("update at "+e+" failed: "+c);let h=$e(t.serverSyncTree_,a,!u),f=h.length>0?Dt(t,e):e;Te(t.eventQueue_,f,h),or(t,i,c,d)}),re(n,c=>{let d=Kr(t,Y(e,c));Dt(t,d)}),Te(t.eventQueue_,e,[])}}function cp(t){Ai(t,"onDisconnectEvents");let e=gi(t),n=qn();Fs(t.onDisconnect_,O(),(s,r)=>{let o=mc(s,r,t.serverSyncTree_,e);Ql(n,s,o)});let i=[];Fs(n,O(),(s,r)=>{i=i.concat(ui(t.serverSyncTree_,s,r));let o=Kr(t,s);Dt(t,o)}),t.onDisconnect_=qn(),Te(t.eventQueue_,O(),i)}function dp(t,e,n){let i;P(e._path)===".info"?i=Il(t.infoSyncTree_,e,n):i=Il(t.serverSyncTree_,e,n),vc(t.eventQueue_,e._path,i)}function vl(t,e,n){let i;P(e._path)===".info"?i=er(t.infoSyncTree_,e,n):i=er(t.serverSyncTree_,e,n),vc(t.eventQueue_,e._path,i)}function up(t){t.persistentConnection_&&t.persistentConnection_.interrupt(ip)}function Ai(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),se(n,...e)}function or(t,e,n,i){e&&xt(()=>{if(n==="ok")e(null);else{let s=(n||"error").toUpperCase(),r=s;i&&(r+=": "+i);let o=new Error(r);o.code=s,e(o)}})}function Sc(t,e,n){return wr(t.serverSyncTree_,e,n)||R.EMPTY_NODE}function Or(t,e=t.transactionQueueTree_){if(e||_i(t,e),Kt(e)){let n=Cc(t,e);I(n.length>0,"Sending zero length transaction queue"),n.every(s=>s.status===0)&&hp(t,In(e),n)}else _c(e)&&fi(e,n=>{Or(t,n)})}function hp(t,e,n){let i=n.map(c=>c.currentWriteId),s=Sc(t,e,i),r=s,o=s.hash();for(let c=0;c<n.length;c++){let d=n[c];I(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;let u=fe(e,d.path);r=r.updateChild(u,d.currentOutputSnapshotRaw)}let a=r.val(!0),l=e;t.server_.put(l.toString(),a,c=>{Ai(t,"transaction put response",{path:l.toString(),status:c});let d=[];if(c==="ok"){let u=[];for(let h=0;h<n.length;h++)n[h].status=2,d=d.concat($e(t.serverSyncTree_,n[h].currentWriteId)),n[h].onComplete&&u.push(()=>n[h].onComplete(null,!0,n[h].currentOutputSnapshotResolved)),n[h].unwatcher();_i(t,Pr(t.transactionQueueTree_,e)),Or(t,t.transactionQueueTree_),Te(t.eventQueue_,e,d);for(let h=0;h<u.length;h++)xt(u[h])}else{if(c==="datastale")for(let u=0;u<n.length;u++)n[u].status===3?n[u].status=4:n[u].status=0;else{de("transaction at "+l.toString()+" failed: "+c);for(let u=0;u<n.length;u++)n[u].status=4,n[u].abortReason=c}Dt(t,e)}},o)}function Dt(t,e){let n=wc(t,e),i=In(n),s=Cc(t,n);return fp(t,s,i),i}function fp(t,e,n){if(e.length===0)return;let i=[],s=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let l=e[a],c=fe(n,l.path),d=!1,u;if(I(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)d=!0,u=l.abortReason,s=s.concat($e(t.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=sp)d=!0,u="maxretry",s=s.concat($e(t.serverSyncTree_,l.currentWriteId,!0));else{let h=Sc(t,l.path,o);l.currentInputSnapshot=h;let f=e[a].update(h.val());if(f!==void 0){pi("transaction failed: Data returned ",f,l.path);let p=ee(f);typeof f=="object"&&f!=null&&Ie(f,".priority")||(p=p.updatePriority(h.getPriority()));let m=l.currentWriteId,v=gi(t),E=gc(p,h,v);l.currentOutputSnapshotRaw=p,l.currentOutputSnapshotResolved=E,l.currentWriteId=xr(t),o.splice(o.indexOf(m),1),s=s.concat(uc(t.serverSyncTree_,l.path,E,l.currentWriteId,l.applyLocally)),s=s.concat($e(t.serverSyncTree_,m,!0))}else d=!0,u="nodata",s=s.concat($e(t.serverSyncTree_,l.currentWriteId,!0))}Te(t.eventQueue_,n,s),s=[],d&&(e[a].status=2,(function(h){setTimeout(h,Math.floor(0))})(e[a].unwatcher),e[a].onComplete&&(u==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(u),!1,null))))}_i(t,t.transactionQueueTree_);for(let a=0;a<i.length;a++)xt(i[a]);Or(t,t.transactionQueueTree_)}function wc(t,e){let n,i=t.transactionQueueTree_;for(n=P(e);n!==null&&Kt(i)===void 0;)i=Pr(i,n),e=j(e),n=P(e);return i}function Cc(t,e){let n=[];return kc(t,e,n),n.sort((i,s)=>i.order-s.order),n}function kc(t,e,n){let i=Kt(e);if(i)for(let s=0;s<i.length;s++)n.push(i[s]);fi(e,s=>{kc(t,s,n)})}function _i(t,e){let n=Kt(e);if(n){let i=0;for(let s=0;s<n.length;s++)n[s].status!==2&&(n[i]=n[s],i++);n.length=i,Ac(e,n.length>0?n:void 0)}fi(e,i=>{_i(t,i)})}function Kr(t,e){let n=In(wc(t,e)),i=Pr(t.transactionQueueTree_,e);return Vf(i,s=>{fs(t,s)}),fs(t,i),Ic(i,s=>{fs(t,s)}),n}function fs(t,e){let n=Kt(e);if(n){let i=[],s=[],r=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(I(r===o-1,"All SENT items should be at beginning of queue."),r=o,n[o].status=3,n[o].abortReason="set"):(I(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),s=s.concat($e(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&i.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?Ac(e,void 0):n.length=r+1,Te(t.eventQueue_,In(e),s);for(let o=0;o<i.length;o++)xt(i[o])}}function pp(t){let e="",n=t.split("/");for(let i=0;i<n.length;i++)if(n[i].length>0){let s=n[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function mp(t){let e={};t.charAt(0)==="?"&&(t=t.substring(1));for(let n of t.split("&")){if(n.length===0)continue;let i=n.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):de(`Invalid query segment '${n}' in query '${t}'`)}return e}function yn(t,e){return t=tt(t),t._checkNotDeleted("ref"),e!==void 0?Bt(t._root,e):t._root}function Bt(t,e){return t=tt(t),P(t._path)===null?ep("child","path",e,!1):Tc("child","path",e,!1),new Oe(t._repo,Y(t._path,e))}function Rc(t,e){t=tt(t),Dr("push",t._path),Ec("push",e,t._path,!0);let n=bc(t._repo),i=Ap(n),s=Bt(t,i),r=Bt(t,i),o;return e!=null?o=Ii(r,e).then(()=>r):o=Promise.resolve(r),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function Mc(t){return Dr("remove",t._path),Ii(t,null)}function Ii(t,e){t=tt(t),Dr("set",t._path),Ec("set",e,t._path,!1);let n=new Re;return ap(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function yi(t,e){Zf("update",e,t._path,!1);let n=new Re;return lp(t._repo,t._path,e,n.wrapCallback(()=>{})),n.promise}function _p(t,e,n,i,s){let r;if(typeof i=="object"&&(r=void 0,s=i),typeof i=="function"&&(r=i),s&&s.onlyOnce){let l=n,c=(d,u)=>{vl(t._repo,t,a),l(d,u)};c.userCallback=n.userCallback,c.context=n.context,n=c}let o=new ar(n,r||void 0),a=e==="value"?new cr(o):new dr(e,o);return dp(t._repo,t,a),()=>vl(t._repo,t,a)}function Ei(t,e,n,i){return _p(t,"value",e,n,i)}function Ep(t,e,n,i){let s=e.lastIndexOf(":"),r=e.substring(0,s),o=Bn(r);t.repoInfo_=new Un(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),i&&(t.authTokenProvider_=i)}function Tp(t,e,n,i,s){let r=i||t.options.databaseURL;r===void 0&&(t.options.projectId||De("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),se("Using default host for project ",t.options.projectId),r=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=Nl(r,s),a=o.repoInfo,l,c;typeof process<"u"&&process.env&&(c=process.env[Ip]),c?(l=!0,r=`http://${c}?ns=${a.namespace}`,o=Nl(r,s),a=o.repoInfo):l=!o.repoInfo.secure;let d=s&&l?new We(We.OWNER):new Is(t.name,t.options,e);tp("Invalid Firebase Database URL",o),D(o.path)||De("Database URL must point to the root of a Firebase Database (not including a child path).");let u=Np(a,t,d,new _s(t,n));return new hr(u,t)}function vp(t,e){let n=ur[e];(!n||n[t.key]!==t)&&De(`Database ${e}(${t.repoInfo_}) has already been deleted.`),up(t),delete n[t.key]}function Np(t,e,n,i){let s=ur[e.name];s||(s={},ur[e.name]=s);let r=s[t.toURLString()];return r&&De("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new rr(t,yp,n,i),s[t.toURLString()]=r,r}function Pc(t=Ua(),e){let n=Fa(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){let i=pa("database");i&&bp(n,...i)}return n}function bp(t,e,n,i={}){t=tt(t),t._checkNotDeleted("useEmulator");let s=`${e}:${n}`,r=t._repoInternal;if(t._instanceStarted){if(s===t._repoInternal.repoInfo_.host&&Et(i,r.repoInfo_.emulatorOptions))return;De("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&De('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new We(We.OWNER);else if(i.mockUserToken){let a=typeof i.mockUserToken=="string"?i.mockUserToken:ga(i.mockUserToken,t.app.options.projectId);o=new We(a)}Bn(e)&&(ma(e),Aa("Database",!0)),Ep(r,s,i,o)}function Sp(t){ju(Ga),Qt(new Me("database",(e,{instanceIdentifier:n})=>{let i=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return Tp(i,s,r,n)},"PUBLIC").setMultipleInstances(!0)),Ue(Va,Ja,t),Ue(Va,Ja,"esm2020")}var Va,Ja,fr,ps,ms,Sl,st,gs,bt,Vu,wl,gn,rt,Ya,Ju,se,An,As,De,de,Yu,pr,zu,Ct,ot,ct,Xu,en,mr,Cl,kl,qu,Qu,eh,th,nh,za,xt,ih,rn,_s,Is,We,Gn,Rl,Ml,Pl,Ll,Dl,Bl,xl,ys,Ol,Kl,Un,Es,as,ls,Ts,Xa,oh,ah,lh,Hl,Gl,Ul,ch,dh,uh,hh,fh,$l,Wl,ph,mh,gh,vs,Ns,Ah,_h,$n,Le,Wn,Ih,yh,Eh,Th,cs,qa,vh,Qa,Nh,Za,el,tl,nl,bh,bs,jn,Vn,Jn,il,sl,K,Ss,ws,tn,Rh,rl,Mh,Ph,Lh,ol,at,L,kt,Hn,Yn,St,Nt,ce,Cs,me,ks,Jl,Yl,al,Be,zl,Xl,Rs,z,Kh,Ms,zn,ds,vt,Rt,nn,R,Ps,_n,Fh,Ls,Ds,Hh,hn,Xn,Bs,xs,Os,Ks,Hs,dl,Wh,jh,Gs,ye,Us,Qn,Pt,fn,xe,$s,us,zh,ue,Ee,Ys,zs,rc,pn,Qs,ni,Zs,ii,Mf,si,tr,nr,Uf,yl,$f,Wf,mc,gc,mn,Yf,zf,hs,Lr,yc,Xf,qf,Ec,pi,Qf,Zf,Tc,ep,Dr,tp,sr,ip,sp,rr,Nl,gp,bl,Ap,oi,ai,ar,lr,Oe,li,cr,dr,Ip,ur,yp,hr,Lc=k(()=>{Fn();Wi();Xt();ji();Va="@firebase/database",Ja="1.1.0";fr="";ps=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Q(n))}get(e){let n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:yt(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};ms=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return Ie(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};Sl=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){let e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new ps(e)}}catch{}return new ms},st=Sl("localStorage"),gs=Sl("sessionStorage");bt=new Tt("@firebase/database"),Vu=(function(){let t=1;return function(){return t++}})(),wl=function(t){let e=ba(t),n=new Ln;n.update(e);let i=n.digest();return Dn.encodeByteArray(i)},gn=function(...t){let e="";for(let n=0;n<t.length;n++){let i=t[n];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=gn.apply(null,i):typeof i=="object"?e+=Q(i):e+=i,e+=" "}return e},rt=null,Ya=!0,Ju=function(t,e){I(!e||t===!0||t===!1,"Can't turn on custom loggers persistently."),t===!0?(bt.logLevel=U.VERBOSE,rt=bt.log.bind(bt),e&&gs.set("logging_enabled",!0)):typeof t=="function"?rt=t:(rt=null,gs.remove("logging_enabled"))},se=function(...t){if(Ya===!0&&(Ya=!1,rt===null&&gs.get("logging_enabled")===!0&&Ju(!0)),rt){let e=gn.apply(null,t);rt(e)}},An=function(t){return function(...e){se(t,...e)}},As=function(...t){let e="FIREBASE INTERNAL ERROR: "+gn(...t);bt.error(e)},De=function(...t){let e=`FIREBASE FATAL ERROR: ${gn(...t)}`;throw bt.error(e),new Error(e)},de=function(...t){let e="FIREBASE WARNING: "+gn(...t);bt.warn(e)},Yu=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&de("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},pr=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},zu=function(t){if(Ne()||document.readyState==="complete")t();else{let e=!1,n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},Ct="[MIN_NAME]",ot="[MAX_NAME]",ct=function(t,e){if(t===e)return 0;if(t===Ct||e===ot)return-1;if(e===Ct||t===ot)return 1;{let n=za(t),i=za(e);return n!==null?i!==null?n-i===0?t.length-e.length:n-i:-1:i!==null?1:t<e?-1:1}},Xu=function(t,e){return t===e?0:t<e?-1:1},en=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Q(e))},mr=function(t){if(typeof t!="object"||t===null)return Q(t);let e=[];for(let i in t)e.push(i);e.sort();let n="{";for(let i=0;i<e.length;i++)i!==0&&(n+=","),n+=Q(e[i]),n+=":",n+=mr(t[e[i]]);return n+="}",n},Cl=function(t,e){let n=t.length;if(n<=e)return[t];let i=[];for(let s=0;s<n;s+=e)s+e>n?i.push(t.substring(s,n)):i.push(t.substring(s,s+e));return i};kl=function(t){I(!pr(t),"Invalid JSON number");let e=11,n=52,i=(1<<e-1)-1,s,r,o,a,l;t===0?(r=0,o=0,s=1/t===-1/0?1:0):(s=t<0,t=Math.abs(t),t>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),i),r=a+i,o=Math.round(t*Math.pow(2,n-a)-Math.pow(2,n))):(r=0,o=Math.round(t/Math.pow(2,1-i-n))));let c=[];for(l=n;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(s?1:0),c.reverse();let d=c.join(""),u="";for(l=0;l<64;l+=8){let h=parseInt(d.substr(l,8),2).toString(16);h.length===1&&(h="0"+h),u=u+h}return u.toLowerCase()},qu=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Qu=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};eh=new RegExp("^-?(0*)\\d{1,10}$"),th=-2147483648,nh=2147483647,za=function(t){if(eh.test(t)){let e=Number(t);if(e>=th&&e<=nh)return e}return null},xt=function(t){try{t()}catch(e){setTimeout(()=>{let n=e.stack||"";throw de("Exception was thrown by user callback.",n),e},Math.floor(0))}},ih=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},rn=function(t,e){let n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};_s=class{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,Ha(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n?.getImmediate({optional:!0}),this.appCheck||n?.get().then(i=>this.appCheck=i)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,i):n(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(n=>n.addTokenListener(e))}notifyForInvalidToken(){de(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}};Is=class{constructor(e,n,i){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(se("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,i):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',de(e)}},We=class{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}};We.OWNER="owner";Gn="5",Rl="v",Ml="s",Pl="r",Ll="f",Dl=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Bl="ls",xl="p",ys="ac",Ol="websocket",Kl="long_polling";Un=class{constructor(e,n,i,s,r=!1,o="",a=!1,l=!1,c=null){this.secure=n,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=st.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&st.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}};Es=class{constructor(){this.counters_={}}incrementCounter(e,n=1){Ie(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return ua(this.counters_)}};as={},ls={};Ts=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){let i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&xt(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};Xa="start",oh="close",ah="pLPCommand",lh="pRTLPCB",Hl="id",Gl="pw",Ul="ser",ch="cb",dh="seg",uh="ts",hh="d",fh="dframe",$l=1870,Wl=30,ph=$l-Wl,mh=25e3,gh=3e4,vs=class t{constructor(e,n,i,s,r,o,a){this.connId=e,this.repoInfo=n,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=An(e),this.stats_=gr(n),this.urlFn=l=>(this.appCheckToken&&(l[ys]=this.appCheckToken),Fl(n,Kl,l))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new Ts(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(gh)),zu(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Ns((...r)=>{let[o,a,l,c,d]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Xa)this.id=a,this.password=l;else if(o===oh)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{let[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let i={};i[Xa]="t",i[Ul]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[ch]=this.scriptTagHolder.uniqueCallbackIdentifier),i[Rl]=Gn,this.transportSessionId&&(i[Ml]=this.transportSessionId),this.lastSessionId&&(i[Bl]=this.lastSessionId),this.applicationId&&(i[xl]=this.applicationId),this.appCheckToken&&(i[ys]=this.appCheckToken),typeof location<"u"&&location.hostname&&Dl.test(location.hostname)&&(i[Pl]=Ll);let s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){t.forceAllow_=!0}static forceDisallow(){t.forceDisallow_=!0}static isAvailable(){return Ne()?!1:t.forceAllow_?!0:!t.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!qu()&&!Qu()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let n=Q(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);let i=Hi(n),s=Cl(i,ph);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(e,n){if(Ne())return;this.myDisconnFrame=document.createElement("iframe");let i={};i[fh]="t",i[Hl]=e,i[Gl]=n,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let n=Q(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}},Ns=class t{constructor(e,n,i,s){if(this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,Ne())this.commandCB=e,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=Vu(),window[ah+this.uniqueCallbackIdentifier]=e,window[lh+this.uniqueCallbackIdentifier]=n,this.myIFrame=t.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){se("frame writing exception"),a.stack&&se(a.stack),se(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||se("No IE domain setting required")}catch{let i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[Hl]=this.myID,e[Gl]=this.myPW,e[Ul]=this.currentSerial;let n=this.urlFn(e),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Wl+i.length<=$l;){let o=this.pendingSegs.shift();i=i+"&"+dh+s+"="+o.seg+"&"+uh+s+"="+o.ts+"&"+hh+s+"="+o.d,s++}return n=n+i,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,i){this.pendingSegs.push({seg:e,ts:n,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);let i=()=>{this.outstandingRequests.delete(n),this.newRequest_()},s=setTimeout(i,Math.floor(mh)),r=()=>{clearTimeout(s),i()};this.addTag(e,r)}addTag(e,n){Ne()?this.doNodeLongPoll(e,n):setTimeout(()=>{try{if(!this.sendNewPolls)return;let i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){let s=i.readyState;(!s||s==="loaded"||s==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),n())},i.onerror=()=>{se("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}};Ah=16384,_h=45e3,$n=null;typeof MozWebSocket<"u"?$n=MozWebSocket:typeof WebSocket<"u"&&($n=WebSocket);Le=class t{constructor(e,n,i,s,r,o,a){this.connId=e,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=An(this.connId),this.stats_=gr(n),this.connURL=t.connectionURL_(n,o,a,s,i),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,i,s,r){let o={};return o[Rl]=Gn,!Ne()&&typeof location<"u"&&location.hostname&&Dl.test(location.hostname)&&(o[Pl]=Ll),n&&(o[Ml]=n),i&&(o[Bl]=i),s&&(o[ys]=s),r&&(o[xl]=r),Fl(e,Ol,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,st.set("previous_websocket_failure",!0);try{let i;if(Ne()){let s=this.nodeAdmin?"AdminNode":"Node";i={headers:{"User-Agent":`Firebase/${Gn}/${fr}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);let r=process.env,o=this.connURL.indexOf("wss://")===0?r.HTTPS_PROXY||r.https_proxy:r.HTTP_PROXY||r.http_proxy;o&&(i.proxy={origin:o})}this.mySock=new $n(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){t.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){let n=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(n);i&&i.length>1&&parseFloat(i[1])<4.4&&(e=!0)}return!e&&$n!==null&&!t.forceDisallow_}static previouslyFailed(){return st.isInMemoryStorage||st.get("previous_websocket_failure")===!0}markConnectionHealthy(){st.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let n=this.frames.join("");this.frames=null;let i=yt(n);this.onMessage(i)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(I(this.frames===null,"We already have a frame buffer"),e.length<=6){let n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;let n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{let i=this.extractFrameCount_(n);i!==null&&this.appendFrame_(i)}}send(e){this.resetKeepAlive();let n=Q(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);let i=Cl(n,Ah);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(_h))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}};Le.responsesRequiredToBeHealthy=2;Le.healthyTimeout=3e4;Wn=class t{static get ALL_TRANSPORTS(){return[vs,Le]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){let n=Le&&Le.isAvailable(),i=n&&!Le.previouslyFailed();if(e.webSocketOnly&&(n||de("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Le];else{let s=this.transports_=[];for(let r of t.ALL_TRANSPORTS)r&&r.isAvailable()&&s.push(r);t.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}};Wn.globalTransportInitialized_=!1;Ih=6e4,yh=5e3,Eh=10*1024,Th=100*1024,cs="t",qa="d",vh="s",Qa="r",Nh="e",Za="o",el="a",tl="n",nl="p",bh="h",bs=class{constructor(e,n,i,s,r,o,a,l,c,d){this.id=e,this.repoInfo_=n,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=An("c:"+this.id+":"),this.transportManager_=new Wn(n),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let n=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,i)},Math.floor(0));let s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=rn(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Th?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Eh?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){let n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(cs in e){let n=e[cs];n===el?this.upgradeIfSecondaryHealthy_():n===Qa?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===Za&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let n=en("t",e),i=en("d",e);if(n==="c")this.onSecondaryControl_(i);else if(n==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:nl,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:el,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:tl,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let n=en("t",e),i=en("d",e);n==="c"?this.onControl_(i):n==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let n=en(cs,e);if(qa in e){let i=e[qa];if(n===bh){let s={...i};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(n===tl){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===vh?this.onConnectionShutdown_(i):n===Qa?this.onReset_(i):n===Nh?As("Server Error: "+i):n===Za?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):As("Unknown control packet command: "+n)}}onHandshake_(e){let n=e.ts,i=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),Gn!==i&&de("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let n=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,i),rn(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Ih))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):rn(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(yh))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:nl,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(st.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};jn=class{put(e,n,i,s){}merge(e,n,i,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,i){}onDisconnectMerge(e,n,i){}onDisconnectCancel(e,n){}reportStats(e){}};Vn=class{constructor(e){this.allowedEvents_=e,this.listeners_={},I(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){let i=[...this.listeners_[e]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,n)}}on(e,n,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:i});let s=this.getInitialEvent(e);s&&n.apply(i,s)}off(e,n,i){this.validateEventType_(e);let s=this.listeners_[e]||[];for(let r=0;r<s.length;r++)if(s[r].callback===n&&(!i||i===s[r].context)){s.splice(r,1);return}}validateEventType_(e){I(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}};Jn=class t extends Vn{static getInstance(){return new t}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Ui()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return I(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};il=32,sl=768,K=class{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}};Ss=class{constructor(e,n){this.errorPrefix_=n,this.parts_=cn(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=zt(this.parts_[i]);Vl(this)}};ws=class t extends Vn{static getInstance(){return new t}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{let i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}getInitialEvent(e){return I(e==="visible","Unknown event type: "+e),[this.visible_]}};tn=1e3,Rh=300*1e3,rl=30*1e3,Mh=1.3,Ph=3e4,Lh="server_kill",ol=3,at=class t extends jn{constructor(e,n,i,s,r,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=r,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=t.nextPersistentConnectionId_++,this.log_=An("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=tn,this.maxReconnectDelay_=Rh,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!Ne())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");ws.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Jn.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,i){let s=++this.requestNumber_,r={r:s,a:e,b:n};this.log_(Q(r)),I(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),i&&(this.requestCBHash_[s]=i)}get(e){this.initConnection_();let n=new Re,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{let a=o.d;o.s==="ok"?n.resolve(a):n.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),n.promise}listen(e,n,i,s){this.initConnection_();let r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),I(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),I(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");let a={onComplete:s,hashFn:n,query:e,tag:i};this.listens.get(o).set(r,a),this.connected_&&this.sendListen_(a)}sendGet_(e){let n=this.outstandingGets_[e];this.sendRequest("g",n.request,i=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(i)})}sendListen_(e){let n=e.query,i=n._path.toString(),s=n._queryIdentifier;this.log_("Listen on "+i+" for "+s);let r={p:i},o="q";e.tag&&(r.q=n._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest(o,r,a=>{let l=a.d,c=a.s;t.warnOnListenWarnings_(l,n),(this.listens.get(i)&&this.listens.get(i).get(s))===e&&(this.log_("listen response",a),c!=="ok"&&this.removeListen_(i,s),e.onComplete&&e.onComplete(c,l))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&Ie(e,"w")){let i=et(e,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){let s='".indexOn": "'+n._queryParams.getIndex().toString()+'"',r=n._path.toString();de(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||va(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=rl)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,n=Ta(e)?"auth":"gauth",i={cred:e};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(n,i,s=>{let r=s.s,o=s.d||"error";this.authToken_===e&&(r==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let n=e.s,i=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,i)})}unlisten(e,n){let i=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),I(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,e._queryObject,n)}sendUnlisten_(e,n,i,s){this.log_("Unlisten on "+e+" for "+n);let r={p:e},o="n";s&&(r.q=i,r.t=s),this.sendRequest(o,r)}onDisconnectPut(e,n,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:i})}onDisconnectMerge(e,n,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:i})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,i,s){let r={p:n,d:i};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,n,i,s){this.putInternal("p",e,n,i,s)}merge(e,n,i,s){this.putInternal("m",e,n,i,s)}putInternal(e,n,i,s,r){this.initConnection_();let o={p:n,d:i};r!==void 0&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;let a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+n)}sendPut_(e){let n=this.outstandingPuts_[e].action,i=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,i,r=>{this.log_(n+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(r.s,r.d)})}reportStats(e){if(this.connected_){let n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,i=>{if(i.s!=="ok"){let r=i.d;this.log_("reportStats","Error sending stats: "+r)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Q(e));let n=e.r,i=this.requestCBHash_[n];i&&(delete this.requestCBHash_[n],i(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):As("Unrecognized action received from server: "+Q(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){I(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=tn,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=tn,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Ph&&(this.reconnectDelay_=tn),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Mh)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+t.nextConnectionId_++,r=this.lastSessionId,o=!1,a=null,l=function(){a?a.close():(o=!0,i())},c=function(u){I(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(u)};this.realtime_={close:l,sendRequest:c};let d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[u,h]=await Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);o?se("getToken() completed but was canceled"):(se("getToken() completed. Creating connection."),this.authToken_=u&&u.accessToken,this.appCheckToken_=h&&h.token,a=new bs(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,i,f=>{de(f+" ("+this.repoInfo_.toString()+")"),this.interrupt(Lh)},r))}catch(u){this.log_("Failed to get token: "+u),o||(this.repoInfo_.nodeAdmin&&de(u),l())}}}interrupt(e){se("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){se("Resuming connection for reason: "+e),delete this.interruptReasons_[e],$i(this.interruptReasons_)&&(this.reconnectDelay_=tn,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let i;n?i=n.map(r=>mr(r)).join("$"):i="default";let s=this.removeListen_(e,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,n){let i=new K(e).toString(),s;if(this.listens.has(i)){let r=this.listens.get(i);s=r.get(n),r.delete(n),r.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(e,n){se("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=ol&&(this.reconnectDelay_=rl,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){se("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=ol&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let e of this.listens.values())for(let n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},n="js";Ne()&&(this.repoInfo_.nodeAdmin?n="admin_node":n="node"),e["sdk."+n+"."+fr.replace(/\./g,"-")]=1,Ui()?e["framework.cordova"]=1:_a()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=Jn.getInstance().currentlyOnline();return $i(this.interruptReasons_)&&e}};at.nextPersistentConnectionId_=0;at.nextConnectionId_=0;L=class t{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new t(e,n)}};kt=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){let i=new L(Ct,e),s=new L(Ct,n);return this.compare(i,s)!==0}minPost(){return L.MIN}};Yn=class extends kt{static get __EMPTY_NODE(){return Hn}static set __EMPTY_NODE(e){Hn=e}compare(e,n){return ct(e.name,n.name)}isDefinedOn(e){throw Ze("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return L.MIN}maxPost(){return new L(ot,Hn)}makePost(e,n){return I(typeof e=="string","KeyIndex indexValue must always be a string."),new L(e,Hn)}toString(){return".key"}},St=new Yn;Nt=class{constructor(e,n,i,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?i(e.key,n):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},ce=class t{constructor(e,n,i,s,r){this.key=e,this.value=n,this.color=i??t.RED,this.left=s??me.EMPTY_NODE,this.right=r??me.EMPTY_NODE}copy(e,n,i,s,r){return new t(e??this.key,n??this.value,i??this.color,s??this.left,r??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,i){let s=this,r=i(e,s.key);return r<0?s=s.copy(null,null,null,s.left.insert(e,n,i),null):r===0?s=s.copy(null,n,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,n,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return me.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let i,s;if(i=this,n(e,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),n(e,i.key)===0){if(i.right.isEmpty())return me.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){let e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};ce.RED=!0;ce.BLACK=!1;Cs=class{copy(e,n,i,s,r){return this}insert(e,n,i){return new ce(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},me=class t{constructor(e,n=t.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new t(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,ce.BLACK,null,null))}remove(e){return new t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,ce.BLACK,null,null))}get(e){let n,i=this.root_;for(;!i.isEmpty();){if(n=this.comparator_(e,i.key),n===0)return i.value;n<0?i=i.left:n>0&&(i=i.right)}return null}getPredecessorKey(e){let n,i=this.root_,s=null;for(;!i.isEmpty();)if(n=this.comparator_(e,i.key),n===0){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else n<0?i=i.left:n>0&&(s=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Nt(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new Nt(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new Nt(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new Nt(this.root_,null,this.comparator_,!0,e)}};me.EMPTY_NODE=new Cs;Jl=function(t){return typeof t=="number"?"number:"+kl(t):"string:"+t},Yl=function(t){if(t.isLeafNode()){let e=t.val();I(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Ie(e,".sv"),"Priority must be a string or number.")}else I(t===ks||t.isEmpty(),"priority of unexpected type.");I(t===ks||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};Be=class t{static set __childrenNodeConstructor(e){al=e}static get __childrenNodeConstructor(){return al}constructor(e,n=t.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,I(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Yl(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new t(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return D(e)?this:P(e)===".priority"?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:t.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){let i=P(e);return i===null?n:n.isEmpty()&&i!==".priority"?this:(I(i!==".priority"||Ve(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,t.__childrenNodeConstructor.EMPTY_NODE.updateChild(j(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Jl(this.priorityNode_.val())+":");let n=typeof this.value_;e+=n+":",n==="number"?e+=kl(this.value_):e+=this.value_,this.lazyHash_=wl(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===t.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof t.__childrenNodeConstructor?-1:(I(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let n=typeof e.value_,i=typeof this.value_,s=t.VALUE_TYPE_ORDER.indexOf(n),r=t.VALUE_TYPE_ORDER.indexOf(i);return I(s>=0,"Unknown leaf type: "+n),I(r>=0,"Unknown leaf type: "+i),s===r?i==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){let n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}};Be.VALUE_TYPE_ORDER=["object","boolean","number","string"];Rs=class extends kt{compare(e,n){let i=e.node.getPriority(),s=n.node.getPriority(),r=i.compareTo(s);return r===0?ct(e.name,n.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return L.MIN}maxPost(){return new L(ot,new Be("[PRIORITY-POST]",Xl))}makePost(e,n){let i=zl(e);return new L(n,new Be("[PRIORITY-POST]",i))}toString(){return".priority"}},z=new Rs;Kh=Math.log(2),Ms=class{constructor(e){let n=r=>parseInt(Math.log(r)/Kh,10),i=r=>parseInt(Array(r+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;let s=i(this.count);this.bits_=e+1&s}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},zn=function(t,e,n,i){t.sort(e);let s=function(l,c){let d=c-l,u,h;if(d===0)return null;if(d===1)return u=t[l],h=n?n(u):u,new ce(h,u.node,ce.BLACK,null,null);{let f=parseInt(d/2,10)+l,p=s(l,f),g=s(f+1,c);return u=t[f],h=n?n(u):u,new ce(h,u.node,ce.BLACK,p,g)}},r=function(l){let c=null,d=null,u=t.length,h=function(p,g){let m=u-p,v=u;u-=p;let E=s(m+1,v),y=t[m],_=n?n(y):y;f(new ce(_,y.node,g,null,E))},f=function(p){c?(c.left=p,c=p):(d=p,c=p)};for(let p=0;p<l.count;++p){let g=l.nextBitIsOne(),m=Math.pow(2,l.count-(p+1));g?h(m,ce.BLACK):(h(m,ce.BLACK),h(m,ce.RED))}return d},o=new Ms(t.length),a=r(o);return new me(i||e,a)};vt={},Rt=class t{static get Default(){return I(vt&&z,"ChildrenNode.ts has not been loaded"),ds=ds||new t({".priority":vt},{".priority":z}),ds}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){let n=et(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof me?n:null}hasIndex(e){return Ie(this.indexSet_,e.toString())}addIndex(e,n){I(e!==St,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],s=!1,r=n.getIterator(L.Wrap),o=r.getNext();for(;o;)s=s||e.isDefinedOn(o.node),i.push(o),o=r.getNext();let a;s?a=zn(i,e.getCompare()):a=vt;let l=e.toString(),c={...this.indexSet_};c[l]=e;let d={...this.indexes_};return d[l]=a,new t(d,c)}addToIndexes(e,n){let i=Jt(this.indexes_,(s,r)=>{let o=et(this.indexSet_,r);if(I(o,"Missing index implementation for "+r),s===vt)if(o.isDefinedOn(e.node)){let a=[],l=n.getIterator(L.Wrap),c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),zn(a,o.getCompare())}else return vt;else{let a=n.get(e.name),l=s;return a&&(l=l.remove(new L(e.name,a))),l.insert(e,e.node)}});return new t(i,this.indexSet_)}removeFromIndexes(e,n){let i=Jt(this.indexes_,s=>{if(s===vt)return s;{let r=n.get(e.name);return r?s.remove(new L(e.name,r)):s}});return new t(i,this.indexSet_)}};R=class t{static get EMPTY_NODE(){return nn||(nn=new t(new me(Ir),null,Rt.Default))}constructor(e,n,i){this.children_=e,this.priorityNode_=n,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&Yl(this.priorityNode_),this.children_.isEmpty()&&I(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||nn}updatePriority(e){return this.children_.isEmpty()?this:new t(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{let n=this.children_.get(e);return n===null?nn:n}}getChild(e){let n=P(e);return n===null?this:this.getImmediateChild(n).getChild(j(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(I(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{let i=new L(e,n),s,r;n.isEmpty()?(s=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(e,n),r=this.indexMap_.addToIndexes(i,this.children_));let o=s.isEmpty()?nn:this.priorityNode_;return new t(s,o,r)}}updateChild(e,n){let i=P(e);if(i===null)return n;{I(P(e)!==".priority"||Ve(e)===1,".priority must be the last token in a path");let s=this.getImmediateChild(i).updateChild(j(e),n);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let n={},i=0,s=0,r=!0;if(this.forEachChild(z,(o,a)=>{n[o]=a.val(e),i++,r&&t.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):r=!1}),!e&&r&&s<2*i){let o=[];for(let a in n)o[a]=n[a];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+Jl(this.getPriority().val())+":"),this.forEachChild(z,(n,i)=>{let s=i.hash();s!==""&&(e+=":"+n+":"+s)}),this.lazyHash_=e===""?"":wl(e)}return this.lazyHash_}getPredecessorChildName(e,n,i){let s=this.resolveIndex_(i);if(s){let r=s.getPredecessorKey(new L(e,n));return r?r.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){let n=this.resolveIndex_(e);if(n){let i=n.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(e){let n=this.getFirstChildName(e);return n?new L(n,this.children_.get(n)):null}getLastChildName(e){let n=this.resolveIndex_(e);if(n){let i=n.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(e){let n=this.getLastChildName(e);return n?new L(n,this.children_.get(n)):null}forEachChild(e,n){let i=this.resolveIndex_(e);return i?i.inorderTraversal(s=>n(s.name,s.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){let i=this.resolveIndex_(n);if(i)return i.getIteratorFrom(e,s=>s);{let s=this.children_.getIteratorFrom(e.name,L.Wrap),r=s.peek();for(;r!=null&&n.compare(r,e)<0;)s.getNext(),r=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){let i=this.resolveIndex_(n);if(i)return i.getReverseIteratorFrom(e,s=>s);{let s=this.children_.getReverseIteratorFrom(e.name,L.Wrap),r=s.peek();for(;r!=null&&n.compare(r,e)>0;)s.getNext(),r=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===_n?-1:0}withIndex(e){if(e===St||this.indexMap_.hasIndex(e))return this;{let n=this.indexMap_.addIndex(e,this.children_);return new t(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===St||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{let n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){let i=this.getIterator(z),s=n.getIterator(z),r=i.getNext(),o=s.getNext();for(;r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=i.getNext(),o=s.getNext()}return r===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===St?null:this.indexMap_.get(e.toString())}};R.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;Ps=class extends R{constructor(){super(new me(Ir),R.EMPTY_NODE,Rt.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return R.EMPTY_NODE}isEmpty(){return!1}},_n=new Ps;Object.defineProperties(L,{MIN:{value:new L(Ct,R.EMPTY_NODE)},MAX:{value:new L(ot,_n)}});Yn.__EMPTY_NODE=R.EMPTY_NODE;Be.__childrenNodeConstructor=R;Bh(_n);Oh(_n);Fh=!0;xh(ee);Ls=class extends kt{constructor(e){super(),this.indexPath_=e,I(!D(e)&&P(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){let i=this.extractChild(e.node),s=this.extractChild(n.node),r=i.compareTo(s);return r===0?ct(e.name,n.name):r}makePost(e,n){let i=ee(e),s=R.EMPTY_NODE.updateChild(this.indexPath_,i);return new L(n,s)}maxPost(){let e=R.EMPTY_NODE.updateChild(this.indexPath_,_n);return new L(ot,e)}toString(){return cn(this.indexPath_,0).join("/")}};Ds=class extends kt{compare(e,n){let i=e.node.compareTo(n.node);return i===0?ct(e.name,n.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return L.MIN}maxPost(){return L.MAX}makePost(e,n){let i=ee(e);return new L(n,i)}toString(){return".value"}},Hh=new Ds;hn=class{constructor(e){this.index_=e}updateChild(e,n,i,s,r,o){I(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(n);return a.getChild(s).equals(i.getChild(s))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(n)?o.trackChildChange(dn(n,a)):I(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Mt(n,i)):o.trackChildChange(un(n,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(n,i).withIndex(this.index_)}updateFullNode(e,n,i){return i!=null&&(e.isLeafNode()||e.forEachChild(z,(s,r)=>{n.hasChild(s)||i.trackChildChange(dn(s,r))}),n.isLeafNode()||n.forEachChild(z,(s,r)=>{if(e.hasChild(s)){let o=e.getImmediateChild(s);o.equals(r)||i.trackChildChange(un(s,r,o))}else i.trackChildChange(Mt(s,r))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?R.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};Xn=class t{constructor(e){this.indexedFilter_=new hn(e.getIndex()),this.index_=e.getIndex(),this.startPost_=t.getStartPost_(e),this.endPost_=t.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&i}updateChild(e,n,i,s,r,o){return this.matches(new L(n,i))||(i=R.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,i,s,r,o)}updateFullNode(e,n,i){n.isLeafNode()&&(n=R.EMPTY_NODE);let s=n.withIndex(this.index_);s=s.updatePriority(R.EMPTY_NODE);let r=this;return n.forEachChild(z,(o,a)=>{r.matches(new L(o,a))||(s=s.updateImmediateChild(o,R.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,i)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}};Bs=class{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{let i=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=n=>{let i=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new Xn(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,i,s,r,o){return this.rangedFilter_.matches(new L(n,i))||(i=R.EMPTY_NODE),e.getImmediateChild(n).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,i,s,r,o):this.fullLimitUpdateChild_(e,n,i,r,o)}updateFullNode(e,n,i){let s;if(n.isLeafNode()||n.isEmpty())s=R.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){s=R.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){let a=r.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=n.withIndex(this.index_),s=s.updatePriority(R.EMPTY_NODE);let r;this.reverse_?r=s.getReverseIterator(this.index_):r=s.getIterator(this.index_);let o=0;for(;r.hasNext();){let a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,R.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,i)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,i,s,r){let o;if(this.reverse_){let u=this.index_.getCompare();o=(h,f)=>u(f,h)}else o=this.index_.getCompare();let a=e;I(a.numChildren()===this.limit_,"");let l=new L(n,i),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(l);if(a.hasChild(n)){let u=a.getImmediateChild(n),h=s.getChildAfterChild(this.index_,c,this.reverse_);for(;h!=null&&(h.name===n||a.hasChild(h.name));)h=s.getChildAfterChild(this.index_,h,this.reverse_);let f=h==null?1:o(h,l);if(d&&!i.isEmpty()&&f>=0)return r?.trackChildChange(un(n,i,u)),a.updateImmediateChild(n,i);{r?.trackChildChange(dn(n,u));let g=a.updateImmediateChild(n,R.EMPTY_NODE);return h!=null&&this.rangedFilter_.matches(h)?(r?.trackChildChange(Mt(h.name,h.node)),g.updateImmediateChild(h.name,h.node)):g}}else return i.isEmpty()?e:d&&o(c,l)>=0?(r!=null&&(r.trackChildChange(dn(c.name,c.node)),r.trackChildChange(Mt(n,i))),a.updateImmediateChild(n,i).updateImmediateChild(c.name,R.EMPTY_NODE)):e}};xs=class t{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=z}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return I(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return I(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Ct}hasEnd(){return this.endSet_}getIndexEndValue(){return I(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return I(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ot}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return I(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===z}copy(){let e=new t;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};Os=class t extends jn{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(I(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,i,s){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=An("p:rest:"),this.listens_={}}listen(e,n,i,s){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let o=t.getListenId_(e,i),a={};this.listens_[o]=a;let l=ll(e._queryParams);this.restRequest_(r+".json",l,(c,d)=>{let u=d;if(c===404&&(u=null,c=null),c===null&&this.onDataUpdate_(r,u,!1,i),et(this.listens_,o)===a){let h;c?c===401?h="permission_denied":h="rest_error:"+c:h="ok",s(h,null)}})}unlisten(e,n){let i=t.getListenId_(e,n);delete this.listens_[i]}get(e){let n=ll(e._queryParams),i=e._path.toString(),s=new Re;return this.restRequest_(i+".json",n,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(i,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,n={},i){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(n.auth=s.accessToken),r&&r.token&&(n.ac=r.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Na(n);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=yt(a.responseText)}catch{de("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,l)}else a.status!==401&&a.status!==404&&de("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}};Ks=class{constructor(){this.rootNode_=R.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}};Hs=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),n={...e};return this.last_&&re(this.last_,(i,s)=>{n[i]=n[i]-s}),this.last_=e,n}};dl=10*1e3,Wh=30*1e3,jh=300*1e3,Gs=class{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new Hs(e);let i=dl+(Wh-dl)*Math.random();rn(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){let e=this.statsListener_.get(),n={},i=!1;re(e,(s,r)=>{r>0&&Ie(this.statsToReport_,s)&&(n[s]=r,i=!0)}),i&&this.server_.reportStats(n),rn(this.reportStats_.bind(this),Math.floor(Math.random()*2*jh))}};(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(ye||(ye={}));Us=class t{constructor(e,n,i){this.path=e,this.affectedTree=n,this.revert=i,this.type=ye.ACK_USER_WRITE,this.source=yr()}operationForChild(e){if(D(this.path)){if(this.affectedTree.value!=null)return I(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let n=this.affectedTree.subtree(new K(e));return new t(O(),n,this.revert)}}else return I(P(this.path)===e,"operationForChild called for unrelated child."),new t(j(this.path),this.affectedTree,this.revert)}};Qn=class t{constructor(e,n){this.source=e,this.path=n,this.type=ye.LISTEN_COMPLETE}operationForChild(e){return D(this.path)?new t(this.source,O()):new t(this.source,j(this.path))}};Pt=class t{constructor(e,n,i){this.source=e,this.path=n,this.snap=i,this.type=ye.OVERWRITE}operationForChild(e){return D(this.path)?new t(this.source,O(),this.snap.getImmediateChild(e)):new t(this.source,j(this.path),this.snap)}};fn=class t{constructor(e,n,i){this.source=e,this.path=n,this.children=i,this.type=ye.MERGE}operationForChild(e){if(D(this.path)){let n=this.children.subtree(new K(e));return n.isEmpty()?null:n.value?new Pt(this.source,O(),n.value):new t(this.source,O(),n)}else return I(P(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new t(this.source,j(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};xe=class{constructor(e,n,i){this.node_=e,this.fullyInitialized_=n,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(D(e))return this.isFullyInitialized()&&!this.filtered_;let n=P(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};$s=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};zh=()=>(us||(us=new me(Xu)),us),ue=class t{static fromObject(e){let n=new t(null);return re(e,(i,s)=>{n=n.set(new K(i),s)}),n}constructor(e,n=zh()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:O(),value:this.value};if(D(e))return null;{let i=P(e),s=this.children.get(i);if(s!==null){let r=s.findRootMostMatchingPathAndValue(j(e),n);return r!=null?{path:Y(new K(i),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(D(e))return this;{let n=P(e),i=this.children.get(n);return i!==null?i.subtree(j(e)):new t(null)}}set(e,n){if(D(e))return new t(n,this.children);{let i=P(e),r=(this.children.get(i)||new t(null)).set(j(e),n),o=this.children.insert(i,r);return new t(this.value,o)}}remove(e){if(D(e))return this.children.isEmpty()?new t(null):new t(null,this.children);{let n=P(e),i=this.children.get(n);if(i){let s=i.remove(j(e)),r;return s.isEmpty()?r=this.children.remove(n):r=this.children.insert(n,s),this.value===null&&r.isEmpty()?new t(null):new t(this.value,r)}else return this}}get(e){if(D(e))return this.value;{let n=P(e),i=this.children.get(n);return i?i.get(j(e)):null}}setTree(e,n){if(D(e))return n;{let i=P(e),r=(this.children.get(i)||new t(null)).setTree(j(e),n),o;return r.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,r),new t(this.value,o)}}fold(e){return this.fold_(O(),e)}fold_(e,n){let i={};return this.children.inorderTraversal((s,r)=>{i[s]=r.fold_(Y(e,s),n)}),n(e,this.value,i)}findOnPath(e,n){return this.findOnPath_(e,O(),n)}findOnPath_(e,n,i){let s=this.value?i(n,this.value):!1;if(s)return s;if(D(e))return null;{let r=P(e),o=this.children.get(r);return o?o.findOnPath_(j(e),Y(n,r),i):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,O(),n)}foreachOnPath_(e,n,i){if(D(e))return this;{this.value&&i(n,this.value);let s=P(e),r=this.children.get(s);return r?r.foreachOnPath_(j(e),Y(n,s),i):new t(null)}}foreach(e){this.foreach_(O(),e)}foreach_(e,n){this.children.inorderTraversal((i,s)=>{s.foreach_(Y(e,i),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,i)=>{i.value&&e(n,i.value)})}};Ee=class t{constructor(e){this.writeTree_=e}static empty(){return new t(new ue(null))}};Ys=class{constructor(){this.changeMap=new Map}trackChildChange(e){let n=e.type,i=e.childName;I(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),I(i!==".priority","Only non-priority child changes can be tracked.");let s=this.changeMap.get(i);if(s){let r=s.type;if(n==="child_added"&&r==="child_removed")this.changeMap.set(i,un(i,e.snapshotNode,s.snapshotNode));else if(n==="child_removed"&&r==="child_added")this.changeMap.delete(i);else if(n==="child_removed"&&r==="child_changed")this.changeMap.set(i,dn(i,s.oldSnap));else if(n==="child_changed"&&r==="child_added")this.changeMap.set(i,Mt(i,e.snapshotNode));else if(n==="child_changed"&&r==="child_changed")this.changeMap.set(i,un(i,e.snapshotNode,s.oldSnap));else throw Ze("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}};zs=class{getCompleteChild(e){return null}getChildAfterChild(e,n,i){return null}},rc=new zs,pn=class{constructor(e,n,i=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=i}getCompleteChild(e){let n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{let i=this.optCompleteServerCache_!=null?new xe(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return br(this.writes_,e,i)}}getChildAfterChild(e,n,i){let s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:lt(this.viewCache_),r=df(this.writes_,s,n,1,i,e);return r.length===0?null:r[0]}};Qs=class{constructor(e,n){this.query_=e,this.eventRegistrations_=[];let i=this.query_._queryParams,s=new hn(i.getIndex()),r=Uh(i);this.processor_=uf(r);let o=n.serverCache,a=n.eventCache,l=s.updateFullNode(R.EMPTY_NODE,o.getNode(),null),c=r.updateFullNode(R.EMPTY_NODE,a.getNode(),null),d=new xe(l,o.isFullyInitialized(),s.filtersNodes()),u=new xe(c,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=ci(u,d),this.eventGenerator_=new $s(this.query_)}get query(){return this.query_}};Zs=class{constructor(){this.views=new Map}};Mf=1,si=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ue(null),this.pendingWriteTree_=cf(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};tr=class t{constructor(e){this.node_=e}getImmediateChild(e){let n=this.node_.getImmediateChild(e);return new t(n)}node(){return this.node_}},nr=class t{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){let n=Y(this.path_,e);return new t(this.syncTree_,n)}node(){return wr(this.syncTree_,this.path_)}},Uf=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},yl=function(t,e,n){if(!t||typeof t!="object")return t;if(I(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return $f(t[".sv"],e,n);if(typeof t[".sv"]=="object")return Wf(t[".sv"],e);I(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},$f=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:I(!1,"Unexpected server value: "+t)}},Wf=function(t,e,n){t.hasOwnProperty("increment")||I(!1,"Unexpected server value: "+JSON.stringify(t,null,2));let i=t.increment;typeof i!="number"&&I(!1,"Unexpected increment value: "+i);let s=e.node();if(I(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;let o=s.getValue();return typeof o!="number"?i:o+i},mc=function(t,e,n,i){return Mr(e,new nr(n,t),i)},gc=function(t,e,n){return Mr(t,new tr(e),n)};mn=class{constructor(e="",n=null,i={children:{},childCount:0}){this.name=e,this.parent=n,this.node=i}};Yf=/[\[\].#$\/\u0000-\u001F\u007F]/,zf=/[\[\].#$\u0000-\u001F\u007F]/,hs=10*1024*1024,Lr=function(t){return typeof t=="string"&&t.length!==0&&!Yf.test(t)},yc=function(t){return typeof t=="string"&&t.length!==0&&!zf.test(t)},Xf=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),yc(t)},qf=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!pr(t)||t&&typeof t=="object"&&Ie(t,".sv")},Ec=function(t,e,n,i){i&&e===void 0||pi(Yt(t,"value"),e,n)},pi=function(t,e,n){let i=n instanceof K?new Ss(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+it(i));if(typeof e=="function")throw new Error(t+"contains a function "+it(i)+" with contents = "+e.toString());if(pr(e))throw new Error(t+"contains "+e.toString()+" "+it(i));if(typeof e=="string"&&e.length>hs/3&&zt(e)>hs)throw new Error(t+"contains a string greater than "+hs+" utf8 bytes "+it(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,r=!1;if(re(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!Lr(o)))throw new Error(t+" contains an invalid key ("+o+") "+it(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Ch(i,o),pi(t,a,i),kh(i)}),s&&r)throw new Error(t+' contains ".value" child '+it(i)+" in addition to actual children.")}},Qf=function(t,e){let n,i;for(n=0;n<e.length;n++){i=e[n];let r=cn(i);for(let o=0;o<r.length;o++)if(!(r[o]===".priority"&&o===r.length-1)){if(!Lr(r[o]))throw new Error(t+"contains an invalid key ("+r[o]+") in path "+i.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(wh);let s=null;for(n=0;n<e.length;n++){if(i=e[n],s!==null&&pe(s,i))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+i.toString());s=i}},Zf=function(t,e,n,i){if(i&&e===void 0)return;let s=Yt(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");let r=[];re(e,(o,a)=>{let l=new K(o);if(pi(s,a,Y(n,l)),Ar(l)===".priority"&&!qf(a))throw new Error(s+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(l)}),Qf(s,r)},Tc=function(t,e,n,i){if(!(i&&n===void 0)&&!yc(n))throw new Error(Yt(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},ep=function(t,e,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Tc(t,e,n,i)},Dr=function(t,e){if(P(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},tp=function(t,e){let n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Lr(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!Xf(n))throw new Error(Yt(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};sr=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};ip="repo_interrupt",sp=25,rr=class{constructor(e,n,i,s){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new sr,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=qn(),this.transactionQueueTree_=new mn,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};Nl=function(t,e){let n=gp(t),i=n.namespace;n.domain==="firebase.com"&&De(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&n.domain!=="localhost"&&De("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||Yu();let s=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new Un(n.host,n.secure,i,s,e,"",i!==n.subdomain),path:new K(n.pathString)}},gp=function(t){let e="",n="",i="",s="",r="",o=!0,a="https",l=443;if(typeof t=="string"){let c=t.indexOf("//");c>=0&&(a=t.substring(0,c-1),t=t.substring(c+2));let d=t.indexOf("/");d===-1&&(d=t.length);let u=t.indexOf("?");u===-1&&(u=t.length),e=t.substring(0,Math.min(d,u)),d<u&&(s=pp(t.substring(d,u)));let h=mp(t.substring(Math.min(t.length,u)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;let f=e.slice(0,c);if(f.toLowerCase()==="localhost")n="localhost";else if(f.split(".").length<=2)n=f;else{let p=e.indexOf(".");i=e.substring(0,p).toLowerCase(),n=e.substring(p+1),r=i}"ns"in h&&(r=h.ns)}return{host:e,port:l,domain:n,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}};bl="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Ap=(function(){let t=0,e=[];return function(n){let i=n===t;t=n;let s,r=new Array(8);for(s=7;s>=0;s--)r[s]=bl.charAt(n%64),n=Math.floor(n/64);I(n===0,"Cannot push at time == 0");let o=r.join("");if(i){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=bl.charAt(e[s]);return I(o.length===20,"nextPushId: Length should be 20."),o}})();oi=class{constructor(e,n,i,s){this.eventType=e,this.eventRegistration=n,this.snapshot=i,this.prevName=s}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Q(this.snapshot.exportVal())}},ai=class{constructor(e,n,i){this.eventRegistration=e,this.error=n,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};ar=class{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return I(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};lr=class t{constructor(e,n,i,s){this._repo=e,this._path=n,this._queryParams=i,this._orderByCalled=s}get key(){return D(this._path)?null:Ar(this._path)}get ref(){return new Oe(this._repo,this._path)}get _queryIdentifier(){let e=cl(this._queryParams),n=mr(e);return n==="{}"?"default":n}get _queryObject(){return cl(this._queryParams)}isEqual(e){if(e=tt(e),!(e instanceof t))return!1;let n=this._repo===e._repo,i=_r(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return n&&i&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+Sh(this._path)}},Oe=class t extends lr{constructor(e,n){super(e,n,new xs,!1)}get parent(){let e=jl(this._path);return e===null?null:new t(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},li=class t{constructor(e,n,i){this._node=e,this.ref=n,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let n=new K(e),i=Bt(this.ref,e);return new t(this._node.getChild(n),i,z)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,s)=>e(new t(s,Bt(this.ref,i),z)))}hasChild(e){let n=new K(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};cr=class t{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){let i=n._queryParams.getIndex();return new oi("value",this,new li(e.snapshotNode,new Oe(n._repo,n._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new ai(this,e,n):null}matches(e){return e instanceof t?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},dr=class t{constructor(e,n){this.eventType=e,this.callbackContext=n}respondsTo(e){let n=e==="children_added"?"child_added":e;return n=n==="children_removed"?"child_removed":n,this.eventType===n}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new ai(this,e,n):null}createEvent(e,n){I(e.childName!=null,"Child events should have a childName.");let i=Bt(new Oe(n._repo,n._path),e.childName),s=n._queryParams.getIndex();return new oi(e.type,this,new li(e.snapshotNode,i,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof t?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};vf(Oe);kf(Oe);Ip="FIREBASE_DATABASE_EMULATOR_HOST",ur={},yp=!1;hr=class{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(rp(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Oe(this._repo,O())),this._rootInternal}_delete(){return this._rootInternal!==null&&(vp(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&De("Cannot call "+e+" on a deleted database.")}};at.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};at.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};Sp()});var Dc=k(()=>{Lc()});var vi={};ho(vi,{db:()=>Ti,onValue:()=>Ei,push:()=>Rc,ref:()=>yn,remove:()=>Mc,set:()=>Ii,update:()=>yi});var wp,Cp,Ti,En=k(()=>{ja();Dc();wp={apiKey:"AIzaSyD6HY-9A-vtf_fv11SK3WxKElHKGQvU4Sg",authDomain:"istanapayment-aedab.firebaseapp.com",projectId:"istanapayment-aedab",storageBucket:"istanapayment-aedab.firebasestorage.app",messagingSenderId:"930279412253",appId:"1:930279412253:web:e607079fef82854a6becf4",measurementId:"G-7W562SKYFV"},Cp=os(wp),Ti=Pc(Cp)});function Bc(t){let e=document.getElementById("hargaJualInput");if(!e)return t;let n=e.textContent.replace(/[^\d]/g,"");return parseInt(n||"0",10)||t}async function xc(t,e){let n=V(t.harga),i=t.kode?t.kode.toUpperCase():"",s=n===0;if((i==="CPLN"||i==="CBPJSKS"||i==="CINDIHOME"||i==="CTELKOM"||i.startsWith("CPAM"))&&t.sn){let f=t.sn.match(/TTAG=([\d.]+)/);f&&(n=parseFloat(f[1])*1e3)}let r=_t[i];if(!r){let f=[{prefix:"T",regex:/^T(\d+)$/,provider:"TELKOMSEL"},{prefix:"I",regex:/^I(\d+)$/,provider:"INDOSAT"},{prefix:"A",regex:/^A(\d+)$/,provider:"AXIS"},{prefix:"X",regex:/^X(\d+)$/,provider:"XL"},{prefix:"TR",regex:/^TR(\d+)$/,provider:"TRI"},{prefix:"S",regex:/^S(\d+)$/,provider:"SMARTFREN"},{prefix:"B",regex:/^B(\d+)$/,provider:"BYU"},{prefix:"P",regex:/^P(\d+)$/,provider:"TOKEN LISTRIK"}];for(let p of f){let g=i.match(p.regex);if(g){let m=parseInt(g[1],10);r=p.prefix==="P"?`${p.provider} ${m.toLocaleString("id-ID")} RB`:`PULSA ${p.provider} ${m.toLocaleString("id-ID")} RB`;break}}r||(r="-")}let o=na(i,n),a=()=>o-n,l="hargaJualInput",c=`<table class="detail-table-laporan-modal">
<tr><td>Waktu Pengisian</td><td>${e} ${t.waktu}</td></tr>
<tr><td>Nomor Tujuan</td><td>${t.tujuan}</td></tr>
<tr><td>Kode Produk</td><td>${t.kode}</td></tr>
<tr><td>Deskripsi</td><td>${r}</td></tr>
<tr><td>Serial Number</td><td>${t.sn}</td></tr>
<tr><td>Status Transaksi</td><td>${t.status}</td></tr>
</table>
<table class="detail-table-laporan-modal">
<tr><td>Harga Modal</td><td>Rp${n.toLocaleString("id-ID")}</td></tr>
<tr><td>Saran Harga Jual</td><td><span id="editHarga" style="cursor:pointer;">\u270F\uFE0F </span><span id="${l}">Rp${o.toLocaleString("id-ID")}</span></td></tr>
<tr><td>Keuntungan</td><td id="keuntungan">Rp${a().toLocaleString("id-ID")}</td></tr>
</table>`,u=["-","NA","N/A","n/a","N.A","Update","UPDATE"].includes((t.sn||"").trim());H({title:"DETAIL TRANSAKSI",message:c,buttons:[{text:"\u{1F5BC}\uFE0F Bagikan",className:"modal-share",onClick:()=>Qo(t,e,Bc(o)),disabled:u||s},{text:"\u{1F4DD} Komplain",className:"modal-complain",onClick:()=>{let f=`Mohon bantu cek transaksi berikut:

Tanggal : ${e} jam ${t.waktu}
Kode Produk : ${t.kode}
Deskripsi : ${r}
Tujuan : ${t.tujuan}
Serial Number : ${t.sn}
Status : ${t.status}
Terima kasih.
`,g=`https://wa.me/6283100100190?text=${encodeURIComponent(f)}`;window.open(g,"_blank")}},{text:"\u{1F5A8}\uFE0F Print",className:"modal-print",onClick:()=>sa(t,e,Bc(o)),disabled:u||s},{text:"\u{1F4B0} Catat Hutang",className:"modal-debt",onClick:async()=>{try{let{db:f,ref:p,push:g,set:m}=await Promise.resolve().then(()=>(En(),vi)),v=localStorage.getItem("kode_agen")||"Unknown",E={waktu:e+" "+t.waktu,kode:t.kode,deskripsi:r,nomor:t.tujuan,snRef:t.sn,harga:n,hargaJual:o,kode_agen:v,status:"BELUM BAYAR",timestamp:Date.now()},y=p(f,"hutang"),_=g(y);await m(_,E),S("Data hutang berhasil dicatat","success",2e3);let T=document.getElementById("navAkun");T&&(T.click(),document.getElementById("catatanHutangDisplay").style.display="block",document.getElementById("akunDisplay").style.display="none")}catch(f){console.error("Gagal mencatat hutang:",f),S("\u274C Gagal mencatat ke Firebase","error")}},disabled:u||s}]});let h=document.getElementById("editHarga");h.onclick=()=>{h.style.display="none";let f=document.getElementById(l),p=o;f.innerHTML=`<input id="inputHargaInline" type="text" value="${p.toLocaleString("id-ID")}" style="padding:0; margin:0; width:80px; height:1.2em; line-height:1.2em; border:1px solid #ccc; vertical-align:middle; text-align:right;"><span id="btnSimpanInline" style="cursor:pointer; margin-left:4px;">\u2705</span><span id="btnBatalInline" style="cursor:pointer; margin-left:4px;">\u274C</span>`;let g=document.getElementById("inputHargaInline");g.addEventListener("keydown",m=>{m.key==="Enter"?(m.preventDefault(),document.getElementById("btnSimpanInline").click()):m.key==="Escape"&&document.getElementById("btnBatalInline").click()}),g.addEventListener("input",()=>{let m=g.selectionStart,v=g.selectionEnd,E=g.value.replace(/\D/g,"");if(E){let y=parseInt(E,10).toLocaleString("id-ID"),_=g.value,T=y.length-_.length;g.value=y,g.setSelectionRange(m+T,v+T)}else g.value=""}),document.getElementById("btnSimpanInline").onclick=()=>{let m=g.value.replace(/\D/g,""),v=parseFloat(m);!isNaN(v)&&v>0?(o=v,f.textContent="Rp"+o.toLocaleString("id-ID"),document.getElementById("keuntungan").textContent="Rp"+(o-n).toLocaleString("id-ID")):(S("Harga tidak valid!","error"),f.textContent="Rp"+o.toLocaleString("id-ID")),h.style.display="inline"},document.getElementById("btnBatalInline").onclick=()=>{f.textContent="Rp"+o.toLocaleString("id-ID"),h.style.display="inline"}}}var Oc=k(()=>{ke();x();Zo();ia();ra();Rn()});function Fr(t,e,n){if(!t||!e)return;let i=document.createElement("div");i.className="laporan-item",i.style.display="grid",i.style.gridTemplateColumns="1fr auto",i.style.alignItems="flex-start",i.style.padding="0.25rem 0.5rem",i.style.borderBottom="1px solid #ddd",i.style.gap="0.5rem",i.style.fontSize="0.85rem";let s=document.createElement("div");s.innerHTML=`
    <div><b>${t.kode}</b> \u2192 ${t.tujuan} \u2192 Rp ${t.harga}</div>
    <div class="sn-text">SN: ${t.sn}</div>
`;let r=document.createElement("div");r.style.display="flex",r.style.flexDirection="column",r.style.alignItems="flex-end",r.style.whiteSpace="nowrap",r.innerHTML=`
        <div style="font-weight:bold">${t.waktu}</div>
        <div>${t.status}</div>
    `;let o=t.status.toLowerCase();o.includes("sukses")?i.classList.add("success"):o.includes("gagal")||o.includes("timeout")?i.classList.add("failed"):i.classList.add("proses"),i.appendChild(s),i.appendChild(r),e.appendChild(i),i.addEventListener("click",()=>xc(t,n))}var Kc=k(()=>{Oc()});function Uc(){let t=document.getElementById("navRiwayat"),e=new Date;Gc=new Date(e.toLocaleString("en-US",{timeZone:"Asia/Jakarta"})).getDate(),t.addEventListener("click",xi)}function xi(){A(`laporan.${Gc}`),kp.style.display="block"}function Fc(t){let e=/^#(\S+)\s+ke\s+(\S+)\s+Rp\.([\d.]+)\s+#([\s\S]*?)\s*@(\d{2}:\d{2})\s+Status=([^;]+);?$/i,n=t.match(e);if(!n)return null;let i=n[4].trim();if(i===""&&(i="-"),n[1]==="CEKTOKEN"&&i.includes("NAMA =")){let s=i.match(/NAMA\s*=\s*.*?NO\.METER\s*=\s*.*?TARIF DAYA\s*=\s*.*?(?=$|UNTUK)/s);s&&(i=s[0].replace(/\s+/g," ").trim())}return{kode:n[1],tujuan:n[2],harga:n[3],sn:i,waktu:n[5],status:n[6].trim()}}function Rp(t){let e=document.getElementById("laporanHeader"),n=document.getElementById("laporanList");if(!n)return;let s=t.split(`
`).map(l=>l.trim()).filter(l=>l);if(window.laporanTerbuka&&!s.some(l=>l.startsWith("Tgl")))return;let r=s.find(l=>l.startsWith("Tgl"))||"",o=r.replace(/^Tgl\.\s*/,"").replace("N/A","").trim();if(!window.headerSudahRender)r&&(Xo(r,e,n),window.headerSudahRender=!0);else{let l=e.querySelector(".laporan-tanggal-text");l&&(l.textContent=r)}n.innerHTML="";let a="";s.forEach(l=>{if(l.startsWith("Tgl")){if(l.includes("N/A")){let c=l.replace("N/A","").trim(),d=e.querySelector(".laporan-tanggal-text");d&&(d.textContent=c);let u=document.createElement("div");u.textContent="Belum ada transaksi",u.style.textAlign="center",u.style.padding="1rem",u.style.color="#666",n.appendChild(u)}}else if(l.startsWith("#")){if(a=l,l.includes("Status=")){let c=Fc(a);c&&Fr(c,n,o),a=""}}else if(a&&(a+=" "+l,l.includes("Status="))){let c=Fc(a);c&&Fr(c,n,o),a=""}})}var Hc,kp,Gc,kn=k(()=>{qo();Kc();$();Hc=qe(t=>{Rp(t)}),kp=document.getElementById("laporanTransaksiDisplay"),Gc=null;window.laporanTerbuka=!1});function Hr(t){if(!document.getElementById("downlineDisplay")){let o=document.createElement("article");o.id="downlineDisplay",o.style.display="none",o.innerHTML=`
      <header class="header-catatan">
        <button id="btnBackDownline" class="btn-back">
          <span class="arrow">\u2190</span>
        </button>
        <h2 class="judul-catatan">Daftar Downline</h2>
      </header>

      <section class="catatan-body">
        <div id="listDownline" class="list-hutang">
          <div class="loading-hutang">\u23F3 Memuat daftar downline...</div>
        </div>
      </section>
    `,document.querySelector("main.container").appendChild(o)}let n=document.getElementById("listDownline"),i=t?.trim();if(!i){n.innerHTML='<p class="info-text">Belum ada data downline.</p>';return}let s=i.split(";").map(o=>o.trim()).filter(Boolean).map(o=>{let a=o.match(/^([A-Z0-9]+)-(.+?)\s*\(([A-Z0-9]+)\)-([\d.]+)$/i);if(!a)return null;let[,l,c,d,u]=a;return{id:l,nama:c.trim(),tipe:d,saldo:u.replace(/\./g,"")}}).filter(Boolean).sort((o,a)=>{let l=parseInt(o.id.replace(/[^\d]/g,""),10),c=parseInt(a.id.replace(/[^\d]/g,""),10);return l-c});if(s.length===0){n.innerHTML='<p class="info-text">Belum ada data downline ditemukan.</p>';return}let r=`
    <div class="table-wrapper">
      <table class="tabel-downline">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nama Agen</th>
            <th>Mark</th>
            <th>Saldo</th>
          </tr>
        </thead>
        <tbody>
          ${s.map(o=>`
                <tr data-id="${o.id}" data-nama="${o.nama}" class="row-downline">
                  <td>${o.id}</td>
                  <td>${o.nama}</td>
                  <td>${o.tipe}</td>
                  <td class="text-right">${Number(o.saldo).toLocaleString("id-ID")}</td>
                </tr>
              `).join("")}
        </tbody>
      </table>
    </div>
  `;n.innerHTML=r,document.querySelectorAll(".row-downline").forEach(o=>{o.addEventListener("click",()=>{let a=o.dataset.id,l=o.dataset.nama,c=`<div style="font-weight:bold; color:var(--text-color); text-align:center;">ID Agen : ${a}<br>Nama Agen : ${l}</div>
            <input type="text" id="inputSaldo" class="form-input" placeholder="Nominal Transfer" />
            <div style="font-weight:bold; color:red; text-align:center;">Pastikan Saldo Anda Mencukupi!</div>`;H({title:"Transfer Saldo",message:c,source:"tambahSaldoAgen",buttons:[{text:"OK",className:"modal-ok",onClick:()=>{let u=document.getElementById("inputSaldo")?.value?.replace(/\./g,""),h=Number(u);A(`trans.${a}.${h}`)}},{text:"Cancel",className:"modal-cancel",onClick:()=>S("Transfer Dibatalkan","error")}]}),setTimeout(()=>{let d=document.getElementById("inputSaldo"),u=document.querySelector(".modal-ok");u&&d&&(u.disabled=!0,d.addEventListener("input",h=>{let f=h.target.value.replace(/[^\d]/g,"");h.target.value=f.replace(/\B(?=(\d{3})+(?!\d))/g,"."),u.disabled=!f||Number(f)<=0}))},50)})})}var Ni,$c,Wc,jc,Gr=k(()=>{ke();x();$();Ni="",$c=0,Wc=null,jc=qe(t=>{if(!/^[A-Z0-9]+-/.test(t))return;let e=Date.now();e-$c<2e3?Ni+=t:Ni=t,$c=e,clearTimeout(Wc),Wc=setTimeout(()=>{Hr(Ni),Ni=""},1500)})});function Ur(t){if(!t)return"-";let e={JAN:"JANUARI",FEB:"FEBRUARI",MAR:"MARET",APR:"APRIL",MEI:"MEI",JUN:"JUNI",JUL:"JULI",AGU:"AGUSTUS",SEP:"SEPTEMBER",OKT:"OKTOBER",NOV:"NOVEMBER",DES:"DESEMBER"},n=t.substring(0,3).toUpperCase(),i=t.substring(3),s=i.length===2?"20"+i:i;return`${e[n]||t} ${s}`}function Tn(t){if(!t||t.length<6)return"-";let e={"01":"JANUARI","02":"FEBRUARI","03":"MARET","04":"APRIL","05":"MEI","06":"JUNI","07":"JULI","08":"AGUSTUS","09":"SEPTEMBER",10:"OKTOBER",11:"NOVEMBER",12:"DESEMBER"},n=t.substring(0,4),i=t.substring(4,6);return e[i]?`${e[i]} ${n}`:t}function Vc(t){let e=t.getElementsByTagName("body");if(e.length>0){let n=e[0].textContent.trim();if(/^Yth\.\s*AGEN PULSA/i.test(n)&&/(Saldo|Bonus|Poin|Pemakaian)/i.test(n)||/Mohon tunggu transaksi sebelumnya selesai/i.test(n)||/masih diproses operator/i.test(n))return!0;if(/ke\s+\d+\s+diproses,/i.test(n)&&/Harga\s+/i.test(n)&&/Saldo\s+/i.test(n))return H({title:"Transaksi Sedang Diproses",message:'<div style="text-align:center;">Mohon tunggu sebentar, transaksi Anda sedang kami proses.</div>',buttons:[{text:"OK",className:"modal-ok",onClick:()=>{}},{text:"Cek Riwayat",className:"modal-info",onClick:()=>{let s=document.getElementById("navRiwayat");s&&s.click()}}]}),!0;if(/^CEKTOKEN/i.test(n)&&/NAMA\s*=/i.test(n)){let s=n.match(/NAMA\s*=\s*(.*)/i)?.[1]||"-",r=n.match(/NO\.METER\s*=\s*(.*)/i)?.[1]||"-",o=n.match(/TARIF DAYA\s*=\s*(.*)/i)?.[1]||"-",a=`<table class="detail-table-laporan-modal">
                <tr><td>Nama Pemilik</td><td>${s}</td></tr>
                <tr><td>ID Pelanggan</td><td>${r}</td></tr>
                <tr><td>Tarif/Daya</td><td>${o}</td></tr>
            </table>`;return H({title:"Info Token Listrik",message:a,buttons:[{text:"BELI TOKEN LISTRIK",className:"modal-ok",onClick:()=>{let l=document.getElementById("inputTujuan");A(ie("p")),l&&!l.value.trim()&&(l.value=r,l.dispatchEvent(new Event("input",{bubbles:!0})))}}]}),!0}if(!/^Tgl\.\s*\d{2}\/\d{2}\/\d{2}/i.test(n)&&(/CEK\s+NAMA\s+(DANA|GOPAY|SHOPEEPAY)/i.test(n)||/CEK\s+NAMA\s+E\s*-\s*WALLET\s+BERHASIL/i.test(n)&&/BILLER\s*=\s*(DANA|GOPAY|SHOPEEPAY)/i.test(n))&&/NAMA\s*=/i.test(n)){let s=n.match(/NAMA\s*=\s*(.*)/i)?.[1]?.trim()||"-";return s=s.replace(/^(DANA|GOPAY|SHOPEEPAY)\s+TOP\s+UP\s+/i,"").trim(),window.dispatchEvent(new CustomEvent("updateNamaDompet",{detail:{nama:s}})),!0}if((/CEK TAGIHAN PLN/i.test(n)||/^CPLN ke/i.test(n))&&/NAMA=/i.test(n)){let s="-",r=n.match(/CEK TAGIHAN PLN ke\s+(\d+)/i),o=n.match(/CPLN ke\s+(\d+)/i);r?s=r[1]:o&&(s=o[1]);let a=n.match(/SN\/Ref:\s*([^,]+)/i);if(a){let c=a[1].trim().split("@"),d={};c.forEach(T=>{let[C,M]=T.split("=");C&&M&&(d[C.trim()]=M.trim())});let u=d.NAMA||"-",h=d.TD||"-",f=d.JBLN||"-",p=d.PTAG||"-",g=d.TAG||"0",m=d.ADM||"0",v=d.TTAG||"0",E=(d.SM||"-").replace(/[\/\s]+$/,""),y=T=>"Rp"+V(T).toLocaleString("id-ID"),_=`<table class="detail-table-laporan-modal">
                    <tr><td>ID Pelanggan</td><td>${s}</td></tr>
                    <tr><td>Nama</td><td>${u}</td></tr>
                    <tr><td>Tarif Daya</td><td>${h}</td></tr>
                    <tr><td>Jumlah Bulan</td><td>${f} BULAN</td></tr>
                    <tr><td>Periode Tagihan</td><td>${Ur(p)}</td></tr>
                    <tr><td>Stand Meter</td><td>${E}</td></tr>
                    <tr><td>Tagihan</td><td>${y(g)}</td></tr>
                    <tr><td>Biaya Admin</td><td>${y(m)}</td></tr>
                    <tr><td>Total Tagihan</td><td>${y(v)}</td></tr>
                </table>`;return H({title:"Info Tagihan PLN",message:_,buttons:[{text:"BAYAR",className:"modal-ok",onClick:()=>{A("pln."+s)}},{text:"CANCEL",className:"modal-cancel",onClick:()=>{S("Pembayaran dibatalkan","error")}}],source:"Info Tagihan PLN"}),!0}}if((/CEK TAGIHAN BPJS/i.test(n)||/^CBPJSKS ke/i.test(n))&&/NAMA=/i.test(n)){let s="-",r=n.match(/CEK TAGIHAN BPJS KESEHATAN ke\s+(\d+)/i),o=n.match(/CBPJSKS ke\s+(\d+)/i);r?s=r[1]:o&&(s=o[1]);let a=n.match(/SN\/Ref:\s*([^,]+)/i);if(a){let c=a[1].trim().split("@"),d={};c.forEach(M=>{let[F,B]=M.split("=");F&&B&&(d[F.trim()]=B.trim())});let u=d.NAMA||"-",f=(/\((.*?)\)/.exec(u)?.[1]||"-").replace(/\bORG\b/gi,"ORANG"),p=u.replace(/\s*\([^)]*\)/,"").trim(),g=d.JBLN||"-",m=d.PS||"-",v=d.CB||"-",E=d.TAG||"0",y=d.ADM||"0",_=d.TTAG||"0";g=g.replace(/\b(\d+)\s*BLN\b/gi,"$1 BULAN"),m=m.replace(/\b(\d+)\s*KK\b/gi,"$1 KK");let T=M=>"Rp"+V(M).toLocaleString("id-ID"),C=`<table class="detail-table-laporan-modal">
            <tr><td>ID Pelanggan</td><td>${s}</td></tr>
            <tr><td>Nama</td><td>${p}</td></tr>
            <tr><td>Jumlah Peserta</td><td>${f}</td></tr>
            <tr><td>Jumlah Bulan</td><td>${g}</td></tr> <!-- \u2705 1BLN \u2192 1 BULAN -->
            <tr><td>Jumlah KK</td><td>${m}</td></tr>       <!-- \u2705 1KK \u2192 1 KK -->
            <tr><td>Cabang</td><td>${v}</td></tr>
            <tr><td>Tagihan</td><td>${T(E)}</td></tr>
            <tr><td>Biaya Admin</td><td>${T(y)}</td></tr>
            <tr><td>Total Tagihan</td><td>${T(_)}</td></tr>
        </table>`;return H({title:"Info Tagihan BPJS Kesehatan",message:C,buttons:[{text:"BAYAR",className:"modal-ok",onClick:()=>{A("bpjsks."+s)}},{text:"CANCEL",className:"modal-cancel",onClick:()=>{S("Pembayaran dibatalkan","error")}}],source:"Info Tagihan BPJS Kesehatan"}),!0}}if((/CEK\s+TAGIHAN\s+PDAM/i.test(n)||/^CPAM[A-Z]+\s+ke\s+\d+/i.test(n))&&/NAMA=/i.test(n)){let s=n.match(/^CPAM([A-Z]+)/i),r=s?s[1]:"",o="-";if(typeof He<"u"&&r){for(let[u,h]of Object.entries(He))if(h.toUpperCase()===r.toUpperCase()){o=u.replace("PDAM ","").toUpperCase();break}}let a="-",l=n.match(/PDAM\s+[A-Z\s]+ke\s+(\d+)/i),c=n.match(/^CPAM[A-Z]+\s+ke\s+(\d+)/i);l?a=l[1]:c&&(a=c[1]);let d=n.match(/SN\/Ref:\s*([^,]+)/i);if(d){let h=d[1].trim().split("@"),f={};h.forEach(F=>{let[B,J]=F.split("=");B&&J&&(f[B.trim()]=J.trim())});let p=f.NAMA||"-",g=f.JBLN||"-",m=f.PTAG||"-",v=f.TAG||"0",E=f.ADM||"0",y=f.TTAG||"0",_=f.SM||"-";_=_.split("/")[0].trim();let T=F=>"Rp"+V(F).toLocaleString("id-ID"),C=Ur(m),M=`<table class="detail-table-laporan-modal">
            <tr><td>ID Pelanggan</td><td>${a}</td></tr>
            <tr><td>Nama Daerah</td><td>${o} (${r})</td></tr>
            <tr><td>Nama Pelanggan</td><td>${p}</td></tr>
            <tr><td>Jumlah Bulan</td><td>${g} BULAN</td></tr>
            <tr><td>Periode Tagihan</td><td>${C}</td></tr>
            <tr><td>Stand Meter</td><td>${_}</td></tr>
            <tr><td>Tagihan</td><td>${T(v)}</td></tr>
            <tr><td>Biaya Admin</td><td>${T(E)}</td></tr>
            <tr><td>Total Tagihan</td><td>${T(y)}</td></tr>
        </table>`;return H({title:"Info Tagihan PDAM",message:M,buttons:[{text:"BAYAR",className:"modal-ok",onClick:()=>{A(`pam${r}.`+a)}},{text:"CANCEL",className:"modal-cancel",onClick:()=>{S("Pembayaran dibatalkan","error")}}]}),!0}}if((/CEK\s+TAGIHAN\s+INDIHOME/i.test(n)||/^CINDIHOME\s+ke\s+\d+/i.test(n))&&/NAMA=/i.test(n)){let s="-",r=n.match(/CEK TAGIHAN INDIHOME ke\s+(\d+)/i),o=n.match(/^CINDIHOME\s+ke\s+(\d+)/i);r?s=r[1]:o&&(s=o[1]);let a=n.match(/SN\/Ref:\s*([^,]+)/i);if(a){let c=a[1].trim().split("@"),d={};c.forEach(T=>{let[C,M]=T.split("=");C&&M&&(d[C.trim()]=M.trim())});let u=d.NAMA||"-",h=d.BILLER||"-",f=d.JBLN||"-",p=d.PTAG||"-",g=d.TAG||"0",m=d.ADM||"0",v=d.TTAG||"0",E=T=>"Rp"+V(T).toLocaleString("id-ID"),y=Tn(p),_=`<table class="detail-table-laporan-modal">
            <tr><td>ID Pelanggan</td><td>${s}</td></tr>
            <tr><td>Nama</td><td>${u}</td></tr>
            <tr><td>Biller</td><td>${h}</td></tr>
            <tr><td>Jumlah Bulan</td><td>${f} BULAN</td></tr>
            <tr><td>Periode Tagihan</td><td>${y}</td></tr>
            <tr><td>Tagihan</td><td>${E(g)}</td></tr>
            <tr><td>Biaya Admin</td><td>${E(m)}</td></tr>
            <tr><td>Total Tagihan</td><td>${E(v)}</td></tr>
        </table>`;return H({title:"Info Tagihan Indihome",message:_,buttons:[{text:"BAYAR",className:"modal-ok",onClick:()=>{A("indihome."+s)}},{text:"CANCEL",className:"modal-cancel",onClick:()=>{S("Pembayaran dibatalkan","error")}}],source:"Info Tagihan Indihome"}),!0}}if((/CEK\s+TAGIHAN\s+TELKOM/i.test(n)||/^CTELKOM\s+ke\s+\d+/i.test(n))&&/NAMA=/i.test(n)){let s="-",r=n.match(/CEK TAGIHAN TELKOM ke\s+(\d+)/i),o=n.match(/^CTELKOM\s+ke\s+(\d+)/i);r?s=r[1]:o&&(s=o[1]);let a=n.match(/SN\/Ref:\s*([^,]+)/i);if(a){let c=a[1].trim().split("@"),d={};c.forEach(T=>{let[C,M]=T.split("=");C&&M&&(d[C.trim()]=M.trim())});let u=d.NAMA||"-",h=d.BILLER||"-",f=d.JBLN||"-",p=d.PTAG||"-",g=d.TAG||"0",m=d.ADM||"0",v=d.TTAG||"0",E=T=>"Rp"+V(T).toLocaleString("id-ID"),y=Tn(p),_=`<table class="detail-table-laporan-modal">
        <tr><td>ID Pelanggan</td><td>${s}</td></tr>
        <tr><td>Nama</td><td>${u}</td></tr>
        <tr><td>Biller</td><td>${h}</td></tr>
        <tr><td>Jumlah Bulan</td><td>${f} BULAN</td></tr>
        <tr><td>Periode Tagihan</td><td>${y}</td></tr>
        <tr><td>Tagihan</td><td>${E(g)}</td></tr>
        <tr><td>Biaya Admin</td><td>${E(m)}</td></tr>
        <tr><td>Total Tagihan</td><td>${E(v)}</td></tr>
        </table>`;return H({title:"Info Tagihan Telkom",message:_,buttons:[{text:"BAYAR",className:"modal-ok",onClick:()=>{A("telkom."+s)}},{text:"CANCEL",className:"modal-cancel",onClick:()=>{S("Pembayaran dibatalkan","error")}}],source:"Info Tagihan TELKOM"}),!0}}if(/^PLN\s+#\s+BAYAR\s+TAGIHAN\s+PLN/i.test(n)&&/Status:\s*SUKSES/i.test(n)||/^PLN ke\s+\d+/i.test(n)&&/Status:\s*Sukses/i.test(n)){let s=n.match(/PLN(?:\s+#\s+BAYAR\s+TAGIHAN\s+PLN)?\s+ke\s+(\d+)/i),r=s?s[1]:"-",o=n.match(/SN\/Ref:\s*([^,]+)/i),a=n;if(o){let c=o[1].trim().split("@"),d={};c.forEach(T=>{if(!T)return;let C=T.split("=");if(C.length===2){let M=C[0].trim(),F=C[1].trim();if(M==="TD")d[M]=F;else if(F.includes("/"))F.split("/").forEach(B=>{if(B.includes("=")){let[J,Z]=B.split("=");d[J.trim()]=Z.trim()}else if(B.includes(":")){let[J,Z]=B.split(":");d[J.trim()]=Z.trim()}else d[M]=B.trim()});else if(F.includes(":")){let[B,J]=F.split(":");d[B.trim()]=J.trim()}else d[M]=F}});let u=d.NAMA||"-",h=d.TD||"-",f=d.JBLN||"-",p=d.PTAG||"-",g=d.ADM||"0",m=d.DENDA||"0",v=d.TTAG||"0",E=d.SM||"-",y=T=>"Rp"+V(T).toLocaleString("id-ID"),_=V(v)-V(g)-V(m);a=`<table class="detail-table-laporan-modal">
                    <tr><td>Jenis Pembayaran</td><td>Tagihan PLN</td></tr>
                    <tr><td>ID Pelanggan</td><td>${r}</td></tr>
                    <tr><td>Nama</td><td>${u}</td></tr>
                    <tr><td>Tarif Daya</td><td>${h}VA</td></tr>
                    <tr><td>Periode Tagihan</td><td>${Ur(p)}</td></tr>
                    <tr><td>Stand Meter</td><td>${E}</td></tr> <!-- \u2705 Tambahan -->
                    <tr><td>Tagihan</td><td>${y(_)}</td></tr>
                    <tr><td>Biaya Admin</td><td>${y(g)}</td></tr>
                    <tr><td>Denda</td><td>${y(m)}</td></tr>
                    <tr><td>Total Tagihan</td><td>${y(v)}</td></tr>
                </table>`}return H({title:"Pembayaran PLN Berhasil",message:a,buttons:[{text:"OK",className:"modal-ok",onClick:()=>{}},{text:"CEK RIWAYAT",className:"modal-info",onClick:()=>{let l=document.getElementById("navRiwayat");l&&l.click()}}]}),!0}if(/^BPJSKS\s+#\s+BAYAR\s+BPJS\s+KESEHATAN/i.test(n)&&/Status:\s*SUKSES/i.test(n)||/^BPJSKS\s+ke\s+\d+/i.test(n)&&/Status:\s*SUKSES/i.test(n)){let s=n.match(/KESEHATAN ke\s+(\d+)/i),r=s?s[1]:"-",o=n.match(/SN\/Ref:\s*([^,]+)/i),a=n;if(o){let c=o[1].trim().split("@"),d={};c.forEach(y=>{let[_,T]=y.split("=");_&&T&&(d[_.trim()]=T.trim())});let u=(d.NAMA||"-").replace(/\s*\([^)]*\)/,"").trim(),h=d.JBLN||"-",f=d.PS||"-",p=d.CB||"-",g=d.ADM||"0",m=d.TTAG||"0",v=y=>"Rp"+V(y).toLocaleString("id-ID"),E=V(m)-V(g);a=`<table class="detail-table-laporan-modal">
                    <tr><td>Jenis Pembayaran</td><td>BPJS Kesehatan</td></tr>
                    <tr><td>ID Pelanggan</td><td>${r}</td></tr>
                    <tr><td>Nama</td><td>${u}</td></tr>
                    <tr><td>Jumlah Bulan</td><td>${h} BULAN</td></tr>
                    <tr><td>Jumlah Peserta</td><td>${f} ORANG</td></tr>
                    <tr><td>Cabang</td><td>${p}</td></tr>
                    <tr><td>Tagihan</td><td>${v(E)}</td></tr>
                    <tr><td>Biaya Admin</td><td>${v(g)}</td></tr>
                    <tr><td>Total Tagihan</td><td>${v(m)}</td></tr>
                    </table>`}return H({title:"Pembayaran BPJS Berhasil",message:a,buttons:[{text:"OK",className:"modal-ok",onClick:()=>{}},{text:"CEK RIWAYAT",className:"modal-info",onClick:()=>{let l=document.getElementById("navRiwayat");l&&l.click()}}]}),!0}if(/^PAM[A-Z]+\s+#\s+BAYAR\s+PDAM/i.test(n)&&/Status:\s*SUKSES/i.test(n)||/^PAM[A-Z]+\s+ke\s+\d+/i.test(n)&&/Status:\s*SUKSES/i.test(n)){let s=n.match(/^PAM([A-Z]+)/i),r=s?s[1]:"-",o="-";if(typeof He<"u"&&r){for(let[u,h]of Object.entries(He))if(h.toUpperCase()===r.toUpperCase()){o=u.replace("PDAM ","").toUpperCase();break}}let a=n.match(/ke\s+(\d+);/i),l=a?a[1]:"-",c=n.match(/SN\/Ref:\s*([^,]+)/i),d=n;if(c){let h=c[1].trim().split("@"),f={};h.forEach(F=>{let[B,J]=F.split("=");B&&J&&(f[B.trim()]=J.trim())});let p=f.NAMA||"-",g=f.JBLN||"-",m=f.PTAG||"-",v=f.ADM||"0",E=f.TTAG||"0",y=f.SM||"-",_=f.REFF||"-";/^\d+BLN$/i.test(g)?g=g.replace("BLN"," BULAN"):/^\d+$/.test(g)&&(g=`${g} BULAN`);let T=F=>"Rp"+V(F).toLocaleString("id-ID"),C=Tn(m),M=V(E)-V(v);d=`<table class="detail-table-laporan-modal">
            <tr><td>Jenis Pembayaran</td><td>PDAM</td></tr>
            <tr><td>Nama Daerah</td><td>${o} (${r})</td></tr>
            <tr><td>ID Pelanggan</td><td>${l}</td></tr>
            <tr><td>Nama</td><td>${p}</td></tr>
            <tr><td>Jumlah Bulan</td><td>${g}</td></tr>
            <tr><td>Periode Tagihan</td><td>${C}</td></tr>
            <tr><td>Stand Meter</td><td>${y}</td></tr>
            <tr><td>Tagihan</td><td>${T(M)}</td></tr>
            <tr><td>Biaya Admin</td><td>${T(v)}</td></tr>
            <tr><td>Total Tagihan</td><td>${T(E)}</td></tr>
            <tr><td>Ref/Transaksi</td><td>${_}</td></tr>
        </table>`}return H({title:"Pembayaran PDAM Berhasil",message:d,buttons:[{text:"OK",className:"modal-ok",onClick:()=>{}},{text:"CEK RIWAYAT",className:"modal-info",onClick:()=>{let u=document.getElementById("navRiwayat");u&&u.click()}}]}),!0}if(/^INDIHOME\s+#\s+BAYAR\s+INDIHOME/i.test(n)&&/Status:\s*SUKSES/i.test(n)||/^INDIHOME\s+ke\s+\d+/i.test(n)&&/Status:\s*SUKSES/i.test(n)){let s=n.match(/INDIHOME(?:\s+#\s+BAYAR\s+INDIHOME)?\s+ke\s+(\d+)/i),r=s?s[1]:"-",o=n.match(/SN\/Ref:\s*([^,]+)/i),a=n;if(o){let c=o[1].trim().split("@"),d={};c.forEach(T=>{let[C,M]=T.split("=");C&&M&&(d[C.trim()]=M.trim())});let u=d.NAMA||"-",h=d.BILLER||"-",f=d.JBLN||"-",p=d.PTAG||"-",g=d.ADM||"0",m=d.TTAG||"0",v=d.REFF||"-",E=T=>"Rp"+V(T).toLocaleString("id-ID"),y=Tn(p),_=V(m)-V(g);a=`<table class="detail-table-laporan-modal">
            <tr><td>Jenis Pembayaran</td><td>Indihome</td></tr>
            <tr><td>ID Pelanggan</td><td>${r}</td></tr>
            <tr><td>Nama</td><td>${u}</td></tr>
            <tr><td>Biller</td><td>${h}</td></tr>
            <tr><td>Jumlah Bulan</td><td>${f} BULAN</td></tr>
            <tr><td>Periode Tagihan</td><td>${y}</td></tr>
            <tr><td>Tagihan</td><td>${E(_)}</td></tr>
            <tr><td>Biaya Admin</td><td>${E(g)}</td></tr>
            <tr><td>Total Tagihan</td><td>${E(m)}</td></tr>
            <tr><td>Ref/Serial</td><td>${v}</td></tr>
        </table>`}return H({title:"Pembayaran Indihome Berhasil",message:a,buttons:[{text:"OK",className:"modal-ok",onClick:()=>{}},{text:"CEK RIWAYAT",className:"modal-info",onClick:()=>{let l=document.getElementById("navRiwayat");l&&l.click()}}]}),!0}if(/^TELKOM\s+#\s+BAYAR\s+TELKOM/i.test(n)&&/Status:\s*SUKSES/i.test(n)||/^TELKOM\s+ke\s+\d+/i.test(n)&&/Status:\s*SUKSES/i.test(n)){let s=n.match(/TELKOM(?:\s+#\s+BAYAR\s+TELKOM)?\s+ke\s+(\d+)/i),r=s?s[1]:"-",o=n.match(/SN\/Ref:\s*([^,]+)/i),a=n;if(o){let c=o[1].trim().split("@"),d={};c.forEach(T=>{let[C,M]=T.split("=");C&&M&&(d[C.trim()]=M.trim())});let u=d.NAMA||"-",h=d.BILLER||"-",f=d.JBLN||"-",p=d.PTAG||"-",g=d.ADM||"0",m=d.TTAG||"0",v=d.REFF||"-",E=T=>"Rp"+V(T).toLocaleString("id-ID"),y=V(m)-V(g),_=Tn(p);a=`<table class="detail-table-laporan-modal">
            <tr><td>Jenis Pembayaran</td><td>Tagihan TELKOM</td></tr>
            <tr><td>ID Pelanggan</td><td>${r}</td></tr>
            <tr><td>Nama</td><td>${u}</td></tr>
            <tr><td>Biller</td><td>${h}</td></tr>
            <tr><td>Jumlah Bulan</td><td>${f} BULAN</td></tr>
            <tr><td>Periode Tagihan</td><td>${_}</td></tr>
            <tr><td>Tagihan</td><td>${E(y)}</td></tr>
            <tr><td>Biaya Admin</td><td>${E(g)}</td></tr>
            <tr><td>Total Tagihan</td><td>${E(m)}</td></tr>
            <tr><td>Ref</td><td>${v}</td></tr>
        </table>`}return H({title:"Pembayaran Telkom Berhasil",message:a,buttons:[{text:"OK",className:"modal-ok",onClick:()=>{}},{text:"CEK RIWAYAT",className:"modal-info",onClick:()=>{let l=document.getElementById("navRiwayat");l&&l.click()}}],source:"Pembayaran TELKOM"}),!0}if(/Status:\s*SUKSES/i.test(n)&&/ke\s+\d+/i.test(n)&&/#Harga/i.test(n)){let s=n.match(/pada\s+([\d/:\s]+)/i),r=n.match(/^([A-Z0-9]+)\s*#/i),o=n.match(/ke\s+(\d+)/i),a=n.match(/#\s*(.+?)\s+ke/i),l=n.match(/SN\/Ref:\s*([^,]+)/i),c=n.match(/#Harga:\s*([\d.,]+)/i),d=n.match(/Saldo\s*([\d.,]+)/i),u=r?r[1]:"-",h=s?s[1].trim():"-",f=a?a[1].trim():"-",p=o?o[1].trim():"-",g=l?l[1].replace("/","").trim():"-",m=c?c[1].replace(/[.,]+$/,"").trim():"-",v=d?d[1].replace(/[.,]+$/,"").trim():"-",E=`
        <table class="detail-table-laporan-modal">
            <tr><td>Waktu</td><td>${h}</td></tr>
            <tr><td>Nomor Tujuan</td><td>${p}</td></tr>
            <tr><td>Deskripsi</td><td>${f}</td></tr>
            <tr><td>SN/Ref</td><td>${g}</td></tr>
            <tr><td>Harga Modal</td><td>Rp${m}</td></tr>
            <tr><td>Saldo Akhir</td><td>Rp${v}</td></tr>
        </table>
    `;return H({title:"Transaksi Berhasil",message:E,buttons:[{text:"OK",className:"modal-ok",onClick:()=>{}},{text:"Cek Riwayat",className:"modal-info",onClick:()=>{let y=document.getElementById("navRiwayat");y&&y.click()}},{text:"Catat Hutang",className:"modal-debt",onClick:async()=>{try{let{db:y,ref:_,push:T,set:C}=await Promise.resolve().then(()=>(En(),vi)),M=localStorage.getItem("kode_agen")||"Unknown",F={waktu:h,kode:u,deskripsi:f,nomor:p,snRef:g,harga:m,kode_agen:M,status:"BELUM BAYAR",timestamp:Date.now()},B=_(y,"hutang"),J=T(B);await C(J,F),S("Data hutang berhasil dicatat","success",2e3);let Z=document.getElementById("navAkun");Z&&(Z.click(),document.getElementById("catatanHutangDisplay").style.display="block",document.getElementById("akunDisplay").style.display="none")}catch(y){console.error("Gagal mencatat hutang:",y),S("\u274C Gagal mencatat ke Firebase","error")}}}]}),!0}if(/ke\s+\d+\s+harga\s+[\d.,]+\s+#GAGAL/i.test(n)){let s=n.match(/^([A-Z0-9]+)\s+ke/i),r=n.match(/ke\s+(\d+)/i),o=n.match(/harga\s+([\d.,]+)/i),a=n.match(/Saldo\s+Tetap\s+Rp\s*([\d.,]+)/i),l=s?s[1]:"-",c=r?r[1]:"-",d=o?o[1]:"-",u=a?a[1]:"-",h=`
        <table class="detail-table-laporan-modal">
            <tr><td>Kode Produk</td><td>${l}</td></tr>
            <tr><td>Nomor Tujuan</td><td>${c}</td></tr>
            <tr><td>Harga Modal</td><td>Rp${d}</td></tr>
            <tr><td>Saldo Akhir</td><td>Rp${u}</td></tr>
        </table>
    `;return H({title:"Transaksi Gagal",message:h,buttons:[{text:"OK",className:"modal-ok",onClick:()=>{}},{text:"Komplain",className:"modal-complain",onClick:()=>{let f=`Mohon bantu cek transaksi yang gagal berikut:

Kode Produk : ${l}
Nomor Tujuan : ${c}

Terima kasih.`,g=`https://wa.me/6283100100190?text=${encodeURIComponent(f)}`;window.open(g,"_blank")}}]}),!0}if(/^Transfer ke\s+/i.test(n)&&/Rp\./i.test(n)){let s=n.match(/ke\s+([A-Z0-9]+)/i),r=n.match(/-\s*([^-]+?)\s*Rp\./i),o=n.match(/Rp\.\s*([\d.]+)/i),a=s?s[1].trim():"-",l=r?r[1].trim():"-",c=o?o[1].replace(/[^\d.]/g,"").replace(/\.$/,""):"0",d=`
        <table class="detail-table-laporan-modal">
            <tr><td>ID Agen</td><td>${a}</td></tr>
            <tr><td>Nama Agen</td><td>${l}</td></tr>
            <tr><td>Jumlah Transfer</td><td>Rp ${c}</td></tr>
        </table>
    `;return H({title:"SUKSES TRANSFER SALDO",message:d,buttons:[{text:"OK",className:"modal-ok",onClick:()=>{}}]}),!0}if(/^Transfer saldo ke\s+[A-Z0-9]+\s+Rp\.\s*[\d.]+\s+#GAGAL TRANSFER/i.test(n)){let s=n.match(/ke\s+([A-Z0-9]+)/i),r=n.match(/Rp\.\s*([\d.]+)/i),o=n.match(/#GAGAL TRANSFER\.\s*(.*)\s*@/i),a=s?s[1].trim():"-",l=r?r[1].trim():"0",c=o?o[1].trim():"Tidak diketahui",d=`
        <table class="detail-table-laporan-modal">
            <tr><td>ID Agen</td><td>${a}</td></tr>
            <tr><td>Jumlah Transfer</td><td>Rp ${l}</td></tr>
            <tr><td>Alasan</td><td>${c}</td></tr>
        </table>
    `;return H({title:"GAGAL TRANSFER SALDO",message:d,buttons:[{text:"OK",className:"modal-cancel",onClick:()=>{}}]}),!0}if(!/(?:#?Harga)/i.test(n))return!0;let i="error";(/SUKSES/i.test(n)||/DIPROSES/i.test(n))&&(i="success"),S(n,i,5e3)}return!0}var Jc=k(()=>{x();ke();$();x();Li()});async function Xc(t){let n=new TextEncoder().encode(t),i=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(i)).map(r=>r.toString(16).padStart(2,"0")).join("")}function qc(){return localStorage.getItem("appPin")}function jr(){Mp.forEach((t,e)=>{t.classList.toggle("filled",e<ge.length)})}function Wr(){ge="",jr()}function Qc(t){$r.classList.add("fade-out"),$r.addEventListener("animationend",()=>{$r.style.display="none",document.querySelector("main.container").style.display="block",t&&t()},{once:!0})}async function Vr(){if(Lp(),ge.length!==6)return;let t=qc();if(!t)return;await Xc(ge)===t?Qc():(Ke.textContent="PIN salah, coba lagi",Zc(),Wr())}function Zc(){Ke.classList.remove("shake"),Ke.offsetWidth,Ke.classList.add("shake")}function Lp(){zc.forEach((t,e)=>{t.style.animationDelay=`${e*.1}s`,t.classList.remove("animated"),t.offsetWidth,t.classList.add("animated")})}var $r,Ke,Mp,zc,Pp,ge,ut,Yc,ed=k(()=>{$r=document.getElementById("pinOverlay"),Ke=document.getElementById("pinMessage"),Mp=document.querySelectorAll(".pinCircle"),zc=document.querySelectorAll(".pinPad button"),Pp=document.getElementById("pinBack"),ge="",ut="check",Yc="";qc()?(ut="check",Ke.textContent="Masukkan PIN Anda"):(ut="set",Ke.textContent="Buat PIN Baru 6 Digit");zc.forEach(t=>{t.id!=="pinBack"&&t.addEventListener("click",async()=>{ge.length<6&&(ge+=t.textContent,jr(),ge.length===6&&setTimeout(async()=>{if(ut==="check")await Vr();else if(ut==="set")Yc=ge,ut="confirm",Ke.textContent="Konfirmasi PIN 6 digit",Wr();else if(ut==="confirm")if(ge===Yc){let e=await Xc(ge);localStorage.setItem("appPin",e),Ke.textContent="PIN berhasil dibuat!",setTimeout(()=>Qc(),2e3)}else Ke.textContent="PIN tidak cocok, coba lagi",ut="set",Zc(),Wr()},200))})});Pp.addEventListener("click",()=>{ge=ge.slice(0,-1),jr()})});function zr(t){console.log("[XMPP]",t)}function Bp(t,e){let n=localStorage.getItem("appPin");if(!n)return;let i=CryptoJS.AES.encrypt(t,n).toString(),s=CryptoJS.AES.encrypt(e,n).toString();localStorage.setItem("xmpp_jid",i),localStorage.setItem("xmpp_pass",s)}function Xr(){let t=localStorage.getItem("appPin");if(!t)return null;let e=localStorage.getItem("xmpp_jid"),n=localStorage.getItem("xmpp_pass");if(!e||!n)return null;try{let i=CryptoJS.AES.decrypt(e,t).toString(CryptoJS.enc.Utf8),s=CryptoJS.AES.decrypt(n,t).toString(CryptoJS.enc.Utf8);return{jid:i,pass:s}}catch(i){return console.error("Gagal dekripsi:",i),null}}function qr(){localStorage.removeItem("xmpp_jid"),localStorage.removeItem("xmpp_pass")}function bi(t,e,n=null){if(Jr){zr("Login temporarily locked, please wait...");return}q=new Strophe.Connection(Dp),q.connect(t+"/",e,function(i){switch(console.log("[DEBUG] Strophe status:",i),i){case Strophe.Status.CONNECTING:console.log("Connecting..."),Se(50);break;case Strophe.Status.CONNFAIL:console.log("Connection failed."),Se(100),ht();break;case Strophe.Status.DISCONNECTING:console.log("Disconnecting...");break;case Strophe.Status.DISCONNECTED:console.log("Disconnected. Coba reconnect..."),Se(0),ht();let s=Xr();s?(Ft(),console.log("\u{1F504} Auto-relogin pakai credential tersimpan..."),setTimeout(()=>{bi(s.jid,s.pass)},1e3)):(ht(),document.getElementById("formLogin").style.display="block",td.style.display="none",nd.style.display="none",id.style.display="none",laporanTransaksiDisplay.style.display="none",document.getElementById("akunDisplay").style.display="none");break;case Strophe.Status.CONNECTED:console.log("Connected as "+q.jid),Se(100),ht(),Yr&&clearInterval(Yr),Yr=setInterval(()=>{q&&q.connected&&(q.send($pres()),console.log("\u{1F504} Sent keepalive"))},3e4),document.getElementById("akune").value="",document.getElementById("paswote").value="",q.send($pres().c("priority").t("127")),document.getElementById("formLogin").style.display="none",Bp(t,e),!document.getElementById("formLogin").style.display!=="none"&&A("S"),td.style.display="block",q.addHandler(fo,null,"message","chat"),q.addHandler(Hc,null,"message","chat"),q.addHandler(Yo,null,"message","chat"),q.addHandler(Vc,null,"message","chat"),q.addHandler(jc,null,"message","chat"),nd.style.display="block",id.style.display="flex",zo(),Uc(),document.querySelectorAll(".bottom-nav .nav-item").forEach(o=>o.classList.remove("active")),document.getElementById("navBeranda").classList.add("active"),document.getElementById("pinOverlay").style.display="flex",Vr(),window.dispatchEvent(new Event("loginUnlocked")),n&&n();break;case Strophe.Status.AUTHFAIL:console.log("Authentication failed."),qr(),S(`Login Gagal
Periksa Username dan Password!`,"error"),Se(100),ht(),Jr=!0,setTimeout(()=>{Jr=!1,console.log("Login unlocked, you can try again."),window.dispatchEvent(new Event("loginUnlocked"))},5e3);break;case Strophe.Status.ATTACHED:console.log("Attached.");break;case Strophe.Status.ERROR:console.log("Error occurred.");break;default:console.log("Other status: "+i)}})}var q,Jr,Dp,td,nd,id,Yr,Qr=k(()=>{po();Bi();kn();kn();Bi();Gr();$();Jc();ed();x();q=null,Jr=!1,Dp="wss://pulsa.dpdns.org:7443/ws",td=document.getElementById("saldoDisplay"),nd=document.getElementById("homeDisplay"),id=document.getElementById("navBottom"),Yr=null});function Kp(){return atob(xp)}function A(t,e=Kp()){if(!q)return;let n=$msg({to:e,type:"chat"}).c("body").t(t);q.send(n),console.log(`Pesan terkirim ke ${e}: ${t}`)}function qe(t){return function(e){let n=e.getElementsByTagName("body")[0];if(n){let i=Strophe.getText(n).trim();t&&typeof t=="function"&&t(i,e)}return!0}}function Zr(){Si&&clearTimeout(Si);let t=!1,e=qe(n=>{n.startsWith("Yth")&&(t=!0,clearTimeout(Si))});q&&q.addHandler(e,null,"message","chat"),Si=setTimeout(()=>{t||H({title:"Koneksi Terputus",message:'<div style="text-align:center;">Server tidak merespon. Silakan tekan Refresh untuk mencoba kembali.</div>',buttons:[{text:"Refresh",className:"modal-info",onClick:()=>window.location.reload()}]})},2e3)}var xp,Si,Op,vn,$=k(()=>{Qr();ke();xp="dXNlcjFAcHVsc2EuZHBkbnMub3Jn",Si=null,Op="cHVsc2EuZHBkbnMub3Jn",vn=atob(Op)});var _o={};ho(_o,{createButton:()=>N,disableGestureZoom:()=>to,formatDisplayInput:()=>sd,hideLoadingModal:()=>ht,isOnLoginPage:()=>Ci,normalizeInput:()=>At,normalizeRupiah:()=>V,preventTextSelectionAndContextMenu:()=>eo,productCommand:()=>ie,setupAutoScrollInput:()=>so,setupInputTujuanListener:()=>oo,setupNavigasiCatatanHutang:()=>ao,setupNavigasiDownline:()=>lo,setupPageShowHandler:()=>io,setupRefreshButtons:()=>ro,setupTogglePassword:()=>Ht,setupVisibilityHandler:()=>no,showLoadingModal:()=>Ft,showToast:()=>S,updateProgress:()=>Se});function N(t,e){let n=document.createElement("button");return n.textContent=t,n.style.margin="0.25rem",n.addEventListener("click",e),n}function S(t,e="error",n=3e3){let i=document.getElementById("toast");if(!i)return;let s="\u26A0\uFE0F";i.classList.remove("success","error"),e==="success"?(s="\u2705",i.classList.add("success")):i.classList.add("error"),i.innerHTML=`
        <div class="toast-icon">${s}</div>
        <div class="toast-message">${t}</div>
    `,i.classList.add("show"),wi&&clearTimeout(wi),wi=setTimeout(()=>{i.classList.remove("show"),wi=null},n)}function V(t){return t&&parseInt(String(t).replace(/[^0-9]/g,""),10)||0}function At(t){return t?t.replace(/\D/g,""):""}function sd(t){return t?t.replace(/\D/g,"").replace(/(.{4})(?=.)/g,"$1-"):""}function Ht(){let t=document.getElementById("togglePass"),e=document.getElementById("paswote");t.addEventListener("click",()=>{e.type==="password"?(e.type="text",t.textContent="\u{1F648}"):(e.type="password",t.textContent="\u{1F441}")})}function eo(){document.addEventListener("selectstart",t=>{let e=t.target;e.closest&&(e.closest("#inputTujuan")||e.closest("#modalMessage"))||e.parentElement&&(e.parentElement.closest("#inputTujuan")||e.parentElement.closest("#modalMessage"))||t.preventDefault()}),document.addEventListener("contextmenu",t=>{let e=t.target;e.closest&&(e.closest("#inputTujuan")||e.closest("#modalMessage"))||e.parentElement&&(e.parentElement.closest("#inputTujuan")||e.parentElement.closest("#modalMessage"))||t.preventDefault()})}function to(){document.addEventListener("gesturestart",t=>{t.preventDefault()})}function Ft(){document.getElementById("loadingModal").style.display="flex",Se(0)}function ht(){document.getElementById("loadingModal").style.display="none"}function Se(t){let e=document.getElementById("loginProgress"),n=document.getElementById("loginProgressText");e&&n&&(e.value=t,n.textContent=t+"%")}function ie(t){return localStorage.getItem("tipe_akun")==="SP"?`harga.${t}x`:`harga.${t}`}function no(t,e,n){document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&(t()?console.log("\u23F8\uFE0F Skip cek server karena masih di halaman login"):(console.log("\u{1F504} App kembali ke foreground, cek server..."),e("S"),n()))})}function io(t,e){window.addEventListener("pageshow",n=>{n.persisted&&(t()?console.log("\u23F8\uFE0F Skip cek server karena masih di halaman login"):(console.log("\u{1F504} App pageshow (Safari/iOS), cek server..."),e()))})}function Ci(){let t=document.getElementById("formLogin");return t&&t.style.display!=="none"}function so(){document.addEventListener("focusin",t=>{(t.target.tagName==="INPUT"||t.target.tagName==="TEXTAREA")&&setTimeout(()=>{t.target.scrollIntoView({behavior:"smooth",block:"center"})},300)})}async function Fp(){try{if(console.log("\u{1F504} Force updating PWA..."),"serviceWorker"in navigator){let e=await navigator.serviceWorker.getRegistrations();for(let n of e)console.log("\u{1F9F9} Unregistering SW:",n.scope),await n.unregister()}let t=await caches.keys();for(let e of t)console.log("\u{1F5D1}\uFE0F Deleting cache:",e),await caches.delete(e);if("caches"in window){let e=new Headers;e.append("Cache-Control","no-cache, no-store, must-revalidate"),e.append("Pragma","no-cache"),e.append("Expires","0")}window.location.href=window.location.pathname}catch(t){console.error("\u274C Error force updating PWA:",t)}}function ro(){document.querySelectorAll(".refreshBtn").forEach(t=>{t.addEventListener("click",async()=>{await Fp()})})}function oo(){let t=document.getElementById("inputTujuan");t&&(t.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),t.blur())}),t.addEventListener("input",()=>{let e=t.selectionStart,n=At(t.value),i=0;for(let a=0;a<e;a++)/\d/.test(t.value[a])&&i++;let s=sd(n);t.value=s;let r=0,o=0;for(;r<s.length&&o<i;)/\d/.test(s[r])&&o++,r++;t.setSelectionRange(r,r)}))}function ao(){document.addEventListener("click",t=>{if(t.target.closest("#btnCatatanHutang")){let e=document.getElementById("akunDisplay"),n=document.getElementById("catatanHutangDisplay");e&&n&&(e.style.display="none",n.style.display="block",history.pushState({page:"catatanHutang"},null,location.href))}if(t.target.closest("#btnBackCatatan")){let e=document.getElementById("akunDisplay"),n=document.getElementById("catatanHutangDisplay");e&&n&&(n.style.display="none",e.style.display="block",history.pushState({page:"akun"},null,location.href))}})}function lo(){document.addEventListener("click",t=>{if(t.target.closest("#btnDownline")){let e=document.getElementById("akunDisplay"),n=document.getElementById("downlineDisplay");e&&n&&(A("lihatdownline"),e.style.display="none",n.style.display="block",history.pushState({page:"downline"},null,location.href))}if(t.target.closest("#btnBackDownline")){let e=document.getElementById("akunDisplay"),n=document.getElementById("downlineDisplay");e&&n&&(n.style.display="none",e.style.display="block",history.pushState({page:"akun"},null,location.href))}})}var wi,x=k(()=>{$();wi=null});x();function rd(){let t=document.querySelectorAll(".toggleThemeBtn"),e=document.documentElement,n=document.getElementById("theme-color"),i={light:"#ffffff",dark:"#121212"},s=localStorage.getItem("theme");s?e.setAttribute("data-theme",s):(s=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",e.setAttribute("data-theme",s),localStorage.setItem("theme",s));function r(){let o=e.getAttribute("data-theme"),a=i[o]||"#ffffff";t.forEach(l=>{let c=l.querySelector(".akun-icon")||l;c.textContent=o==="dark"?"\u2600\uFE0F":"\u{1F319}"}),n.setAttribute("content",a)}t.forEach(o=>{o.addEventListener("click",()=>{let l=e.getAttribute("data-theme")==="dark"?"light":"dark";e.setAttribute("data-theme",l),localStorage.setItem("theme",l),r()})}),r()}x();Qr();$();function Hp(){document.getElementById("akune").value="",document.getElementById("paswote").value=""}function od(){document.getElementById("formLogin").addEventListener("submit",function(t){t.preventDefault();let e=this.querySelector('button[type="submit"]'),n=document.getElementById("akune").value.toLowerCase(),i=document.getElementById("paswote").value;if(!n||!i){S("Username dan password harus diisi","error");return}e.disabled=!0,e.textContent="Tunggu...";let s=n+"@"+vn;Ft(),bi(s,i)}),window.addEventListener("loginUnlocked",()=>{let t=document.querySelector('#formLogin button[type="submit"]');t&&(t.disabled=!1,t.textContent="Login")}),window.addEventListener("load",()=>{let t=Xr();console.log("Loaded credentials from localStorage:",t),t&&t.jid&&t.pass?(zr("Found saved credentials, auto-logging in..."),document.getElementById("akune").value=t.jid.split("@")[0],document.getElementById("paswote").value=t.pass,Ft(),Se(0),bi(t.jid,t.pass,()=>{document.getElementById("loading").style.display="none"})):(document.getElementById("loading").style.display="none",document.getElementById("formLogin").style.display="block")}),document.getElementById("logoutBtn").addEventListener("click",function(){console.log("Manual logout."),q&&(q.disconnect(),qr()),Hp()})}x();function ad(){document.getElementById("contactBtn").addEventListener("click",async()=>{if("contacts"in navigator&&"ContactsManager"in window)try{let e=["name","tel"],n={multiple:!1},i=await navigator.contacts.select(e,n);if(!i||i.length===0){console.log("User batal pilih kontak");return}let s=document.getElementById("inputTujuan");if(!s)return;let r=i[0].tel&&i[0].tel[0];if(!r){S("Kontak tidak memiliki nomor telepon.","error");return}s.value=At(r),s.dispatchEvent(new Event("input",{bubbles:!0,composed:!0}))}catch(e){console.warn("Akses kontak dibatalkan:",e)}else S("Browser Anda tidak mendukung akses kontak","error")})}function ld(){let t=document.querySelectorAll(".bottom-nav .nav-item");t.forEach(e=>{e.addEventListener("click",()=>{t.forEach(n=>n.classList.remove("active")),e.classList.add("active"),e.id==="navRiwayat"?(console.log("ini navRiwayat"),document.getElementById("laporanTransaksiDisplay").style.display="block",document.getElementById("homeDisplay").style.display="none",document.getElementById("saldoDisplay").style.display="none",document.getElementById("akunDisplay").style.display="none",document.getElementById("catatanHutangDisplay").style.display="none",document.getElementById("downlineDisplay").style.display="none"):e.id==="navBeranda"?(console.log("ini halaman navBeranda"),document.getElementById("homeDisplay").style.display="block",document.getElementById("laporanTransaksiDisplay").style.display="none",document.getElementById("saldoDisplay").style.display="block",document.getElementById("akunDisplay").style.display="none",document.getElementById("catatanHutangDisplay").style.display="none",document.getElementById("downlineDisplay").style.display="none"):e.id==="navAkun"&&(console.log("ini halaman navAkun"),document.getElementById("laporanTransaksiDisplay").style.display="none",document.getElementById("homeDisplay").style.display="none",document.getElementById("saldoDisplay").style.display="none",document.getElementById("akunDisplay").style.display="block",document.getElementById("catatanHutangDisplay").style.display="none",document.getElementById("downlineDisplay").style.display="none")})})}function cd(){let t=document.getElementById("akunDisplay");t.innerHTML=`
    <div class="akun-list">
      <button id="logoutBtn" class="akun-item">
        <span class="akun-icon">\u{1F4F4}</span>
        <span class="akun-label">Keluar Akun</span>
      </button>
      <button class="akun-item refreshBtn">
        <span class="akun-icon">\u{1F504}</span>
        <span class="akun-label">Refresh Aplikasi</span>
      </button>
      <button class="akun-item toggleThemeBtn">
        <span class="akun-icon">\u{1F319}</span>
        <span class="akun-label">Tema Gelap/Terang</span>
      </button>
      <button class="akun-item" id="btnCatatanHutang">
        <span class="akun-icon">\u{1F4B0}</span>
        <span class="akun-label">Catatan Hutang</span>
      </button>
      <button class="akun-item" id="btnDownline">
        <span class="akun-icon">\u{1F465}</span>
        <span class="akun-label">Lihat Downline</span>
      </button>
    </div>
  `;let e=document.createElement("p");e.textContent="Istana Payment Versi 114",e.style.textAlign="center",e.style.marginTop="10px",e.style.fontSize="0.9em",e.style.color="#9c9c9cff",document.getElementById("btnDownline").insertAdjacentElement("afterend",e)}function co(){let t=document.getElementById("navBottom");if(!t)return;let e=window.visualViewport;function n(){let i=window.innerHeight-e.height-e.offsetTop;i>0?t.style.bottom=i+"px":t.style.bottom="0px"}e.addEventListener("resize",n),e.addEventListener("scroll",n)}function uo(){let t=document.getElementById("toast");if(!t)return;let e=window.visualViewport;function n(){let i=e.height/2+e.offsetTop;t.style.top=i+"px"}e.addEventListener("resize",n),e.addEventListener("scroll",n),n()}document.addEventListener("DOMContentLoaded",()=>{co(),uo()});x();$();function dd(){let t=document.getElementById("formLogin"),e=document.getElementById("formRegister"),n=document.getElementById("backToLogin"),i=document.getElementById("regUser"),s=document.getElementById("regPass"),r=document.getElementById("regPass2"),o=document.getElementById("regWarning"),a=document.getElementById("passWarning");Ht(document.getElementById("toggleRegPass"),s),Ht(document.getElementById("toggleRegPass2"),r),n.addEventListener("click",()=>{e.reset(),o.style.display="none",a.style.display="none",e.style.display="none",t.style.display="block"}),i.addEventListener("input",()=>{let c=i.value;/^[A-Za-z0-9]*$/.test(c)?o.style.display="none":(o.textContent="Username hanya boleh huruf dan angka (tanpa spasi & simbol)!",o.style.display="block")});function l(){s.value&&r.value&&s.value!==r.value?(a.textContent="Konfirmasi password tidak cocok!",a.style.display="block"):a.style.display="none"}s.addEventListener("input",l),r.addEventListener("input",l),e.addEventListener("submit",async c=>{if(c.preventDefault(),!/^[A-Za-z0-9]+$/.test(i.value)){o.textContent="Username hanya boleh huruf dan angka (tanpa spasi & simbol)!",o.style.display="block";return}if(s.value!==r.value){a.textContent="Konfirmasi password tidak cocok!",a.style.display="block";return}try{let d=await fetch("https://pulsa.dpdns.org:5443/api/register",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Basic "+btoa("adminkantor@pulsa.dpdns.org:password123")},body:JSON.stringify({user:i.value,host:vn,password:s.value})}),u;try{u=await d.json()}catch{u=await d.text()}if(console.log("Register response:",u),d.ok&&typeof u=="string"&&u.includes("successfully registered")){let h=i.value;S("Akun berhasil dibuat, silakan login!","success");let f="6282316015252",p=`tambahakun ${h}@${vn}/`;window.open(`https://wa.me/${f}?text=${encodeURIComponent(p)}`,"_blank"),e.reset(),e.style.display="none",t.style.display="block",document.getElementById("akune").value=h}else if(u&&u.status==="error"&&u.message){if(u.message.includes("already registered")){let h=i.value;S(`Username ${h} sudah terdaftar, gunakan username lain`,"error",5e3)}else S(u.message,"error");s.value="",r.value=""}else S("Gagal register, coba lagi!","error")}catch(d){console.error(d),S("Terjadi kesalahan koneksi","error")}})}x();var ki=!1,Nn=null;function Gp(){S("Tekan sekali lagi untuk keluar","sukses")}function ud(){window.addEventListener("popstate",t=>{if(window.modalTerbuka){let s=document.getElementById("modalHeader");if(s&&s.textContent==="Koneksi Terputus"){console.log("\u26D4 Tombol back diabaikan karena modal Koneksi Terputus"),history.pushState({modal:!0},null,location.href);return}window.modalSumber==="showHargaItem"&&S("Transaksi dibatalkan","error"),window.modalSumber==="Info Tagihan PLN"&&S("Pembayaran dibatalkan","error");let r=document.getElementById("modalOverlay");r&&(r.style.display="none",window.modalTerbuka=!1,window.modalSumber=null);return}if(window.datepickerTerbuka){let s=document.getElementById("datepickerModal"),r=document.getElementById("datepickerBackdrop");s&&s.remove(),r&&r.remove(),window.datepickerTerbuka=!1;return}let e=document.getElementById("catatanHutangDisplay"),n=document.getElementById("akunDisplay");if(e&&e.style.display==="block"){e.style.display="none",n.style.display="block";return}let i=document.getElementById("downlineDisplay");if(i&&i.style.display==="block"){i.style.display="none",n.style.display="block";return}ki?(Nn&&clearTimeout(Nn),ki=!1):(Gp(),ki=!0,Nn&&clearTimeout(Nn),Nn=setTimeout(()=>{ki=!1},1500),history.pushState({dummy:!0},null,location.href))}),window.addEventListener("load",()=>{history.pushState({first:!0},null,location.href)})}x();function hd(){"serviceWorker"in navigator&&(navigator.serviceWorker.register("sw.js").then(t=>{t.onupdatefound=()=>{let e=t.installing;e.onstatechange=()=>{e.state==="installed"&&navigator.serviceWorker.controller&&(S("Versi baru ditemukan, memuat ulang...","success"),e.postMessage({action:"skipWaiting"}),setTimeout(()=>window.location.reload(!0),1e3))}}}).catch(t=>console.log("Service Worker registration failed:",t)),navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()}))}$();$();var Gt=null;function fd(){let t=document.getElementById("installPwaBtn");t&&(window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),Gt=e,t.style.display="block"}),t.addEventListener("click",async()=>{if(!Gt)return;t.disabled=!0,t.textContent="\u23F3 Memulai...",Gt.prompt();let{outcome:e}=await Gt.userChoice;Gt=null,e==="accepted"?(t.textContent="\u2705 Terinstal",setTimeout(()=>t.style.display="none",2e3)):(t.textContent="\u{1F4F1} Install Aplikasi",t.disabled=!1)}),window.addEventListener("appinstalled",()=>{Gt=null,t.style.display="none"}))}En();ke();function pd(){if(!document.getElementById("catatanHutangDisplay")){let r=document.createElement("article");r.id="catatanHutangDisplay",r.style.display="none",r.innerHTML=`
      <header class="header-catatan">
        <button id="btnBackCatatan" class="btn-back">
          <span class="arrow">\u2190</span>
        </button>
        <h2 class="judul-catatan">Catatan Hutang</h2>
      </header>

      <section class="catatan-body">
        <div id="listHutang" class="list-hutang">
          <div class="loading-hutang">\u23F3 Memuat data hutang...</div>
        </div>
      </section>
    `,document.querySelector("main.container").appendChild(r)}let e=yn(Ti,"hutang"),n=document.getElementById("listHutang"),i=localStorage.getItem("kode_agen");function s(r){if(!r){n.innerHTML='<div class="illustration">\u{1FA99}</div><p class="info-text">Belum ada data hutang tersimpan.</p>';return}let o=Object.entries(r).map(([a,l])=>({id:a,...l})).filter(a=>a.kode_agen===i);if(o.length===0){n.innerHTML='<div class="illustration">\u{1F4ED}</div><p class="info-text">Catatan Hutang Masih Kosong.</p>';return}o.sort((a,l)=>l.timestamp-a.timestamp),n.innerHTML=o.map(a=>{let l=a.nama_pembeli||"",c=l?"Ubah Nama Pembeli":"Tulis Nama Pembeli";return`
    <div class="hutang-card ${a.status==="LUNAS"?"hutang-lunas":"hutang-belum"}">
      <div class="hutang-header">
        <h3 class="hutang-deskripsi">Nama Pembeli: ${l||"-"}</h3>
        <span class="hutang-status">${a.status}</span>
      </div>

      <div class="hutang-info">
      <div><strong>Waktu Transaksi:</strong> ${a.waktu}</div>
      <div><strong>Nomor Tujuan:</strong> ${a.nomor}</div>
      <div><strong>Kode Produk:</strong> ${a.kode}</div>
      <div><strong>Deskripsi:</strong> ${a.deskripsi}</div>
      <div><strong>Harga Modal:</strong> Rp${a.harga.toLocaleString("id-ID")}</div>
      </div>

      <div class="hutang-footer">
        <button class="btn-pembeli" data-id="${a.id}" data-nama="${l}">${c}</button>
        <button class="btn-sudah-bayar" data-id="${a.id}">Tandai Sudah Bayar</button>
      </div>
    </div>
  `}).join(""),document.querySelectorAll(".btn-pembeli").forEach(a=>{a.onclick=()=>{let l=a.dataset.id,c=a.dataset.nama||"";H({title:c?"Ubah Nama Pembeli":"Tulis Nama Pembeli",message:`<input type="text" id="inputNamaPembeli" value="${c}" 
                 style="width:100%; padding:8px; font-size:14px;" 
                 placeholder="Masukkan nama pembeli...">`,buttons:[{text:"OK",className:"modal-ok",onClick:()=>{let h=document.getElementById("inputNamaPembeli").value.trim();h.length>0&&yi(yn(Ti,"hutang/"+l),{nama_pembeli:h})}},{text:"Cancel",className:"modal-cancel",onClick:()=>{}}]}),setTimeout(()=>{let u=document.getElementById("inputNamaPembeli");u&&(u.focus(),u.addEventListener("keydown",h=>{if(h.key==="Enter"){h.preventDefault();let f=document.querySelector(".modal-ok");f&&f.click()}}))},100)}}),document.querySelectorAll(".btn-sudah-bayar").forEach(a=>{a.onclick=()=>{let l=a.dataset.id,c=r[l];if(!c)return;let{deskripsi:d,nomor:u,kode:h,harga:f,waktu:p,nama_pembeli:g}=c,m=`
      <table class="detail-table-laporan-modal">
        <tr><td>Waktu Transaksi</td><td>${p}</td></tr>
        <tr><td>Nomor Tujuan</td><td>${u}</td></tr>
        <tr><td>Kode Produk</td><td>${h}</td></tr>
        <tr><td>Deskripsi</td><td>${d}</td></tr>
        <tr><td>Harga Modal</td><td>Rp ${f.toLocaleString("id-ID")}</td></tr>
        <tr><td>Nama Pembeli</td><td>${g||"-"}</td></tr>
      </table>
      <div style="font-weight:bold; color:red; text-align:center;">
        Apakah Anda yakin pembeli sudah membayar?
      </div>
    `;H({title:"Konfirmasi Pelunasan",message:m,source:"sudahBayarHutang",buttons:[{text:"OK",className:"modal-ok",onClick:()=>{Promise.resolve().then(()=>(En(),vi)).then(({ref:v,db:E,remove:y})=>{y(v(E,"hutang/"+l)).then(()=>console.log("Data hutang berhasil dihapus")).catch(_=>console.error("Gagal hapus data:",_))})}},{text:"Cancel",className:"modal-cancel",onClick:()=>{}}]})}})}Ei(e,r=>s(r.val()))}Gr();ld();cd();pd();Hr();hd();Ht();oo();eo();rd();co();uo();so();ud();ro();ad();od();dd();no(Ci,A,Zr);io(Ci,Zr);to();fd();ao();lo();})();
/*! Bundled license information:

@firebase/util/dist/index.esm.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2025 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/component/dist/esm/index.esm.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/logger/dist/esm/index.esm.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/app/dist/esm/index.esm.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

firebase/app/dist/esm/index.esm.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/database/dist/index.esm.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
*/
