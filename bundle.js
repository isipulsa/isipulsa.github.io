(()=>{var Ct=Object.defineProperty;var Pt=(e,n)=>()=>(e&&(n=e(e=0)),n);var Nt=(e,n)=>{for(var t in n)Ct(e,t,{get:n[t],enumerable:!0})};var Ee={};Nt(Ee,{createButton:()=>d,formatDisplayInput:()=>ae,hideLoadingModal:()=>K,normalizeInput:()=>H,normalizeRupiah:()=>Y,preventTextSelectionAndContextMenu:()=>oe,productCommand:()=>x,setupTogglePassword:()=>G,showLoadingModal:()=>z,showToast:()=>p,updateProgress:()=>D});function d(e,n){let t=document.createElement("button");return t.textContent=e,t.style.margin="0.25rem",t.addEventListener("click",n),t}function p(e,n="error",t=3e3){let a=document.getElementById("toast");if(!a)return;let o="\u26A0\uFE0F";a.classList.remove("success","error"),n==="success"?(o="\u2705",a.classList.add("success")):a.classList.add("error"),a.innerHTML=`
        <div class="toast-icon">${o}</div>
        <div class="toast-message">${e}</div>
    `,a.classList.add("show"),V&&clearTimeout(V),V=setTimeout(()=>{a.classList.remove("show"),V=null},t)}function Y(e){return e&&parseInt(e.replace(/[^0-9]/g,""),10)||0}function H(e){return e?e.replace(/\D/g,""):""}function ae(e){return e?e.replace(/\D/g,"").replace(/(.{4})(?=.)/g,"$1-"):""}function G(e,n){e.addEventListener("click",()=>{n.type==="password"?(n.type="text",e.textContent="\u{1F648}"):(n.type="password",e.textContent="\u{1F441}")})}function oe(){document.addEventListener("selectstart",e=>{e.target.id!=="inputTujuan"&&e.preventDefault()}),document.addEventListener("contextmenu",e=>{e.target.id!=="inputTujuan"&&e.preventDefault()})}function z(){document.getElementById("loadingModal").style.display="flex",D(0)}function K(){document.getElementById("loadingModal").style.display="none"}function D(e){let n=document.getElementById("loginProgress"),t=document.getElementById("loginProgressText");n&&t&&(n.value=e,t.textContent=e+"%")}function x(e){return localStorage.getItem("tipe_akun")==="SP"?`harga.${e}x`:`harga.${e}`}var V,T=Pt(()=>{V=null});T();function Se(){let e=document.querySelectorAll(".toggleThemeBtn"),n=document.documentElement,t=document.getElementById("theme-color"),a={light:"#ffffff",dark:"#121212"},o=localStorage.getItem("theme");o?n.setAttribute("data-theme",o):(o=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",n.setAttribute("data-theme",o),localStorage.setItem("theme",o));function r(){let c=n.getAttribute("data-theme"),u=a[c]||"#ffffff";e.forEach(i=>{let l=i.querySelector(".akun-icon")||i;l.textContent=c==="dark"?"\u2600\uFE0F":"\u{1F319}"}),t.setAttribute("content",u)}e.forEach(c=>{c.addEventListener("click",()=>{let i=n.getAttribute("data-theme")==="dark"?"light":"dark";n.setAttribute("data-theme",i),localStorage.setItem("theme",i),r()})}),r()}T();function xe(e){let n=e.getElementsByTagName("body");if(n.length>0){let t=n[0].textContent;if(console.log("[DEBUG] body:",t),!t.includes("Yth."))return!0;let a=t.match(/Yth\.\s+([^-]+)-\s*([A-Z0-9]+)/),o=a?a[1].trim():"tidak diketahui";localStorage.setItem("nama_agen",o);let r=a?a[2].trim():"tidak diketahui",c=t.match(/Saldo\s(-?[\d.]+)/),u=t.match(/Proses\s([\d.]+)/),i=t.match(/Trx\s([\d.]+)/i),l=t.match(/Bonus\s([\d.]+)/),g=t.match(/Poin\s([\d.]+)/i),f=t.match(/Pemakaian\s([\d.]+)/i),k=c?c[1]:"-",m=u?u[1]:"-",y=i?i[1]:"-",v=l?l[1]:"-",I=g?g[1]:"-",w=f?f[1]:"-",E=t.match(/Grup\s+([A-Z0-9]+)/i);if(E){let h=E[1].toUpperCase();localStorage.setItem("tipe_akun",h),console.log("[DEBUG] tipe_akun tersimpan:",h)}document.getElementById("saldoDisplay").innerHTML=`
            <header style="
                margin-bottom:0.5rem;
                display:grid; 
                grid-template-columns: 1fr 1fr; 
                text-align:center;
                gap:0.5rem;
            ">
                <div>\u{1F464} <strong>${o}</strong></div>
                <div>\u{1F194} <strong>${r}</strong></div>
            </header>
            <div style="
                display:grid; 
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
                gap:0.5rem;
            ">
                <div>\u{1F4B0} <strong>Saldo:</strong> ${k}</div>
                <div>\u2699\uFE0F <strong>Proses:</strong> ${m}</div>
                <div>\u{1F4CA} <strong>Jml TRX:</strong> ${y}</div>
                <div>\u{1F381} <strong>Bonus:</strong> ${v}</div>
                <div>\u2B50 <strong>Poin:</strong> ${I}</div>
                <div>\u{1F4C5} <strong>Terpakai:</strong> ${w}</div>
            </div>
        `}return!0}var Bt="dXNlcjFAcHVsc2EuZHBkbnMub3Jn";function Dt(){return atob(Bt)}function s(e,n=Dt()){if(!b)return;let t=$msg({to:n,type:"chat"}).c("body").t(e);b.send(t),console.log(`Pesan terkirim ke ${n}: ${e}`)}function W(e){return function(n){let t=n.getElementsByTagName("body")[0];if(t){let a=Strophe.getText(t).trim();e&&typeof e=="function"&&e(a,n)}return!0}}T();var B=document.getElementById("inputTujuan"),L=document.getElementById("operatorDisplay"),C=document.getElementById("extraButtons"),Le=document.getElementById("clearInput"),Mt={Tsel:["0811","0812","0813","0851","0852","0853","0821","0822","0823","0824"],Isat:["0814","0815","0816","0855","0856","0857","0858"],Axis:["083"],"By.U":["085155","085156","085157","085158","085154","085159","08512"],"Token Listrik":["01","04","05","06","07","09","1","2","3","4","5","6","7","8","9","001","020","03"],Smar:["088"],Tri:["089"],XL:["0817","0818","0819","0859","0878","0877"]};function $t(e){return e.startsWith("628")?"0"+e.slice(2):e}function Rt(e){let n="",t=$t(e),a=Object.entries(Mt).sort((o,r)=>{let c=Math.max(...o[1].map(i=>i.length));return Math.max(...r[1].map(i=>i.length))-c});for(let[o,r]of a)for(let c of r)if(t.startsWith(c))return o;return n}function Ce(){let e=H(B.value.trim());if(!e){L.textContent="",B.classList.remove("with-operator"),C.innerHTML="";return}let n=Rt(e);n&&n!=="Token Listrik"?(L.textContent=n,B.classList.add("with-operator")):(L.textContent="",B.classList.remove("with-operator")),C.innerHTML=""}B.addEventListener("input",()=>{Ce(),ie()});function ie(){Le.style.display=B.value?"block":"none"}Le.addEventListener("click",()=>{B.value="",Ce(),ie(),B.focus()});ie();T();function $({title:e="",message:n="",buttons:t=[],source:a=""}){let o=document.getElementById("modalOverlay"),r=document.getElementById("modalHeader"),c=document.getElementById("modalMessage"),u=document.getElementById("modalButtons"),i=document.getElementById("modalCloseBtn");r.innerHTML=e,c.innerHTML=n,o.style.display="flex",window.modalTerbuka=!0,window.modalSumber=a,history.pushState({modal:!0},null,location.href),u.innerHTML="",e==="Koneksi Terputus"||e==="Transaksi Sedang Diproses"?i.style.display="none":i.style.display="block",t.forEach(l=>{let g=document.createElement("button");g.textContent=l.text,g.className=l.className||"modal-ok",l.disabled?(g.disabled=!0,g.style.opacity="0.6",g.style.cursor="not-allowed"):g.onclick=()=>{o.style.display="none",window.modalTerbuka=!1,window.modalSumber=null,l.onClick&&l.onClick()},u.appendChild(g)}),i.onclick=()=>{o.style.display="none",window.modalTerbuka=!1,window.modalSumber==="showHargaItem"&&Promise.resolve().then(()=>(T(),Ee)).then(({showToast:l})=>{l("Transaksi dibatalkan","error")}),window.modalSumber=null}}function q(e,n,t,a,o=""){$({title:e,message:n,source:o,buttons:[{text:"OK",className:"modal-ok",onClick:()=>{window.modalTerbuka=!1,window.modalSumber=null,t&&t()}},{text:"Cancel",className:"modal-cancel",onClick:()=>{window.modalTerbuka=!1,window.modalSumber=null,a&&a()}}]})}var se=!1;function le(e){se=e}var _=document.getElementById("extraButtons"),Ht=document.getElementById("inputTujuan");function Pe(e){se||(_.innerHTML=""),_.style.display="block",_.className="harga-list";let n=e.split(`
`).map(a=>a.trim()).filter(a=>a),t=!1;n.forEach(a=>{let o=a.split("=");if(o.length>=3){let r=o[0].trim(),c=o[1].trim(),u=o[2].replace(";","").trim();if(/\[K\]|\[G\]/.test(u)||!/^\d+([.,]\d+)?$/.test(u))return;if(!t){let l=document.createElement("div");l.className="menu-item harga-item header-item",l.style.display="flex",l.style.justifyContent="space-between",l.style.alignItems="center",l.style.padding="0.5rem 1rem",l.style.borderBottom="1px solid #ccc",l.innerHTML=`
                <span style="font-weight:bold; color:var(--pico-primary); min-width:50px;">Kode</span>
                <span style="flex:1; margin-left:1rem; margin-right:1rem; font-weight:bold;">Deskripsi</span>
                <span style="font-weight:bold; color:var(--pico-success); min-width:60px; text-align:right;">Harga</span>
            `,_.appendChild(l),t=!0}let i=document.createElement("div");i.className="menu-item harga-item",i.style.display="flex",i.style.justifyContent="space-between",i.style.alignItems="center",i.style.padding="0.5rem 1rem",i.innerHTML=`
            <span style="font-weight:bold; color:var(--pico-primary); min-width:50px;">${r}</span>
            <span style="flex:1; margin-left:1rem; margin-right:1rem;">${c}</span>
            <span style="font-weight:bold; color:var(--pico-success); min-width:60px; text-align:right;">Rp${u}</span>
        `,i.addEventListener("click",()=>{let l=Ht.value,g=`
                <table class="detail-table-laporan-modal">
                    <tr><td>Kode Produk</td><td>${r}</td></tr>
                    <tr><td>Deskripsi Produk</td><td>${c}</td></tr>
                    <tr><td>Harga Modal</td><td>Rp${u}</td></tr>
                    <tr><td>Nomor Tujuan</td><td>${l}</td></tr>
                </table>
                <div style="font-weight:bold; color:red; text-align:center;">
                    Pastikan Saldo Anda Mencukupi!
                </div>`;q("KONFIRMASI TRANSAKSI",g,()=>{s(`${r}.${l}`),s("S")},()=>{p("Transaksi dibatalkan","error")},"showHargaItem")}),_.appendChild(i)}})}T();T();function Ne(e,n,t){if(!t||t==="Unknown"){p("Nomor Tujuan Tidak Dikenali untuk Pulsa");return}let a=localStorage.getItem("tipe_akun");e.style.display="block",n.textContent=t,t==="Tsel"?(e.appendChild(d("Pulsa Reguler",()=>s(x("t")))),e.appendChild(d("Tambah Masa Aktif",()=>s(x("tmat"))))):t==="Isat"?(e.appendChild(d("Pulsa Reguler",()=>s(x("i")))),e.appendChild(d("Tambah Masa Aktif",()=>s(x("tmai"))))):t==="XL"?(e.appendChild(d("Pulsa Reguler",()=>s(x("x")))),e.appendChild(d("Tambah Masa Aktif",()=>s(x("tmax"))))):t==="Axis"?(e.appendChild(d("Pulsa Reguler",()=>s(x("a")))),e.appendChild(d("Tambah Masa Aktif",()=>s(x("tmaa"))))):t==="Tri"?(e.appendChild(d("Pulsa Reguler",()=>s(x("tr")))),e.appendChild(d("Tambah Masa Aktif",()=>s(x("tmatri"))))):t==="Smar"&&e.appendChild(d("Pulsa Reguler",()=>s(x("s"))))}T();function Be(e,n,t){if(!t||t==="Unknown"){p("Nomor Tujuan Tidak Dikenali untuk Paket Data");return}e.style.display="block",n.textContent=t,t==="Tsel"?(e.appendChild(d("1 Bulan",()=>s("harga.td"))),e.appendChild(d("Jawa Timur",()=>s("harga.jtm"))),e.appendChild(d("Jawa Tengah",()=>s("harga.jtg"))),e.appendChild(d("Jawa Barat",()=>s("harga.jbr")))):t==="Isat"?(e.appendChild(d("Freedom Internet",()=>s("harga.if"))),e.appendChild(d("Freedom Unlimited",()=>s("harga.iu"))),e.appendChild(d("Freedom Mini",()=>s("harga.im")))):t==="XL"?(e.appendChild(d("Xtra Combo Flex",()=>s("harga.xcf"))),e.appendChild(d("XL Mini",()=>s("harga.xm")))):t==="Axis"?(e.appendChild(d("1 Bulan",()=>s("harga.bro"))),e.appendChild(d("Axis Mini",()=>s("harga.am")))):t==="Tri"?(e.appendChild(d("AON",()=>s("harga.aon"))),e.appendChild(d("Happy",()=>s("harga.hap")))):t==="Smar"&&(e.appendChild(d("Unlimited Harian",()=>s("harga.suh"))),e.appendChild(d("Smartfren Unlimited",()=>s("harga.sun"))),e.appendChild(d("Smartfren Mini",()=>s("harga.sd"))))}T();function De(e,n,t){if(!t||t==="Unknown"){p("Nomor Tujuan Tidak Dikenali untuk Paket Nelpon");return}e.style.display="block",n.textContent=t,t==="Tsel"?e.appendChild(d("Telkomsel Nelpon",()=>s("harga.tn"))):t==="Isat"?e.appendChild(d("Indosat Nelpon",()=>s("harga.in"))):t==="XL"?e.appendChild(d("XL Nelpon",()=>s("harga.xn"))):t==="Axis"?e.appendChild(d("Axis Nelpon",()=>s("harga.an"))):t==="Tri"&&e.appendChild(d("Tri Nelpon",()=>s("harga.trn")))}T();var Kt=document.getElementById("inputTujuan");function Me(e,n,t){e.style.display="block",n.textContent=t,e.appendChild(d("Cek Nama Pemilik",()=>s("cektoken."+Kt.value))),e.appendChild(d("Beli Token Listrik",()=>s(x("p"))))}T();var Z=document.getElementById("inputTujuan");function $e(e,n){if(console.log(n),!n||n==="Unknown"){p("Nomor Tujuan Tidak Dikenali untuk Nominal Bebas");return}le(!0);let t=document.createElement("div");t.className="wrapper-input";let a=document.createElement("div");a.className="row-input";let o=document.createElement("select");o.className="select-provider",["--Pilih--","Telkomsel","Dana","Gopay","ShopeePay"].forEach(m=>{if(m==="Telkomsel"&&n.toLowerCase()!=="tsel")return;let y=document.createElement("option");y.value=m==="--Pilih--"?"":m,y.textContent=m,o.appendChild(y)});let c=document.createElement("div");c.className="input-nominal-wrapper";let u=document.createElement("span");u.textContent="Rp";let i=document.createElement("input");i.type="text",i.placeholder="Masukkan nominal",i.className="input-nominal",i.inputMode="numeric",i.pattern="[0-9]*",i.autocomplete="off",i.style.padding="0 0 0 0.5rem",i.style.margin="0 -0.5rem 0 0",i.disabled=!0;let l=document.createElement("div");l.style.color="red",l.style.fontSize="12px",l.style.margin="4px 0",l.style.display="none";let g=document.createElement("div");g.className="nama-pemilik",g.textContent="\u2013",g.style.display="none";let f=document.createElement("button");f.textContent="Kirim",f.className="btn-kirim",f.disabled=!0;function k(){f.disabled=!o.value||!i.value||l.style.display==="block"}o.addEventListener("change",()=>{if(!o.value){i.disabled=!0,i.value="",l.style.display="none",f.disabled=!0,g.style.display="none";return}i.disabled=!1;let m="";o.value==="Dana"&&(m="d."),o.value==="Gopay"&&(m="gp."),o.value==="ShopeePay"&&(m="sp."),m&&s(m+Z.value)}),i.addEventListener("input",()=>{let m=i.value.replace(/[^\d]/g,"");if(!m){i.value="",l.style.display="none",k();return}i.value=new Intl.NumberFormat("id-ID").format(m);let y=parseInt(m,10);o.value==="Telkomsel"?y<2e3||y>2e5?(l.textContent="Nominal Telkomsel minimal 2.000 dan maksimal 200.000",l.style.display="block"):y%1e3!==0?(l.textContent="Nominal Telkomsel hanya boleh kelipatan 1.000",l.style.display="block"):l.style.display="none":(o.value==="Dana"||o.value==="Gopay"||o.value==="ShopeePay")&&(y<1e4||y>1e6)?(l.textContent="Nominal minimal 10.000 dan maksimal 1.000.000",l.style.display="block"):l.style.display="none",k()}),f.addEventListener("click",()=>{if(!o.value){o.focus(),p("Pilih provider/dompet terlebih dahulu","error");return}if(!i.value){i.focus(),p("Masukkan nominal terlebih dahulu","error");return}if(!Z.value){Z.focus(),p("Masukkan nomor tujuan terlebih dahulu","error");return}let m=parseInt(i.value.replace(/\./g,""),10),y=o.value,v=0,I=localStorage.getItem("tipe_akun");I==="SP"?o.value==="Telkomsel"?v=m+850:o.value==="Dana"?v=m+150:o.value==="Gopay"?v=m+550:o.value==="ShopeePay"&&(v=m+600):o.value==="Telkomsel"?v=m+1e3:(o.value==="Dana"||o.value==="Gopay"||o.value==="ShopeePay")&&(v=m+1250);let w=Z.value,E=`
    <table class="detail-table-laporan-modal">
        <tr><td>Provider</td><td>${y} Rp${new Intl.NumberFormat("id-ID").format(m)}</td></tr>
        <tr><td>Harga Modal</td><td>Rp${new Intl.NumberFormat("id-ID").format(v)}</td></tr>
        <tr><td>Nomor Tujuan</td><td>${w}</td></tr>
    </table>
    <div style="font-weight:bold; color:red; text-align:center;">
        Pastikan Saldo Anda Mencukupi!
    </div>`;q("KONFIRMASI TRANSAKSI",E,()=>{if(le(!1),o.value==="Telkomsel"){let h=Math.floor(m/1e3);I==="SP"?s(`kirim.xtelkomsel.${w}.${h}`):s(`kirim.telkomsel.${w}.${h}`)}else o.value==="Dana"?s(`kirim.dana.${w}.${m}`):o.value==="ShopeePay"?s(`kirim.shopee.${w}.${m}`):o.value==="Gopay"&&s(`kirim.gopay.${w}.${m}`)},()=>{p("Transaksi dibatalkan","error")})}),a.appendChild(o),a.appendChild(c),c.appendChild(u),c.appendChild(i),t.appendChild(a),t.appendChild(l),t.appendChild(g),t.appendChild(f),e.appendChild(t),window.addEventListener("updateNamaDompet",m=>{let{nama:y}=m.detail;o.value&&(g.textContent=`${y}`,g.style.display="block",g.style.background=getComputedStyle(document.documentElement).getPropertyValue("--flash-color"),setTimeout(()=>{g.style.background="var(--bg-color)"},1e3))})}T();function Re(e,n,t){e.style.display="block",n.textContent=t,e.appendChild(d("Dana",()=>s("harga.d"))),e.appendChild(d("Shopee Pay",()=>s("harga.sp"))),e.appendChild(d("Gopay",()=>s("harga.gp"))),e.appendChild(d("Ovo",()=>s("harga.o"))),e.appendChild(d("Grab",()=>s("harga.gr"))),e.appendChild(d("LinkAja",()=>s("harga.la"))),e.appendChild(d("Mandiri E-Money",()=>s("harga.em"))),e.appendChild(d("BNI TapCash",()=>s("harga.bnitap"))),e.appendChild(d("BRI Bizzi",()=>s("harga.brizzi"))),e.appendChild(d("Maxim",()=>s("harga.max")))}T();function He(e,n,t){e.style.display="block",n.textContent=t,e.appendChild(d("Free Fire",()=>s("harga.ff"))),e.appendChild(d("Mobile Legends",()=>s("harga.ml"))),e.appendChild(d("PUBG Mobile",()=>s("harga.pm"))),e.appendChild(d("Point Blank",()=>s("harga.pb")))}T();var zn=document.getElementById("inputTujuan");function Ke(e,n,t){e.style.display="block",n.textContent=t,e.appendChild(d("Nex Parabola",()=>s("harga.nex"))),e.appendChild(d("K-Vision",()=>s("harga.kv"))),e.appendChild(d("Jawara Vision",()=>s("harga.mnc")))}T();var jt=document.getElementById("inputTujuan");function je(e,n,t){e.style.display="block",n.textContent=t,e.appendChild(d("Cek Tagihan Listrik",()=>s("cpln."+jt.value)))}T();var Ut=document.getElementById("inputTujuan");function Ue(e,n,t){e.style.display="block",n.textContent=t,e.appendChild(d("Cek Tagihan BPJS Kesehatan",()=>s("cbpjsks."+Ut.value)))}T();var Ot=document.getElementById("inputTujuan");function Oe(e,n,t){e.style.display="block",n.textContent=t,e.appendChild(d("Cek Tagihan Indihome",()=>s("cindihome."+Ot.value)))}var re=document.getElementById("menuGrid"),Ge=W(e=>{Pe(e)});function ze(){let e=[{name:"Pulsa",emoji:"\u{1F4F1}"},{name:"Paket Data",emoji:"\u{1F310}"},{name:"Paket Nelpon & SMS",emoji:"\u{1F4DE}"},{name:"Token Listrik",emoji:"\u26A1"},{name:"Nominal Bebas",emoji:"\u270D\uFE0F"},{name:"Dompet Digital",emoji:"\u{1F4B3}"},{name:"Games",emoji:"\u{1F3AE}"},{name:"Paket TV",emoji:"\u{1F4FA}"},{name:"Bayar Listrik",emoji:"\u{1F4A1}"},{name:"Bayar BPJS",emoji:"\u{1F3E5}"},{name:"Bayar IndiHome",emoji:"\u{1F4E1}"}];re&&(re.innerHTML="",e.forEach(n=>{let t=document.createElement("div");t.className="menu-item",t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="center",t.style.cursor="pointer";let a=document.createElement("span");a.textContent=n.emoji,a.style.fontSize="2rem",a.style.marginBottom="0.5rem";let o=document.createElement("p");o.textContent=n.name,o.style.margin="0",t.appendChild(a),t.appendChild(o),re.appendChild(t),t.addEventListener("click",()=>Gt(n))}))}function Gt(e){if(!B.value.trim()){p("Masukkan nomor tujuan terlebih dahulu","error"),B.focus();return}C.innerHTML="";let n=L.textContent;e.name==="Pulsa"?Ne(C,L,n):e.name==="Paket Data"?Be(C,L,n):e.name==="Paket Nelpon & SMS"?De(C,L,n):e.name==="Token Listrik"?Me(C,L,n):e.name==="Nominal Bebas"?$e(C,n):e.name==="Dompet Digital"?Re(C,L,n):e.name==="Games"?He(C,L,n):e.name==="Paket TV"?Ke(C,L,n):e.name==="Bayar Listrik"?je(C,L,n):e.name==="Bayar BPJS"?Ue(C,L,n):e.name==="Bayar IndiHome"?Oe(C,L,n):p("Menu belum siap","error");let t=document.getElementById("homeDisplay");t&&t.scrollIntoView({behavior:"smooth",block:"start"})}function We(e,n,t){window.laporanTerbuka=!0,n.innerHTML="";let a=document.createElement("div");a.style.display="flex",a.style.flexDirection="column",a.style.alignItems="center",a.style.marginBottom="0.5rem";let o=document.createElement("div");o.textContent="Laporan Transaksi",o.style.fontWeight="bold",o.style.fontSize="1.1rem",o.style.marginBottom="0.3rem",a.appendChild(o);let r=document.createElement("div");r.style.display="flex",r.style.justifyContent="space-between",r.style.alignItems="center",r.style.width="100%";let c=document.createElement("div");c.className="laporan-tanggal-text",c.style.fontWeight="bold",c.textContent=e;let u=document.createElement("div");u.style.display="flex",u.style.gap="0.3rem",u.style.alignItems="center";let i=document.createElement("button");i.textContent="\u{1F4C5}",i.style.fontSize="1.4rem",i.style.border="none",i.style.background="transparent",i.style.cursor="pointer",i.addEventListener("click",()=>{i.disabled=!0,setTimeout(()=>{i.disabled=!1},3e3);let g=document.createElement("div");g.id="datepickerBackdrop";let f=document.createElement("div");f.id="datepickerModal";let k=document.createElement("input");document.body.appendChild(g),document.body.appendChild(f);function m(){f.remove(),g.remove(),window.datepickerTerbuka=!1}window.datepickerTerbuka=!0,history.pushState({datepicker:!0},null,location.href);let y=new Date,v=y.getFullYear(),I=y.getMonth(),w=y.getDate();flatpickr(k,{defaultDate:y,minDate:new Date(v,I,1),maxDate:new Date(v,I,w),inline:!0,appendTo:f,onChange:function(E){if(!E.length)return;let P=E[0].getDate();window.tanggalSekarang=P,s(`laporan.${P}`),m()}})});let l=document.createElement("button");l.innerHTML="\u{1F504}",l.style.fontSize="1.6rem",l.style.cursor="pointer",l.style.border="none",l.style.background="transparent",l.style.padding="0",l.style.margin="0",l.style.outline="none",l.addEventListener("click",()=>{l.disabled=!0,de(),setTimeout(()=>{l.disabled=!1},3e3)}),u.appendChild(i),u.appendChild(l),r.appendChild(c),r.appendChild(u),a.appendChild(r),n.appendChild(a)}T();T();var Je={T10:"PULSA 10.000",T20:"PULSA 20.000",X25:"PULSA 25.000",I50:"PULSA 50.000",S100:"PULSA 100.000"};async function Fe(e,n,t){try{let a="PRODUK DIGITAL";/^pln/i.test(e.kode)?a="TAGIHAN LISTRIK PASCABAYAR":/^p/i.test(e.kode)?a="TOKEN LISTRIK":/^td/i.test(e.kode)?a="PAKET DATA TELKOMSEL":/^if/i.test(e.kode)?a="PAKET DATA INDOSAT":/^tr/i.test(e.kode)?a="PULSA TRI":/^i/i.test(e.kode)?a="PULSA INDOSAT":/^s/i.test(e.kode)?a="PULSA SMARTFREN":/^x/i.test(e.kode)?a="PULSA XL":/^a/i.test(e.kode)?a="PULSA AXIS":/^t(?!d)/i.test(e.kode)&&(a="PULSA TELKOMSEL");let o=/^pln/i.test(e.kode)?3e3:0,r=t+o,c=localStorage.getItem("nama_agen")||"",u=18,i=["ID PELANGGAN","NAMA","TARIF/DAYA","JUMLAH KWH","HARGA","ADMIN","TOTAL HARGA"],l=u*.6,g=Math.max(...i.map(S=>S.length)),f=Math.ceil((g-3)*l)+8,k=c.length*(u*.6),m=Math.sqrt(k**2+(u*2)**2),y=Math.ceil(m),v=y/2,I=y/2,w=`
<svg xmlns="http://www.w3.org/2000/svg" width="${y}" height="${y}">
  <g transform="rotate(-45, ${v}, ${I})">
    <text x="10" y="${I}" font-size="${u}" font-family="monospace"
          fill="black" fill-opacity="0.12">
      ${c}
    </text>
  </g>
</svg>`,E=encodeURIComponent(w),h=(S,O)=>`
      <div class="kv-row">
        <div class="kv-label">${S}</div>
        <div class="kv-colon">:</div>
        <div class="kv-value">${O??""}</div>
      </div>`,P="";if(a==="TOKEN LISTRIK"){let S=e.sn.split("/"),O=S[0]||"",F=(S[1]||"").trim(),be=S[2]&&S[3]?`${S[2]}/${S[3]}`:S[2]||"",Lt=S[4]||"";P=`
      <div style="display:flex; justify-content:space-between; font-size:${u}px; margin-bottom:6px;">
        <div style="text-align:left;">TGL: ${n}</div>
        <div style="text-align:right;">JAM: ${e.waktu}</div>
      </div>

      <div style="text-align:center; font-weight:bold; font-size:25px; margin:6px 0;">
        -- STRUK BUKTI PEMBELIAN --
      </div>
      <div style="text-align:center; font-weight:bold; font-size:25px; margin-bottom:6px;">TOKEN LISTRIK</div>
      <hr style="border:1px solid black; margin:6px 0;">

      ${h("ID PELANGGAN",e.tujuan)}
      ${h("NAMA",F)}
      ${h("TARIF/DAYA",be)}
      ${h("JUMLAH KWH",Lt)}

      <div style="text-align:center; margin-top:8px; font-weight:bold;">---- RINCIAN PEMBAYARAN ----</div>

      ${h("HARGA",`Rp${t.toLocaleString("id-ID")}`)}
      ${h("ADMIN",`Rp${o.toLocaleString("id-ID")}`)}
      ${h("<strong>TOTAL HARGA</strong>",`<strong>Rp${r.toLocaleString("id-ID")}</strong>`)}
      <div style="text-align:center; margin:10px 0; font-weight:bold;">-------- KODE TOKEN --------</div>
      <div style="text-align:center; font-size:28px; font-weight:bold; white-space:pre-line; margin:10px 0;">${O}</div>
      <hr style="border:1px solid black; margin:8px 0;">

      <div style="text-align:center; font-size:18px;">SIMPANLAH STRUK INI</div>
      <div style="text-align:center; font-size:18px;">SEBAGAI BUKTI PEMBELIAN ANDA</div>
      <div style="text-align:center; font-size:18px;">TERIMA KASIH</div>
      `}else{let S=Je[e.kode]||e.kode,O="NOMINAL";if(/PAKET DATA/i.test(a)&&(O="DESKRIPSI"),/PULSA/i.test(a)){let F=e.kode.match(/(\d+)$/);F&&(S=`PULSA ${(parseInt(F[1],10)*1e3).toLocaleString("id-ID")}`)}P=`
  <div style="display:flex; justify-content:space-between; font-size:${u}px; margin-bottom:6px;">
    <div style="text-align:left;">TGL: ${n}</div>
    <div style="text-align:right;">JAM: ${e.waktu}</div>
  </div>

  <div style="text-align:center; font-weight:bold; font-size:25px; margin:6px 0 0 0;">-- STRUK BUKTI PEMBELIAN --</div>
  <div style="text-align:center; font-weight:bold; font-size:25px; margin-bottom:6px;">${a}</div>
  <hr style="border:1px solid black; margin:6px 0;">

  ${h("NOMOR HP",e.tujuan)}
  ${h(O,S)}
  ${h("SN",e.sn)}

  <div style="text-align:center; margin-top:8px; font-weight:bold;">---- RINCIAN PEMBAYARAN ----</div>

  ${h("HARGA",`Rp ${t.toLocaleString("id-ID")}`)}
  ${h("ADMIN",`Rp ${o.toLocaleString("id-ID")}`)}
  ${h("<strong>TOTAL HARGA</strong>",`<strong>RP ${r.toLocaleString("id-ID")}</strong>`)}

  <hr style="border:1px solid black; margin:8px 0;">
  <div style="text-align:center; font-size:18px;">SIMPANLAH STRUK INI</div>
  <div style="text-align:center; font-size:18px;">SEBAGAI BUKTI PEMBELIAN ANDA</div>
  <div style="text-align:center; font-size:18px;">TERIMA KASIH</div>
  `}let M=document.createElement("div");M.innerHTML=`
      <style>
        .struk { font-family: monospace; font-size:${u}px; width:450px; color:#000; padding:20px; }
        /* grid: [label column] [colon column] [value column] */
        .struk .kv-row { display: grid; grid-template-columns: ${f}px 12px 1fr; column-gap:8px; align-items:start; margin:2px 0; }
        .struk .kv-label { text-align:left; white-space:nowrap; }
        .struk .kv-colon { text-align:left; }
        .struk .kv-value { text-align:left; white-space:pre-wrap; word-break:break-word; }
      </style>

      <div class="struk" style="background: #fff url('data:image/svg+xml,${E}') repeat; background-size: ${y*.6}px ${y*.6}px;">
        ${P}
      </div>
    `,document.body.appendChild(M);let Et=await html2canvas(M.querySelector(".struk"),{scale:2,backgroundColor:"#ffffff"});document.body.removeChild(M);let St=Et.toDataURL("image/jpeg"),xt=await(await fetch(St)).blob(),Ae=new File([xt],"struk-transaksi.jpeg",{type:"image/jpeg"});navigator.canShare&&navigator.canShare({files:[Ae]})?await navigator.share({title:"Struk Transaksi",text:"Berikut struk transaksi Anda",files:[Ae]}):navigator.share?await navigator.share({title:"Struk Transaksi",text:`STRUK BUKTI PEMBELIAN
Jenis Produk : ${a}
TGL: ${n} ${e.waktu}
NOMOR : ${e.tujuan}
SN : ${e.sn}
HARGA : Rp${t.toLocaleString("id-ID")}
ADMIN : Rp${o.toLocaleString("id-ID")}
TOTAL : Rp${r.toLocaleString("id-ID")}
SIMPANLAH STRUK INI SEBAGAI BUKTI PEMBELIAN ANDA
TERIMA KASIH`}):p("Web Share API tidak didukung di browser ini.","error")}catch(a){console.error(a),p("Batal membagikan struk.","error")}}var Ye={xcf1:24e3,td2:32e3,xcf1a:18e3},zt=["t","i","a","x","s","tr","b","p","d","sp","gp","o","gr","la","em","bnitap","brizzi","max"];function _e(e){let n=e+1500,t=500;return Math.ceil(n/t)*t}function Xe(e,n){if(!e)return _e(n);let t=e.toLowerCase();if(Ye[t])return Ye[t];for(let a of zt)if(t.startsWith(a)){let o=t.slice(a.length);return/^\d+$/.test(o)?(parseInt(o,10)+3)*1e3:n}return _e(n)}T();var Q=null;async function Wt(){Q=await(await(await(await navigator.bluetooth.requestDevice({filters:[{services:["000018f0-0000-1000-8000-00805f9b34fb"]}]})).gatt.connect()).getPrimaryService("000018f0-0000-1000-8000-00805f9b34fb")).getCharacteristic("00002af1-0000-1000-8000-00805f9b34fb")}async function A(e){Q||await Wt(),Q&&await Q.writeValue(e)}async function J(e){let t=new TextEncoder("utf-8").encode(e+`
\r`);await A(t)}function Ve(e="-",n=32){return e.repeat(n)+`
`}function qe(e,n,t=32){let a=e.length+n.length;if(a>=t)return e+" "+n;let o=t-a;return e+" ".repeat(o)+n}function ce(e,n,t=32){let a=e.padEnd(13," ")+": RP",o=n.toLocaleString("id-ID");return qe(a,o,t)}function Jt(e){let n=e.split("-"),t=n.slice(0,3).join("-"),a=n.slice(3).join("-");return[t,a].filter(Boolean).join(`
`)}async function Ze(e,n,t){let a=new TextEncoder("utf-8"),o=new Uint8Array([27,33,48]),r=new Uint8Array([27,69,1]),c=new Uint8Array([27,69,0]),u=new Uint8Array([27,33,16]),i=new Uint8Array([27,33,32]),l=new Uint8Array([27,33,0]),g=new Uint8Array([27,97,0]),f=new Uint8Array([27,97,1]),k="PRODUK DIGITAL";/^pln/i.test(e.kode)?k="TAGIHAN LISTRIK PASCABAYAR":/^p/i.test(e.kode)?k="TOKEN LISTRIK":/^td/i.test(e.kode)?k="PAKET DATA":/^tr/i.test(e.kode)?k="PULSA TRI":/^i/i.test(e.kode)?k="PULSA INDOSAT":/^s/i.test(e.kode)?k="PULSA TFREN":/^x/i.test(e.kode)?k="PULSA XL":/^a/i.test(e.kode)?k="PULSA AXIS":/^t(?!d)/i.test(e.kode)&&(k="PULSA TELKOMSEL");let m=/^pln/i.test(e.kode)?3e3:0,y=t+m,v=localStorage.getItem("nama_agen")||"";try{if(k==="TOKEN LISTRIK"){let I=e.sn.split("/"),w=I[0]||"",E=Jt(w),h=I[1]?.trim()||"",P=I[2]&&I[3]?`${I[2]}/${I[3]}`:"",M=I[4]||"";await J(qe(`TGL: ${n}`,`JAM: ${e.waktu}`,32)),await A(f),await A(r),await A(a.encode(`
-- STRUK BUKTI PEMBELIAN --
`)),await A(a.encode(`TOKEN LISTRIK
`)),await A(g),await A(c),await J(`${Ve("_",32)}
ID PELANGGAN : ${e.tujuan}
NAMA         : ${h}
TARIF/DAYA   : ${P}
JUMLAH KWH   : ${M}`),await A(f),await A(a.encode(`
-- RINCIAN PEMBAYARAN --
`)),await A(g),await J(ce("HARGA",t,32)+`
`+ce("ADMIN",m,32)),await A(r),await J(ce("TOTAL HARGA",y,32)),await A(c),await A(f),await A(a.encode(`
---------- KODE TOKEN ----------

`)),await A(o),await A(a.encode(E+`
`)),await A(l),await J(`${Ve("_",32)}
SIMPANLAH STRUK INI
SEBAGAI BUKTI PEMBELIAN ANDA
TERIMA KASIH


`)}else await J(`
${v}
${n} ${e.waktu}
`),await A(f),await A(a.encode(`-- STRUK BUKTI PEMBELIAN --
`)),await A(a.encode(k+`
`)),await A(g),`${e.tujuan}${e.kode}${e.sn}${t.toLocaleString("id-ID")}${m.toLocaleString("id-ID")}${y.toLocaleString("id-ID")}`;p("Struk berhasil dikirim ke printer thermal","success")}catch{p("Batal Print","error")}}function Qe(e){let n=document.getElementById("hargaJualInput");if(!n)return e;let t=n.textContent.replace(/[^\d]/g,"");return parseInt(t||"0",10)||e}async function et(e,n){let t=Y(e.harga),a=e.kode?e.kode.toLowerCase():"",o=Xe(a,t),r=()=>o-t,c="hargaJualInput",u=`<table class="detail-table-laporan-modal">
<tr><td>Waktu Pengisian</td><td>${n} ${e.waktu}</td></tr>
<tr><td>Kode Produk</td><td>${e.kode}</td></tr>
<tr><td>Nomor Tujuan</td><td>${e.tujuan}</td></tr>
<tr><td>Serial Number</td><td>${e.sn}</td></tr>
<tr><td>Status Transaksi</td><td>${e.status}</td></tr>
</table>
<table class="detail-table-laporan-modal">
<tr><td>Harga Modal</td><td>Rp${t.toLocaleString("id-ID")}</td></tr>
<tr><td>Saran Harga Jual</td><td><span id="editHarga" style="cursor:pointer;">\u270F\uFE0F </span><span id="${c}">Rp${o.toLocaleString("id-ID")}</span></td></tr>
<tr><td>Keuntungan</td><td id="keuntungan">Rp${r().toLocaleString("id-ID")}</td></tr>
</table>`,l=["-","NA","N/A","n/a","N.A","Update","UPDATE"].includes((e.sn||"").trim());$({title:"DETAIL TRANSAKSI",message:u,buttons:[{text:"\u{1F5BC}\uFE0F Bagikan",className:"modal-share",onClick:()=>Fe(e,n,Qe(o)),disabled:l},{text:"\u{1F4DD} Komplain",className:"modal-complain",onClick:()=>{let f=`Mohon bantu cek transaksi berikut:

Tanggal : ${n} jam ${e.waktu}
Kode Produk : ${e.kode}
Tujuan : ${e.tujuan}
Serial Number : ${e.sn}
Status : ${e.status}
Terima kasih.
`,m=`https://wa.me/6283100100190?text=${encodeURIComponent(f)}`;window.open(m,"_blank")}},{text:"\u{1F5A8}\uFE0F Print",className:"modal-print",onClick:()=>Ze(e,n,Qe(o)),disabled:l}]});let g=document.getElementById("editHarga");g.onclick=()=>{g.style.display="none";let f=document.getElementById(c),k=o;f.innerHTML=`<input id="inputHargaInline" type="text" value="${k.toLocaleString("id-ID")}" style="padding:0; margin:0; width:80px; height:1.2em; line-height:1.2em; border:1px solid #ccc; vertical-align:middle; text-align:right;"><span id="btnSimpanInline" style="cursor:pointer; margin-left:4px;">\u2705</span><span id="btnBatalInline" style="cursor:pointer; margin-left:4px;">\u274C</span>`;let m=document.getElementById("inputHargaInline");m.addEventListener("keydown",y=>{y.key==="Enter"?(y.preventDefault(),document.getElementById("btnSimpanInline").click()):y.key==="Escape"&&document.getElementById("btnBatalInline").click()}),m.addEventListener("input",()=>{let y=m.selectionStart,v=m.selectionEnd,I=m.value.replace(/\D/g,"");if(I){let w=parseInt(I,10).toLocaleString("id-ID"),E=m.value,h=w.length-E.length;m.value=w,m.setSelectionRange(y+h,v+h)}else m.value=""}),document.getElementById("btnSimpanInline").onclick=()=>{let y=m.value.replace(/\D/g,""),v=parseFloat(y);!isNaN(v)&&v>0?(o=v,f.textContent="Rp"+o.toLocaleString("id-ID"),document.getElementById("keuntungan").textContent="Rp"+(o-t).toLocaleString("id-ID")):(p("Harga tidak valid!","error"),f.textContent="Rp"+o.toLocaleString("id-ID")),g.style.display="inline"},document.getElementById("btnBatalInline").onclick=()=>{f.textContent="Rp"+o.toLocaleString("id-ID"),g.style.display="inline"}}}function me(e,n,t){if(!e||!n)return;let a=document.createElement("div");a.className="laporan-item",a.style.display="grid",a.style.gridTemplateColumns="1fr auto",a.style.alignItems="flex-start",a.style.padding="0.25rem 0.5rem",a.style.borderBottom="1px solid #ddd",a.style.gap="0.5rem",a.style.fontSize="0.85rem";let o=document.createElement("div");o.innerHTML=`
    <div><b>${e.kode}</b> \u2192 ${e.tujuan} \u2192 Rp ${e.harga}</div>
    <div class="sn-text">SN: ${e.sn}</div>
`;let r=document.createElement("div");r.style.display="flex",r.style.flexDirection="column",r.style.alignItems="flex-end",r.style.whiteSpace="nowrap",r.innerHTML=`
        <div style="font-weight:bold">${e.waktu}</div>
        <div>${e.status}</div>
    `;let c=e.status.toLowerCase();c.includes("sukses")?a.classList.add("success"):c.includes("gagal")||c.includes("timeout")?a.classList.add("failed"):a.classList.add("proses"),a.appendChild(o),a.appendChild(r),n.appendChild(a),a.addEventListener("click",()=>et(e,t))}var nt=W(e=>{Yt(e)}),Ft=document.getElementById("laporanTransaksiDisplay"),at=null;function ot(){let e=document.getElementById("navRiwayat"),n=new Date;at=new Date(n.toLocaleString("en-US",{timeZone:"Asia/Jakarta"})).getDate(),e.addEventListener("click",de)}function de(){s(`laporan.${at}`),Ft.style.display="block"}window.laporanTerbuka=!1;function tt(e){let n=/^#(\S+)\s+ke\s+(\S+)\s+Rp\.([\d.]+)\s+#([\s\S]*?)\s*@(\d{2}:\d{2})\s+Status=([^;]+);?$/i,t=e.match(n);if(!t)return null;let a=t[4].trim();if(a===""&&(a="-"),t[1]==="CEKTOKEN"&&a.includes("NAMA =")){let o=a.match(/NAMA\s*=\s*.*?NO\.METER\s*=\s*.*?TARIF DAYA\s*=\s*.*?(?=$|UNTUK)/s);o&&(a=o[0].replace(/\s+/g," ").trim())}return{kode:t[1],tujuan:t[2],harga:t[3],sn:a,waktu:t[5],status:t[6].trim()}}function Yt(e){let n=document.getElementById("laporanHeader"),t=document.getElementById("laporanList");if(!t)return;let o=e.split(`
`).map(i=>i.trim()).filter(i=>i);if(window.laporanTerbuka&&!o.some(i=>i.startsWith("Tgl")))return;let r=o.find(i=>i.startsWith("Tgl"))||"",c=r.replace(/^Tgl\.\s*/,"").replace("N/A","").trim();if(!window.headerSudahRender)r&&(We(r,n,t),window.headerSudahRender=!0);else{let i=n.querySelector(".laporan-tanggal-text");i&&(i.textContent=r)}t.innerHTML="";let u="";o.forEach(i=>{if(i.startsWith("Tgl")){if(i.includes("N/A")){let l=i.replace("N/A","").trim(),g=n.querySelector(".laporan-tanggal-text");g&&(g.textContent=l);let f=document.createElement("div");f.textContent="Belum ada transaksi",f.style.textAlign="center",f.style.padding="1rem",f.style.color="#666",t.appendChild(f)}}else if(i.startsWith("#")){if(u=i,i.includes("Status=")){let l=tt(u);l&&me(l,t,c),u=""}}else if(u&&(u+=" "+i,i.includes("Status="))){let l=tt(u);l&&me(l,t,c),u=""}})}T();T();function it(e){let n=e.getElementsByTagName("body");if(n.length>0){let t=n[0].textContent.trim();if(/^Yth\.\s*AGEN PULSA/i.test(t)&&/(Saldo|Bonus|Poin|Pemakaian)/i.test(t))return!0;if(/Mohon tunggu transaksi sebelumnya selesai/i.test(t)||/masih diproses operator/i.test(t))return p(t,"success",5e3),!0;if(/ke\s+\d+\s+diproses,/i.test(t)&&/Harga\s+/i.test(t)&&/Saldo\s+/i.test(t))return $({title:"Transaksi Sedang Diproses",message:'<div style="text-align:center;">Mohon tunggu sebentar, transaksi Anda sedang kami proses.</div>',buttons:[{text:"OK",className:"modal-ok",onClick:()=>{}},{text:"Cek Laporan",className:"modal-info",onClick:()=>{let o=document.getElementById("navRiwayat");o&&o.click()}}]}),!0;if(/^CEKTOKEN/i.test(t)&&/NAMA\s*=/i.test(t)){let o=t.match(/NAMA\s*=\s*(.*)/i)?.[1]||"-",r=t.match(/NO\.METER\s*=\s*(.*)/i)?.[1]||"-",c=t.match(/TARIF DAYA\s*=\s*(.*)/i)?.[1]||"-",u=`<table class="detail-table-laporan-modal">
                <tr><td>Nama</td><td>${o}</td></tr>
                <tr><td>No. Meter</td><td>${r}</td></tr>
                <tr><td>Tarif Daya</td><td>${c}</td></tr>
            </table>`;return $({title:"Info Nomor Token Pelanggan",message:u,buttons:[{text:"OK",className:"modal-ok",onClick:()=>{let i=document.getElementById("inputTujuan");s("harga.p"),i&&!i.value.trim()&&(i.value=r,i.dispatchEvent(new Event("input",{bubbles:!0})))}}]}),!0}if(/CEK TAGIHAN PLN/i.test(t)&&/NAMA=/i.test(t)){let o=t.match(/CEK TAGIHAN PLN ke\s+(\d+)/i),r=o?o[1]:"-",c=t.match(/SN\/Ref:\s*([^,]+)/i);if(c){let i=c[1].trim().split("@"),l={};i.forEach(h=>{let[P,M]=h.split("=");P&&M&&(l[P.trim()]=M.trim())});let g=l.NAMA||"-",f=l.TD||"-",k=l.JBLN||"-",m=l.PTAG||"-",y=l.TAG||"0",v=l.ADM||"0",I=l.TTAG||"0",w=h=>"Rp"+Y(h).toLocaleString("id-ID"),E=`<table class="detail-table-laporan-modal">
            <tr><td>ID Pelanggan</td><td>${r}</td></tr>
            <tr><td>Nama</td><td>${g}</td></tr>
            <tr><td>Tarif Daya</td><td>${f}</td></tr>
            <tr><td>Jumlah Bulan</td><td>${k}</td></tr>
            <tr><td>Periode Tagihan</td><td>${m}</td></tr>
            <tr><td>Tagihan</td><td>${w(y)}</td></tr>
            <tr><td>Biaya Admin</td><td>${w(v)}</td></tr>
            <tr><td>Total Tagihan</td><td>${w(I)}</td></tr>
        </table>`;return $({title:"Info Tagihan PLN",message:E,buttons:[{text:"BAYAR",className:"modal-ok",onClick:()=>{s("pln."+r)}},{text:"CANCEL",className:"modal-cancel",onClick:()=>{p("Pembayaran dibatalkan","error")}}]}),!0}}if(!/^Tgl\.\s*\d{2}\/\d{2}\/\d{2}/i.test(t)&&(/CEK\s+NAMA\s+(DANA|GOPAY|SHOPEEPAY)/i.test(t)||/CEK\s+NAMA\s+E\s*-\s*WALLET\s+BERHASIL/i.test(t)&&/BILLER\s*=\s*(DANA|GOPAY|SHOPEEPAY)/i.test(t))&&/NAMA\s*=/i.test(t)){let o=t.match(/NAMA\s*=\s*(.*)/i)?.[1]?.trim()||"-";return o=o.replace(/^(DANA|GOPAY|SHOPEEPAY)\s+TOP\s+UP\s+/i,"").trim(),window.dispatchEvent(new CustomEvent("updateNamaDompet",{detail:{nama:o}})),!0}if(!/(?:#?Harga)/i.test(t))return!0;let a="error";(/SUKSES/i.test(t)||/DIPROSES/i.test(t))&&(a="success"),p(t,a,5e3)}return!0}var ue=document.getElementById("pinOverlay"),R=document.getElementById("pinMessage"),_t=document.querySelectorAll(".pinCircle"),lt=document.querySelectorAll(".pinPad button"),Xt=document.getElementById("pinBack"),N="",j="check",st="";async function rt(e){let t=new TextEncoder().encode(e),a=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(a)).map(r=>r.toString(16).padStart(2,"0")).join("")}function dt(){return localStorage.getItem("appPin")}dt()?(j="check",R.textContent="Masukkan PIN Anda"):(j="set",R.textContent="Buat PIN Baru 6 Digit");function ge(){_t.forEach((e,n)=>{e.classList.toggle("filled",n<N.length)})}function pe(){N="",ge()}function ct(e){ue.classList.add("fade-out"),ue.addEventListener("animationend",()=>{ue.style.display="none",document.querySelector("main.container").style.display="block",e&&e()},{once:!0})}async function fe(){if(Vt(),N.length!==6)return;let e=dt();if(!e)return;await rt(N)===e?ct():(R.textContent="PIN salah, coba lagi",mt(),pe())}function mt(){R.classList.remove("shake"),R.offsetWidth,R.classList.add("shake")}function Vt(){lt.forEach((e,n)=>{e.style.animationDelay=`${n*.1}s`,e.classList.remove("animated"),e.offsetWidth,e.classList.add("animated")})}lt.forEach(e=>{e.id!=="pinBack"&&e.addEventListener("click",async()=>{N.length<6&&(N+=e.textContent,ge(),N.length===6&&setTimeout(async()=>{if(j==="check")await fe();else if(j==="set")st=N,j="confirm",R.textContent="Konfirmasi PIN 6 digit",pe();else if(j==="confirm")if(N===st){let n=await rt(N);localStorage.setItem("appPin",n),R.textContent="PIN berhasil dibuat!",setTimeout(()=>ct(),2e3)}else R.textContent="PIN tidak cocok, coba lagi",j="set",mt(),pe()},200))})});Xt.addEventListener("click",()=>{N=N.slice(0,-1),ge()});T();var b=null,ye=!1,qt="wss://pulsa.dpdns.org:7443/ws",ut=document.getElementById("saldoDisplay"),pt=document.getElementById("homeDisplay"),gt=document.getElementById("navBottom"),ke=null;function he(e){console.log("[XMPP]",e)}function Zt(e,n){let t=localStorage.getItem("appPin");if(!t){console.error("PIN belum ada, tidak bisa enkripsi");return}let a=CryptoJS.AES.encrypt(e,t).toString(),o=CryptoJS.AES.encrypt(n,t).toString();localStorage.setItem("xmpp_jid",a),localStorage.setItem("xmpp_pass",o)}function ve(){let e=localStorage.getItem("appPin");if(!e)return null;let n=localStorage.getItem("xmpp_jid"),t=localStorage.getItem("xmpp_pass");if(!n||!t)return null;try{let a=CryptoJS.AES.decrypt(n,e).toString(CryptoJS.enc.Utf8),o=CryptoJS.AES.decrypt(t,e).toString(CryptoJS.enc.Utf8);return{jid:a,pass:o}}catch(a){return console.error("Gagal dekripsi:",a),null}}function Te(){localStorage.removeItem("xmpp_jid"),localStorage.removeItem("xmpp_pass")}function ee(e,n,t=null){if(ye){he("Login temporarily locked, please wait...");return}b=new Strophe.Connection(qt),b.connect(e+"/",n,function(a){switch(console.log("[DEBUG] Strophe status:",a),a){case Strophe.Status.CONNECTING:console.log("Connecting..."),D(50);break;case Strophe.Status.CONNFAIL:console.log("Connection failed."),D(100),K();break;case Strophe.Status.DISCONNECTING:console.log("Disconnecting...");break;case Strophe.Status.DISCONNECTED:console.log("Disconnected. Coba reconnect..."),D(0),K();let o=ve();o?(z(),console.log("\u{1F504} Auto-relogin pakai credential tersimpan..."),setTimeout(()=>{ee(o.jid,o.pass)},1e3)):(K(),document.getElementById("formLogin").style.display="block",ut.style.display="none",pt.style.display="none",gt.style.display="none",laporanTransaksiDisplay.style.display="none",document.getElementById("akunDisplay").style.display="none");break;case Strophe.Status.CONNECTED:console.log("Connected as "+b.jid),D(100),K(),ke&&clearInterval(ke),ke=setInterval(()=>{b&&b.connected&&(b.send($pres()),console.log("\u{1F504} Sent keepalive"))},3e4),document.getElementById("akune").value="",document.getElementById("paswote").value="",b.send($pres().c("priority").t("127")),document.getElementById("formLogin").style.display="none",Zt(e,n),!document.getElementById("formLogin").style.display!=="none"&&s("S"),ut.style.display="block",b.addHandler(xe,null,"message","chat"),b.addHandler(nt,null,"message","chat"),b.addHandler(Ge,null,"message","chat"),b.addHandler(it,null,"message","chat"),pt.style.display="block",gt.style.display="flex",ze(),ot(),document.querySelectorAll(".bottom-nav .nav-item").forEach(c=>c.classList.remove("active")),document.getElementById("navBeranda").classList.add("active"),document.getElementById("pinOverlay").style.display="flex",fe(),window.dispatchEvent(new Event("loginUnlocked")),t&&t();break;case Strophe.Status.AUTHFAIL:console.log("Authentication failed."),Te(),p(`Login Gagal
Periksa Username dan Password!`,"error"),D(100),K(),ye=!0,setTimeout(()=>{ye=!1,console.log("Login unlocked, you can try again."),window.dispatchEvent(new Event("loginUnlocked"))},5e3);break;case Strophe.Status.ATTACHED:console.log("Attached.");break;case Strophe.Status.ERROR:console.log("Error occurred.");break;default:console.log("Other status: "+a)}})}function Qt(){document.getElementById("akune").value="",document.getElementById("paswote").value=""}function ft(e){document.getElementById("formLogin").addEventListener("submit",function(n){n.preventDefault();let t=this.querySelector('button[type="submit"]'),a=document.getElementById("akune").value.toLowerCase(),o=document.getElementById("paswote").value;if(!a||!o){p("Username dan password harus diisi","error");return}t.disabled=!0,t.textContent="Tunggu...";let r=a+"@"+e;z(),ee(r,o)}),window.addEventListener("loginUnlocked",()=>{let n=document.querySelector('#formLogin button[type="submit"]');n&&(n.disabled=!1,n.textContent="Login")}),window.addEventListener("load",()=>{let n=ve();console.log("Loaded credentials from localStorage:",n),n&&n.jid&&n.pass?(he("Found saved credentials, auto-logging in..."),document.getElementById("akune").value=n.jid.split("@")[0],document.getElementById("paswote").value=n.pass,z(),D(0),ee(n.jid,n.pass,()=>{document.getElementById("loading").style.display="none"})):(document.getElementById("loading").style.display="none",document.getElementById("formLogin").style.display="block")}),document.getElementById("logoutBtn").addEventListener("click",function(){console.log("Manual logout."),b&&(b.disconnect(),Te()),Qt()})}T();function yt(){document.getElementById("contactBtn").addEventListener("click",async()=>{if("contacts"in navigator&&"ContactsManager"in window)try{let n=["name","tel"],t={multiple:!1},a=await navigator.contacts.select(n,t);if(!a||a.length===0){console.log("User batal pilih kontak");return}let o=document.getElementById("inputTujuan");if(!o)return;let r=a[0].tel&&a[0].tel[0];if(!r){p("Kontak tidak memiliki nomor telepon.","error");return}o.value=H(r),o.dispatchEvent(new Event("input",{bubbles:!0,composed:!0}))}catch(n){console.warn("Akses kontak dibatalkan:",n)}else p("Browser Anda tidak mendukung akses kontak.","error")})}function kt(){let e=document.querySelectorAll(".bottom-nav .nav-item"),n=document.getElementById("akunDisplay");e.forEach(t=>{t.addEventListener("click",()=>{e.forEach(a=>a.classList.remove("active")),t.classList.add("active"),t.id==="navRiwayat"?(console.log("ini navRiwayat"),document.getElementById("laporanTransaksiDisplay").style.display="block",document.getElementById("homeDisplay").style.display="none",document.getElementById("saldoDisplay").style.display="none",n.style.display="none"):t.id==="navBeranda"?(console.log("ini halaman navBeranda"),document.getElementById("homeDisplay").style.display="block",document.getElementById("laporanTransaksiDisplay").style.display="none",document.getElementById("saldoDisplay").style.display="block",n.style.display="none"):t.id==="navAkun"&&(console.log("ini halaman navAkun"),document.getElementById("laporanTransaksiDisplay").style.display="none",document.getElementById("homeDisplay").style.display="none",document.getElementById("saldoDisplay").style.display="none",n.style.display="block")})})}function ht(){let e=document.getElementById("akunDisplay");e.innerHTML=`
    <div class="akun-list">
      <button id="logoutBtn" class="akun-item">
        <span class="akun-icon">\u{1F4F4}</span>
        <span class="akun-label">Keluar Akun</span>
      </button>
      <button class="akun-item refreshBtn">
        <span class="akun-icon">\u{1F504}</span>
        <span class="akun-label">Refresh Halaman</span>
      </button>
      <button class="akun-item toggleThemeBtn">
        <span class="akun-icon">\u{1F319}</span>
        <span class="akun-label">Tema Gelap/Terang</span>
      </button>
    </div>
  `}function Ie(){let e=document.getElementById("navBottom");if(!e)return;let n=window.visualViewport;function t(){let a=window.innerHeight-n.height-n.offsetTop;a>0?e.style.bottom=a+"px":e.style.bottom="0px"}n.addEventListener("resize",t),n.addEventListener("scroll",t)}function we(){let e=document.getElementById("toast");if(!e)return;let n=window.visualViewport;function t(){let a=n.height/2+n.offsetTop;e.style.top=a+"px"}n.addEventListener("resize",t),n.addEventListener("scroll",t),t()}document.addEventListener("DOMContentLoaded",()=>{Ie(),we()});T();function vt(e){let n=document.getElementById("formLogin"),t=document.getElementById("formRegister"),a=document.getElementById("backToLogin"),o=document.getElementById("regUser"),r=document.getElementById("regPass"),c=document.getElementById("regPass2"),u=document.getElementById("regWarning"),i=document.getElementById("passWarning");G(document.getElementById("toggleRegPass"),r),G(document.getElementById("toggleRegPass2"),c),a.addEventListener("click",()=>{t.reset(),u.style.display="none",i.style.display="none",t.style.display="none",n.style.display="block"}),o.addEventListener("input",()=>{let g=o.value;/^[A-Za-z0-9]*$/.test(g)?u.style.display="none":(u.textContent="Username hanya boleh huruf dan angka (tanpa spasi & simbol)!",u.style.display="block")});function l(){r.value&&c.value&&r.value!==c.value?(i.textContent="Konfirmasi password tidak cocok!",i.style.display="block"):i.style.display="none"}r.addEventListener("input",l),c.addEventListener("input",l),t.addEventListener("submit",async g=>{if(g.preventDefault(),!/^[A-Za-z0-9]+$/.test(o.value)){u.textContent="Username hanya boleh huruf dan angka (tanpa spasi & simbol)!",u.style.display="block";return}if(r.value!==c.value){i.textContent="Konfirmasi password tidak cocok!",i.style.display="block";return}try{let f=await fetch("https://pulsa.dpdns.org:5443/api/register",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Basic "+btoa("adminkantor@pulsa.dpdns.org:password123")},body:JSON.stringify({user:o.value,host:e,password:r.value})}),k;try{k=await f.json()}catch{k=await f.text()}if(console.log("Register response:",k),f.ok&&typeof k=="string"&&k.includes("successfully registered")){let m=o.value;p("Akun berhasil dibuat, silakan login!","success");let y="6282316015252",v=`tambahakun ${m}@${e}/`;window.open(`https://wa.me/${y}?text=${encodeURIComponent(v)}`,"_blank"),t.reset(),t.style.display="none",n.style.display="block",document.getElementById("akune").value=m}else if(k&&k.status==="error"&&k.message){if(k.message.includes("already registered")){let m=o.value;p(`Username ${m} sudah terdaftar, gunakan username lain`,"error",5e3)}else p(k.message,"error");r.value="",c.value=""}else p("Gagal register, coba lagi!","error")}catch(f){console.error(f),p("Terjadi kesalahan koneksi","error")}})}T();var te=!1,X=null;function en(){p("Tekan sekali lagi untuk keluar","sukses")}function Tt(){window.addEventListener("popstate",e=>{if(window.modalTerbuka){let n=document.getElementById("modalHeader");if(n&&n.textContent==="Koneksi Terputus"){console.log("\u26D4 Tombol back diabaikan karena modal Koneksi Terputus"),history.pushState({modal:!0},null,location.href);return}window.modalSumber==="showHargaItem"&&p("Transaksi dibatalkan","error");let t=document.getElementById("modalOverlay");t&&(t.style.display="none",window.modalTerbuka=!1,window.modalSumber=null);return}if(window.datepickerTerbuka){let n=document.getElementById("datepickerModal"),t=document.getElementById("datepickerBackdrop");n&&n.remove(),t&&t.remove(),window.datepickerTerbuka=!1;return}te?(X&&clearTimeout(X),te=!1):(en(),te=!0,X&&clearTimeout(X),X=setTimeout(()=>{te=!1},1500),history.pushState({dummy:!0},null,location.href))}),window.addEventListener("load",()=>{history.pushState({first:!0},null,location.href)})}T();function It(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("sw.js").then(e=>{e.onupdatefound=()=>{let n=e.installing;n.onstatechange=()=>{n.state==="installed"&&navigator.serviceWorker.controller&&(p(`Versi baru tersedia
silakan keluar lalu masuk lagi!`,"success"),setTimeout(()=>window.location.reload(),1500))}}}).catch(e=>console.log("Service Worker failed:",e))})}kt();ht();var wt="pulsa.dpdns.org";It();document.querySelectorAll(".refreshBtn").forEach(e=>{e.addEventListener("click",()=>{console.log("Refresh button clicked, reloading..."),window.location.reload()})});var tn=document.getElementById("togglePass"),nn=document.getElementById("paswote");G(tn,nn);var U=document.getElementById("inputTujuan");U.addEventListener("input",()=>{let e=U.selectionStart,n=U.selectionEnd,t=H(U.value),a=0;for(let u=0;u<e;u++)/\d/.test(U.value[u])&&a++;let o=ae(t);U.value=o;let r=0,c=0;for(;r<o.length&&c<a;)/\d/.test(o[r])&&c++,r++;U.setSelectionRange(r,r)});oe();yt();ft(wt);vt(wt);Se();Ie();we();document.addEventListener("gesturestart",function(e){e.preventDefault()});Tt();document.addEventListener("focusin",e=>{(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA")&&setTimeout(()=>{e.target.scrollIntoView({behavior:"smooth",block:"center"})},300)});var ne=null;function At(){ne&&clearTimeout(ne);let e=!1,n=W(t=>{t.startsWith("Yth")&&(e=!0,clearTimeout(ne))});b&&b.addHandler(n,null,"message","chat"),ne=setTimeout(()=>{e||(console.warn("\u26A0\uFE0F Tidak ada respon dari server!"),$({title:"Koneksi Terputus",message:'<div style="text-align:center;">Server tidak merespon. Silakan tekan Refresh untuk mencoba kembali.</div>',buttons:[{text:"Refresh",className:"modal-info",onClick:()=>window.location.reload()}]}))},2e3)}function bt(){let e=document.getElementById("formLogin");return e&&e.style.display!=="none"}document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&(bt()?console.log("\u23F8\uFE0F Skip cek server karena masih di halaman login"):(console.log("\u{1F504} App kembali ke foreground, cek server..."),s("S"),At()))});window.addEventListener("pageshow",e=>{e.persisted&&(bt()?console.log("\u23F8\uFE0F Skip cek server karena masih di halaman login"):(console.log("\u{1F504} App pageshow (Safari/iOS), cek server..."),At()))});})();
