(()=>{var mc=Object.defineProperty;var Z=(t,e)=>()=>(t&&(e=t(t=0)),e);var Ar=(t,e)=>{for(var n in e)mc(t,n,{get:e[n],enumerable:!0})};var xr={};Ar(xr,{createButton:()=>y,disableGestureZoom:()=>Qn,formatDisplayInput:()=>Nr,hideLoadingModal:()=>De,isOnLoginPage:()=>Qt,normalizeInput:()=>Ye,normalizeRupiah:()=>re,preventTextSelectionAndContextMenu:()=>Jn,productCommand:()=>j,setupAutoScrollInput:()=>ei,setupInputTujuanListener:()=>ni,setupNavigasiCatatanHutang:()=>ii,setupPageShowHandler:()=>Zn,setupRefreshButtons:()=>ti,setupTogglePassword:()=>qe,setupVisibilityHandler:()=>Xn,showLoadingModal:()=>Je,showToast:()=>E,updateProgress:()=>he});function y(t,e){let n=document.createElement("button");return n.textContent=t,n.style.margin="0.25rem",n.addEventListener("click",e),n}function E(t,e="error",n=3e3){let i=document.getElementById("toast");if(!i)return;let s="\u26A0\uFE0F";i.classList.remove("success","error"),e==="success"?(s="\u2705",i.classList.add("success")):i.classList.add("error"),i.innerHTML=`
        <div class="toast-icon">${s}</div>
        <div class="toast-message">${t}</div>
    `,i.classList.add("show"),Jt&&clearTimeout(Jt),Jt=setTimeout(()=>{i.classList.remove("show"),Jt=null},n)}function re(t){return t&&parseInt(String(t).replace(/[^0-9]/g,""),10)||0}function Ye(t){return t?t.replace(/\D/g,""):""}function Nr(t){return t?t.replace(/\D/g,"").replace(/(.{4})(?=.)/g,"$1-"):""}function qe(){let t=document.getElementById("togglePass"),e=document.getElementById("paswote");t.addEventListener("click",()=>{e.type==="password"?(e.type="text",t.textContent="\u{1F648}"):(e.type="password",t.textContent="\u{1F441}")})}function Jn(){document.addEventListener("selectstart",t=>{t.target.id!=="inputTujuan"&&t.preventDefault()}),document.addEventListener("contextmenu",t=>{t.target.id!=="inputTujuan"&&t.preventDefault()})}function Qn(){document.addEventListener("gesturestart",t=>{t.preventDefault()})}function Je(){document.getElementById("loadingModal").style.display="flex",he(0)}function De(){document.getElementById("loadingModal").style.display="none"}function he(t){let e=document.getElementById("loginProgress"),n=document.getElementById("loginProgressText");e&&n&&(e.value=t,n.textContent=t+"%")}function j(t){return localStorage.getItem("tipe_akun")==="SP"?`harga.${t}x`:`harga.${t}`}function Xn(t,e,n){document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&(t()?console.log("\u23F8\uFE0F Skip cek server karena masih di halaman login"):(console.log("\u{1F504} App kembali ke foreground, cek server..."),e("S"),n()))})}function Zn(t,e){window.addEventListener("pageshow",n=>{n.persisted&&(t()?console.log("\u23F8\uFE0F Skip cek server karena masih di halaman login"):(console.log("\u{1F504} App pageshow (Safari/iOS), cek server..."),e()))})}function Qt(){let t=document.getElementById("formLogin");return t&&t.style.display!=="none"}function ei(){document.addEventListener("focusin",t=>{(t.target.tagName==="INPUT"||t.target.tagName==="TEXTAREA")&&setTimeout(()=>{t.target.scrollIntoView({behavior:"smooth",block:"center"})},300)})}function ti(){document.querySelectorAll(".refreshBtn").forEach(t=>{t.addEventListener("click",()=>{console.log("\u{1F504} Refresh button clicked, reloading..."),window.location.reload()})})}function ni(){let t=document.getElementById("inputTujuan");t&&t.addEventListener("input",()=>{let e=t.selectionStart,n=Ye(t.value),i=0;for(let a=0;a<e;a++)/\d/.test(t.value[a])&&i++;let s=Nr(n);t.value=s;let r=0,o=0;for(;r<s.length&&o<i;)/\d/.test(s[r])&&o++,r++;t.setSelectionRange(r,r)})}function ii(){document.addEventListener("click",t=>{if(t.target.closest("#btnCatatanHutang")){let e=document.getElementById("akunDisplay"),n=document.getElementById("catatanHutangDisplay");e&&n&&(e.style.display="none",n.style.display="block",history.pushState({page:"catatanHutang"},null,location.href))}if(t.target.closest("#btnBackCatatan")){let e=document.getElementById("akunDisplay"),n=document.getElementById("catatanHutangDisplay");e&&n&&(n.style.display="none",e.style.display="block",history.pushState({page:"akun"},null,location.href))}})}var Jt,R=Z(()=>{Jt=null});var ro,oo=Z(()=>{ro=()=>{}});function uo(t){return ho(void 0,t)}function ho(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:let n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(let n in e)!e.hasOwnProperty(n)||!Rc(n)||(t[n]=ho(t[n],e[n]));return t}function Rc(t){return t!=="__proto__"}function Dc(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}function on(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function mo(t){return(await fetch(t,{credentials:"include"})).ok}function go(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n={alg:"none",type:"JWT"},i=e||"demo-project",s=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o={iss:`https://securetoken.google.com/${i}`,aud:i,iat:s,exp:s+3600,auth_time:s,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}},...t};return[wt(JSON.stringify(n)),wt(JSON.stringify(o)),""].join(".")}function Fc(){let t={prod:[],emulator:[]};for(let e of Object.keys(Et))Et[e]?t.emulator.push(e):t.prod.push(e);return t}function $c(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}function _o(t,e){if(typeof window>"u"||typeof document>"u"||!on(window.location.host)||Et[t]===e||Et[t]||ao)return;Et[t]=e;function n(h){return`__firebase__banner__${h}`}let i="__firebase__banner",r=Fc().prod.length>0;function o(){let h=document.getElementById(i);h&&h.remove()}function a(h){h.style.display="flex",h.style.background="#7faaf0",h.style.position="fixed",h.style.bottom="5px",h.style.left="5px",h.style.padding=".5em",h.style.borderRadius="5px",h.style.alignItems="center"}function l(h,f){h.setAttribute("width","24"),h.setAttribute("id",f),h.setAttribute("height","24"),h.setAttribute("viewBox","0 0 24 24"),h.setAttribute("fill","none"),h.style.marginLeft="-6px"}function c(){let h=document.createElement("span");return h.style.cursor="pointer",h.style.marginLeft="16px",h.style.fontSize="24px",h.innerHTML=" &times;",h.onclick=()=>{ao=!0,o()},h}function d(h,f){h.setAttribute("id",f),h.innerText="Learn more",h.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",h.setAttribute("target","__blank"),h.style.paddingLeft="5px",h.style.textDecoration="underline"}function u(){let h=$c(i),f=n("text"),p=document.getElementById(f)||document.createElement("span"),_=n("learnmore"),v=document.getElementById(_)||document.createElement("a"),k=n("preprendIcon"),I=document.getElementById(k)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(h.created){let w=h.element;a(w),d(v,_);let C=c();l(I,k),w.append(I,p,v,C),document.body.appendChild(w)}r?(p.innerText="Preview backend disconnected.",I.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(I.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,p.innerText="Preview backend running in this workspace."),p.setAttribute("id",f)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",u):u()}function Hc(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function gi(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Hc())}function yo(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function fe(){return hi.NODE_CLIENT===!0||hi.NODE_ADMIN===!0}function vo(){try{return typeof indexedDB=="object"}catch{return!1}}function Eo(){return new Promise((t,e)=>{try{let n=!0,i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(n){e(n)}})}function Wc(t,e){return t.replace(Kc,(n,i)=>{let s=e[i];return s!=null?String(s):`<${i}?>`})}function Xe(t){return JSON.parse(t)}function $(t){return JSON.stringify(t)}function pe(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Oe(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function _i(t){for(let e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function bt(t,e,n){let i={};for(let s in t)Object.prototype.hasOwnProperty.call(t,s)&&(i[s]=e.call(n,t[s],s,t));return i}function Ze(t,e){if(t===e)return!0;let n=Object.keys(t),i=Object.keys(e);for(let s of n){if(!i.includes(s))return!1;let r=t[s],o=e[s];if(lo(r)&&lo(o)){if(!Ze(r,o))return!1}else if(r!==o)return!1}for(let s of i)if(!n.includes(s))return!1;return!0}function lo(t){return t!==null&&typeof t=="object"}function ko(t){let e=[];for(let[n,i]of Object.entries(t))Array.isArray(i)?i.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function an(t,e){return`${t} failed: ${e} argument `}function Be(t){return t&&t._delegate?t._delegate:t}var hi,m,Me,co,Pc,rn,fi,pi,wt,nn,Lc,Mc,Oc,fo,Bc,po,mi,Ie,Et,ao,Uc,Le,Ct,Kc,wo,Co,bo,sn,Io,kt,am,It=Z(()=>{oo();hi={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};m=function(t,e){if(!t)throw Me(e)},Me=function(t){return new Error("Firebase Database ("+hi.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};co=function(t){let e=[],n=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&i+1<t.length&&(t.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++i)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},Pc=function(t){let e=[],n=0,i=0;for(;n<t.length;){let s=t[n++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){let r=t[n++];e[i++]=String.fromCharCode((s&31)<<6|r&63)}else if(s>239&&s<365){let r=t[n++],o=t[n++],a=t[n++],l=((s&7)<<18|(r&63)<<12|(o&63)<<6|a&63)-65536;e[i++]=String.fromCharCode(55296+(l>>10)),e[i++]=String.fromCharCode(56320+(l&1023))}else{let r=t[n++],o=t[n++];e[i++]=String.fromCharCode((s&15)<<12|(r&63)<<6|o&63)}}return e.join("")},rn={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<t.length;s+=3){let r=t[s],o=s+1<t.length,a=o?t[s+1]:0,l=s+2<t.length,c=l?t[s+2]:0,d=r>>2,u=(r&3)<<4|a>>4,h=(a&15)<<2|c>>6,f=c&63;l||(f=64,o||(h=64)),i.push(n[d],n[u],n[h],n[f])}return i.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(co(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):Pc(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();let n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<t.length;){let r=n[t.charAt(s++)],a=s<t.length?n[t.charAt(s)]:0;++s;let c=s<t.length?n[t.charAt(s)]:64;++s;let u=s<t.length?n[t.charAt(s)]:64;if(++s,r==null||a==null||c==null||u==null)throw new fi;let h=r<<2|a>>4;if(i.push(h),c!==64){let f=a<<4&240|c>>2;if(i.push(f),u!==64){let p=c<<6&192|u;i.push(p)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},fi=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},pi=function(t){let e=co(t);return rn.encodeByteArray(e,!0)},wt=function(t){return pi(t).replace(/\./g,"")},nn=function(t){try{return rn.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};Lc=()=>Dc().__FIREBASE_DEFAULTS__,Mc=()=>{if(typeof process>"u"||typeof process.env>"u")return;let t=process.env.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},Oc=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=t&&nn(t[1]);return e&&JSON.parse(e)},fo=()=>{try{return ro()||Lc()||Mc()||Oc()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Bc=t=>fo()?.emulatorHosts?.[t],po=t=>{let e=Bc(t);if(!e)return;let n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let i=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),i]:[e.substring(0,n),i]},mi=()=>fo()?.config;Ie=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,i)=>{n?this.reject(n):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,i))}}};Et={};ao=!1;Uc="FirebaseError",Le=class t extends Error{constructor(e,n,i){super(n),this.code=e,this.customData=i,this.name=Uc,Object.setPrototypeOf(this,t.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ct.prototype.create)}},Ct=class{constructor(e,n,i){this.service=e,this.serviceName=n,this.errors=i}create(e,...n){let i=n[0]||{},s=`${this.service}/${e}`,r=this.errors[e],o=r?Wc(r,i):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new Le(s,a,i)}};Kc=/\{\$([^}]+)}/g;wo=function(t){let e={},n={},i={},s="";try{let r=t.split(".");e=Xe(nn(r[0])||""),n=Xe(nn(r[1])||""),s=r[2],i=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:i,signature:s}},Co=function(t){let e=wo(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},bo=function(t){let e=wo(t).claims;return typeof e=="object"&&e.admin===!0};sn=class{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);let i=this.W_;if(typeof e=="string")for(let u=0;u<16;u++)i[u]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let u=0;u<16;u++)i[u]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let u=16;u<80;u++){let h=i[u-3]^i[u-8]^i[u-14]^i[u-16];i[u]=(h<<1|h>>>31)&4294967295}let s=this.chain_[0],r=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],c,d;for(let u=0;u<80;u++){u<40?u<20?(c=a^r&(o^a),d=1518500249):(c=r^o^a,d=1859775393):u<60?(c=r&o|a&(r|o),d=2400959708):(c=r^o^a,d=3395469782);let h=(s<<5|s>>>27)+c+l+d+i[u]&4294967295;l=a,a=o,o=(r<<30|r>>>2)&4294967295,r=s,s=h}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);let i=n-this.blockSize,s=0,r=this.buf_,o=this.inbuf_;for(;s<n;){if(o===0)for(;s<=i;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<n;)if(r[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(r),o=0;break}}else for(;s<n;)if(r[o]=e[s],++o,++s,o===this.blockSize){this.compress_(r),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){let e=[],n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=n&255,n/=256;this.compress_(this.buf_);let i=0;for(let s=0;s<5;s++)for(let r=24;r>=0;r-=8)e[i]=this.chain_[s]>>r&255,++i;return e}};Io=function(t){let e=[],n=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);if(s>=55296&&s<=56319){let r=s-55296;i++,m(i<t.length,"Surrogate pair missing trail surrogate.");let o=t.charCodeAt(i)-56320;s=65536+(r<<10)+o}s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):s<65536?(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},kt=function(t){let e=0;for(let n=0;n<t.length;n++){let i=t.charCodeAt(n);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,n++):e+=3}return e};am=14400*1e3;});function jc(t){return t===Fe?void 0:t}function Gc(t){return t.instantiationMode==="EAGER"}var ge,Fe,ln,Tt,yi=Z(()=>{It();ge=class{constructor(e,n,i){this.name=e,this.instanceFactory=n,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};Fe="[DEFAULT]";ln=class{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){let i=new Ie;if(this.instancesDeferred.set(n,i),this.isInitialized(n)||this.shouldAutoInitialize())try{let s=this.getOrInitializeService({instanceIdentifier:n});s&&i.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){let n=this.normalizeInstanceIdentifier(e?.identifier),i=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Gc(e))try{this.getOrInitializeService({instanceIdentifier:Fe})}catch{}for(let[n,i]of this.instancesDeferred.entries()){let s=this.normalizeInstanceIdentifier(n);try{let r=this.getOrInitializeService({instanceIdentifier:s});i.resolve(r)}catch{}}}}clearInstance(e=Fe){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Fe){return this.instances.has(e)}getOptions(e=Fe){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:n={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let s=this.getOrInitializeService({instanceIdentifier:i,options:n});for(let[r,o]of this.instancesDeferred.entries()){let a=this.normalizeInstanceIdentifier(r);i===a&&o.resolve(s)}return s}onInit(e,n){let i=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(i)??new Set;s.add(e),this.onInitCallbacks.set(i,s);let r=this.instances.get(i);return r&&e(r,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){let i=this.onInitCallbacks.get(n);if(i)for(let s of i)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:jc(e),options:n}),this.instances.set(e,i),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=Fe){return this.component?this.component.multipleInstances?e:Fe:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};Tt=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let n=new ln(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}});var Vc,D,zc,Yc,qc,Jc,et,vi=Z(()=>{Vc=[];(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(D||(D={}));zc={debug:D.DEBUG,verbose:D.VERBOSE,info:D.INFO,warn:D.WARN,error:D.ERROR,silent:D.SILENT},Yc=D.INFO,qc={[D.DEBUG]:"log",[D.VERBOSE]:"log",[D.INFO]:"info",[D.WARN]:"warn",[D.ERROR]:"error"},Jc=(t,e,...n)=>{if(e<t.logLevel)return;let i=new Date().toISOString(),s=qc[e];if(s)console[s](`[${i}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},et=class{constructor(e){this.name=e,this._logLevel=Yc,this._logHandler=Jc,this._userLogHandler=null,Vc.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in D))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?zc[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,D.DEBUG,...e),this._logHandler(this,D.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,D.VERBOSE,...e),this._logHandler(this,D.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,D.INFO,...e),this._logHandler(this,D.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,D.WARN,...e),this._logHandler(this,D.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,D.ERROR,...e),this._logHandler(this,D.ERROR,...e)}}});function Xc(){return To||(To=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Zc(){return So||(So=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}function ed(t){let e=new Promise((n,i)=>{let s=()=>{t.removeEventListener("success",r),t.removeEventListener("error",o)},r=()=>{n(me(t.result)),s()},o=()=>{i(t.error),s()};t.addEventListener("success",r),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&Ao.set(n,t)}).catch(()=>{}),bi.set(e,t),e}function td(t){if(wi.has(t))return;let e=new Promise((n,i)=>{let s=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",o),t.removeEventListener("abort",o)},r=()=>{n(),s()},o=()=>{i(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",r),t.addEventListener("error",o),t.addEventListener("abort",o)});wi.set(t,e)}function xo(t){Ci=t(Ci)}function nd(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){let i=t.call(cn(this),e,...n);return No.set(i,e.sort?e.sort():[e]),me(i)}:Zc().includes(t)?function(...e){return t.apply(cn(this),e),me(Ao.get(this))}:function(...e){return me(t.apply(cn(this),e))}}function id(t){return typeof t=="function"?nd(t):(t instanceof IDBTransaction&&td(t),Qc(t,Xc())?new Proxy(t,Ci):t)}function me(t){if(t instanceof IDBRequest)return ed(t);if(Ei.has(t))return Ei.get(t);let e=id(t);return e!==t&&(Ei.set(t,e),bi.set(e,t)),e}var Qc,To,So,Ao,wi,No,Ei,bi,Ci,cn,ki=Z(()=>{Qc=(t,e)=>e.some(n=>t instanceof n);Ao=new WeakMap,wi=new WeakMap,No=new WeakMap,Ei=new WeakMap,bi=new WeakMap;Ci={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return wi.get(t);if(e==="objectStoreNames")return t.objectStoreNames||No.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return me(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};cn=t=>bi.get(t)});function Ro(t,e,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){let o=indexedDB.open(t,e),a=me(o);return i&&o.addEventListener("upgradeneeded",l=>{i(me(o.result),l.oldVersion,l.newVersion,me(o.transaction),l)}),n&&o.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{r&&l.addEventListener("close",()=>r()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}function Po(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Ii.get(e))return Ii.get(e);let n=e.replace(/FromIndex$/,""),i=e!==n,s=rd.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(s||sd.includes(n)))return;let r=async function(o,...a){let l=this.transaction(o,s?"readwrite":"readonly"),c=l.store;return i&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),s&&l.done]))[0]};return Ii.set(e,r),r}var sd,rd,Ii,Do=Z(()=>{ki();ki();sd=["get","getKey","getAll","getAllKeys","count"],rd=["put","add","delete","clear"],Ii=new Map;xo(t=>({...t,get:(e,n,i)=>Po(e,n)||t.get(e,n,i),has:(e,n)=>!!Po(e,n)||t.has(e,n)}))});function od(t){return t.getComponent()?.type==="VERSION"}function Mo(t,e){try{t.container.addComponent(e)}catch(n){_e.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function St(t){let e=t.name;if(xi.has(e))return _e.debug(`There were multiple attempts to register component ${e}.`),!1;xi.set(e,t);for(let n of dn.values())Mo(n,t);for(let n of Md.values())Mo(n,t);return!0}function $o(t,e){let n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Ho(t){return t==null?!1:t.settings!==void 0}function Li(t,e={}){let n=t;typeof e!="object"&&(e={name:e});let i={name:Ni,automaticDataCollectionEnabled:!0,...e},s=i.name;if(typeof s!="string"||!s)throw Te.create("bad-app-name",{appName:String(s)});if(n||(n=mi()),!n)throw Te.create("no-options");let r=dn.get(s);if(r){if(Ze(n,r.options)&&Ze(i,r.config))return r;throw Te.create("duplicate-app",{appName:s})}let o=new Tt(s);for(let l of xi.values())o.addComponent(l);let a=new Pi(n,i,o);return dn.set(s,a),a}function Wo(t=Ni){let e=dn.get(t);if(!e&&t===Ni&&mi())return Li();if(!e)throw Te.create("no-app",{appName:t});return e}function Se(t,e,n){let i=Ld[t]??t;n&&(i+=`-${n}`);let s=i.match(/\s|\//),r=e.match(/\s|\//);if(s||r){let o=[`Unable to register library "${i}" with version "${e}":`];s&&o.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&r&&o.push("and"),r&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),_e.warn(o.join(" "));return}St(new ge(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}function Ko(){return Ti||(Ti=Ro(Bd,Fd,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(At)}catch(n){console.warn(n)}}}}).catch(t=>{throw Te.create("idb-open",{originalErrorMessage:t.message})})),Ti}async function $d(t){try{let n=(await Ko()).transaction(At),i=await n.objectStore(At).get(jo(t));return await n.done,i}catch(e){if(e instanceof Le)_e.warn(e.message);else{let n=Te.create("idb-get",{originalErrorMessage:e?.message});_e.warn(n.message)}}}async function Oo(t,e){try{let i=(await Ko()).transaction(At,"readwrite");await i.objectStore(At).put(e,jo(t)),await i.done}catch(n){if(n instanceof Le)_e.warn(n.message);else{let i=Te.create("idb-set",{originalErrorMessage:n?.message});_e.warn(i.message)}}}function jo(t){return`${t.name}!${t.options.appId}`}function Bo(){return new Date().toISOString().substring(0,10)}function Wd(t,e=Hd){let n=[],i=t.slice();for(let s of t){let r=n.find(o=>o.agent===s.agent);if(r){if(r.dates.push(s.date),Fo(n)>e){r.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Fo(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}function Fo(t){return wt(JSON.stringify({version:2,heartbeats:t})).length}function Kd(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let i=1;i<t.length;i++)t[i].date<n&&(n=t[i].date,e=i);return e}function jd(t){St(new ge("platform-logger",e=>new Si(e),"PRIVATE")),St(new ge("heartbeat",e=>new Ri(e),"PRIVATE")),Se(Ai,Lo,t),Se(Ai,Lo,"esm2020"),Se("fire-js","")}var Si,Ai,Lo,_e,ad,ld,cd,dd,ud,hd,fd,pd,md,gd,_d,yd,vd,Ed,wd,Cd,bd,kd,Id,Td,Sd,Ad,Nd,xd,Pd,Rd,Dd,Ni,Ld,dn,Md,xi,Od,Te,Pi,Uo,Bd,Fd,At,Ti,Hd,Ud,Ri,Di,un=Z(()=>{yi();vi();It();It();Do();Si=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(od(n)){let i=n.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(n=>n).join(" ")}};Ai="@firebase/app",Lo="0.14.4";_e=new et("@firebase/app"),ad="@firebase/app-compat",ld="@firebase/analytics-compat",cd="@firebase/analytics",dd="@firebase/app-check-compat",ud="@firebase/app-check",hd="@firebase/auth",fd="@firebase/auth-compat",pd="@firebase/database",md="@firebase/data-connect",gd="@firebase/database-compat",_d="@firebase/functions",yd="@firebase/functions-compat",vd="@firebase/installations",Ed="@firebase/installations-compat",wd="@firebase/messaging",Cd="@firebase/messaging-compat",bd="@firebase/performance",kd="@firebase/performance-compat",Id="@firebase/remote-config",Td="@firebase/remote-config-compat",Sd="@firebase/storage",Ad="@firebase/storage-compat",Nd="@firebase/firestore",xd="@firebase/ai",Pd="@firebase/firestore-compat",Rd="firebase",Dd="12.4.0";Ni="[DEFAULT]",Ld={[Ai]:"fire-core",[ad]:"fire-core-compat",[cd]:"fire-analytics",[ld]:"fire-analytics-compat",[ud]:"fire-app-check",[dd]:"fire-app-check-compat",[hd]:"fire-auth",[fd]:"fire-auth-compat",[pd]:"fire-rtdb",[md]:"fire-data-connect",[gd]:"fire-rtdb-compat",[_d]:"fire-fn",[yd]:"fire-fn-compat",[vd]:"fire-iid",[Ed]:"fire-iid-compat",[wd]:"fire-fcm",[Cd]:"fire-fcm-compat",[bd]:"fire-perf",[kd]:"fire-perf-compat",[Id]:"fire-rc",[Td]:"fire-rc-compat",[Sd]:"fire-gcs",[Ad]:"fire-gcs-compat",[Nd]:"fire-fst",[Pd]:"fire-fst-compat",[xd]:"fire-vertex","fire-js":"fire-js",[Rd]:"fire-js-all"};dn=new Map,Md=new Map,xi=new Map;Od={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Te=new Ct("app","Firebase",Od);Pi=class{constructor(e,n,i){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new ge("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Te.create("app-deleted",{appName:this._name})}};Uo=Dd;Bd="firebase-heartbeat-database",Fd=1,At="firebase-heartbeat-store",Ti=null;Hd=1024,Ud=30,Ri=class{constructor(e){this.container=e,this._heartbeatsCache=null;let n=this.container.getProvider("app").getImmediate();this._storage=new Di(n),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){try{let n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Bo();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(s=>s.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats.length>Ud){let s=Kd(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){_e.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";let e=Bo(),{heartbeatsToSend:n,unsentEntries:i}=Wd(this._heartbeatsCache.heartbeats),s=wt(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return _e.warn(e),""}}};Di=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return vo()?Eo().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){let n=await $d(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){let i=await this.read();return Oo(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){let i=await this.read();return Oo(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}};jd("")});var Gd,Vd,Go=Z(()=>{un();un();Gd="firebase",Vd="12.4.0";Se(Gd,Vd,"app")});function zd(t){$s=t}function Q(t,e){for(let n in t)t.hasOwnProperty(n)&&e(n,t[n])}function tu(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");let i=new Error(t+" at "+e._path.toString()+": "+n);return i.code=t.toUpperCase(),i}function ou(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function Ua(t,e,n){m(typeof e=="string","typeof type must == string"),m(typeof n=="object","typeof params must == object");let i;if(e===$a)i=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===Ha)i=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);ou(t)&&(n.ns=t.namespace);let s=[];return Q(n,(r,o)=>{s.push(r+"="+o)}),i+s.join("&")}function Us(t){let e=t.toString();return Mi[e]||(Mi[e]=new qi),Mi[e]}function au(t,e){let n=t.toString();return Oi[n]||(Oi[n]=e()),Oi[n]}function x(){return new P("")}function T(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function xe(t){return t.pieces_.length-t.pieceNum_}function L(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new P(t.pieces_,e)}function za(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function Au(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function Ya(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function qa(t){if(t.pieceNum_>=t.pieces_.length)return null;let e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new P(e,0)}function H(t,e){let n=[];for(let i=t.pieceNum_;i<t.pieces_.length;i++)n.push(t.pieces_[i]);if(e instanceof P)for(let i=e.pieceNum_;i<e.pieces_.length;i++)n.push(e.pieces_[i]);else{let i=e.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&n.push(i[s])}return new P(n,0)}function A(t){return t.pieceNum_>=t.pieces_.length}function q(t,e){let n=T(t),i=T(e);if(n===null)return e;if(n===i)return q(L(t),L(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function Ws(t,e){if(xe(t)!==xe(e))return!1;for(let n=t.pieceNum_,i=e.pieceNum_;n<=t.pieces_.length;n++,i++)if(t.pieces_[n]!==e.pieces_[i])return!1;return!0}function ae(t,e){let n=t.pieceNum_,i=e.pieceNum_;if(xe(t)>xe(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[i])return!1;++n,++i}return!0}function Nu(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=kt(e),Ja(t)}function xu(t){let e=t.parts_.pop();t.byteLength_-=kt(e),t.parts_.length>0&&(t.byteLength_-=1)}function Ja(t){if(t.byteLength_>sa)throw new Error(t.errorPrefix_+"has a key path longer than "+sa+" bytes ("+t.byteLength_+").");if(t.parts_.length>ia)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+ia+") or object contains a cycle "+$e(t))}function $e(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}function Mu(t,e){return ft(t.name,e.name)}function Ks(t,e){return ft(t,e)}function Ou(t){is=t}function Bu(t){Za=t}function Fu(t){el=t}function W(t,e=null){if(t===null)return b.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),m(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){let n=t;return new Ee(n,W(e))}if(!(t instanceof Array)&&Hu){let n=[],i=!1;if(Q(t,(o,a)=>{if(o.substring(0,1)!=="."){let l=W(a);l.isEmpty()||(i=i||!l.getPriority().isEmpty(),n.push(new S(o,l)))}}),n.length===0)return b.EMPTY_NODE;let r=wn(n,Mu,o=>o.name,Ks);if(i){let o=wn(n,M.getCompare());return new b(r,W(e),new lt({".priority":o},{".priority":M}))}else return new b(r,W(e),lt.Default)}else{let n=b.EMPTY_NODE;return Q(t,(i,s)=>{if(pe(t,i)&&i.substring(0,1)!=="."){let r=W(s);(r.isLeafNode()||!r.isEmpty())&&(n=n.updateImmediateChild(i,r))}}),n.updatePriority(W(e))}}function tl(t){return{type:"value",snapshotNode:t}}function ct(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Bt(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Ft(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function Wu(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}function Ku(t){return t.loadsAllData()?new $t(t.getIndex()):t.hasLimit()?new cs(t):new Cn(t)}function la(t){let e={};if(t.isDefault())return e;let n;if(t.index_===M?n="$priority":t.index_===Uu?n="$value":t.index_===st?n="$key":(m(t.index_ instanceof as,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=$(n),t.startSet_){let i=t.startAfterSet_?"startAfter":"startAt";e[i]=$(t.indexStartValue_),t.startNameSet_&&(e[i]+=","+$(t.indexStartName_))}if(t.endSet_){let i=t.endBeforeSet_?"endBefore":"endAt";e[i]=$(t.indexEndValue_),t.endNameSet_&&(e[i]+=","+$(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function ca(t){let e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==M&&(e.i=t.index_.toString()),e}function bn(){return{value:null,children:new Map}}function nl(t,e,n){if(A(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{let i=T(e);t.children.has(i)||t.children.set(i,bn());let s=t.children.get(i);e=L(e),nl(s,e,n)}}function fs(t,e,n){t.value!==null?n(e,t.value):ju(t,(i,s)=>{let r=new P(e.toString()+"/"+i);fs(s,r,n)})}function ju(t,e){t.children.forEach((n,i)=>{e(i,n)})}function il(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function js(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Gs(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}function zu(t,e,n,i){let s=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(Wu(o.childName,o.snapshotNode))}),Rt(t,s,"child_removed",e,i,n),Rt(t,s,"child_added",e,i,n),Rt(t,s,"child_moved",r,i,n),Rt(t,s,"child_changed",e,i,n),Rt(t,s,"value",e,i,n),s}function Rt(t,e,n,i,s,r){let o=i.filter(a=>a.type===n);o.sort((a,l)=>qu(t,a,l)),o.forEach(a=>{let l=Yu(t,a,r);s.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,t.query_))})})}function Yu(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function qu(t,e,n){if(e.childName==null||n.childName==null)throw Me("Should only compare child_ events.");let i=new S(e.childName,e.snapshotNode),s=new S(n.childName,n.snapshotNode);return t.index_.compare(i,s)}function On(t,e){return{eventCache:t,serverCache:e}}function Lt(t,e,n,i){return On(new we(e,n,i),t.serverCache)}function sl(t,e,n,i){return On(t.eventCache,new we(e,n,i))}function ys(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Ge(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}function Mt(t,e,n){if(A(e))return new ce(new X(n));{let i=t.writeTree_.findRootMostValueAndPath(e);if(i!=null){let s=i.path,r=i.value,o=q(s,e);return r=r.updateChild(o,n),new ce(t.writeTree_.set(s,r))}else{let s=new X(n),r=t.writeTree_.setTree(e,s);return new ce(r)}}}function ua(t,e,n){let i=t;return Q(n,(s,r)=>{i=Mt(i,H(e,s),r)}),i}function ha(t,e){if(A(e))return ce.empty();{let n=t.writeTree_.setTree(e,new X(null));return new ce(n)}}function vs(t,e){return Ve(t,e)!=null}function Ve(t,e){let n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(q(n.path,e)):null}function fa(t){let e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(M,(i,s)=>{e.push(new S(i,s))}):t.writeTree_.children.inorderTraversal((i,s)=>{s.value!=null&&e.push(new S(i,s.value))}),e}function Ne(t,e){if(A(e))return t;{let n=Ve(t,e);return n!=null?new ce(new X(n)):new ce(t.writeTree_.subtree(e))}}function Es(t){return t.writeTree_.isEmpty()}function ut(t,e){return rl(x(),t.writeTree_,e)}function rl(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let i=null;return e.children.inorderTraversal((s,r)=>{s===".priority"?(m(r.value!==null,"Priority writes must always be leaf nodes"),i=r.value):n=rl(H(t,s),r,n)}),!n.getChild(t).isEmpty()&&i!==null&&(n=n.updateChild(H(t,".priority"),i)),n}}function Vs(t,e){return cl(e,t)}function Qu(t,e,n,i,s){m(i>t.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),t.allWrites.push({path:e,snap:n,writeId:i,visible:s}),s&&(t.visibleWrites=Mt(t.visibleWrites,e,n)),t.lastWriteId=i}function Xu(t,e){for(let n=0;n<t.allWrites.length;n++){let i=t.allWrites[n];if(i.writeId===e)return i}return null}function Zu(t,e){let n=t.allWrites.findIndex(a=>a.writeId===e);m(n>=0,"removeWrite called with nonexistent writeId.");let i=t.allWrites[n];t.allWrites.splice(n,1);let s=i.visible,r=!1,o=t.allWrites.length-1;for(;s&&o>=0;){let a=t.allWrites[o];a.visible&&(o>=n&&eh(a,i.path)?s=!1:ae(i.path,a.path)&&(r=!0)),o--}if(s){if(r)return th(t),!0;if(i.snap)t.visibleWrites=ha(t.visibleWrites,i.path);else{let a=i.children;Q(a,l=>{t.visibleWrites=ha(t.visibleWrites,H(i.path,l))})}return!0}else return!1}function eh(t,e){if(t.snap)return ae(t.path,e);for(let n in t.children)if(t.children.hasOwnProperty(n)&&ae(H(t.path,n),e))return!0;return!1}function th(t){t.visibleWrites=ol(t.allWrites,nh,x()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function nh(t){return t.visible}function ol(t,e,n){let i=ce.empty();for(let s=0;s<t.length;++s){let r=t[s];if(e(r)){let o=r.path,a;if(r.snap)ae(n,o)?(a=q(n,o),i=Mt(i,a,r.snap)):ae(o,n)&&(a=q(o,n),i=Mt(i,x(),r.snap.getChild(a)));else if(r.children){if(ae(n,o))a=q(n,o),i=ua(i,a,r.children);else if(ae(o,n))if(a=q(o,n),A(a))i=ua(i,x(),r.children);else{let l=Oe(r.children,T(a));if(l){let c=l.getChild(L(a));i=Mt(i,x(),c)}}}else throw Me("WriteRecord should have .snap or .children")}}return i}function al(t,e,n,i,s){if(!i&&!s){let r=Ve(t.visibleWrites,e);if(r!=null)return r;{let o=Ne(t.visibleWrites,e);if(Es(o))return n;if(n==null&&!vs(o,x()))return null;{let a=n||b.EMPTY_NODE;return ut(o,a)}}}else{let r=Ne(t.visibleWrites,e);if(!s&&Es(r))return n;if(!s&&n==null&&!vs(r,x()))return null;{let o=function(c){return(c.visible||s)&&(!i||!~i.indexOf(c.writeId))&&(ae(c.path,e)||ae(e,c.path))},a=ol(t.allWrites,o,e),l=n||b.EMPTY_NODE;return ut(a,l)}}}function ih(t,e,n){let i=b.EMPTY_NODE,s=Ve(t.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(M,(r,o)=>{i=i.updateImmediateChild(r,o)}),i;if(n){let r=Ne(t.visibleWrites,e);return n.forEachChild(M,(o,a)=>{let l=ut(Ne(r,new P(o)),a);i=i.updateImmediateChild(o,l)}),fa(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{let r=Ne(t.visibleWrites,e);return fa(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function sh(t,e,n,i,s){m(i||s,"Either existingEventSnap or existingServerSnap must exist");let r=H(e,n);if(vs(t.visibleWrites,r))return null;{let o=Ne(t.visibleWrites,r);return Es(o)?s.getChild(n):ut(o,s.getChild(n))}}function rh(t,e,n,i){let s=H(e,n),r=Ve(t.visibleWrites,s);if(r!=null)return r;if(i.isCompleteForChild(n)){let o=Ne(t.visibleWrites,s);return ut(o,i.getNode().getImmediateChild(n))}else return null}function oh(t,e){return Ve(t.visibleWrites,e)}function ah(t,e,n,i,s,r,o){let a,l=Ne(t.visibleWrites,e),c=Ve(l,x());if(c!=null)a=c;else if(n!=null)a=ut(l,n);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let d=[],u=o.getCompare(),h=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),f=h.getNext();for(;f&&d.length<s;)u(f,i)!==0&&d.push(f),f=h.getNext();return d}else return[]}function lh(){return{visibleWrites:ce.empty(),allWrites:[],lastWriteId:-1}}function Tn(t,e,n,i){return al(t.writeTree,t.treePath,e,n,i)}function zs(t,e){return ih(t.writeTree,t.treePath,e)}function pa(t,e,n,i){return sh(t.writeTree,t.treePath,e,n,i)}function Sn(t,e){return oh(t.writeTree,H(t.treePath,e))}function ch(t,e,n,i,s,r){return ah(t.writeTree,t.treePath,e,n,i,s,r)}function Ys(t,e,n){return rh(t.writeTree,t.treePath,e,n)}function ll(t,e){return cl(H(t.treePath,e),t.writeTree)}function cl(t,e){return{treePath:t,writeTree:e}}function dh(t){return{filter:t}}function uh(t,e){m(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),m(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function hh(t,e,n,i,s){let r=new ws,o,a;if(n.type===le.OVERWRITE){let c=n;c.source.fromUser?o=bs(t,e,c.path,c.snap,i,s,r):(m(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!A(c.path),o=An(t,e,c.path,c.snap,i,s,a,r))}else if(n.type===le.MERGE){let c=n;c.source.fromUser?o=ph(t,e,c.path,c.children,i,s,r):(m(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=ks(t,e,c.path,c.children,i,s,a,r))}else if(n.type===le.ACK_USER_WRITE){let c=n;c.revert?o=_h(t,e,c.path,i,s,r):o=mh(t,e,c.path,c.affectedTree,i,s,r)}else if(n.type===le.LISTEN_COMPLETE)o=gh(t,e,n.path,i,r);else throw Me("Unknown operation type: "+n.type);let l=r.getChanges();return fh(e,o,l),{viewCache:o,changes:l}}function fh(t,e,n){let i=e.eventCache;if(i.isFullyInitialized()){let s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=ys(t);(n.length>0||!t.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&n.push(tl(ys(e)))}}function ul(t,e,n,i,s,r){let o=e.eventCache;if(Sn(i,n)!=null)return e;{let a,l;if(A(n))if(m(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=Ge(e),d=c instanceof b?c:b.EMPTY_NODE,u=zs(i,d);a=t.filter.updateFullNode(e.eventCache.getNode(),u,r)}else{let c=Tn(i,Ge(e));a=t.filter.updateFullNode(e.eventCache.getNode(),c,r)}else{let c=T(n);if(c===".priority"){m(xe(n)===1,"Can't have a priority with additional path components");let d=o.getNode();l=e.serverCache.getNode();let u=pa(i,n,d,l);u!=null?a=t.filter.updatePriority(d,u):a=o.getNode()}else{let d=L(n),u;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();let h=pa(i,n,o.getNode(),l);h!=null?u=o.getNode().getImmediateChild(c).updateChild(d,h):u=o.getNode().getImmediateChild(c)}else u=Ys(i,c,e.serverCache);u!=null?a=t.filter.updateChild(o.getNode(),c,u,d,s,r):a=o.getNode()}}return Lt(e,a,o.isFullyInitialized()||A(n),t.filter.filtersNodes())}}function An(t,e,n,i,s,r,o,a){let l=e.serverCache,c,d=o?t.filter:t.filter.getIndexedFilter();if(A(n))c=d.updateFullNode(l.getNode(),i,null);else if(d.filtersNodes()&&!l.isFiltered()){let f=l.getNode().updateChild(n,i);c=d.updateFullNode(l.getNode(),f,null)}else{let f=T(n);if(!l.isCompleteForPath(n)&&xe(n)>1)return e;let p=L(n),v=l.getNode().getImmediateChild(f).updateChild(p,i);f===".priority"?c=d.updatePriority(l.getNode(),v):c=d.updateChild(l.getNode(),f,v,p,dl,null)}let u=sl(e,c,l.isFullyInitialized()||A(n),d.filtersNodes()),h=new Ht(s,u,r);return ul(t,u,n,s,h,a)}function bs(t,e,n,i,s,r,o){let a=e.eventCache,l,c,d=new Ht(s,e,r);if(A(n))c=t.filter.updateFullNode(e.eventCache.getNode(),i,o),l=Lt(e,c,!0,t.filter.filtersNodes());else{let u=T(n);if(u===".priority")c=t.filter.updatePriority(e.eventCache.getNode(),i),l=Lt(e,c,a.isFullyInitialized(),a.isFiltered());else{let h=L(n),f=a.getNode().getImmediateChild(u),p;if(A(h))p=i;else{let _=d.getCompleteChild(u);_!=null?za(h)===".priority"&&_.getChild(qa(h)).isEmpty()?p=_:p=_.updateChild(h,i):p=b.EMPTY_NODE}if(f.equals(p))l=e;else{let _=t.filter.updateChild(a.getNode(),u,p,h,d,o);l=Lt(e,_,a.isFullyInitialized(),t.filter.filtersNodes())}}}return l}function ma(t,e){return t.eventCache.isCompleteForChild(e)}function ph(t,e,n,i,s,r,o){let a=e;return i.foreach((l,c)=>{let d=H(n,l);ma(e,T(d))&&(a=bs(t,a,d,c,s,r,o))}),i.foreach((l,c)=>{let d=H(n,l);ma(e,T(d))||(a=bs(t,a,d,c,s,r,o))}),a}function ga(t,e,n){return n.foreach((i,s)=>{e=e.updateChild(i,s)}),e}function ks(t,e,n,i,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;A(n)?c=i:c=new X(null).setTree(n,i);let d=e.serverCache.getNode();return c.children.inorderTraversal((u,h)=>{if(d.hasChild(u)){let f=e.serverCache.getNode().getImmediateChild(u),p=ga(t,f,h);l=An(t,l,new P(u),p,s,r,o,a)}}),c.children.inorderTraversal((u,h)=>{let f=!e.serverCache.isCompleteForChild(u)&&h.value===null;if(!d.hasChild(u)&&!f){let p=e.serverCache.getNode().getImmediateChild(u),_=ga(t,p,h);l=An(t,l,new P(u),_,s,r,o,a)}}),l}function mh(t,e,n,i,s,r,o){if(Sn(s,n)!=null)return e;let a=e.serverCache.isFiltered(),l=e.serverCache;if(i.value!=null){if(A(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return An(t,e,n,l.getNode().getChild(n),s,r,a,o);if(A(n)){let c=new X(null);return l.getNode().forEachChild(st,(d,u)=>{c=c.set(new P(d),u)}),ks(t,e,n,c,s,r,a,o)}else return e}else{let c=new X(null);return i.foreach((d,u)=>{let h=H(n,d);l.isCompleteForPath(h)&&(c=c.set(d,l.getNode().getChild(h)))}),ks(t,e,n,c,s,r,a,o)}}function gh(t,e,n,i,s){let r=e.serverCache,o=sl(e,r.getNode(),r.isFullyInitialized()||A(n),r.isFiltered());return ul(t,o,n,i,dl,s)}function _h(t,e,n,i,s,r){let o;if(Sn(i,n)!=null)return e;{let a=new Ht(i,e,s),l=e.eventCache.getNode(),c;if(A(n)||T(n)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=Tn(i,Ge(e));else{let u=e.serverCache.getNode();m(u instanceof b,"serverChildren would be complete if leaf node"),d=zs(i,u)}d=d,c=t.filter.updateFullNode(l,d,r)}else{let d=T(n),u=Ys(i,d,e.serverCache);u==null&&e.serverCache.isCompleteForChild(d)&&(u=l.getImmediateChild(d)),u!=null?c=t.filter.updateChild(l,d,u,L(n),a,r):e.eventCache.getNode().hasChild(d)?c=t.filter.updateChild(l,d,b.EMPTY_NODE,L(n),a,r):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Tn(i,Ge(e)),o.isLeafNode()&&(c=t.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||Sn(i,x())!=null,Lt(e,c,o,t.filter.filtersNodes())}}function yh(t){return t.viewCache_.serverCache.getNode()}function vh(t,e){let n=Ge(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!A(e)&&!n.getImmediateChild(T(e)).isEmpty())?n.getChild(e):null}function _a(t){return t.eventRegistrations_.length===0}function Eh(t,e){t.eventRegistrations_.push(e)}function ya(t,e,n){let i=[];if(n){m(e==null,"A cancel should cancel all event registrations.");let s=t.query._path;t.eventRegistrations_.forEach(r=>{let o=r.createCancelEvent(n,s);o&&i.push(o)})}if(e){let s=[];for(let r=0;r<t.eventRegistrations_.length;++r){let o=t.eventRegistrations_[r];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(t.eventRegistrations_.slice(r+1));break}}t.eventRegistrations_=s}else t.eventRegistrations_=[];return i}function va(t,e,n,i){e.type===le.MERGE&&e.source.queryId!==null&&(m(Ge(t.viewCache_),"We should always have a full cache before handling merges"),m(ys(t.viewCache_),"Missing event cache, even though we have a server cache"));let s=t.viewCache_,r=hh(t.processor_,s,e,n,i);return uh(t.processor_,r.viewCache),m(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=r.viewCache,hl(t,r.changes,r.viewCache.eventCache.getNode(),null)}function wh(t,e){let n=t.viewCache_.eventCache,i=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(M,(r,o)=>{i.push(ct(r,o))}),n.isFullyInitialized()&&i.push(tl(n.getNode())),hl(t,i,n.getNode(),e)}function hl(t,e,n,i){let s=i?[i]:t.eventRegistrations_;return zu(t.eventGenerator_,e,n,s)}function Ch(t){m(!Nn,"__referenceConstructor has already been defined"),Nn=t}function bh(){return m(Nn,"Reference.ts has not been loaded"),Nn}function kh(t){return t.views.size===0}function qs(t,e,n,i){let s=e.source.queryId;if(s!==null){let r=t.views.get(s);return m(r!=null,"SyncTree gave us an op for an invalid query."),va(r,e,n,i)}else{let r=[];for(let o of t.views.values())r=r.concat(va(o,e,n,i));return r}}function Ih(t,e,n,i,s){let r=e._queryIdentifier,o=t.views.get(r);if(!o){let a=Tn(n,s?i:null),l=!1;a?l=!0:i instanceof b?(a=zs(n,i),l=!1):(a=b.EMPTY_NODE,l=!1);let c=On(new we(a,l,!1),new we(i,s,!1));return new Is(e,c)}return o}function Th(t,e,n,i,s,r){let o=Ih(t,e,i,s,r);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),Eh(o,n),wh(o,n)}function Sh(t,e,n,i){let s=e._queryIdentifier,r=[],o=[],a=Pe(t);if(s==="default")for(let[l,c]of t.views.entries())o=o.concat(ya(c,n,i)),_a(c)&&(t.views.delete(l),c.query._queryParams.loadsAllData()||r.push(c.query));else{let l=t.views.get(s);l&&(o=o.concat(ya(l,n,i)),_a(l)&&(t.views.delete(s),l.query._queryParams.loadsAllData()||r.push(l.query)))}return a&&!Pe(t)&&r.push(new(bh())(e._repo,e._path)),{removed:r,events:o}}function fl(t){let e=[];for(let n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function rt(t,e){let n=null;for(let i of t.views.values())n=n||vh(i,e);return n}function pl(t,e){if(e._queryParams.loadsAllData())return Bn(t);{let i=e._queryIdentifier;return t.views.get(i)}}function ml(t,e){return pl(t,e)!=null}function Pe(t){return Bn(t)!=null}function Bn(t){for(let e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}function Ah(t){m(!xn,"__referenceConstructor has already been defined"),xn=t}function Nh(){return m(xn,"Reference.ts has not been loaded"),xn}function gl(t,e,n,i,s){return Qu(t.pendingWriteTree_,e,n,i,s),s?Gt(t,new dt(il(),e,n)):[]}function Ue(t,e,n=!1){let i=Xu(t.pendingWriteTree_,e);if(Zu(t.pendingWriteTree_,e)){let r=new X(null);return i.snap!=null?r=r.set(x(),!0):Q(i.children,o=>{r=r.set(new P(o),!0)}),Gt(t,new gs(i.path,r,n))}else return[]}function Fn(t,e,n){return Gt(t,new dt(js(),e,n))}function Ph(t,e,n){let i=X.fromObject(n);return Gt(t,new In(js(),e,i))}function Rh(t,e){return Gt(t,new kn(js(),e))}function Dh(t,e,n){let i=Qs(t,n);if(i){let s=Xs(i),r=s.path,o=s.queryId,a=q(r,e),l=new kn(Gs(o),a);return Zs(t,r,l)}else return[]}function Ss(t,e,n,i,s=!1){let r=e._path,o=t.syncPointTree_.get(r),a=[];if(o&&(e._queryIdentifier==="default"||ml(o,e))){let l=Sh(o,e,n,i);kh(o)&&(t.syncPointTree_=t.syncPointTree_.remove(r));let c=l.removed;if(a=l.events,!s){let d=c.findIndex(h=>h._queryParams.loadsAllData())!==-1,u=t.syncPointTree_.findOnPath(r,(h,f)=>Pe(f));if(d&&!u){let h=t.syncPointTree_.subtree(r);if(!h.isEmpty()){let f=Oh(h);for(let p=0;p<f.length;++p){let _=f[p],v=_.query,k=vl(t,_);t.listenProvider_.startListening(Ot(v),Rn(t,v),k.hashFn,k.onComplete)}}}!u&&c.length>0&&!i&&(d?t.listenProvider_.stopListening(Ot(e),null):c.forEach(h=>{let f=t.queryToTagMap.get($n(h));t.listenProvider_.stopListening(Ot(h),f)}))}Bh(t,c)}return a}function Lh(t,e,n,i){let s=Qs(t,i);if(s!=null){let r=Xs(s),o=r.path,a=r.queryId,l=q(o,e),c=new dt(Gs(a),l,n);return Zs(t,o,c)}else return[]}function Mh(t,e,n,i){let s=Qs(t,i);if(s){let r=Xs(s),o=r.path,a=r.queryId,l=q(o,e),c=X.fromObject(n),d=new In(Gs(a),l,c);return Zs(t,o,d)}else return[]}function Ea(t,e,n,i=!1){let s=e._path,r=null,o=!1;t.syncPointTree_.foreachOnPath(s,(h,f)=>{let p=q(h,s);r=r||rt(f,p),o=o||Pe(f)});let a=t.syncPointTree_.get(s);a?(o=o||Pe(a),r=r||rt(a,x())):(a=new Ts,t.syncPointTree_=t.syncPointTree_.set(s,a));let l;r!=null?l=!0:(l=!1,r=b.EMPTY_NODE,t.syncPointTree_.subtree(s).foreachChild((f,p)=>{let _=rt(p,x());_&&(r=r.updateImmediateChild(f,_))}));let c=ml(a,e);if(!c&&!e._queryParams.loadsAllData()){let h=$n(e);m(!t.queryToTagMap.has(h),"View does not exist, but we have a tag");let f=Fh();t.queryToTagMap.set(h,f),t.tagToQueryMap.set(f,h)}let d=Vs(t.pendingWriteTree_,s),u=Th(a,e,n,d,r,l);if(!c&&!o&&!i){let h=pl(a,e);u=u.concat($h(t,e,h))}return u}function Js(t,e,n){let s=t.pendingWriteTree_,r=t.syncPointTree_.findOnPath(e,(o,a)=>{let l=q(o,e),c=rt(a,l);if(c)return c});return al(s,e,r,n,!0)}function Gt(t,e){return _l(e,t.syncPointTree_,null,Vs(t.pendingWriteTree_,x()))}function _l(t,e,n,i){if(A(t.path))return yl(t,e,n,i);{let s=e.get(x());n==null&&s!=null&&(n=rt(s,x()));let r=[],o=T(t.path),a=t.operationForChild(o),l=e.children.get(o);if(l&&a){let c=n?n.getImmediateChild(o):null,d=ll(i,o);r=r.concat(_l(a,l,c,d))}return s&&(r=r.concat(qs(s,t,i,n))),r}}function yl(t,e,n,i){let s=e.get(x());n==null&&s!=null&&(n=rt(s,x()));let r=[];return e.children.inorderTraversal((o,a)=>{let l=n?n.getImmediateChild(o):null,c=ll(i,o),d=t.operationForChild(o);d&&(r=r.concat(yl(d,a,l,c)))}),s&&(r=r.concat(qs(s,t,i,n))),r}function vl(t,e){let n=e.query,i=Rn(t,n);return{hashFn:()=>(yh(e)||b.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return i?Dh(t,n._path,i):Rh(t,n._path);{let r=tu(s,n);return Ss(t,n,null,r)}}}}function Rn(t,e){let n=$n(e);return t.queryToTagMap.get(n)}function $n(t){return t._path.toString()+"$"+t._queryIdentifier}function Qs(t,e){return t.tagToQueryMap.get(e)}function Xs(t){let e=t.indexOf("$");return m(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new P(t.substr(0,e))}}function Zs(t,e,n){let i=t.syncPointTree_.get(e);m(i,"Missing sync point for query tag that we're tracking");let s=Vs(t.pendingWriteTree_,e);return qs(i,n,s,null)}function Oh(t){return t.fold((e,n,i)=>{if(n&&Pe(n))return[Bn(n)];{let s=[];return n&&(s=fl(n)),Q(i,(r,o)=>{s=s.concat(o)}),s}})}function Ot(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(Nh())(t._repo,t._path):t}function Bh(t,e){for(let n=0;n<e.length;++n){let i=e[n];if(!i._queryParams.loadsAllData()){let s=$n(i),r=t.queryToTagMap.get(s);t.queryToTagMap.delete(s),t.tagToQueryMap.delete(r)}}}function Fh(){return xh++}function $h(t,e,n){let i=e._path,s=Rn(t,e),r=vl(t,n),o=t.listenProvider_.startListening(Ot(e),s,r.hashFn,r.onComplete),a=t.syncPointTree_.subtree(i);if(s)m(!Pe(a.value),"If we're adding a query, it shouldn't be shadowed");else{let l=a.fold((c,d,u)=>{if(!A(c)&&d&&Pe(d))return[Bn(d).query];{let h=[];return d&&(h=h.concat(fl(d).map(f=>f.query))),Q(u,(f,p)=>{h=h.concat(p)}),h}});for(let c=0;c<l.length;++c){let d=l[c];t.listenProvider_.stopListening(Ot(d),Rn(t,d))}}return o}function er(t,e,n){let i=t.getPriority().val(),s=wa(i,e.getImmediateChild(".priority"),n),r;if(t.isLeafNode()){let o=t,a=wa(o.getValue(),e,n);return a!==o.getValue()||s!==o.getPriority().val()?new Ee(a,W(s)):t}else{let o=t;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new Ee(s))),o.forEachChild(M,(a,l)=>{let c=er(l,e.getImmediateChild(a),n);c!==l&&(r=r.updateImmediateChild(a,c))}),r}}function tr(t,e){let n=e instanceof P?e:new P(e),i=t,s=T(n);for(;s!==null;){let r=Oe(i.node.children,s)||{children:{},childCount:0};i=new Ut(s,i,r),n=L(n),s=T(n)}return i}function mt(t){return t.node.value}function wl(t,e){t.node.value=e,xs(t)}function Cl(t){return t.node.childCount>0}function jh(t){return mt(t)===void 0&&!Cl(t)}function Hn(t,e){Q(t.node.children,(n,i)=>{e(new Ut(n,t,i))})}function bl(t,e,n,i){n&&!i&&e(t),Hn(t,s=>{bl(s,e,!0,i)}),n&&i&&e(t)}function Gh(t,e,n){let i=n?t:t.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function Vt(t){return new P(t.parent===null?t.name:Vt(t.parent)+"/"+t.name)}function xs(t){t.parent!==null&&Vh(t.parent,t.name,t)}function Vh(t,e,n){let i=jh(n),s=pe(t.node.children,e);i&&s?(delete t.node.children[e],t.node.childCount--,xs(t)):!i&&!s&&(t.node.children[e]=n.node,t.node.childCount++,xs(t))}function ir(t,e){let n=null;for(let i=0;i<e.length;i++){let s=e[i],r=s.getPath();n!==null&&!Ws(r,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:r}),n.events.push(s)}n&&t.eventLists_.push(n)}function Nl(t,e,n){ir(t,n),xl(t,i=>Ws(i,e))}function Ce(t,e,n){ir(t,n),xl(t,i=>ae(i,e)||ae(e,i))}function xl(t,e){t.recursionDepth_++;let n=!0;for(let i=0;i<t.eventLists_.length;i++){let s=t.eventLists_[i];if(s){let r=s.path;e(r)?(Xh(t.eventLists_[i]),t.eventLists_[i]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function Xh(t){for(let e=0;e<t.events.length;e++){let n=t.events[e];if(n!==null){t.events[e]=null;let i=n.getEventRunner();We&&K("event: "+n.toString()),pt(i)}}}function tf(t,e,n){if(t.stats_=Us(t.repoInfo_),t.forceRestClient_||ru())t.server_=new us(t.repoInfo_,(i,s,r,o)=>{Ca(t,i,s,r,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>ba(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{$(n)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}t.persistentConnection_=new je(t.repoInfo_,e,(i,s,r,o)=>{Ca(t,i,s,r,o)},i=>{ba(t,i)},i=>{nf(t,i)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(i=>{t.server_.refreshAuthToken(i)}),t.appCheckProvider_.addTokenChangeListener(i=>{t.server_.refreshAppCheckToken(i.token)}),t.statsReporter_=au(t.repoInfo_,()=>new ms(t.stats_,t.server_)),t.infoData_=new hs,t.infoSyncTree_=new Pn({startListening:(i,s,r,o)=>{let a=[],l=t.infoData_.getNode(i._path);return l.isEmpty()||(a=Fn(t.infoSyncTree_,i._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),rr(t,"connected",!1),t.serverSyncTree_=new Pn({startListening:(i,s,r,o)=>(t.server_.listen(i,r,s,(a,l)=>{let c=o(a,l);Ce(t.eventQueue_,i._path,c)}),[]),stopListening:(i,s)=>{t.server_.unlisten(i,s)}})}function Pl(t){let n=t.infoData_.getNode(new P(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function sr(t){return Hh({timestamp:Pl(t)})}function Ca(t,e,n,i,s){t.dataUpdateCount++;let r=new P(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(s)if(i){let l=bt(n,c=>W(c));o=Mh(t.serverSyncTree_,r,l,s)}else{let l=W(n);o=Lh(t.serverSyncTree_,r,l,s)}else if(i){let l=bt(n,c=>W(c));o=Ph(t.serverSyncTree_,r,l)}else{let l=W(n);o=Fn(t.serverSyncTree_,r,l)}let a=r;o.length>0&&(a=Un(t,r)),Ce(t.eventQueue_,a,o)}function ba(t,e){rr(t,"connected",e),e===!1&&rf(t)}function nf(t,e){Q(e,(n,i)=>{rr(t,n,i)})}function rr(t,e,n){let i=new P("/.info/"+e),s=W(n);t.infoData_.updateSnapshot(i,s);let r=Fn(t.infoSyncTree_,i,s);Ce(t.eventQueue_,i,r)}function Rl(t){return t.nextWriteId_++}function sf(t,e,n,i,s){or(t,"set",{path:e.toString(),value:n,priority:i});let r=sr(t),o=W(n,i),a=Js(t.serverSyncTree_,e),l=El(o,a,r),c=Rl(t),d=gl(t.serverSyncTree_,e,l,c,!0);ir(t.eventQueue_,d),t.server_.put(e.toString(),o.val(!0),(h,f)=>{let p=h==="ok";p||J("set at "+e+" failed: "+h);let _=Ue(t.serverSyncTree_,c,!p);Ce(t.eventQueue_,e,_),lf(t,s,h,f)});let u=Bl(t,e);Un(t,u),Ce(t.eventQueue_,u,[])}function rf(t){or(t,"onDisconnectEvents");let e=sr(t),n=bn();fs(t.onDisconnect_,x(),(s,r)=>{let o=Kh(s,r,t.serverSyncTree_,e);nl(n,s,o)});let i=[];fs(n,x(),(s,r)=>{i=i.concat(Fn(t.serverSyncTree_,s,r));let o=Bl(t,s);Un(t,o)}),t.onDisconnect_=bn(),Ce(t.eventQueue_,x(),i)}function of(t,e,n){let i;T(e._path)===".info"?i=Ea(t.infoSyncTree_,e,n):i=Ea(t.serverSyncTree_,e,n),Nl(t.eventQueue_,e._path,i)}function ka(t,e,n){let i;T(e._path)===".info"?i=Ss(t.infoSyncTree_,e,n):i=Ss(t.serverSyncTree_,e,n),Nl(t.eventQueue_,e._path,i)}function af(t){t.persistentConnection_&&t.persistentConnection_.interrupt(Zh)}function or(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),K(n,...e)}function lf(t,e,n,i){e&&pt(()=>{if(n==="ok")e(null);else{let s=(n||"error").toUpperCase(),r=s;i&&(r+=": "+i);let o=new Error(r);o.code=s,e(o)}})}function Dl(t,e,n){return Js(t.serverSyncTree_,e,n)||b.EMPTY_NODE}function ar(t,e=t.transactionQueueTree_){if(e||Wn(t,e),mt(e)){let n=Ml(t,e);m(n.length>0,"Sending zero length transaction queue"),n.every(s=>s.status===0)&&cf(t,Vt(e),n)}else Cl(e)&&Hn(e,n=>{ar(t,n)})}function cf(t,e,n){let i=n.map(c=>c.currentWriteId),s=Dl(t,e,i),r=s,o=s.hash();for(let c=0;c<n.length;c++){let d=n[c];m(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;let u=q(e,d.path);r=r.updateChild(u,d.currentOutputSnapshotRaw)}let a=r.val(!0),l=e;t.server_.put(l.toString(),a,c=>{or(t,"transaction put response",{path:l.toString(),status:c});let d=[];if(c==="ok"){let u=[];for(let h=0;h<n.length;h++)n[h].status=2,d=d.concat(Ue(t.serverSyncTree_,n[h].currentWriteId)),n[h].onComplete&&u.push(()=>n[h].onComplete(null,!0,n[h].currentOutputSnapshotResolved)),n[h].unwatcher();Wn(t,tr(t.transactionQueueTree_,e)),ar(t,t.transactionQueueTree_),Ce(t.eventQueue_,e,d);for(let h=0;h<u.length;h++)pt(u[h])}else{if(c==="datastale")for(let u=0;u<n.length;u++)n[u].status===3?n[u].status=4:n[u].status=0;else{J("transaction at "+l.toString()+" failed: "+c);for(let u=0;u<n.length;u++)n[u].status=4,n[u].abortReason=c}Un(t,e)}},o)}function Un(t,e){let n=Ll(t,e),i=Vt(n),s=Ml(t,n);return df(t,s,i),i}function df(t,e,n){if(e.length===0)return;let i=[],s=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let l=e[a],c=q(n,l.path),d=!1,u;if(m(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)d=!0,u=l.abortReason,s=s.concat(Ue(t.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=ef)d=!0,u="maxretry",s=s.concat(Ue(t.serverSyncTree_,l.currentWriteId,!0));else{let h=Dl(t,l.path,o);l.currentInputSnapshot=h;let f=e[a].update(h.val());if(f!==void 0){nr("transaction failed: Data returned ",f,l.path);let p=W(f);typeof f=="object"&&f!=null&&pe(f,".priority")||(p=p.updatePriority(h.getPriority()));let v=l.currentWriteId,k=sr(t),I=El(p,h,k);l.currentOutputSnapshotRaw=p,l.currentOutputSnapshotResolved=I,l.currentWriteId=Rl(t),o.splice(o.indexOf(v),1),s=s.concat(gl(t.serverSyncTree_,l.path,I,l.currentWriteId,l.applyLocally)),s=s.concat(Ue(t.serverSyncTree_,v,!0))}else d=!0,u="nodata",s=s.concat(Ue(t.serverSyncTree_,l.currentWriteId,!0))}Ce(t.eventQueue_,n,s),s=[],d&&(e[a].status=2,(function(h){setTimeout(h,Math.floor(0))})(e[a].unwatcher),e[a].onComplete&&(u==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(u),!1,null))))}Wn(t,t.transactionQueueTree_);for(let a=0;a<i.length;a++)pt(i[a]);ar(t,t.transactionQueueTree_)}function Ll(t,e){let n,i=t.transactionQueueTree_;for(n=T(e);n!==null&&mt(i)===void 0;)i=tr(i,n),e=L(e),n=T(e);return i}function Ml(t,e){let n=[];return Ol(t,e,n),n.sort((i,s)=>i.order-s.order),n}function Ol(t,e,n){let i=mt(e);if(i)for(let s=0;s<i.length;s++)n.push(i[s]);Hn(e,s=>{Ol(t,s,n)})}function Wn(t,e){let n=mt(e);if(n){let i=0;for(let s=0;s<n.length;s++)n[s].status!==2&&(n[i]=n[s],i++);n.length=i,wl(e,n.length>0?n:void 0)}Hn(e,i=>{Wn(t,i)})}function Bl(t,e){let n=Vt(Ll(t,e)),i=tr(t.transactionQueueTree_,e);return Gh(i,s=>{Ui(t,s)}),Ui(t,i),bl(i,s=>{Ui(t,s)}),n}function Ui(t,e){let n=mt(e);if(n){let i=[],s=[],r=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(m(r===o-1,"All SENT items should be at beginning of queue."),r=o,n[o].status=3,n[o].abortReason="set"):(m(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),s=s.concat(Ue(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&i.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?wl(e,void 0):n.length=r+1,Ce(t.eventQueue_,Vt(e),s);for(let o=0;o<i.length;o++)pt(i[o])}}function uf(t){let e="",n=t.split("/");for(let i=0;i<n.length;i++)if(n[i].length>0){let s=n[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function hf(t){let e={};t.charAt(0)==="?"&&(t=t.substring(1));for(let n of t.split("&")){if(n.length===0)continue;let i=n.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):J(`Invalid query segment '${n}' in query '${t}'`)}return e}function Kn(t,e){return t=Be(t),t._checkNotDeleted("ref"),e!==void 0?ht(t._root,e):t._root}function ht(t,e){return t=Be(t),T(t._path)===null?Jh("child","path",e,!1):Sl("child","path",e,!1),new be(t._repo,H(t._path,e))}function Fl(t,e){t=Be(t),Al("push",t._path),Tl("push",e,t._path,!0);let n=Pl(t._repo),i=pf(n),s=ht(t,i),r=ht(t,i),o;return e!=null?o=lr(r,e).then(()=>r):o=Promise.resolve(r),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function lr(t,e){t=Be(t),Al("set",t._path),Tl("set",e,t._path,!1);let n=new Ie;return sf(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function mf(t,e,n,i,s){let r;if(typeof i=="object"&&(r=void 0,s=i),typeof i=="function"&&(r=i),s&&s.onlyOnce){let l=n,c=(d,u)=>{ka(t._repo,t,a),l(d,u)};c.userCallback=n.userCallback,c.context=n.context,n=c}let o=new Ds(n,r||void 0),a=e==="value"?new Ms(o):new Os(e,o);return of(t._repo,t,a),()=>ka(t._repo,t,a)}function jn(t,e,n,i){return mf(t,"value",e,n,i)}function yf(t,e,n,i){let s=e.lastIndexOf(":"),r=e.substring(0,s),o=on(r);t.repoInfo_=new pn(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),i&&(t.authTokenProvider_=i)}function vf(t,e,n,i,s){let r=i||t.options.databaseURL;r===void 0&&(t.options.projectId||ve("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),K("Using default host for project ",t.options.projectId),r=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=Ia(r,s),a=o.repoInfo,l,c;typeof process<"u"&&process.env&&(c=process.env[gf]),c?(l=!0,r=`http://${c}?ns=${a.namespace}`,o=Ia(r,s),a=o.repoInfo):l=!o.repoInfo.secure;let d=s&&l?new Ae(Ae.OWNER):new zi(t.name,t.options,e);Qh("Invalid Firebase Database URL",o),A(o.path)||ve("Database URL must point to the root of a Firebase Database (not including a child path).");let u=wf(a,t,d,new Vi(t,n));return new Fs(u,t)}function Ef(t,e){let n=Bs[e];(!n||n[t.key]!==t)&&ve(`Database ${e}(${t.repoInfo_}) has already been deleted.`),af(t),delete n[t.key]}function wf(t,e,n,i){let s=Bs[e.name];s||(s={},Bs[e.name]=s);let r=s[t.toURLString()];return r&&ve("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Rs(t,_f,n,i),s[t.toURLString()]=r,r}function $l(t=Wo(),e){let n=$o(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){let i=po("database");i&&Cf(n,...i)}return n}function Cf(t,e,n,i={}){t=Be(t),t._checkNotDeleted("useEmulator");let s=`${e}:${n}`,r=t._repoInternal;if(t._instanceStarted){if(s===t._repoInternal.repoInfo_.host&&Ze(i,r.repoInfo_.emulatorOptions))return;ve("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&ve('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Ae(Ae.OWNER);else if(i.mockUserToken){let a=typeof i.mockUserToken=="string"?i.mockUserToken:go(i.mockUserToken,t.app.options.projectId);o=new Ae(a)}on(e)&&(mo(e),_o("Database",!0)),yf(r,s,i,o)}function bf(t){zd(Uo),St(new ge("database",(e,{instanceIdentifier:n})=>{let i=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return vf(i,s,r,n)},"PUBLIC").setMultipleInstances(!0)),Se(Vo,zo,t),Se(Vo,zo,"esm2020")}var Vo,zo,$s,Wi,Ki,Sa,He,ji,it,Yd,Aa,Wt,We,Yo,qd,K,Kt,Gi,ve,J,Jd,Na,Qd,ot,Ke,ft,Xd,Nt,Hs,xa,Pa,Zd,eu,nu,iu,su,qo,pt,ru,Dt,Vi,zi,Ae,fn,Ra,Da,La,Ma,Oa,Ba,Fa,Yi,$a,Ha,pn,qi,Mi,Oi,Ji,Jo,lu,cu,du,Wa,Ka,ja,uu,hu,fu,pu,mu,Ga,Va,gu,_u,yu,Qi,Xi,vu,Eu,mn,ye,gn,wu,Cu,bu,ku,Bi,Qo,Iu,Xo,Tu,Zo,ea,ta,na,Su,Zi,_n,yn,vn,ia,sa,P,es,ts,xt,Pu,ra,Ru,Du,Lu,oa,je,S,at,hn,En,st,nt,z,ns,ee,is,Qa,Xa,aa,Ee,Za,el,ss,M,$u,rs,wn,Fi,tt,lt,Pt,b,os,jt,Hu,as,ls,Uu,$t,Cn,cs,ds,us,hs,ps,da,Gu,Vu,ms,le,gs,kn,dt,In,we,_s,$i,Ju,X,ce,ws,Cs,dl,Ht,Is,Nn,Ts,xn,xh,Pn,As,Ns,Hh,wa,Uh,Wh,Kh,El,Ut,zh,Yh,Hi,kl,Il,qh,Tl,nr,Sl,Jh,Al,Qh,Ps,Zh,ef,Rs,Ia,ff,Ta,pf,Dn,Ln,Ds,Ls,be,Mn,Ms,Os,gf,Bs,_f,Fs,Hl=Z(()=>{un();yi();It();vi();Vo="@firebase/database",zo="1.1.0";$s="";Wi=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),$(n))}get(e){let n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:Xe(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};Ki=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return pe(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};Sa=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){let e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Wi(e)}}catch{}return new Ki},He=Sa("localStorage"),ji=Sa("sessionStorage");it=new et("@firebase/database"),Yd=(function(){let t=1;return function(){return t++}})(),Aa=function(t){let e=Io(t),n=new sn;n.update(e);let i=n.digest();return rn.encodeByteArray(i)},Wt=function(...t){let e="";for(let n=0;n<t.length;n++){let i=t[n];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=Wt.apply(null,i):typeof i=="object"?e+=$(i):e+=i,e+=" "}return e},We=null,Yo=!0,qd=function(t,e){m(!e||t===!0||t===!1,"Can't turn on custom loggers persistently."),t===!0?(it.logLevel=D.VERBOSE,We=it.log.bind(it),e&&ji.set("logging_enabled",!0)):typeof t=="function"?We=t:(We=null,ji.remove("logging_enabled"))},K=function(...t){if(Yo===!0&&(Yo=!1,We===null&&ji.get("logging_enabled")===!0&&qd(!0)),We){let e=Wt.apply(null,t);We(e)}},Kt=function(t){return function(...e){K(t,...e)}},Gi=function(...t){let e="FIREBASE INTERNAL ERROR: "+Wt(...t);it.error(e)},ve=function(...t){let e=`FIREBASE FATAL ERROR: ${Wt(...t)}`;throw it.error(e),new Error(e)},J=function(...t){let e="FIREBASE WARNING: "+Wt(...t);it.warn(e)},Jd=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&J("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Na=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},Qd=function(t){if(fe()||document.readyState==="complete")t();else{let e=!1,n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},ot="[MIN_NAME]",Ke="[MAX_NAME]",ft=function(t,e){if(t===e)return 0;if(t===ot||e===Ke)return-1;if(e===ot||t===Ke)return 1;{let n=qo(t),i=qo(e);return n!==null?i!==null?n-i===0?t.length-e.length:n-i:-1:i!==null?1:t<e?-1:1}},Xd=function(t,e){return t===e?0:t<e?-1:1},Nt=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+$(e))},Hs=function(t){if(typeof t!="object"||t===null)return $(t);let e=[];for(let i in t)e.push(i);e.sort();let n="{";for(let i=0;i<e.length;i++)i!==0&&(n+=","),n+=$(e[i]),n+=":",n+=Hs(t[e[i]]);return n+="}",n},xa=function(t,e){let n=t.length;if(n<=e)return[t];let i=[];for(let s=0;s<n;s+=e)s+e>n?i.push(t.substring(s,n)):i.push(t.substring(s,s+e));return i};Pa=function(t){m(!Na(t),"Invalid JSON number");let e=11,n=52,i=(1<<e-1)-1,s,r,o,a,l;t===0?(r=0,o=0,s=1/t===-1/0?1:0):(s=t<0,t=Math.abs(t),t>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),i),r=a+i,o=Math.round(t*Math.pow(2,n-a)-Math.pow(2,n))):(r=0,o=Math.round(t/Math.pow(2,1-i-n))));let c=[];for(l=n;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(s?1:0),c.reverse();let d=c.join(""),u="";for(l=0;l<64;l+=8){let h=parseInt(d.substr(l,8),2).toString(16);h.length===1&&(h="0"+h),u=u+h}return u.toLowerCase()},Zd=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},eu=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};nu=new RegExp("^-?(0*)\\d{1,10}$"),iu=-2147483648,su=2147483647,qo=function(t){if(nu.test(t)){let e=Number(t);if(e>=iu&&e<=su)return e}return null},pt=function(t){try{t()}catch(e){setTimeout(()=>{let n=e.stack||"";throw J("Exception was thrown by user callback.",n),e},Math.floor(0))}},ru=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Dt=function(t,e){let n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};Vi=class{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,Ho(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n?.getImmediate({optional:!0}),this.appCheck||n?.get().then(i=>this.appCheck=i)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,i):n(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(n=>n.addTokenListener(e))}notifyForInvalidToken(){J(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}};zi=class{constructor(e,n,i){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(K("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,i):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',J(e)}},Ae=class{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}};Ae.OWNER="owner";fn="5",Ra="v",Da="s",La="r",Ma="f",Oa=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Ba="ls",Fa="p",Yi="ac",$a="websocket",Ha="long_polling";pn=class{constructor(e,n,i,s,r=!1,o="",a=!1,l=!1,c=null){this.secure=n,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=He.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&He.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}};qi=class{constructor(){this.counters_={}}incrementCounter(e,n=1){pe(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return uo(this.counters_)}};Mi={},Oi={};Ji=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){let i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&pt(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};Jo="start",lu="close",cu="pLPCommand",du="pRTLPCB",Wa="id",Ka="pw",ja="ser",uu="cb",hu="seg",fu="ts",pu="d",mu="dframe",Ga=1870,Va=30,gu=Ga-Va,_u=25e3,yu=3e4,Qi=class t{constructor(e,n,i,s,r,o,a){this.connId=e,this.repoInfo=n,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Kt(e),this.stats_=Us(n),this.urlFn=l=>(this.appCheckToken&&(l[Yi]=this.appCheckToken),Ua(n,Ha,l))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new Ji(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(yu)),Qd(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Xi((...r)=>{let[o,a,l,c,d]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Jo)this.id=a,this.password=l;else if(o===lu)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{let[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let i={};i[Jo]="t",i[ja]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[uu]=this.scriptTagHolder.uniqueCallbackIdentifier),i[Ra]=fn,this.transportSessionId&&(i[Da]=this.transportSessionId),this.lastSessionId&&(i[Ba]=this.lastSessionId),this.applicationId&&(i[Fa]=this.applicationId),this.appCheckToken&&(i[Yi]=this.appCheckToken),typeof location<"u"&&location.hostname&&Oa.test(location.hostname)&&(i[La]=Ma);let s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){t.forceAllow_=!0}static forceDisallow(){t.forceDisallow_=!0}static isAvailable(){return fe()?!1:t.forceAllow_?!0:!t.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Zd()&&!eu()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let n=$(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);let i=pi(n),s=xa(i,gu);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(e,n){if(fe())return;this.myDisconnFrame=document.createElement("iframe");let i={};i[mu]="t",i[Wa]=e,i[Ka]=n,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let n=$(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}},Xi=class t{constructor(e,n,i,s){if(this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,fe())this.commandCB=e,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=Yd(),window[cu+this.uniqueCallbackIdentifier]=e,window[du+this.uniqueCallbackIdentifier]=n,this.myIFrame=t.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){K("frame writing exception"),a.stack&&K(a.stack),K(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||K("No IE domain setting required")}catch{let i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[Wa]=this.myID,e[Ka]=this.myPW,e[ja]=this.currentSerial;let n=this.urlFn(e),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Va+i.length<=Ga;){let o=this.pendingSegs.shift();i=i+"&"+hu+s+"="+o.seg+"&"+fu+s+"="+o.ts+"&"+pu+s+"="+o.d,s++}return n=n+i,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,i){this.pendingSegs.push({seg:e,ts:n,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);let i=()=>{this.outstandingRequests.delete(n),this.newRequest_()},s=setTimeout(i,Math.floor(_u)),r=()=>{clearTimeout(s),i()};this.addTag(e,r)}addTag(e,n){fe()?this.doNodeLongPoll(e,n):setTimeout(()=>{try{if(!this.sendNewPolls)return;let i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){let s=i.readyState;(!s||s==="loaded"||s==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),n())},i.onerror=()=>{K("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}};vu=16384,Eu=45e3,mn=null;typeof MozWebSocket<"u"?mn=MozWebSocket:typeof WebSocket<"u"&&(mn=WebSocket);ye=class t{constructor(e,n,i,s,r,o,a){this.connId=e,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Kt(this.connId),this.stats_=Us(n),this.connURL=t.connectionURL_(n,o,a,s,i),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,i,s,r){let o={};return o[Ra]=fn,!fe()&&typeof location<"u"&&location.hostname&&Oa.test(location.hostname)&&(o[La]=Ma),n&&(o[Da]=n),i&&(o[Ba]=i),s&&(o[Yi]=s),r&&(o[Fa]=r),Ua(e,$a,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,He.set("previous_websocket_failure",!0);try{let i;if(fe()){let s=this.nodeAdmin?"AdminNode":"Node";i={headers:{"User-Agent":`Firebase/${fn}/${$s}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);let r=process.env,o=this.connURL.indexOf("wss://")===0?r.HTTPS_PROXY||r.https_proxy:r.HTTP_PROXY||r.http_proxy;o&&(i.proxy={origin:o})}this.mySock=new mn(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){t.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){let n=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(n);i&&i.length>1&&parseFloat(i[1])<4.4&&(e=!0)}return!e&&mn!==null&&!t.forceDisallow_}static previouslyFailed(){return He.isInMemoryStorage||He.get("previous_websocket_failure")===!0}markConnectionHealthy(){He.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let n=this.frames.join("");this.frames=null;let i=Xe(n);this.onMessage(i)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(m(this.frames===null,"We already have a frame buffer"),e.length<=6){let n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;let n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{let i=this.extractFrameCount_(n);i!==null&&this.appendFrame_(i)}}send(e){this.resetKeepAlive();let n=$(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);let i=xa(n,vu);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Eu))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}};ye.responsesRequiredToBeHealthy=2;ye.healthyTimeout=3e4;gn=class t{static get ALL_TRANSPORTS(){return[Qi,ye]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){let n=ye&&ye.isAvailable(),i=n&&!ye.previouslyFailed();if(e.webSocketOnly&&(n||J("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[ye];else{let s=this.transports_=[];for(let r of t.ALL_TRANSPORTS)r&&r.isAvailable()&&s.push(r);t.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}};gn.globalTransportInitialized_=!1;wu=6e4,Cu=5e3,bu=10*1024,ku=100*1024,Bi="t",Qo="d",Iu="s",Xo="r",Tu="e",Zo="o",ea="a",ta="n",na="p",Su="h",Zi=class{constructor(e,n,i,s,r,o,a,l,c,d){this.id=e,this.repoInfo_=n,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Kt("c:"+this.id+":"),this.transportManager_=new gn(n),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let n=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,i)},Math.floor(0));let s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=Dt(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>ku?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>bu?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){let n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Bi in e){let n=e[Bi];n===ea?this.upgradeIfSecondaryHealthy_():n===Xo?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===Zo&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let n=Nt("t",e),i=Nt("d",e);if(n==="c")this.onSecondaryControl_(i);else if(n==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:na,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:ea,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:ta,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let n=Nt("t",e),i=Nt("d",e);n==="c"?this.onControl_(i):n==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let n=Nt(Bi,e);if(Qo in e){let i=e[Qo];if(n===Su){let s={...i};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(n===ta){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===Iu?this.onConnectionShutdown_(i):n===Xo?this.onReset_(i):n===Tu?Gi("Server Error: "+i):n===Zo?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Gi("Unknown control packet command: "+n)}}onHandshake_(e){let n=e.ts,i=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),fn!==i&&J("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let n=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,i),Dt(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(wu))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Dt(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Cu))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:na,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(He.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};_n=class{put(e,n,i,s){}merge(e,n,i,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,i){}onDisconnectMerge(e,n,i){}onDisconnectCancel(e,n){}reportStats(e){}};yn=class{constructor(e){this.allowedEvents_=e,this.listeners_={},m(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){let i=[...this.listeners_[e]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,n)}}on(e,n,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:i});let s=this.getInitialEvent(e);s&&n.apply(i,s)}off(e,n,i){this.validateEventType_(e);let s=this.listeners_[e]||[];for(let r=0;r<s.length;r++)if(s[r].callback===n&&(!i||i===s[r].context)){s.splice(r,1);return}}validateEventType_(e){m(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}};vn=class t extends yn{static getInstance(){return new t}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!gi()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return m(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};ia=32,sa=768,P=class{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}};es=class{constructor(e,n){this.errorPrefix_=n,this.parts_=Ya(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=kt(this.parts_[i]);Ja(this)}};ts=class t extends yn{static getInstance(){return new t}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{let i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}getInitialEvent(e){return m(e==="visible","Unknown event type: "+e),[this.visible_]}};xt=1e3,Pu=300*1e3,ra=30*1e3,Ru=1.3,Du=3e4,Lu="server_kill",oa=3,je=class t extends _n{constructor(e,n,i,s,r,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=r,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=t.nextPersistentConnectionId_++,this.log_=Kt("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=xt,this.maxReconnectDelay_=Pu,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!fe())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");ts.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&vn.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,i){let s=++this.requestNumber_,r={r:s,a:e,b:n};this.log_($(r)),m(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),i&&(this.requestCBHash_[s]=i)}get(e){this.initConnection_();let n=new Ie,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{let a=o.d;o.s==="ok"?n.resolve(a):n.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),n.promise}listen(e,n,i,s){this.initConnection_();let r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),m(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),m(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");let a={onComplete:s,hashFn:n,query:e,tag:i};this.listens.get(o).set(r,a),this.connected_&&this.sendListen_(a)}sendGet_(e){let n=this.outstandingGets_[e];this.sendRequest("g",n.request,i=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(i)})}sendListen_(e){let n=e.query,i=n._path.toString(),s=n._queryIdentifier;this.log_("Listen on "+i+" for "+s);let r={p:i},o="q";e.tag&&(r.q=n._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest(o,r,a=>{let l=a.d,c=a.s;t.warnOnListenWarnings_(l,n),(this.listens.get(i)&&this.listens.get(i).get(s))===e&&(this.log_("listen response",a),c!=="ok"&&this.removeListen_(i,s),e.onComplete&&e.onComplete(c,l))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&pe(e,"w")){let i=Oe(e,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){let s='".indexOn": "'+n._queryParams.getIndex().toString()+'"',r=n._path.toString();J(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||bo(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=ra)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,n=Co(e)?"auth":"gauth",i={cred:e};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(n,i,s=>{let r=s.s,o=s.d||"error";this.authToken_===e&&(r==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let n=e.s,i=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,i)})}unlisten(e,n){let i=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),m(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,e._queryObject,n)}sendUnlisten_(e,n,i,s){this.log_("Unlisten on "+e+" for "+n);let r={p:e},o="n";s&&(r.q=i,r.t=s),this.sendRequest(o,r)}onDisconnectPut(e,n,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:i})}onDisconnectMerge(e,n,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:i})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,i,s){let r={p:n,d:i};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,n,i,s){this.putInternal("p",e,n,i,s)}merge(e,n,i,s){this.putInternal("m",e,n,i,s)}putInternal(e,n,i,s,r){this.initConnection_();let o={p:n,d:i};r!==void 0&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;let a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+n)}sendPut_(e){let n=this.outstandingPuts_[e].action,i=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,i,r=>{this.log_(n+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(r.s,r.d)})}reportStats(e){if(this.connected_){let n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,i=>{if(i.s!=="ok"){let r=i.d;this.log_("reportStats","Error sending stats: "+r)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+$(e));let n=e.r,i=this.requestCBHash_[n];i&&(delete this.requestCBHash_[n],i(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):Gi("Unrecognized action received from server: "+$(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){m(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=xt,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=xt,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Du&&(this.reconnectDelay_=xt),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Ru)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+t.nextConnectionId_++,r=this.lastSessionId,o=!1,a=null,l=function(){a?a.close():(o=!0,i())},c=function(u){m(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(u)};this.realtime_={close:l,sendRequest:c};let d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[u,h]=await Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);o?K("getToken() completed but was canceled"):(K("getToken() completed. Creating connection."),this.authToken_=u&&u.accessToken,this.appCheckToken_=h&&h.token,a=new Zi(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,i,f=>{J(f+" ("+this.repoInfo_.toString()+")"),this.interrupt(Lu)},r))}catch(u){this.log_("Failed to get token: "+u),o||(this.repoInfo_.nodeAdmin&&J(u),l())}}}interrupt(e){K("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){K("Resuming connection for reason: "+e),delete this.interruptReasons_[e],_i(this.interruptReasons_)&&(this.reconnectDelay_=xt,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let i;n?i=n.map(r=>Hs(r)).join("$"):i="default";let s=this.removeListen_(e,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,n){let i=new P(e).toString(),s;if(this.listens.has(i)){let r=this.listens.get(i);s=r.get(n),r.delete(n),r.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(e,n){K("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=oa&&(this.reconnectDelay_=ra,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){K("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=oa&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let e of this.listens.values())for(let n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},n="js";fe()&&(this.repoInfo_.nodeAdmin?n="admin_node":n="node"),e["sdk."+n+"."+$s.replace(/\./g,"-")]=1,gi()?e["framework.cordova"]=1:yo()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=vn.getInstance().currentlyOnline();return _i(this.interruptReasons_)&&e}};je.nextPersistentConnectionId_=0;je.nextConnectionId_=0;S=class t{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new t(e,n)}};at=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){let i=new S(ot,e),s=new S(ot,n);return this.compare(i,s)!==0}minPost(){return S.MIN}};En=class extends at{static get __EMPTY_NODE(){return hn}static set __EMPTY_NODE(e){hn=e}compare(e,n){return ft(e.name,n.name)}isDefinedOn(e){throw Me("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return S.MIN}maxPost(){return new S(Ke,hn)}makePost(e,n){return m(typeof e=="string","KeyIndex indexValue must always be a string."),new S(e,hn)}toString(){return".key"}},st=new En;nt=class{constructor(e,n,i,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?i(e.key,n):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},z=class t{constructor(e,n,i,s,r){this.key=e,this.value=n,this.color=i??t.RED,this.left=s??ee.EMPTY_NODE,this.right=r??ee.EMPTY_NODE}copy(e,n,i,s,r){return new t(e??this.key,n??this.value,i??this.color,s??this.left,r??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,i){let s=this,r=i(e,s.key);return r<0?s=s.copy(null,null,null,s.left.insert(e,n,i),null):r===0?s=s.copy(null,n,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,n,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return ee.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let i,s;if(i=this,n(e,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),n(e,i.key)===0){if(i.right.isEmpty())return ee.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){let e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};z.RED=!0;z.BLACK=!1;ns=class{copy(e,n,i,s,r){return this}insert(e,n,i){return new z(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},ee=class t{constructor(e,n=t.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new t(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,z.BLACK,null,null))}remove(e){return new t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,z.BLACK,null,null))}get(e){let n,i=this.root_;for(;!i.isEmpty();){if(n=this.comparator_(e,i.key),n===0)return i.value;n<0?i=i.left:n>0&&(i=i.right)}return null}getPredecessorKey(e){let n,i=this.root_,s=null;for(;!i.isEmpty();)if(n=this.comparator_(e,i.key),n===0){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else n<0?i=i.left:n>0&&(s=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new nt(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new nt(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new nt(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new nt(this.root_,null,this.comparator_,!0,e)}};ee.EMPTY_NODE=new ns;Qa=function(t){return typeof t=="number"?"number:"+Pa(t):"string:"+t},Xa=function(t){if(t.isLeafNode()){let e=t.val();m(typeof e=="string"||typeof e=="number"||typeof e=="object"&&pe(e,".sv"),"Priority must be a string or number.")}else m(t===is||t.isEmpty(),"priority of unexpected type.");m(t===is||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};Ee=class t{static set __childrenNodeConstructor(e){aa=e}static get __childrenNodeConstructor(){return aa}constructor(e,n=t.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,m(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Xa(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new t(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return A(e)?this:T(e)===".priority"?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:t.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){let i=T(e);return i===null?n:n.isEmpty()&&i!==".priority"?this:(m(i!==".priority"||xe(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,t.__childrenNodeConstructor.EMPTY_NODE.updateChild(L(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Qa(this.priorityNode_.val())+":");let n=typeof this.value_;e+=n+":",n==="number"?e+=Pa(this.value_):e+=this.value_,this.lazyHash_=Aa(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===t.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof t.__childrenNodeConstructor?-1:(m(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let n=typeof e.value_,i=typeof this.value_,s=t.VALUE_TYPE_ORDER.indexOf(n),r=t.VALUE_TYPE_ORDER.indexOf(i);return m(s>=0,"Unknown leaf type: "+n),m(r>=0,"Unknown leaf type: "+i),s===r?i==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){let n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}};Ee.VALUE_TYPE_ORDER=["object","boolean","number","string"];ss=class extends at{compare(e,n){let i=e.node.getPriority(),s=n.node.getPriority(),r=i.compareTo(s);return r===0?ft(e.name,n.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return S.MIN}maxPost(){return new S(Ke,new Ee("[PRIORITY-POST]",el))}makePost(e,n){let i=Za(e);return new S(n,new Ee("[PRIORITY-POST]",i))}toString(){return".priority"}},M=new ss;$u=Math.log(2),rs=class{constructor(e){let n=r=>parseInt(Math.log(r)/$u,10),i=r=>parseInt(Array(r+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;let s=i(this.count);this.bits_=e+1&s}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},wn=function(t,e,n,i){t.sort(e);let s=function(l,c){let d=c-l,u,h;if(d===0)return null;if(d===1)return u=t[l],h=n?n(u):u,new z(h,u.node,z.BLACK,null,null);{let f=parseInt(d/2,10)+l,p=s(l,f),_=s(f+1,c);return u=t[f],h=n?n(u):u,new z(h,u.node,z.BLACK,p,_)}},r=function(l){let c=null,d=null,u=t.length,h=function(p,_){let v=u-p,k=u;u-=p;let I=s(v+1,k),w=t[v],C=n?n(w):w;f(new z(C,w.node,_,null,I))},f=function(p){c?(c.left=p,c=p):(d=p,c=p)};for(let p=0;p<l.count;++p){let _=l.nextBitIsOne(),v=Math.pow(2,l.count-(p+1));_?h(v,z.BLACK):(h(v,z.BLACK),h(v,z.RED))}return d},o=new rs(t.length),a=r(o);return new ee(i||e,a)};tt={},lt=class t{static get Default(){return m(tt&&M,"ChildrenNode.ts has not been loaded"),Fi=Fi||new t({".priority":tt},{".priority":M}),Fi}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){let n=Oe(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof ee?n:null}hasIndex(e){return pe(this.indexSet_,e.toString())}addIndex(e,n){m(e!==st,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],s=!1,r=n.getIterator(S.Wrap),o=r.getNext();for(;o;)s=s||e.isDefinedOn(o.node),i.push(o),o=r.getNext();let a;s?a=wn(i,e.getCompare()):a=tt;let l=e.toString(),c={...this.indexSet_};c[l]=e;let d={...this.indexes_};return d[l]=a,new t(d,c)}addToIndexes(e,n){let i=bt(this.indexes_,(s,r)=>{let o=Oe(this.indexSet_,r);if(m(o,"Missing index implementation for "+r),s===tt)if(o.isDefinedOn(e.node)){let a=[],l=n.getIterator(S.Wrap),c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),wn(a,o.getCompare())}else return tt;else{let a=n.get(e.name),l=s;return a&&(l=l.remove(new S(e.name,a))),l.insert(e,e.node)}});return new t(i,this.indexSet_)}removeFromIndexes(e,n){let i=bt(this.indexes_,s=>{if(s===tt)return s;{let r=n.get(e.name);return r?s.remove(new S(e.name,r)):s}});return new t(i,this.indexSet_)}};b=class t{static get EMPTY_NODE(){return Pt||(Pt=new t(new ee(Ks),null,lt.Default))}constructor(e,n,i){this.children_=e,this.priorityNode_=n,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&Xa(this.priorityNode_),this.children_.isEmpty()&&m(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Pt}updatePriority(e){return this.children_.isEmpty()?this:new t(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{let n=this.children_.get(e);return n===null?Pt:n}}getChild(e){let n=T(e);return n===null?this:this.getImmediateChild(n).getChild(L(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(m(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{let i=new S(e,n),s,r;n.isEmpty()?(s=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(e,n),r=this.indexMap_.addToIndexes(i,this.children_));let o=s.isEmpty()?Pt:this.priorityNode_;return new t(s,o,r)}}updateChild(e,n){let i=T(e);if(i===null)return n;{m(T(e)!==".priority"||xe(e)===1,".priority must be the last token in a path");let s=this.getImmediateChild(i).updateChild(L(e),n);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let n={},i=0,s=0,r=!0;if(this.forEachChild(M,(o,a)=>{n[o]=a.val(e),i++,r&&t.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):r=!1}),!e&&r&&s<2*i){let o=[];for(let a in n)o[a]=n[a];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+Qa(this.getPriority().val())+":"),this.forEachChild(M,(n,i)=>{let s=i.hash();s!==""&&(e+=":"+n+":"+s)}),this.lazyHash_=e===""?"":Aa(e)}return this.lazyHash_}getPredecessorChildName(e,n,i){let s=this.resolveIndex_(i);if(s){let r=s.getPredecessorKey(new S(e,n));return r?r.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){let n=this.resolveIndex_(e);if(n){let i=n.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(e){let n=this.getFirstChildName(e);return n?new S(n,this.children_.get(n)):null}getLastChildName(e){let n=this.resolveIndex_(e);if(n){let i=n.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(e){let n=this.getLastChildName(e);return n?new S(n,this.children_.get(n)):null}forEachChild(e,n){let i=this.resolveIndex_(e);return i?i.inorderTraversal(s=>n(s.name,s.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){let i=this.resolveIndex_(n);if(i)return i.getIteratorFrom(e,s=>s);{let s=this.children_.getIteratorFrom(e.name,S.Wrap),r=s.peek();for(;r!=null&&n.compare(r,e)<0;)s.getNext(),r=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){let i=this.resolveIndex_(n);if(i)return i.getReverseIteratorFrom(e,s=>s);{let s=this.children_.getReverseIteratorFrom(e.name,S.Wrap),r=s.peek();for(;r!=null&&n.compare(r,e)>0;)s.getNext(),r=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===jt?-1:0}withIndex(e){if(e===st||this.indexMap_.hasIndex(e))return this;{let n=this.indexMap_.addIndex(e,this.children_);return new t(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===st||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{let n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){let i=this.getIterator(M),s=n.getIterator(M),r=i.getNext(),o=s.getNext();for(;r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=i.getNext(),o=s.getNext()}return r===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===st?null:this.indexMap_.get(e.toString())}};b.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;os=class extends b{constructor(){super(new ee(Ks),b.EMPTY_NODE,lt.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return b.EMPTY_NODE}isEmpty(){return!1}},jt=new os;Object.defineProperties(S,{MIN:{value:new S(ot,b.EMPTY_NODE)},MAX:{value:new S(Ke,jt)}});En.__EMPTY_NODE=b.EMPTY_NODE;Ee.__childrenNodeConstructor=b;Ou(jt);Fu(jt);Hu=!0;Bu(W);as=class extends at{constructor(e){super(),this.indexPath_=e,m(!A(e)&&T(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){let i=this.extractChild(e.node),s=this.extractChild(n.node),r=i.compareTo(s);return r===0?ft(e.name,n.name):r}makePost(e,n){let i=W(e),s=b.EMPTY_NODE.updateChild(this.indexPath_,i);return new S(n,s)}maxPost(){let e=b.EMPTY_NODE.updateChild(this.indexPath_,jt);return new S(Ke,e)}toString(){return Ya(this.indexPath_,0).join("/")}};ls=class extends at{compare(e,n){let i=e.node.compareTo(n.node);return i===0?ft(e.name,n.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return S.MIN}maxPost(){return S.MAX}makePost(e,n){let i=W(e);return new S(n,i)}toString(){return".value"}},Uu=new ls;$t=class{constructor(e){this.index_=e}updateChild(e,n,i,s,r,o){m(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(n);return a.getChild(s).equals(i.getChild(s))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(n)?o.trackChildChange(Bt(n,a)):m(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(ct(n,i)):o.trackChildChange(Ft(n,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(n,i).withIndex(this.index_)}updateFullNode(e,n,i){return i!=null&&(e.isLeafNode()||e.forEachChild(M,(s,r)=>{n.hasChild(s)||i.trackChildChange(Bt(s,r))}),n.isLeafNode()||n.forEachChild(M,(s,r)=>{if(e.hasChild(s)){let o=e.getImmediateChild(s);o.equals(r)||i.trackChildChange(Ft(s,r,o))}else i.trackChildChange(ct(s,r))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?b.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};Cn=class t{constructor(e){this.indexedFilter_=new $t(e.getIndex()),this.index_=e.getIndex(),this.startPost_=t.getStartPost_(e),this.endPost_=t.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&i}updateChild(e,n,i,s,r,o){return this.matches(new S(n,i))||(i=b.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,i,s,r,o)}updateFullNode(e,n,i){n.isLeafNode()&&(n=b.EMPTY_NODE);let s=n.withIndex(this.index_);s=s.updatePriority(b.EMPTY_NODE);let r=this;return n.forEachChild(M,(o,a)=>{r.matches(new S(o,a))||(s=s.updateImmediateChild(o,b.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,i)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}};cs=class{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{let i=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=n=>{let i=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new Cn(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,i,s,r,o){return this.rangedFilter_.matches(new S(n,i))||(i=b.EMPTY_NODE),e.getImmediateChild(n).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,i,s,r,o):this.fullLimitUpdateChild_(e,n,i,r,o)}updateFullNode(e,n,i){let s;if(n.isLeafNode()||n.isEmpty())s=b.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){s=b.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){let a=r.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=n.withIndex(this.index_),s=s.updatePriority(b.EMPTY_NODE);let r;this.reverse_?r=s.getReverseIterator(this.index_):r=s.getIterator(this.index_);let o=0;for(;r.hasNext();){let a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,b.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,i)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,i,s,r){let o;if(this.reverse_){let u=this.index_.getCompare();o=(h,f)=>u(f,h)}else o=this.index_.getCompare();let a=e;m(a.numChildren()===this.limit_,"");let l=new S(n,i),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(l);if(a.hasChild(n)){let u=a.getImmediateChild(n),h=s.getChildAfterChild(this.index_,c,this.reverse_);for(;h!=null&&(h.name===n||a.hasChild(h.name));)h=s.getChildAfterChild(this.index_,h,this.reverse_);let f=h==null?1:o(h,l);if(d&&!i.isEmpty()&&f>=0)return r?.trackChildChange(Ft(n,i,u)),a.updateImmediateChild(n,i);{r?.trackChildChange(Bt(n,u));let _=a.updateImmediateChild(n,b.EMPTY_NODE);return h!=null&&this.rangedFilter_.matches(h)?(r?.trackChildChange(ct(h.name,h.node)),_.updateImmediateChild(h.name,h.node)):_}}else return i.isEmpty()?e:d&&o(c,l)>=0?(r!=null&&(r.trackChildChange(Bt(c.name,c.node)),r.trackChildChange(ct(n,i))),a.updateImmediateChild(n,i).updateImmediateChild(c.name,b.EMPTY_NODE)):e}};ds=class t{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=M}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return m(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return m(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:ot}hasEnd(){return this.endSet_}getIndexEndValue(){return m(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return m(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ke}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return m(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===M}copy(){let e=new t;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};us=class t extends _n{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(m(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,i,s){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=Kt("p:rest:"),this.listens_={}}listen(e,n,i,s){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let o=t.getListenId_(e,i),a={};this.listens_[o]=a;let l=la(e._queryParams);this.restRequest_(r+".json",l,(c,d)=>{let u=d;if(c===404&&(u=null,c=null),c===null&&this.onDataUpdate_(r,u,!1,i),Oe(this.listens_,o)===a){let h;c?c===401?h="permission_denied":h="rest_error:"+c:h="ok",s(h,null)}})}unlisten(e,n){let i=t.getListenId_(e,n);delete this.listens_[i]}get(e){let n=la(e._queryParams),i=e._path.toString(),s=new Ie;return this.restRequest_(i+".json",n,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(i,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,n={},i){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(n.auth=s.accessToken),r&&r.token&&(n.ac=r.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+ko(n);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Xe(a.responseText)}catch{J("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,l)}else a.status!==401&&a.status!==404&&J("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}};hs=class{constructor(){this.rootNode_=b.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}};ps=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),n={...e};return this.last_&&Q(this.last_,(i,s)=>{n[i]=n[i]-s}),this.last_=e,n}};da=10*1e3,Gu=30*1e3,Vu=300*1e3,ms=class{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new ps(e);let i=da+(Gu-da)*Math.random();Dt(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){let e=this.statsListener_.get(),n={},i=!1;Q(e,(s,r)=>{r>0&&pe(this.statsToReport_,s)&&(n[s]=r,i=!0)}),i&&this.server_.reportStats(n),Dt(this.reportStats_.bind(this),Math.floor(Math.random()*2*Vu))}};(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(le||(le={}));gs=class t{constructor(e,n,i){this.path=e,this.affectedTree=n,this.revert=i,this.type=le.ACK_USER_WRITE,this.source=il()}operationForChild(e){if(A(this.path)){if(this.affectedTree.value!=null)return m(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let n=this.affectedTree.subtree(new P(e));return new t(x(),n,this.revert)}}else return m(T(this.path)===e,"operationForChild called for unrelated child."),new t(L(this.path),this.affectedTree,this.revert)}};kn=class t{constructor(e,n){this.source=e,this.path=n,this.type=le.LISTEN_COMPLETE}operationForChild(e){return A(this.path)?new t(this.source,x()):new t(this.source,L(this.path))}};dt=class t{constructor(e,n,i){this.source=e,this.path=n,this.snap=i,this.type=le.OVERWRITE}operationForChild(e){return A(this.path)?new t(this.source,x(),this.snap.getImmediateChild(e)):new t(this.source,L(this.path),this.snap)}};In=class t{constructor(e,n,i){this.source=e,this.path=n,this.children=i,this.type=le.MERGE}operationForChild(e){if(A(this.path)){let n=this.children.subtree(new P(e));return n.isEmpty()?null:n.value?new dt(this.source,x(),n.value):new t(this.source,x(),n)}else return m(T(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new t(this.source,L(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};we=class{constructor(e,n,i){this.node_=e,this.fullyInitialized_=n,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(A(e))return this.isFullyInitialized()&&!this.filtered_;let n=T(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};_s=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};Ju=()=>($i||($i=new ee(Xd)),$i),X=class t{static fromObject(e){let n=new t(null);return Q(e,(i,s)=>{n=n.set(new P(i),s)}),n}constructor(e,n=Ju()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:x(),value:this.value};if(A(e))return null;{let i=T(e),s=this.children.get(i);if(s!==null){let r=s.findRootMostMatchingPathAndValue(L(e),n);return r!=null?{path:H(new P(i),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(A(e))return this;{let n=T(e),i=this.children.get(n);return i!==null?i.subtree(L(e)):new t(null)}}set(e,n){if(A(e))return new t(n,this.children);{let i=T(e),r=(this.children.get(i)||new t(null)).set(L(e),n),o=this.children.insert(i,r);return new t(this.value,o)}}remove(e){if(A(e))return this.children.isEmpty()?new t(null):new t(null,this.children);{let n=T(e),i=this.children.get(n);if(i){let s=i.remove(L(e)),r;return s.isEmpty()?r=this.children.remove(n):r=this.children.insert(n,s),this.value===null&&r.isEmpty()?new t(null):new t(this.value,r)}else return this}}get(e){if(A(e))return this.value;{let n=T(e),i=this.children.get(n);return i?i.get(L(e)):null}}setTree(e,n){if(A(e))return n;{let i=T(e),r=(this.children.get(i)||new t(null)).setTree(L(e),n),o;return r.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,r),new t(this.value,o)}}fold(e){return this.fold_(x(),e)}fold_(e,n){let i={};return this.children.inorderTraversal((s,r)=>{i[s]=r.fold_(H(e,s),n)}),n(e,this.value,i)}findOnPath(e,n){return this.findOnPath_(e,x(),n)}findOnPath_(e,n,i){let s=this.value?i(n,this.value):!1;if(s)return s;if(A(e))return null;{let r=T(e),o=this.children.get(r);return o?o.findOnPath_(L(e),H(n,r),i):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,x(),n)}foreachOnPath_(e,n,i){if(A(e))return this;{this.value&&i(n,this.value);let s=T(e),r=this.children.get(s);return r?r.foreachOnPath_(L(e),H(n,s),i):new t(null)}}foreach(e){this.foreach_(x(),e)}foreach_(e,n){this.children.inorderTraversal((i,s)=>{s.foreach_(H(e,i),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,i)=>{i.value&&e(n,i.value)})}};ce=class t{constructor(e){this.writeTree_=e}static empty(){return new t(new X(null))}};ws=class{constructor(){this.changeMap=new Map}trackChildChange(e){let n=e.type,i=e.childName;m(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),m(i!==".priority","Only non-priority child changes can be tracked.");let s=this.changeMap.get(i);if(s){let r=s.type;if(n==="child_added"&&r==="child_removed")this.changeMap.set(i,Ft(i,e.snapshotNode,s.snapshotNode));else if(n==="child_removed"&&r==="child_added")this.changeMap.delete(i);else if(n==="child_removed"&&r==="child_changed")this.changeMap.set(i,Bt(i,s.oldSnap));else if(n==="child_changed"&&r==="child_added")this.changeMap.set(i,ct(i,e.snapshotNode));else if(n==="child_changed"&&r==="child_changed")this.changeMap.set(i,Ft(i,e.snapshotNode,s.oldSnap));else throw Me("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}};Cs=class{getCompleteChild(e){return null}getChildAfterChild(e,n,i){return null}},dl=new Cs,Ht=class{constructor(e,n,i=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=i}getCompleteChild(e){let n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{let i=this.optCompleteServerCache_!=null?new we(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Ys(this.writes_,e,i)}}getChildAfterChild(e,n,i){let s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Ge(this.viewCache_),r=ch(this.writes_,s,n,1,i,e);return r.length===0?null:r[0]}};Is=class{constructor(e,n){this.query_=e,this.eventRegistrations_=[];let i=this.query_._queryParams,s=new $t(i.getIndex()),r=Ku(i);this.processor_=dh(r);let o=n.serverCache,a=n.eventCache,l=s.updateFullNode(b.EMPTY_NODE,o.getNode(),null),c=r.updateFullNode(b.EMPTY_NODE,a.getNode(),null),d=new we(l,o.isFullyInitialized(),s.filtersNodes()),u=new we(c,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=On(u,d),this.eventGenerator_=new _s(this.query_)}get query(){return this.query_}};Ts=class{constructor(){this.views=new Map}};xh=1,Pn=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new X(null),this.pendingWriteTree_=lh(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};As=class t{constructor(e){this.node_=e}getImmediateChild(e){let n=this.node_.getImmediateChild(e);return new t(n)}node(){return this.node_}},Ns=class t{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){let n=H(this.path_,e);return new t(this.syncTree_,n)}node(){return Js(this.syncTree_,this.path_)}},Hh=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},wa=function(t,e,n){if(!t||typeof t!="object")return t;if(m(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return Uh(t[".sv"],e,n);if(typeof t[".sv"]=="object")return Wh(t[".sv"],e);m(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},Uh=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:m(!1,"Unexpected server value: "+t)}},Wh=function(t,e,n){t.hasOwnProperty("increment")||m(!1,"Unexpected server value: "+JSON.stringify(t,null,2));let i=t.increment;typeof i!="number"&&m(!1,"Unexpected increment value: "+i);let s=e.node();if(m(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;let o=s.getValue();return typeof o!="number"?i:o+i},Kh=function(t,e,n,i){return er(e,new Ns(n,t),i)},El=function(t,e,n){return er(t,new As(e),n)};Ut=class{constructor(e="",n=null,i={children:{},childCount:0}){this.name=e,this.parent=n,this.node=i}};zh=/[\[\].#$\/\u0000-\u001F\u007F]/,Yh=/[\[\].#$\u0000-\u001F\u007F]/,Hi=10*1024*1024,kl=function(t){return typeof t=="string"&&t.length!==0&&!zh.test(t)},Il=function(t){return typeof t=="string"&&t.length!==0&&!Yh.test(t)},qh=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Il(t)},Tl=function(t,e,n,i){i&&e===void 0||nr(an(t,"value"),e,n)},nr=function(t,e,n){let i=n instanceof P?new es(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+$e(i));if(typeof e=="function")throw new Error(t+"contains a function "+$e(i)+" with contents = "+e.toString());if(Na(e))throw new Error(t+"contains "+e.toString()+" "+$e(i));if(typeof e=="string"&&e.length>Hi/3&&kt(e)>Hi)throw new Error(t+"contains a string greater than "+Hi+" utf8 bytes "+$e(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,r=!1;if(Q(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!kl(o)))throw new Error(t+" contains an invalid key ("+o+") "+$e(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Nu(i,o),nr(t,a,i),xu(i)}),s&&r)throw new Error(t+' contains ".value" child '+$e(i)+" in addition to actual children.")}},Sl=function(t,e,n,i){if(!(i&&n===void 0)&&!Il(n))throw new Error(an(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Jh=function(t,e,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Sl(t,e,n,i)},Al=function(t,e){if(T(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},Qh=function(t,e){let n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!kl(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!qh(n))throw new Error(an(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};Ps=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};Zh="repo_interrupt",ef=25,Rs=class{constructor(e,n,i,s){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Ps,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=bn(),this.transactionQueueTree_=new Ut,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};Ia=function(t,e){let n=ff(t),i=n.namespace;n.domain==="firebase.com"&&ve(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&n.domain!=="localhost"&&ve("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||Jd();let s=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new pn(n.host,n.secure,i,s,e,"",i!==n.subdomain),path:new P(n.pathString)}},ff=function(t){let e="",n="",i="",s="",r="",o=!0,a="https",l=443;if(typeof t=="string"){let c=t.indexOf("//");c>=0&&(a=t.substring(0,c-1),t=t.substring(c+2));let d=t.indexOf("/");d===-1&&(d=t.length);let u=t.indexOf("?");u===-1&&(u=t.length),e=t.substring(0,Math.min(d,u)),d<u&&(s=uf(t.substring(d,u)));let h=hf(t.substring(Math.min(t.length,u)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;let f=e.slice(0,c);if(f.toLowerCase()==="localhost")n="localhost";else if(f.split(".").length<=2)n=f;else{let p=e.indexOf(".");i=e.substring(0,p).toLowerCase(),n=e.substring(p+1),r=i}"ns"in h&&(r=h.ns)}return{host:e,port:l,domain:n,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}};Ta="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",pf=(function(){let t=0,e=[];return function(n){let i=n===t;t=n;let s,r=new Array(8);for(s=7;s>=0;s--)r[s]=Ta.charAt(n%64),n=Math.floor(n/64);m(n===0,"Cannot push at time == 0");let o=r.join("");if(i){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=Ta.charAt(e[s]);return m(o.length===20,"nextPushId: Length should be 20."),o}})();Dn=class{constructor(e,n,i,s){this.eventType=e,this.eventRegistration=n,this.snapshot=i,this.prevName=s}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+$(this.snapshot.exportVal())}},Ln=class{constructor(e,n,i){this.eventRegistration=e,this.error=n,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};Ds=class{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return m(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};Ls=class t{constructor(e,n,i,s){this._repo=e,this._path=n,this._queryParams=i,this._orderByCalled=s}get key(){return A(this._path)?null:za(this._path)}get ref(){return new be(this._repo,this._path)}get _queryIdentifier(){let e=ca(this._queryParams),n=Hs(e);return n==="{}"?"default":n}get _queryObject(){return ca(this._queryParams)}isEqual(e){if(e=Be(e),!(e instanceof t))return!1;let n=this._repo===e._repo,i=Ws(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return n&&i&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+Au(this._path)}},be=class t extends Ls{constructor(e,n){super(e,n,new ds,!1)}get parent(){let e=qa(this._path);return e===null?null:new t(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},Mn=class t{constructor(e,n,i){this._node=e,this.ref=n,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let n=new P(e),i=ht(this.ref,e);return new t(this._node.getChild(n),i,M)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,s)=>e(new t(s,ht(this.ref,i),M)))}hasChild(e){let n=new P(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};Ms=class t{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){let i=n._queryParams.getIndex();return new Dn("value",this,new Mn(e.snapshotNode,new be(n._repo,n._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new Ln(this,e,n):null}matches(e){return e instanceof t?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},Os=class t{constructor(e,n){this.eventType=e,this.callbackContext=n}respondsTo(e){let n=e==="children_added"?"child_added":e;return n=n==="children_removed"?"child_removed":n,this.eventType===n}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new Ln(this,e,n):null}createEvent(e,n){m(e.childName!=null,"Child events should have a childName.");let i=ht(new be(n._repo,n._path),e.childName),s=n._queryParams.getIndex();return new Dn(e.type,this,new Mn(e.snapshotNode,i,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof t?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};Ch(be);Ah(be);gf="FIREBASE_DATABASE_EMULATOR_HOST",Bs={},_f=!1;Fs=class{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(tf(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new be(this._repo,x())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Ef(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&ve("Cannot call "+e+" on a deleted database.")}};je.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};je.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};bf()});var Ul=Z(()=>{Hl()});var dr={};Ar(dr,{db:()=>cr,onValue:()=>jn,push:()=>Fl,ref:()=>Kn,set:()=>lr});var kf,If,cr,Gn=Z(()=>{Go();Ul();kf={apiKey:"AIzaSyD6HY-9A-vtf_fv11SK3WxKElHKGQvU4Sg",authDomain:"istanapayment-aedab.firebaseapp.com",projectId:"istanapayment-aedab",storageBucket:"istanapayment-aedab.firebasestorage.app",messagingSenderId:"930279412253",appId:"1:930279412253:web:e607079fef82854a6becf4",measurementId:"G-7W562SKYFV"},If=Li(kf),cr=$l(If)});R();function Pr(){let t=document.querySelectorAll(".toggleThemeBtn"),e=document.documentElement,n=document.getElementById("theme-color"),i={light:"#ffffff",dark:"#121212"},s=localStorage.getItem("theme");s?e.setAttribute("data-theme",s):(s=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",e.setAttribute("data-theme",s),localStorage.setItem("theme",s));function r(){let o=e.getAttribute("data-theme"),a=i[o]||"#ffffff";t.forEach(l=>{let c=l.querySelector(".akun-icon")||l;c.textContent=o==="dark"?"\u2600\uFE0F":"\u{1F319}"}),n.setAttribute("content",a)}t.forEach(o=>{o.addEventListener("click",()=>{let l=e.getAttribute("data-theme")==="dark"?"light":"dark";e.setAttribute("data-theme",l),localStorage.setItem("theme",l),r()})}),r()}R();function Rr(t){let e=t.getElementsByTagName("body");if(e.length>0){let n=e[0].textContent;if(console.log("[DEBUG] body:",n),!n.includes("Yth."))return!0;let i=n.match(/Yth\.\s+([^-]+)-\s*([A-Z0-9]+)/),s=i?i[1].trim():"tidak diketahui",r=i?i[2].trim():"tidak diketahui";localStorage.setItem("nama_agen",s),localStorage.setItem("kode_agen",r);let o=n.match(/Saldo\s(-?[\d.]+)/),a=n.match(/Proses\s([\d.]+)/),l=n.match(/Trx\s([\d.]+)/i),c=n.match(/Bonus\s([\d.]+)/),d=n.match(/Poin\s([\d.]+)/i),u=n.match(/Pemakaian\s([\d.]+)/i),h=o?o[1]:"-",f=a?a[1]:"-",p=l?l[1]:"-",_=c?c[1]:"-",v=d?d[1]:"-",k=u?u[1]:"-",I=n.match(/Grup\s+([A-Z0-9]+)/i);if(I){let w=I[1].toUpperCase();localStorage.setItem("tipe_akun",w),console.log("[DEBUG] tipe_akun tersimpan:",w)}document.getElementById("saldoDisplay").innerHTML=`
            <header style="
                margin-bottom:0.5rem;
                display:grid; 
                grid-template-columns: 1fr 1fr; 
                text-align:center;
                gap:0.5rem;
            ">
                <div>\u{1F464} <strong>${s}</strong></div>
                <div>\u{1F194} <strong>${r}</strong></div>
            </header>
            <div style="
                display:grid; 
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
                gap:0.5rem;
            ">
                <div>\u{1F4B0} <strong>Saldo:</strong> ${h}</div>
                <div>\u2699\uFE0F <strong>Proses:</strong> ${f}</div>
                <div>\u{1F4CA} <strong>Jml TRX:</strong> ${p}</div>
                <div>\u{1F381} <strong>Bonus:</strong> ${_}</div>
                <div>\u2B50 <strong>Poin:</strong> ${v}</div>
                <div>\u{1F4C5} <strong>Terpakai:</strong> ${k}</div>
            </div>
        `}return!0}function Y({title:t="",message:e="",buttons:n=[],source:i=""}){let s=document.getElementById("modalOverlay"),r=document.getElementById("modalHeader"),o=document.getElementById("modalMessage"),a=document.getElementById("modalButtons"),l=document.getElementById("modalCloseBtn");r.innerHTML=t,o.innerHTML=e,s.style.display="flex",t==="Koneksi Terputus"?s.style.zIndex="99999":s.style.zIndex="3000",window.modalTerbuka=!0,window.modalSumber=i,history.pushState({modal:!0},null,location.href),a.innerHTML="",t==="Koneksi Terputus"||t==="Transaksi Sedang Diproses"||t==="Info Tagihan BPJS Kesehatan"||t==="Pembayaran Berhasil"||t==="Info Tagihan PLN"?l.style.display="none":l.style.display="block",n.forEach(c=>{let d=document.createElement("button");d.textContent=c.text,d.className=c.className||"modal-ok",c.disabled?(d.disabled=!0,d.style.opacity="0.6",d.style.cursor="not-allowed"):d.onclick=()=>{s.style.display="none",window.modalTerbuka=!1,window.modalSumber=null,c.onClick&&c.onClick()},a.appendChild(d)}),l.onclick=()=>{s.style.display="none",window.modalTerbuka=!1,window.modalSumber==="showHargaItem"&&Promise.resolve().then(()=>(R(),xr)).then(({showToast:c})=>{c("Transaksi dibatalkan","error")}),window.modalSumber=null}}function Xt(t,e,n,i,s=""){Y({title:t,message:e,source:s,buttons:[{text:"OK",className:"modal-ok",onClick:()=>{window.modalTerbuka=!1,window.modalSumber=null,n&&n()}},{text:"Cancel",className:"modal-cancel",onClick:()=>{window.modalTerbuka=!1,window.modalSumber=null,i&&i()}}]})}var gc="dXNlcjFAcHVsc2EuZHBkbnMub3Jn",Zt=null,_c="cHVsc2EuZHBkbnMub3Jn",_t=atob(_c);function yc(){return atob(gc)}function g(t,e=yc()){if(!F)return;let n=$msg({to:e,type:"chat"}).c("body").t(t);F.send(n),console.log(`Pesan terkirim ke ${e}: ${t}`)}function yt(t){return function(e){let n=e.getElementsByTagName("body")[0];if(n){let i=Strophe.getText(n).trim();t&&typeof t=="function"&&t(i,e)}return!0}}function si(){Zt&&clearTimeout(Zt);let t=!1,e=yt(n=>{n.startsWith("Yth")&&(t=!0,clearTimeout(Zt))});F&&F.addHandler(e,null,"message","chat"),Zt=setTimeout(()=>{t||Y({title:"Koneksi Terputus",message:'<div style="text-align:center;">Server tidak merespon. Silakan tekan Refresh untuk mencoba kembali.</div>',buttons:[{text:"Refresh",className:"modal-info",onClick:()=>window.location.reload()}]})},2e3)}R();var oe=document.getElementById("inputTujuan"),G=document.getElementById("operatorDisplay"),V=document.getElementById("extraButtons"),Dr=document.getElementById("clearInput"),vc={Tsel:["0811","0812","0813","0851","0852","0853","0821","0822","0823","0824"],Isat:["0814","0815","0816","0855","0856","0857","0858"],Axis:["083"],"By.U":["085155","085156","085157","085158","085154","085159","08512"],"Token Listrik":["01","04","05","06","07","09","1","2","3","4","5","6","7","8","9","001","020","03"],Smar:["088"],Tri:["089"],XL:["0817","0818","0819","0859","0878","0877"]};function Ec(t){return t.startsWith("628")?"0"+t.slice(2):t}function wc(t){let e="",n=Ec(t),i=Object.entries(vc).sort((s,r)=>{let o=Math.max(...s[1].map(l=>l.length));return Math.max(...r[1].map(l=>l.length))-o});for(let[s,r]of i)for(let o of r)if(n.startsWith(o))return s;return e}function Lr(){let t=Ye(oe.value.trim());if(!t){G.textContent="",oe.classList.remove("with-operator"),V.innerHTML="";return}let e=wc(t);e&&e!=="Token Listrik"?(G.textContent=e,oe.classList.add("with-operator")):(G.textContent="",oe.classList.remove("with-operator")),V.innerHTML=""}oe.addEventListener("input",()=>{Lr(),ri()});function ri(){Dr.style.display=oe.value?"block":"none"}Dr.addEventListener("click",()=>{oe.value="",Lr(),ri(),oe.focus()});ri();R();var oi=!1,ai="";function li(t){oi=t}function Mr(t){ai=t}var vt=document.getElementById("extraButtons"),Cc=document.getElementById("inputTujuan");function Or(t){oi||(vt.innerHTML=""),vt.style.display="block",vt.className="harga-list";let e=t.split(`
`).map(i=>i.trim()).filter(i=>i),n=!1;e.forEach(i=>{let s=i.split("=");if(s.length>=3){let r=s[0].trim(),o=s[1].trim(),a=s[2].replace(";","").trim();if(/\[K\]|\[G\]/.test(a)||!/^\d+([.,]\d+)?$/.test(a))return;if(!n){let c=document.createElement("div");c.className="menu-item harga-item header-item",c.style.display="flex",c.style.justifyContent="space-between",c.style.alignItems="center",c.style.padding="0.5rem 1rem",c.style.borderBottom="1px solid #ccc",c.innerHTML=`
                <span style="font-weight:bold; color:var(--pico-primary); min-width:50px;">Kode</span>
                <span style="flex:1; margin-left:1rem; margin-right:1rem; font-weight:bold;">Deskripsi</span>
                <span style="font-weight:bold; color:var(--pico-success); min-width:60px; text-align:right;">Harga</span>
            `,vt.appendChild(c),n=!0}let l=document.createElement("div");l.className="menu-item harga-item",l.style.display="flex",l.style.justifyContent="space-between",l.style.alignItems="center",l.style.padding="0.5rem 1rem",l.innerHTML=`
            <span style="font-weight:bold; color:var(--pico-primary); min-width:50px;">${r}</span>
            <span style="flex:1; margin-left:1rem; margin-right:1rem;">${o}</span>
            <span style="font-weight:bold; color:var(--pico-success); min-width:60px; text-align:right;">Rp${a}</span>
        `,l.addEventListener("click",()=>{let c=Cc.value.trim(),d=c;["Pulsa","Paket Data","Paket Nelpon & SMS","Nominal Bebas"].includes(ai)&&c.startsWith("628")&&(d="0"+c.substring(2));let u=`
                <table class="detail-table-laporan-modal">
                    <tr><td>Kode Produk</td><td>${r}</td></tr>
                    <tr><td>Deskripsi Produk</td><td>${o}</td></tr>
                    <tr><td>Harga Modal</td><td>Rp${a}</td></tr>
                    <tr><td>Nomor Tujuan</td><td>${d}</td></tr>
                </table>
                <div style="font-weight:bold; color:red; text-align:center;">
                    Pastikan Saldo Anda Mencukupi!
                </div>`;Xt("KONFIRMASI TRANSAKSI",u,()=>{g(`${r}.${d}`),g("S")},()=>{E("Transaksi dibatalkan","error")},"showHargaItem")}),vt.appendChild(l)}})}R();R();function Br(t,e,n){if(!n||n==="Unknown"){E("Nomor Tujuan Tidak Dikenali untuk Pulsa");return}let i=localStorage.getItem("tipe_akun");t.style.display="block",e.textContent=n,n==="Tsel"?(t.appendChild(y("Pulsa Reguler",()=>g(j("t")))),t.appendChild(y("Tambah Masa Aktif",()=>g(j("tmat"))))):n==="Isat"?(t.appendChild(y("Pulsa Reguler",()=>g(j("i")))),t.appendChild(y("Tambah Masa Aktif",()=>g(j("tmai"))))):n==="XL"?(t.appendChild(y("Pulsa Reguler",()=>g(j("x")))),t.appendChild(y("Tambah Masa Aktif",()=>g(j("tmax"))))):n==="Axis"?(t.appendChild(y("Pulsa Reguler",()=>g(j("a")))),t.appendChild(y("Tambah Masa Aktif",()=>g(j("tmaa"))))):n==="Tri"?(t.appendChild(y("Pulsa Reguler",()=>g(j("tr")))),t.appendChild(y("Tambah Masa Aktif",()=>g(j("tmatri"))))):n==="Smar"&&t.appendChild(y("Pulsa Reguler",()=>g(j("s"))))}R();function Fr(t,e,n){if(!n||n==="Unknown"){E("Nomor Tujuan Tidak Dikenali untuk Paket Data");return}t.style.display="block",e.textContent=n,n==="Tsel"?(t.appendChild(y("1 Bulan",()=>g("harga.td"))),t.appendChild(y("Jawa Timur",()=>g("harga.jtm"))),t.appendChild(y("Jawa Tengah",()=>g("harga.jtg"))),t.appendChild(y("Jawa Barat",()=>g("harga.jbr")))):n==="Isat"?(t.appendChild(y("Freedom Internet",()=>g("harga.if"))),t.appendChild(y("Freedom Unlimited",()=>g("harga.iu"))),t.appendChild(y("Freedom Mini",()=>g("harga.im")))):n==="XL"?(t.appendChild(y("Xtra Combo Flex",()=>g("harga.xcf"))),t.appendChild(y("XL Mini",()=>g("harga.xm")))):n==="Axis"?(t.appendChild(y("1 Bulan",()=>g("harga.bro"))),t.appendChild(y("Axis Mini",()=>g("harga.am")))):n==="Tri"?(t.appendChild(y("AON",()=>g("harga.aon"))),t.appendChild(y("Happy",()=>g("harga.hap")))):n==="Smar"&&(t.appendChild(y("Unlimited Harian",()=>g("harga.suh"))),t.appendChild(y("Smartfren Unlimited",()=>g("harga.sun"))),t.appendChild(y("Smartfren Mini",()=>g("harga.sd"))))}R();function $r(t,e,n){if(!n||n==="Unknown"){E("Nomor Tujuan Tidak Dikenali untuk Paket Nelpon");return}t.style.display="block",e.textContent=n,n==="Tsel"?t.appendChild(y("Telkomsel Nelpon",()=>g("harga.tn"))):n==="Isat"?t.appendChild(y("Indosat Nelpon",()=>g("harga.in"))):n==="XL"?t.appendChild(y("XL Nelpon",()=>g("harga.xn"))):n==="Axis"?t.appendChild(y("Axis Nelpon",()=>g("harga.an"))):n==="Tri"&&t.appendChild(y("Tri Nelpon",()=>g("harga.trn")))}R();var bc=document.getElementById("inputTujuan");function Hr(t,e,n){t.style.display="block",e.textContent=n,t.appendChild(y("Cek Nama Pemilik",()=>g("cektoken."+bc.value))),t.appendChild(y("Beli Token Listrik",()=>g(j("p"))))}R();var en=document.getElementById("inputTujuan");function Ur(t,e){if(console.log(e),!e||e==="Unknown"){E("Nomor Tujuan Tidak Dikenali untuk Nominal Bebas");return}li(!0);let n=document.createElement("div");n.className="wrapper-input";let i=document.createElement("div");i.className="row-input";let s=document.createElement("select");s.className="select-provider",["--Pilih--","Telkomsel","Dana","Gopay","ShopeePay"].forEach(f=>{if(f==="Telkomsel"&&e.toLowerCase()!=="tsel")return;let p=document.createElement("option");p.value=f==="--Pilih--"?"":f,p.textContent=f,s.appendChild(p)});let o=document.createElement("div");o.className="input-nominal-wrapper";let a=document.createElement("span");a.textContent="Rp";let l=document.createElement("input");l.type="text",l.placeholder="Masukkan nominal",l.className="input-nominal",l.inputMode="numeric",l.pattern="[0-9]*",l.autocomplete="off",l.style.padding="0 0 0 0.5rem",l.style.margin="0 -0.5rem 0 0",l.disabled=!0;let c=document.createElement("div");c.style.color="red",c.style.fontSize="12px",c.style.margin="4px 0",c.style.display="none";let d=document.createElement("div");d.className="nama-pemilik",d.textContent="\u2013",d.style.display="none";let u=document.createElement("button");u.textContent="Kirim",u.className="btn-kirim",u.disabled=!0;function h(){u.disabled=!s.value||!l.value||c.style.display==="block"}s.addEventListener("change",()=>{if(!s.value){l.disabled=!0,l.value="",c.style.display="none",u.disabled=!0,d.style.display="none";return}l.disabled=!1;let f="";s.value==="Dana"&&(f="d."),s.value==="Gopay"&&(f="gp."),s.value==="ShopeePay"&&(f="sp."),f&&g(f+en.value)}),l.addEventListener("input",()=>{let f=l.value.replace(/[^\d]/g,"");if(!f){l.value="",c.style.display="none",h();return}l.value=new Intl.NumberFormat("id-ID").format(f);let p=parseInt(f,10);s.value==="Telkomsel"?p<2e3||p>2e5?(c.textContent="Nominal Telkomsel minimal 2.000 dan maksimal 200.000",c.style.display="block"):p%1e3!==0?(c.textContent="Nominal Telkomsel hanya boleh kelipatan 1.000",c.style.display="block"):c.style.display="none":(s.value==="Dana"||s.value==="Gopay"||s.value==="ShopeePay")&&(p<1e4||p>1e6)?(c.textContent="Nominal minimal 10.000 dan maksimal 1.000.000",c.style.display="block"):c.style.display="none",h()}),u.addEventListener("click",()=>{if(!s.value){s.focus(),E("Pilih provider/dompet terlebih dahulu","error");return}if(!l.value){l.focus(),E("Masukkan nominal terlebih dahulu","error");return}if(!en.value){en.focus(),E("Masukkan nomor tujuan terlebih dahulu","error");return}let f=parseInt(l.value.replace(/\./g,""),10),p=s.value,_=0,v=localStorage.getItem("tipe_akun");v==="SP"?s.value==="Telkomsel"?_=f+850:s.value==="Dana"?_=f+150:s.value==="Gopay"?_=f+550:s.value==="ShopeePay"&&(_=f+600):s.value==="Telkomsel"?_=f+1e3:(s.value==="Dana"||s.value==="Gopay"||s.value==="ShopeePay")&&(_=f+1250);let k=en.value,I=`
    <table class="detail-table-laporan-modal">
        <tr><td>Provider</td><td>${p} Rp${new Intl.NumberFormat("id-ID").format(f)}</td></tr>
        <tr><td>Harga Modal</td><td>Rp${new Intl.NumberFormat("id-ID").format(_)}</td></tr>
        <tr><td>Nomor Tujuan</td><td>${k}</td></tr>
    </table>
    <div style="font-weight:bold; color:red; text-align:center;">
        Pastikan Saldo Anda Mencukupi!
    </div>`;Xt("KONFIRMASI TRANSAKSI",I,()=>{if(li(!1),s.value==="Telkomsel"){let w=Math.floor(f/1e3);v==="SP"?g(`kirim.xtelkomsel.${k}.${w}`):g(`kirim.telkomsel.${k}.${w}`)}else s.value==="Dana"?g(`kirim.dana.${k}.${f}`):s.value==="ShopeePay"?g(`kirim.shopee.${k}.${f}`):s.value==="Gopay"&&g(`kirim.gopay.${k}.${f}`)},()=>{E("Transaksi dibatalkan","error")})}),i.appendChild(s),i.appendChild(o),o.appendChild(a),o.appendChild(l),n.appendChild(i),n.appendChild(c),n.appendChild(d),n.appendChild(u),t.appendChild(n),window.addEventListener("updateNamaDompet",f=>{let{nama:p}=f.detail;s.value&&(d.textContent=`${p}`,d.style.display="block",d.style.background=getComputedStyle(document.documentElement).getPropertyValue("--flash-color"),setTimeout(()=>{d.style.background="var(--bg-color)"},1e3))})}R();function Wr(t,e,n){t.style.display="block",e.textContent=n,t.appendChild(y("Dana",()=>g("harga.d"))),t.appendChild(y("Shopee Pay",()=>g("harga.sp"))),t.appendChild(y("Gopay",()=>g("harga.gp"))),t.appendChild(y("Ovo",()=>g("harga.o"))),t.appendChild(y("Grab",()=>g("harga.gr"))),t.appendChild(y("LinkAja",()=>g("harga.la"))),t.appendChild(y("Mandiri E-Money",()=>g("harga.em"))),t.appendChild(y("BNI TapCash",()=>g("harga.bnitap"))),t.appendChild(y("BRI Bizzi",()=>g("harga.brizzi"))),t.appendChild(y("Maxim",()=>g("harga.max")))}R();function Kr(t,e,n){t.style.display="block",e.textContent=n,t.appendChild(y("Free Fire",()=>g("harga.ff"))),t.appendChild(y("Mobile Legends",()=>g("harga.ml"))),t.appendChild(y("PUBG Mobile",()=>g("harga.pm"))),t.appendChild(y("Point Blank",()=>g("harga.pb")))}R();var wp=document.getElementById("inputTujuan");function jr(t,e,n){t.style.display="block",e.textContent=n,t.appendChild(y("Nex Parabola",()=>g("harga.nex"))),t.appendChild(y("K-Vision",()=>g("harga.kv"))),t.appendChild(y("Jawara Vision",()=>g("harga.mnc")))}R();var kc=document.getElementById("inputTujuan");function Gr(t,e,n){t.style.display="block",e.textContent=n,t.appendChild(y("Cek Tagihan Listrik",()=>g("cpln."+kc.value)))}R();var Ic=document.getElementById("inputTujuan");function Vr(t,e,n){t.style.display="block",e.textContent=n,t.appendChild(y("Cek Tagihan BPJS Kesehatan",()=>g("cbpjsks."+Ic.value)))}R();var Tc=document.getElementById("inputTujuan");function zr(t,e,n){t.style.display="block",e.textContent=n,t.appendChild(y("Cek Tagihan Indihome",()=>g("cindihome."+Tc.value)))}var ci=document.getElementById("menuGrid"),Yr=yt(t=>{Or(t)});function qr(){let t=[{name:"Pulsa",emoji:"\u{1F4F1}"},{name:"Paket Data",emoji:"\u{1F310}"},{name:"Paket Nelpon & SMS",emoji:"\u{1F4DE}"},{name:"Token Listrik",emoji:"\u26A1"},{name:"Nominal Bebas",emoji:"\u270D\uFE0F"},{name:"Dompet Digital",emoji:"\u{1F4B3}"},{name:"Games",emoji:"\u{1F3AE}"},{name:"Paket TV",emoji:"\u{1F4FA}"},{name:"Bayar Listrik",emoji:"\u{1F4A1}"},{name:"Bayar BPJS",emoji:"\u{1F3E5}"},{name:"Bayar IndiHome",emoji:"\u{1F4E1}"}];ci&&(ci.innerHTML="",t.forEach(e=>{let n=document.createElement("div");n.className="menu-item",n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="center",n.style.cursor="pointer";let i=document.createElement("span");i.textContent=e.emoji,i.style.fontSize="2rem",i.style.marginBottom="0.5rem";let s=document.createElement("p");s.textContent=e.name,s.style.margin="0",n.appendChild(i),n.appendChild(s),ci.appendChild(n),n.addEventListener("click",()=>Sc(e))}))}function Sc(t){if(Mr(t.name),!oe.value.trim()){E("Masukkan nomor tujuan terlebih dahulu","error"),oe.focus();return}V.innerHTML="";let e=G.textContent;t.name==="Pulsa"?Br(V,G,e):t.name==="Paket Data"?Fr(V,G,e):t.name==="Paket Nelpon & SMS"?$r(V,G,e):t.name==="Token Listrik"?Hr(V,G,e):t.name==="Nominal Bebas"?Ur(V,e):t.name==="Dompet Digital"?Wr(V,G,e):t.name==="Games"?Kr(V,G,e):t.name==="Paket TV"?jr(V,G,e):t.name==="Bayar Listrik"?Gr(V,G,e):t.name==="Bayar BPJS"?Vr(V,G,e):t.name==="Bayar IndiHome"?zr(V,G,e):E("Menu belum siap","error");let n=document.getElementById("homeDisplay");n&&n.scrollIntoView({behavior:"smooth",block:"start"})}function Jr(t,e,n){window.laporanTerbuka=!0,e.innerHTML="";let i=document.createElement("div");i.style.display="flex",i.style.flexDirection="column",i.style.alignItems="center",i.style.marginBottom="0.5rem";let s=document.createElement("div");s.textContent="Laporan Transaksi",s.style.fontWeight="bold",s.style.fontSize="1.1rem",s.style.marginBottom="0.3rem",i.appendChild(s);let r=document.createElement("div");r.style.display="flex",r.style.justifyContent="space-between",r.style.alignItems="center",r.style.width="100%";let o=document.createElement("div");o.className="laporan-tanggal-text",o.style.fontWeight="bold",o.textContent=t;let a=document.createElement("div");a.style.display="flex",a.style.gap="0.3rem",a.style.alignItems="center";let l=document.createElement("button");l.textContent="\u{1F4C5}",l.style.fontSize="1.6rem",l.style.border="none",l.style.background="transparent",l.style.cursor="pointer",l.addEventListener("click",()=>{l.disabled=!0,setTimeout(()=>{l.disabled=!1},3e3);let d=document.createElement("div");d.id="datepickerBackdrop";let u=document.createElement("div");u.id="datepickerModal";let h=document.createElement("input");document.body.appendChild(d),document.body.appendChild(u);function f(){u.remove(),d.remove(),window.datepickerTerbuka=!1}window.datepickerTerbuka=!0,history.pushState({datepicker:!0},null,location.href);let p=new Date,_=p.getFullYear(),v=p.getMonth(),k=p.getDate();flatpickr(h,{defaultDate:p,minDate:new Date(_,v,1),maxDate:new Date(_,v,k),inline:!0,appendTo:u,onChange:function(I){if(!I.length)return;let C=I[0].getDate();window.tanggalSekarang=C,g(`laporan.${C}`),f()}})});let c=document.createElement("button");c.innerHTML="\u{1F504}",c.style.fontSize="1.6rem",c.style.cursor="pointer",c.style.border="none",c.style.background="transparent",c.style.padding="0",c.style.margin="0",c.style.outline="none",c.addEventListener("click",()=>{c.disabled=!0,di(),setTimeout(()=>{c.disabled=!1},3e3)}),a.appendChild(l),a.appendChild(c),r.appendChild(o),r.appendChild(a),i.appendChild(r),e.appendChild(i)}R();R();var Qr={T10:"PULSA 10.000",T20:"PULSA 20.000",X25:"PULSA 25.000",I50:"PULSA 50.000",S100:"PULSA 100.000"};async function Xr(t,e,n){try{let i="PRODUK DIGITAL";/^pln/i.test(t.kode)?i="TAGIHAN LISTRIK":/^p/i.test(t.kode)?i="TOKEN LISTRIK":/^td/i.test(t.kode)?i="PAKET DATA TELKOMSEL":/^if/i.test(t.kode)?i="PAKET DATA INDOSAT":/^tr/i.test(t.kode)?i="PULSA TRI":/^i/i.test(t.kode)?i="PULSA INDOSAT":/^s/i.test(t.kode)?i="PULSA SMARTFREN":/^x/i.test(t.kode)?i="PULSA XL":/^a/i.test(t.kode)?i="PULSA AXIS":/^t(?!d)/i.test(t.kode)&&(i="PULSA TELKOMSEL");let s=/^pln/i.test(t.kode)?3e3:0,r=n+s,o=localStorage.getItem("nama_agen")||"",a=18,l=["ID PELANGGAN","NAMA","TARIF/DAYA","JUMLAH KWH","HARGA","ADMIN","TOTAL HARGA"],d=document.createElement("canvas").getContext("2d");d.font=`${a}px monospace`;let u=0;l.forEach(N=>{let se=d.measureText(N).width;se>u&&(u=se)});let h=Math.ceil(u)+10,f=o.length*(a*.6),p=Math.sqrt(f**2+(a*2)**2),_=Math.ceil(p),v=_/2,k=_/2,I=`
<svg xmlns="http://www.w3.org/2000/svg" width="${_}" height="${_}">
  <g transform="rotate(-45, ${v}, ${k})">
    <text x="10" y="${k}" font-size="${a}" font-family="monospace"
          fill="black" fill-opacity="0.12">
      ${o}
    </text>
  </g>
</svg>`,w=encodeURIComponent(I),C=(N,se)=>`
      <div class="kv-row">
        <div class="kv-label">${N}</div>
        <div class="kv-colon">:</div>
        <div class="kv-value">${se??""}</div>
      </div>`,O="";if(i==="TOKEN LISTRIK"){let N=t.sn.split("/"),se=N[0]||"",Re=(N[1]||"").trim(),Yt=N[2]&&N[3]?`${N[2]}/${N[3]}`:N[2]||"",Yn=N[4]||"";O=`
      <div style="display:flex; justify-content:space-between; font-size:${a}px; margin-bottom:6px;">
        <div style="text-align:left;">TGL: ${e}</div>
        <div style="text-align:right;">JAM: ${t.waktu}</div>
      </div>

      <div style="text-align:center; font-weight:bold; font-size:25px; margin:6px 0;">
        -- STRUK BUKTI PEMBELIAN --
      </div>
      <div style="text-align:center; font-weight:bold; font-size:25px; margin-bottom:6px;">TOKEN LISTRIK</div>
      <hr style="border:1px solid black; margin:6px 0;">

      ${C("ID PELANGGAN",t.tujuan)}
      ${C("NAMA",Re)}
      ${C("TARIF/DAYA",Yt)}
      ${C("JUMLAH KWH",Yn)}

      <div style="text-align:center; margin-top:8px; font-weight:bold;">---- RINCIAN PEMBAYARAN ----</div>

      ${C("HARGA",`Rp${n.toLocaleString("id-ID")}`)}
      ${C("ADMIN",`Rp${s.toLocaleString("id-ID")}`)}
      ${C("<strong>TOTAL HARGA</strong>",`<strong>Rp${r.toLocaleString("id-ID")}</strong>`)}
      <div style="text-align:center; margin:10px 0; font-weight:bold;">-------- KODE TOKEN --------</div>
      <div style="text-align:center; font-size:28px; font-weight:bold; white-space:pre-line; margin:10px 0;">${se}</div>
      <hr style="border:1px solid black; margin:8px 0;">

      <div style="text-align:center; font-size:18px;">SIMPANLAH STRUK INI</div>
      <div style="text-align:center; font-size:18px;">SEBAGAI BUKTI PEMBELIAN ANDA</div>
      <div style="text-align:center; font-size:18px;">TERIMA KASIH</div>
      `}else if(i==="TAGIHAN LISTRIK"){let N={};t.sn.split("@").forEach(qn=>{let[Tr,Sr]=qn.split("=");Tr&&Sr&&(N[Tr.trim()]=Sr.trim())});let se=t.tujuan||"-",Re=N.AMA||"-",Yt=N.TD||"-",Yn=N.PTAG||"-",fc=N.JBLN||"-",pc=N.SM||"-",br=parseInt(N.ADM||"0",10),kr=parseInt(N.DENDA||"0",10),Ir=parseInt(N.TTAG||"0",10),qt=qn=>"Rp"+Number(qn).toLocaleString("id-ID");O=`
      <div style="display:flex; justify-content:space-between; font-size:${a}px; margin-bottom:6px;">
        <div style="text-align:left;">TGL: ${e}</div>
        <div style="text-align:right;">JAM: ${t.waktu}</div>
      </div>

      <div style="text-align:center; font-weight:bold; font-size:25px; margin:6px 0;">
        -- STRUK PEMBAYARAN TAGIHAN --
      </div>
      <div style="text-align:center; font-weight:bold; font-size:25px; margin-bottom:6px;">TAGIHAN LISTRIK</div>
      <hr style="border:1px solid black; margin:6px 0;">

      ${C("ID PELANGGAN",se)}
      ${C("NAMA",Re)}
      ${C("TARIF/DAYA",Yt)}
      ${C("PERIODE TAGIHAN",`${Yn} (${fc} Bulan)`)}
      ${C("STAND METER",pc)}

      <div style="text-align:center; margin-top:8px; font-weight:bold;">---- RINCIAN PEMBAYARAN ----</div>

      ${C("TAGIHAN",qt(Ir-br-kr))}
      ${C("ADMIN",qt(br))}
      ${C("DENDA",qt(kr))}
      ${C("<strong>TOTAL TAGIHAN</strong>",`<strong>${qt(Ir)}</strong>`)}

      <hr style="border:1px solid black; margin:8px 0;">
      <div style="text-align:center; font-size:18px;">SIMPANLAH STRUK INI</div>
      <div style="text-align:center; font-size:18px;">SEBAGAI BUKTI PEMBAYARAN ANDA</div>
      <div style="text-align:center; font-size:18px;">TERIMA KASIH</div>
    `}else{let N=Qr[t.kode]||t.kode,se="NOMINAL";if(/PAKET DATA/i.test(i)&&(se="DESKRIPSI"),/PULSA/i.test(i)){let Re=t.kode.match(/(\d+)$/);Re&&(N=`PULSA ${(parseInt(Re[1],10)*1e3).toLocaleString("id-ID")}`)}O=`
  <div style="display:flex; justify-content:space-between; font-size:${a}px; margin-bottom:6px;">
    <div style="text-align:left;">TGL: ${e}</div>
    <div style="text-align:right;">JAM: ${t.waktu}</div>
  </div>

  <div style="text-align:center; font-weight:bold; font-size:25px; margin:6px 0 0 0;">-- STRUK BUKTI PEMBELIAN --</div>
  <div style="text-align:center; font-weight:bold; font-size:25px; margin-bottom:6px;">${i}</div>
  <hr style="border:1px solid black; margin:6px 0;">

  ${C("NOMOR HP",t.tujuan)}
  ${C(se,N)}
  ${C("SN",t.sn)}

  <div style="text-align:center; margin-top:8px; font-weight:bold;">---- RINCIAN PEMBAYARAN ----</div>

  ${C("HARGA",`Rp ${n.toLocaleString("id-ID")}`)}
  ${C("ADMIN",`Rp ${s.toLocaleString("id-ID")}`)}
  ${C("<strong>TOTAL HARGA</strong>",`<strong>RP ${r.toLocaleString("id-ID")}</strong>`)}

  <hr style="border:1px solid black; margin:8px 0;">
  <div style="text-align:center; font-size:18px;">SIMPANLAH STRUK INI</div>
  <div style="text-align:center; font-size:18px;">SEBAGAI BUKTI PEMBELIAN ANDA</div>
  <div style="text-align:center; font-size:18px;">TERIMA KASIH</div>
  `}let U=document.createElement("div");U.innerHTML=`
      <style>
        .struk { font-family: monospace; font-size:${a}px; width:450px; color:#000; padding:20px; }
        /* grid: [label column] [colon column] [value column] */
        .struk .kv-row { display: grid; grid-template-columns: ${h}px 12px 1fr; column-gap:8px; align-items:start; margin:2px 0; }
        .struk .kv-label { text-align:left; white-space:nowrap; }
        .struk .kv-colon { text-align:left; }
        .struk .kv-value { text-align:left; white-space:pre-wrap; word-break:break-word; }
      </style>

      <div class="struk" style="background: #fff url('data:image/svg+xml,${w}') repeat; background-size: ${_*.6}px ${_*.6}px;">
        ${O}
      </div>
    `,document.body.appendChild(U);let ne=await html2canvas(U.querySelector(".struk"),{scale:2,backgroundColor:"#ffffff"});document.body.removeChild(U);let de=ne.toDataURL("image/jpeg"),ie=await(await fetch(de)).blob(),ue=new File([ie],"struk-transaksi.jpeg",{type:"image/jpeg"});navigator.canShare&&navigator.canShare({files:[ue]})?await navigator.share({title:"Struk Transaksi",text:"Berikut struk transaksi Anda",files:[ue]}):navigator.share?await navigator.share({title:"Struk Transaksi",text:`STRUK BUKTI PEMBELIAN
Jenis Produk : ${i}
TGL: ${e} ${t.waktu}
NOMOR : ${t.tujuan}
SN : ${t.sn}
HARGA : Rp${n.toLocaleString("id-ID")}
ADMIN : Rp${s.toLocaleString("id-ID")}
TOTAL : Rp${r.toLocaleString("id-ID")}
SIMPANLAH STRUK INI SEBAGAI BUKTI PEMBELIAN ANDA
TERIMA KASIH`}):E("Web Share API tidak didukung di browser ini.","error")}catch(i){console.error(i),E("Batal membagikan struk.","error")}}var Zr={xcf1:24e3,td2:32e3,xcf1a:18e3},Ac=["t","i","a","x","s","tr","b","p","d","sp","gp","o","gr","la","em","bnitap","brizzi","max"];function eo(t){let e=t+1500,n=500;return Math.ceil(e/n)*n}function to(t,e){if(!t)return eo(e);let n=t.toLowerCase();if(Zr[n])return Zr[n];for(let i of Ac)if(n.startsWith(i)){let s=n.slice(i.length);return/^\d+$/.test(s)?(parseInt(s,10)+3)*1e3:e}return eo(e)}R();var tn=null;async function Nc(){tn=await(await(await(await navigator.bluetooth.requestDevice({filters:[{services:["000018f0-0000-1000-8000-00805f9b34fb"]}]})).gatt.connect()).getPrimaryService("000018f0-0000-1000-8000-00805f9b34fb")).getCharacteristic("00002af1-0000-1000-8000-00805f9b34fb")}async function B(t){tn||await Nc(),tn&&await tn.writeValue(t)}async function Qe(t){let n=new TextEncoder("utf-8").encode(t+`
\r`);await B(n)}function no(t="-",e=32){return t.repeat(e)+`
`}function io(t,e,n=32){let i=t.length+e.length;if(i>=n)return t+" "+e;let s=n-i;return t+" ".repeat(s)+e}function ui(t,e,n=32){let i=t.padEnd(13," ")+": RP",s=e.toLocaleString("id-ID");return io(i,s,n)}function xc(t){let e=t.split("-"),n=e.slice(0,3).join("-"),i=e.slice(3).join("-");return[n,i].filter(Boolean).join(`
`)}async function so(t,e,n){let i=new TextEncoder("utf-8"),s=new Uint8Array([27,33,48]),r=new Uint8Array([27,69,1]),o=new Uint8Array([27,69,0]),a=new Uint8Array([27,33,16]),l=new Uint8Array([27,33,32]),c=new Uint8Array([27,33,0]),d=new Uint8Array([27,97,0]),u=new Uint8Array([27,97,1]),h="PRODUK DIGITAL";/^pln/i.test(t.kode)?h="TAGIHAN LISTRIK PASCABAYAR":/^p/i.test(t.kode)?h="TOKEN LISTRIK":/^td/i.test(t.kode)?h="PAKET DATA":/^tr/i.test(t.kode)?h="PULSA TRI":/^i/i.test(t.kode)?h="PULSA INDOSAT":/^s/i.test(t.kode)?h="PULSA TFREN":/^x/i.test(t.kode)?h="PULSA XL":/^a/i.test(t.kode)?h="PULSA AXIS":/^t(?!d)/i.test(t.kode)&&(h="PULSA TELKOMSEL");let f=/^pln/i.test(t.kode)?3e3:0,p=n+f,_=localStorage.getItem("nama_agen")||"";try{if(h==="TOKEN LISTRIK"){let v=t.sn.split("/"),k=v[0]||"",I=xc(k),w=v[1]?.trim()||"",C=v[2]&&v[3]?`${v[2]}/${v[3]}`:"",O=v[4]||"";await Qe(io(`TGL: ${e}`,`JAM: ${t.waktu}`,32)),await B(u),await B(r),await B(i.encode(`
-- STRUK BUKTI PEMBELIAN --
`)),await B(i.encode(`TOKEN LISTRIK
`)),await B(d),await B(o),await Qe(`${no("_",32)}
ID PELANGGAN : ${t.tujuan}
NAMA         : ${w}
TARIF/DAYA   : ${C}
JUMLAH KWH   : ${O}`),await B(u),await B(i.encode(`
-- RINCIAN PEMBAYARAN --
`)),await B(d),await Qe(ui("HARGA",n,32)+`
`+ui("ADMIN",f,32)),await B(r),await Qe(ui("TOTAL HARGA",p,32)),await B(o),await B(u),await B(i.encode(`
---------- KODE TOKEN ----------

`)),await B(s),await B(i.encode(I+`
`)),await B(c),await Qe(`${no("_",32)}
SIMPANLAH STRUK INI
SEBAGAI BUKTI PEMBELIAN ANDA
TERIMA KASIH


`)}else await Qe(`
${_}
${e} ${t.waktu}
`),await B(u),await B(i.encode(`-- STRUK BUKTI PEMBELIAN --
`)),await B(i.encode(h+`
`)),await B(d),`${t.tujuan}${t.kode}${t.sn}${n.toLocaleString("id-ID")}${f.toLocaleString("id-ID")}${p.toLocaleString("id-ID")}`;E("Struk berhasil dikirim ke printer thermal","success")}catch{E("Batal Print","error")}}function Wl(t){let e=document.getElementById("hargaJualInput");if(!e)return t;let n=e.textContent.replace(/[^\d]/g,"");return parseInt(n||"0",10)||t}async function Kl(t,e){let n=re(t.harga),i=t.kode?t.kode.toLowerCase():"",s=to(i,n),r=()=>s-n,o="hargaJualInput",a=`<table class="detail-table-laporan-modal">
<tr><td>Waktu Pengisian</td><td>${e} ${t.waktu}</td></tr>
<tr><td>Kode Produk</td><td>${t.kode}</td></tr>
<tr><td>Nomor Tujuan</td><td>${t.tujuan}</td></tr>
<tr><td>Serial Number</td><td>${t.sn}</td></tr>
<tr><td>Status Transaksi</td><td>${t.status}</td></tr>
</table>
<table class="detail-table-laporan-modal">
<tr><td>Harga Modal</td><td>Rp${n.toLocaleString("id-ID")}</td></tr>
<tr><td>Saran Harga Jual</td><td><span id="editHarga" style="cursor:pointer;">\u270F\uFE0F </span><span id="${o}">Rp${s.toLocaleString("id-ID")}</span></td></tr>
<tr><td>Keuntungan</td><td id="keuntungan">Rp${r().toLocaleString("id-ID")}</td></tr>
</table>`,c=["-","NA","N/A","n/a","N.A","Update","UPDATE"].includes((t.sn||"").trim());Y({title:"DETAIL TRANSAKSI",message:a,buttons:[{text:"\u{1F5BC}\uFE0F Bagikan",className:"modal-share",onClick:()=>Xr(t,e,Wl(s)),disabled:c},{text:"\u{1F4DD} Komplain",className:"modal-complain",onClick:()=>{let u=`Mohon bantu cek transaksi berikut:

Tanggal : ${e} jam ${t.waktu}
Kode Produk : ${t.kode}
Tujuan : ${t.tujuan}
Serial Number : ${t.sn}
Status : ${t.status}
Terima kasih.
`,f=`https://wa.me/6283100100190?text=${encodeURIComponent(u)}`;window.open(f,"_blank")}},{text:"\u{1F5A8}\uFE0F Print",className:"modal-print",onClick:()=>so(t,e,Wl(s)),disabled:c},{text:"\u{1F4B0} Catat Hutang",className:"modal-debt",onClick:async()=>{try{let{db:u,ref:h,push:f,set:p}=await Promise.resolve().then(()=>(Gn(),dr)),_=localStorage.getItem("kode_agen")||"Unknown",v={waktu:e+" "+t.waktu,kode:t.kode,deskripsi:t.deskripsi||"-",nomor:t.tujuan,snRef:t.sn,harga:n,hargaJual:s,kode_agen:_,status:"BELUM LUNAS",timestamp:Date.now()},k=h(u,"hutang"),I=f(k);await p(I,v),E("Data hutang berhasil dicatat","success");let w=document.getElementById("navAkun");w&&(w.click(),document.getElementById("catatanHutangDisplay").style.display="block",document.getElementById("akunDisplay").style.display="none")}catch(u){console.error("Gagal mencatat hutang:",u),E("\u274C Gagal mencatat ke Firebase","error")}}}]});let d=document.getElementById("editHarga");d.onclick=()=>{d.style.display="none";let u=document.getElementById(o),h=s;u.innerHTML=`<input id="inputHargaInline" type="text" value="${h.toLocaleString("id-ID")}" style="padding:0; margin:0; width:80px; height:1.2em; line-height:1.2em; border:1px solid #ccc; vertical-align:middle; text-align:right;"><span id="btnSimpanInline" style="cursor:pointer; margin-left:4px;">\u2705</span><span id="btnBatalInline" style="cursor:pointer; margin-left:4px;">\u274C</span>`;let f=document.getElementById("inputHargaInline");f.addEventListener("keydown",p=>{p.key==="Enter"?(p.preventDefault(),document.getElementById("btnSimpanInline").click()):p.key==="Escape"&&document.getElementById("btnBatalInline").click()}),f.addEventListener("input",()=>{let p=f.selectionStart,_=f.selectionEnd,v=f.value.replace(/\D/g,"");if(v){let k=parseInt(v,10).toLocaleString("id-ID"),I=f.value,w=k.length-I.length;f.value=k,f.setSelectionRange(p+w,_+w)}else f.value=""}),document.getElementById("btnSimpanInline").onclick=()=>{let p=f.value.replace(/\D/g,""),_=parseFloat(p);!isNaN(_)&&_>0?(s=_,u.textContent="Rp"+s.toLocaleString("id-ID"),document.getElementById("keuntungan").textContent="Rp"+(s-n).toLocaleString("id-ID")):(E("Harga tidak valid!","error"),u.textContent="Rp"+s.toLocaleString("id-ID")),d.style.display="inline"},document.getElementById("btnBatalInline").onclick=()=>{u.textContent="Rp"+s.toLocaleString("id-ID"),d.style.display="inline"}}}function ur(t,e,n){if(!t||!e)return;let i=document.createElement("div");i.className="laporan-item",i.style.display="grid",i.style.gridTemplateColumns="1fr auto",i.style.alignItems="flex-start",i.style.padding="0.25rem 0.5rem",i.style.borderBottom="1px solid #ddd",i.style.gap="0.5rem",i.style.fontSize="0.85rem";let s=document.createElement("div");s.innerHTML=`
    <div><b>${t.kode}</b> \u2192 ${t.tujuan} \u2192 Rp ${t.harga}</div>
    <div class="sn-text">SN: ${t.sn}</div>
`;let r=document.createElement("div");r.style.display="flex",r.style.flexDirection="column",r.style.alignItems="flex-end",r.style.whiteSpace="nowrap",r.innerHTML=`
        <div style="font-weight:bold">${t.waktu}</div>
        <div>${t.status}</div>
    `;let o=t.status.toLowerCase();o.includes("sukses")?i.classList.add("success"):o.includes("gagal")||o.includes("timeout")?i.classList.add("failed"):i.classList.add("proses"),i.appendChild(s),i.appendChild(r),e.appendChild(i),i.addEventListener("click",()=>Kl(t,n))}var Gl=yt(t=>{Sf(t)}),Tf=document.getElementById("laporanTransaksiDisplay"),Vl=null;function zl(){let t=document.getElementById("navRiwayat"),e=new Date;Vl=new Date(e.toLocaleString("en-US",{timeZone:"Asia/Jakarta"})).getDate(),t.addEventListener("click",di)}function di(){g(`laporan.${Vl}`),Tf.style.display="block"}window.laporanTerbuka=!1;function jl(t){let e=/^#(\S+)\s+ke\s+(\S+)\s+Rp\.([\d.]+)\s+#([\s\S]*?)\s*@(\d{2}:\d{2})\s+Status=([^;]+);?$/i,n=t.match(e);if(!n)return null;let i=n[4].trim();if(i===""&&(i="-"),n[1]==="CEKTOKEN"&&i.includes("NAMA =")){let s=i.match(/NAMA\s*=\s*.*?NO\.METER\s*=\s*.*?TARIF DAYA\s*=\s*.*?(?=$|UNTUK)/s);s&&(i=s[0].replace(/\s+/g," ").trim())}return{kode:n[1],tujuan:n[2],harga:n[3],sn:i,waktu:n[5],status:n[6].trim()}}function Sf(t){let e=document.getElementById("laporanHeader"),n=document.getElementById("laporanList");if(!n)return;let s=t.split(`
`).map(l=>l.trim()).filter(l=>l);if(window.laporanTerbuka&&!s.some(l=>l.startsWith("Tgl")))return;let r=s.find(l=>l.startsWith("Tgl"))||"",o=r.replace(/^Tgl\.\s*/,"").replace("N/A","").trim();if(!window.headerSudahRender)r&&(Jr(r,e,n),window.headerSudahRender=!0);else{let l=e.querySelector(".laporan-tanggal-text");l&&(l.textContent=r)}n.innerHTML="";let a="";s.forEach(l=>{if(l.startsWith("Tgl")){if(l.includes("N/A")){let c=l.replace("N/A","").trim(),d=e.querySelector(".laporan-tanggal-text");d&&(d.textContent=c);let u=document.createElement("div");u.textContent="Belum ada transaksi",u.style.textAlign="center",u.style.padding="1rem",u.style.color="#666",n.appendChild(u)}}else if(l.startsWith("#")){if(a=l,l.includes("Status=")){let c=jl(a);c&&ur(c,n,o),a=""}}else if(a&&(a+=" "+l,l.includes("Status="))){let c=jl(a);c&&ur(c,n,o),a=""}})}R();R();Gn();function Yl(){if(!document.getElementById("catatanHutangDisplay")){let s=document.createElement("article");s.id="catatanHutangDisplay",s.style.display="none",s.innerHTML=`
      <header class="header-catatan">
        <button id="btnBackCatatan" class="btn-back">
          <span class="arrow">\u2190</span>
        </button>
        <h2 class="judul-catatan">Catatan Hutang</h2>
      </header>

      <section class="catatan-body">
        <div id="listHutang" class="list-hutang">
          <div class="loading-hutang">\u23F3 Memuat data hutang...</div>
        </div>
      </section>
    `,document.querySelector("main.container").appendChild(s)}let e=Kn(cr,"hutang"),n=document.getElementById("listHutang"),i=localStorage.getItem("kode_agen");jn(e,s=>{let r=s.val();if(!r){n.innerHTML=`
        <div class="illustration">\u{1FA99}</div>
        <p class="info-text">Belum ada data hutang tersimpan.</p>
      `;return}let o=Object.entries(r).map(([a,l])=>({id:a,...l})).filter(a=>a.kode_agen===i);if(o.length===0){n.innerHTML=`
        <div class="illustration">\u{1F4ED}</div>
        <p class="info-text">Catatan Hutang Masih Kosong.</p>
      `;return}o.sort((a,l)=>l.timestamp-a.timestamp),n.innerHTML=o.map(a=>`
        <div class="hutang-card ${a.status==="LUNAS"?"hutang-lunas":"hutang-belum"}">
          <div class="hutang-header">
            <h3 class="hutang-deskripsi">${a.deskripsi}</h3>
            <span class="hutang-status">${a.status}</span>
          </div>

          <div class="hutang-info">
            <div><strong>Nomor Tujuan:</strong> ${a.nomor}</div>
            <div><strong>Kode Produk:</strong> ${a.kode}</div>
            <div><strong>Harga Modal:</strong> Rp ${a.harga}</div>
            <div><strong>Waktu Transaksi:</strong> ${a.waktu}</div>
            <div><strong>Nama Pembeli:</strong> - </div>
          </div>

          <div class="hutang-footer">
            <button class="btn-pembeli">Masukkan Nama Pembeli</button>
            <button class="btn-sudah-bayar" data-id="${a.id}">Tandai Sudah Bayar</button>
          </div>
        </div>
      `).join("")})}function ql(t){let e=t.getElementsByTagName("body");if(e.length>0){let n=e[0].textContent.trim();if(/^Yth\.\s*AGEN PULSA/i.test(n)&&/(Saldo|Bonus|Poin|Pemakaian)/i.test(n))return!0;if(/Mohon tunggu transaksi sebelumnya selesai/i.test(n)||/masih diproses operator/i.test(n))return E(n,"success",5e3),!0;if(/ke\s+\d+\s+diproses,/i.test(n)&&/Harga\s+/i.test(n)&&/Saldo\s+/i.test(n))return Y({title:"Transaksi Sedang Diproses",message:'<div style="text-align:center;">Mohon tunggu sebentar, transaksi Anda sedang kami proses.</div>',buttons:[{text:"OK",className:"modal-ok",onClick:()=>{}},{text:"Cek Riwayat",className:"modal-info",onClick:()=>{let s=document.getElementById("navRiwayat");s&&s.click()}}]}),!0;if(/^CEKTOKEN/i.test(n)&&/NAMA\s*=/i.test(n)){let s=n.match(/NAMA\s*=\s*(.*)/i)?.[1]||"-",r=n.match(/NO\.METER\s*=\s*(.*)/i)?.[1]||"-",o=n.match(/TARIF DAYA\s*=\s*(.*)/i)?.[1]||"-",a=`<table class="detail-table-laporan-modal">
                <tr><td>Nama</td><td>${s}</td></tr>
                <tr><td>No. Meter</td><td>${r}</td></tr>
                <tr><td>Tarif Daya</td><td>${o}</td></tr>
            </table>`;return Y({title:"Info Nomor Token Pelanggan",message:a,buttons:[{text:"OK",className:"modal-ok",onClick:()=>{let l=document.getElementById("inputTujuan");g("harga.p"),l&&!l.value.trim()&&(l.value=r,l.dispatchEvent(new Event("input",{bubbles:!0})))}}]}),!0}if((/CEK TAGIHAN PLN/i.test(n)||/^CPLN ke/i.test(n))&&/NAMA=/i.test(n)){let s="-",r=n.match(/CEK TAGIHAN PLN ke\s+(\d+)/i),o=n.match(/CPLN ke\s+(\d+)/i);r?s=r[1]:o&&(s=o[1]);let a=n.match(/SN\/Ref:\s*([^,]+)/i);if(a){let c=a[1].trim().split("@"),d={};c.forEach(C=>{let[O,U]=C.split("=");O&&U&&(d[O.trim()]=U.trim())});let u=d.NAMA||"-",h=d.TD||"-",f=d.JBLN||"-",p=d.PTAG||"-",_=d.TAG||"0",v=d.ADM||"0",k=d.TTAG||"0",I=C=>"Rp"+re(C).toLocaleString("id-ID"),w=`<table class="detail-table-laporan-modal">
                    <tr><td>ID Pelanggan</td><td>${s}</td></tr>
                    <tr><td>Nama</td><td>${u}</td></tr>
                    <tr><td>Tarif Daya</td><td>${h}</td></tr>
                    <tr><td>Jumlah Bulan</td><td>${f} Bulan</td></tr>
                    <tr><td>Periode Tagihan</td><td>${p}</td></tr>
                    <tr><td>Tagihan</td><td>${I(_)}</td></tr>
                    <tr><td>Biaya Admin</td><td>${I(v)}</td></tr>
                    <tr><td>Total Tagihan</td><td>${I(k)}</td></tr>
                </table>`;return Y({title:"Info Tagihan PLN",message:w,buttons:[{text:"BAYAR",className:"modal-ok",onClick:()=>{g("pln."+s)}},{text:"CANCEL",className:"modal-cancel",onClick:()=>{E("Pembayaran dibatalkan","error")}}],source:"Info Tagihan PLN"}),!0}}if((/CEK TAGIHAN BPJS/i.test(n)||/CBPJSKS/i.test(n))&&/NAMA=/i.test(n)){let s="-",r=n.match(/CEK TAGIHAN BPJS KESEHATAN ke\s+(\d+)/i),o=n.match(/CBPJSKS ke\s+(\d+)/i);r?s=r[1]:o&&(s=o[1]);let a=n.match(/SN\/Ref:\s*([^,]+)/i);if(a){let c=a[1].trim().split("@"),d={};c.forEach(O=>{let[U,ne]=O.split("=");U&&ne&&(d[U.trim()]=ne.trim())});let u=d.NAMA||"-",h=u.replace(/\s*\([^)]*\)/,"").trim(),f=d.JBLN||"-",p=d.PS||"-",_=d.CB||"-",v=d.TAG||"0",k=d.ADM||"0",I=d.TTAG||"0",w=O=>"Rp"+re(O).toLocaleString("id-ID"),C=`<table class="detail-table-laporan-modal">
            <tr><td>ID Pelanggan</td><td>${s}</td></tr>
            <tr><td>Nama</td><td>${h}</td></tr>
            <tr><td>Jumlah Peserta</td><td>${/\((.*?)\)/.exec(u)?.[1]||"-"}</td></tr>
            <tr><td>Jumlah Bulan</td><td>${f}</td></tr>
            <tr><td>Jumlah KK</td><td>${p}</td></tr>
            <tr><td>Cabang</td><td>${_}</td></tr>
            <tr><td>Tagihan</td><td>${w(v)}</td></tr>
            <tr><td>Biaya Admin</td><td>${w(k)}</td></tr>
            <tr><td>Total Tagihan</td><td>${w(I)}</td></tr>
            </table>`;return Y({title:"Info Tagihan BPJS Kesehatan",message:C,buttons:[{text:"BAYAR",className:"modal-ok",onClick:()=>{g("bpjsks."+s)}},{text:"CANCEL",className:"modal-cancel",onClick:()=>{E("Pembayaran dibatalkan","error")}}]}),!0}}if(!/^Tgl\.\s*\d{2}\/\d{2}\/\d{2}/i.test(n)&&(/CEK\s+NAMA\s+(DANA|GOPAY|SHOPEEPAY)/i.test(n)||/CEK\s+NAMA\s+E\s*-\s*WALLET\s+BERHASIL/i.test(n)&&/BILLER\s*=\s*(DANA|GOPAY|SHOPEEPAY)/i.test(n))&&/NAMA\s*=/i.test(n)){let s=n.match(/NAMA\s*=\s*(.*)/i)?.[1]?.trim()||"-";return s=s.replace(/^(DANA|GOPAY|SHOPEEPAY)\s+TOP\s+UP\s+/i,"").trim(),window.dispatchEvent(new CustomEvent("updateNamaDompet",{detail:{nama:s}})),!0}if(/^PLN\s+#\s+BAYAR\s+TAGIHAN\s+PLN/i.test(n)&&/Status:\s*SUKSES/i.test(n)||/^PLN ke\s+\d+/i.test(n)&&/Status:\s*Sukses/i.test(n)){let s=n.match(/PLN(?:\s+#\s+BAYAR\s+TAGIHAN\s+PLN)?\s+ke\s+(\d+)/i),r=s?s[1]:"-",o=n.match(/SN\/Ref:\s*([^,]+)/i),a=n;if(o){let c=o[1].trim().split("@"),d={};c.forEach(O=>{if(!O)return;let U=O.split("=");if(U.length===2){let ne=U[0].trim(),de=U[1].trim();if(ne==="TD")d[ne]=de;else if(de.includes("/"))de.split("/").forEach(ie=>{if(ie.includes("=")){let[ue,N]=ie.split("=");d[ue.trim()]=N.trim()}else if(ie.includes(":")){let[ue,N]=ie.split(":");d[ue.trim()]=N.trim()}else d[ne]=ie.trim()});else if(de.includes(":")){let[ie,ue]=de.split(":");d[ie.trim()]=ue.trim()}else d[ne]=de}});let u=d.NAMA||"-",h=d.TD||"-",f=d.JBLN||"-",p=d.PTAG||"-",_=d.ADM||"0",v=d.DENDA||"0",k=d.TTAG||"0",I=d.SM||"-",w=O=>"Rp"+re(O).toLocaleString("id-ID"),C=re(k)-re(_)-re(v);a=`<table class="detail-table-laporan-modal">
                    <tr><td>Jenis Pembayaran</td><td>Tagihan PLN</td></tr>
                    <tr><td>ID Pelanggan</td><td>${r}</td></tr>
                    <tr><td>Nama</td><td>${u}</td></tr>
                    <tr><td>Tarif Daya</td><td>${h}VA</td></tr>
                    <tr><td>Periode Tagihan</td><td>${p} (${f} Bulan)</td></tr>
                    <tr><td>Stand Meter</td><td>${I}</td></tr> <!-- \u2705 Tambahan -->
                    <tr><td>Tagihan</td><td>${w(C)}</td></tr>
                    <tr><td>Biaya Admin</td><td>${w(_)}</td></tr>
                    <tr><td>Denda</td><td>${w(v)}</td></tr>
                    <tr><td>Total Tagihan</td><td>${w(k)}</td></tr>
                </table>`}return Y({title:"Pembayaran Berhasil",message:a,buttons:[{text:"OK",className:"modal-ok",onClick:()=>{}},{text:"Cek Riwayat",className:"modal-info",onClick:()=>{let l=document.getElementById("navRiwayat");l&&l.click()}}]}),!0}if(/^BPJSKS\s+#\s+BAYAR\s+BPJS\s+KESEHATAN/i.test(n)&&/Status:\s*SUKSES/i.test(n)){let s=n.match(/KESEHATAN ke\s+(\d+)/i),r=s?s[1]:"-",o=n.match(/SN\/Ref:\s*([^,]+)/i),a=n;if(o){let c=o[1].trim().split("@"),d={};c.forEach(I=>{let[w,C]=I.split("=");w&&C&&(d[w.trim()]=C.trim())});let u=(d.NAMA||"-").replace(/\s*\([^)]*\)/,"").trim(),h=d.JBLN||"-",f=d.PS||"-",p=d.CB||"-",_=d.ADM||"0",v=d.TTAG||"0",k=I=>"Rp"+re(I).toLocaleString("id-ID");a=`<table class="detail-table-laporan-modal">
                    <tr><td>Jenis Pembayaran</td><td>BPJS Kesehatan</td></tr>
                    <tr><td>ID Pelanggan</td><td>${r}</td></tr>
                    <tr><td>Nama</td><td>${u}</td></tr>
                    <tr><td>Jumlah Bulan</td><td>${h} Bulan</td></tr>
                    <tr><td>Jumlah Peserta</td><td>${f} Orang</td></tr>
                    <tr><td>Cabang</td><td>${p}</td></tr>
                    <tr><td>Biaya Admin</td><td>${k(_)}</td></tr>
                    <tr><td>Total Tagihan</td><td>${k(v)}</td></tr>
                    </table>`}return Y({title:"Pembayaran Berhasil",message:a,buttons:[{text:"OK",className:"modal-ok",onClick:()=>{}},{text:"",className:"modal-info",onClick:()=>{let l=document.getElementById("navRiwayat");l&&l.click()}}]}),!0}if(/Status:\s*SUKSES/i.test(n)&&/ke\s+\d+/i.test(n)&&/#Harga/i.test(n)){let s=n.match(/pada\s+([\d/:\s]+)/i),r=n.match(/^([A-Z0-9]+)\s*#/i),o=n.match(/ke\s+(\d+)/i),a=n.match(/#\s*(.+?)\s+ke/i),l=n.match(/SN\/Ref:\s*([^,]+)/i),c=n.match(/#Harga:\s*([\d.,]+)/i),d=n.match(/Saldo\s*([\d.,]+)/i),u=r?r[1]:"-",h=s?s[1].trim():"-",f=a?a[1].trim():"-",p=o?o[1].trim():"-",_=l?l[1].replace("/","").trim():"-",v=c?c[1].replace(/[.,]+$/,"").trim():"-",k=d?d[1].replace(/[.,]+$/,"").trim():"-",I=`
        <table class="detail-table-laporan-modal">
            <tr><td>Waktu</td><td>${h}</td></tr>
            <tr><td>Nomor Tujuan</td><td>${p}</td></tr>
            <tr><td>Deskripsi</td><td>${f}</td></tr>
            <tr><td>SN/Ref</td><td>${_}</td></tr>
            <tr><td>Harga Modal</td><td>Rp${v}</td></tr>
            <tr><td>Saldo Akhir</td><td>Rp${k}</td></tr>
        </table>
    `;return Y({title:"Transaksi Berhasil",message:I,buttons:[{text:"OK",className:"modal-ok",onClick:()=>{}},{text:"Cek Riwayat",className:"modal-info",onClick:()=>{let w=document.getElementById("navRiwayat");w&&w.click()}},{text:"Catat Hutang",className:"modal-debt",onClick:async()=>{try{let{db:w,ref:C,push:O,set:U}=await Promise.resolve().then(()=>(Gn(),dr)),ne=localStorage.getItem("kode_agen")||"Unknown",de={waktu:h,kode:u,deskripsi:f,nomor:p,snRef:_,harga:v,kode_agen:ne,status:"BELUM LUNAS",timestamp:Date.now()},ie=C(w,"hutang"),ue=O(ie);await U(ue,de),E("Data hutang berhasil dicatat","success");let N=document.getElementById("navAkun");N&&(N.click(),document.getElementById("catatanHutangDisplay").style.display="block",document.getElementById("akunDisplay").style.display="none")}catch(w){console.error("Gagal mencatat hutang:",w),E("\u274C Gagal mencatat ke Firebase","error")}}}]}),!0}if(/ke\s+\d+\s+harga\s+[\d.,]+\s+#GAGAL/i.test(n)){let s=n.match(/^([A-Z0-9]+)\s+ke/i),r=n.match(/ke\s+(\d+)/i),o=n.match(/harga\s+([\d.,]+)/i),a=n.match(/Saldo\s+Tetap\s+Rp\s*([\d.,]+)/i),l=s?s[1]:"-",c=r?r[1]:"-",d=o?o[1]:"-",u=a?a[1]:"-",h=`
        <table class="detail-table-laporan-modal">
            <tr><td>Kode Produk</td><td>${l}</td></tr>
            <tr><td>Nomor Tujuan</td><td>${c}</td></tr>
            <tr><td>Harga Modal</td><td>Rp${d}</td></tr>
            <tr><td>Saldo Akhir</td><td>Rp${u}</td></tr>
        </table>
    `;return Y({title:"Transaksi Gagal",message:h,buttons:[{text:"OK",className:"modal-ok",onClick:()=>{}},{text:"Komplain",className:"modal-complain",onClick:()=>{let f=`Mohon bantu cek transaksi yang gagal berikut:

Kode Produk : ${l}
Nomor Tujuan : ${c}

Terima kasih.`,_=`https://wa.me/6283100100190?text=${encodeURIComponent(f)}`;window.open(_,"_blank")}}]}),!0}if(!/(?:#?Harga)/i.test(n))return!0;let i="error";(/SUKSES/i.test(n)||/DIPROSES/i.test(n))&&(i="success"),E(n,i,5e3)}return!0}var hr=document.getElementById("pinOverlay"),ke=document.getElementById("pinMessage"),Af=document.querySelectorAll(".pinCircle"),Ql=document.querySelectorAll(".pinPad button"),Nf=document.getElementById("pinBack"),te="",ze="check",Jl="";async function Xl(t){let n=new TextEncoder().encode(t),i=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(i)).map(r=>r.toString(16).padStart(2,"0")).join("")}function Zl(){return localStorage.getItem("appPin")}Zl()?(ze="check",ke.textContent="Masukkan PIN Anda"):(ze="set",ke.textContent="Buat PIN Baru 6 Digit");function pr(){Af.forEach((t,e)=>{t.classList.toggle("filled",e<te.length)})}function fr(){te="",pr()}function ec(t){hr.classList.add("fade-out"),hr.addEventListener("animationend",()=>{hr.style.display="none",document.querySelector("main.container").style.display="block",t&&t()},{once:!0})}async function mr(){if(xf(),te.length!==6)return;let t=Zl();if(!t)return;await Xl(te)===t?ec():(ke.textContent="PIN salah, coba lagi",tc(),fr())}function tc(){ke.classList.remove("shake"),ke.offsetWidth,ke.classList.add("shake")}function xf(){Ql.forEach((t,e)=>{t.style.animationDelay=`${e*.1}s`,t.classList.remove("animated"),t.offsetWidth,t.classList.add("animated")})}Ql.forEach(t=>{t.id!=="pinBack"&&t.addEventListener("click",async()=>{te.length<6&&(te+=t.textContent,pr(),te.length===6&&setTimeout(async()=>{if(ze==="check")await mr();else if(ze==="set")Jl=te,ze="confirm",ke.textContent="Konfirmasi PIN 6 digit",fr();else if(ze==="confirm")if(te===Jl){let e=await Xl(te);localStorage.setItem("appPin",e),ke.textContent="PIN berhasil dibuat!",setTimeout(()=>ec(),2e3)}else ke.textContent="PIN tidak cocok, coba lagi",ze="set",tc(),fr()},200))})});Nf.addEventListener("click",()=>{te=te.slice(0,-1),pr()});R();var F=null,gr=!1,Pf="wss://pulsa.dpdns.org:7443/ws",nc=document.getElementById("saldoDisplay"),ic=document.getElementById("homeDisplay"),sc=document.getElementById("navBottom"),_r=null;function yr(t){console.log("[XMPP]",t)}function Rf(t,e){let n=localStorage.getItem("appPin");if(!n)return;let i=CryptoJS.AES.encrypt(t,n).toString(),s=CryptoJS.AES.encrypt(e,n).toString();localStorage.setItem("xmpp_jid",i),localStorage.setItem("xmpp_pass",s)}function vr(){let t=localStorage.getItem("appPin");if(!t)return null;let e=localStorage.getItem("xmpp_jid"),n=localStorage.getItem("xmpp_pass");if(!e||!n)return null;try{let i=CryptoJS.AES.decrypt(e,t).toString(CryptoJS.enc.Utf8),s=CryptoJS.AES.decrypt(n,t).toString(CryptoJS.enc.Utf8);return{jid:i,pass:s}}catch(i){return console.error("Gagal dekripsi:",i),null}}function Er(){localStorage.removeItem("xmpp_jid"),localStorage.removeItem("xmpp_pass")}function Vn(t,e,n=null){if(gr){yr("Login temporarily locked, please wait...");return}F=new Strophe.Connection(Pf),F.connect(t+"/",e,function(i){switch(console.log("[DEBUG] Strophe status:",i),i){case Strophe.Status.CONNECTING:console.log("Connecting..."),he(50);break;case Strophe.Status.CONNFAIL:console.log("Connection failed."),he(100),De();break;case Strophe.Status.DISCONNECTING:console.log("Disconnecting...");break;case Strophe.Status.DISCONNECTED:console.log("Disconnected. Coba reconnect..."),he(0),De();let s=vr();s?(Je(),console.log("\u{1F504} Auto-relogin pakai credential tersimpan..."),setTimeout(()=>{Vn(s.jid,s.pass)},1e3)):(De(),document.getElementById("formLogin").style.display="block",nc.style.display="none",ic.style.display="none",sc.style.display="none",laporanTransaksiDisplay.style.display="none",document.getElementById("akunDisplay").style.display="none");break;case Strophe.Status.CONNECTED:console.log("Connected as "+F.jid),he(100),De(),_r&&clearInterval(_r),_r=setInterval(()=>{F&&F.connected&&(F.send($pres()),console.log("\u{1F504} Sent keepalive"))},3e4),document.getElementById("akune").value="",document.getElementById("paswote").value="",F.send($pres().c("priority").t("127")),document.getElementById("formLogin").style.display="none",Rf(t,e),!document.getElementById("formLogin").style.display!=="none"&&g("S"),nc.style.display="block",F.addHandler(Rr,null,"message","chat"),F.addHandler(Gl,null,"message","chat"),F.addHandler(Yr,null,"message","chat"),F.addHandler(ql,null,"message","chat"),ic.style.display="block",sc.style.display="flex",qr(),zl(),document.querySelectorAll(".bottom-nav .nav-item").forEach(o=>o.classList.remove("active")),document.getElementById("navBeranda").classList.add("active"),document.getElementById("pinOverlay").style.display="flex",mr(),window.dispatchEvent(new Event("loginUnlocked")),n&&n();break;case Strophe.Status.AUTHFAIL:console.log("Authentication failed."),Er(),E(`Login Gagal
Periksa Username dan Password!`,"error"),he(100),De(),gr=!0,setTimeout(()=>{gr=!1,console.log("Login unlocked, you can try again."),window.dispatchEvent(new Event("loginUnlocked"))},5e3);break;case Strophe.Status.ATTACHED:console.log("Attached.");break;case Strophe.Status.ERROR:console.log("Error occurred.");break;default:console.log("Other status: "+i)}})}function Df(){document.getElementById("akune").value="",document.getElementById("paswote").value=""}function rc(){document.getElementById("formLogin").addEventListener("submit",function(t){t.preventDefault();let e=this.querySelector('button[type="submit"]'),n=document.getElementById("akune").value.toLowerCase(),i=document.getElementById("paswote").value;if(!n||!i){E("Username dan password harus diisi","error");return}e.disabled=!0,e.textContent="Tunggu...";let s=n+"@"+_t;Je(),Vn(s,i)}),window.addEventListener("loginUnlocked",()=>{let t=document.querySelector('#formLogin button[type="submit"]');t&&(t.disabled=!1,t.textContent="Login")}),window.addEventListener("load",()=>{let t=vr();console.log("Loaded credentials from localStorage:",t),t&&t.jid&&t.pass?(yr("Found saved credentials, auto-logging in..."),document.getElementById("akune").value=t.jid.split("@")[0],document.getElementById("paswote").value=t.pass,Je(),he(0),Vn(t.jid,t.pass,()=>{document.getElementById("loading").style.display="none"})):(document.getElementById("loading").style.display="none",document.getElementById("formLogin").style.display="block")}),document.getElementById("logoutBtn").addEventListener("click",function(){console.log("Manual logout."),F&&(F.disconnect(),Er()),Df()})}R();function oc(){document.getElementById("contactBtn").addEventListener("click",async()=>{if("contacts"in navigator&&"ContactsManager"in window)try{let e=["name","tel"],n={multiple:!1},i=await navigator.contacts.select(e,n);if(!i||i.length===0){console.log("User batal pilih kontak");return}let s=document.getElementById("inputTujuan");if(!s)return;let r=i[0].tel&&i[0].tel[0];if(!r){E("Kontak tidak memiliki nomor telepon.","error");return}s.value=Ye(r),s.dispatchEvent(new Event("input",{bubbles:!0,composed:!0}))}catch(e){console.warn("Akses kontak dibatalkan:",e)}else E("Browser Anda tidak mendukung akses kontak.","error")})}function ac(){let t=document.querySelectorAll(".bottom-nav .nav-item");t.forEach(e=>{e.addEventListener("click",()=>{t.forEach(n=>n.classList.remove("active")),e.classList.add("active"),e.id==="navRiwayat"?(console.log("ini navRiwayat"),document.getElementById("laporanTransaksiDisplay").style.display="block",document.getElementById("homeDisplay").style.display="none",document.getElementById("saldoDisplay").style.display="none",document.getElementById("akunDisplay").style.display="none",document.getElementById("catatanHutangDisplay").style.display="none"):e.id==="navBeranda"?(console.log("ini halaman navBeranda"),document.getElementById("homeDisplay").style.display="block",document.getElementById("laporanTransaksiDisplay").style.display="none",document.getElementById("saldoDisplay").style.display="block",document.getElementById("akunDisplay").style.display="none",document.getElementById("catatanHutangDisplay").style.display="none"):e.id==="navAkun"&&(console.log("ini halaman navAkun"),document.getElementById("laporanTransaksiDisplay").style.display="none",document.getElementById("homeDisplay").style.display="none",document.getElementById("saldoDisplay").style.display="none",document.getElementById("akunDisplay").style.display="block",document.getElementById("catatanHutangDisplay").style.display="none")})})}function lc(){let t=document.getElementById("akunDisplay");t.innerHTML=`
    <div class="akun-list">
      <button id="logoutBtn" class="akun-item">
        <span class="akun-icon">\u{1F4F4}</span>
        <span class="akun-label">Keluar Akun</span>
      </button>
      <button class="akun-item refreshBtn">
        <span class="akun-icon">\u{1F504}</span>
        <span class="akun-label">Refresh Halaman</span>
      </button>
      <button class="akun-item toggleThemeBtn">
        <span class="akun-icon">\u{1F319}</span>
        <span class="akun-label">Tema Gelap/Terang</span>
      </button>
      <button class="akun-item" id="btnCatatanHutang">
        <span class="akun-icon">\u{1F4B0}</span>
        <span class="akun-label">Catatan Hutang</span>
      </button>
      <button class="akun-item" id="btnDownline">
        <span class="akun-icon">\u{1F465}</span>
        <span class="akun-label">Lihat Downline</span>
      </button>
    </div>
  `}function wr(){let t=document.getElementById("navBottom");if(!t)return;let e=window.visualViewport;function n(){let i=window.innerHeight-e.height-e.offsetTop;i>0?t.style.bottom=i+"px":t.style.bottom="0px"}e.addEventListener("resize",n),e.addEventListener("scroll",n)}function Cr(){let t=document.getElementById("toast");if(!t)return;let e=window.visualViewport;function n(){let i=e.height/2+e.offsetTop;t.style.top=i+"px"}e.addEventListener("resize",n),e.addEventListener("scroll",n),n()}document.addEventListener("DOMContentLoaded",()=>{wr(),Cr()});R();function cc(){let t=document.getElementById("formLogin"),e=document.getElementById("formRegister"),n=document.getElementById("backToLogin"),i=document.getElementById("regUser"),s=document.getElementById("regPass"),r=document.getElementById("regPass2"),o=document.getElementById("regWarning"),a=document.getElementById("passWarning");qe(document.getElementById("toggleRegPass"),s),qe(document.getElementById("toggleRegPass2"),r),n.addEventListener("click",()=>{e.reset(),o.style.display="none",a.style.display="none",e.style.display="none",t.style.display="block"}),i.addEventListener("input",()=>{let c=i.value;/^[A-Za-z0-9]*$/.test(c)?o.style.display="none":(o.textContent="Username hanya boleh huruf dan angka (tanpa spasi & simbol)!",o.style.display="block")});function l(){s.value&&r.value&&s.value!==r.value?(a.textContent="Konfirmasi password tidak cocok!",a.style.display="block"):a.style.display="none"}s.addEventListener("input",l),r.addEventListener("input",l),e.addEventListener("submit",async c=>{if(c.preventDefault(),!/^[A-Za-z0-9]+$/.test(i.value)){o.textContent="Username hanya boleh huruf dan angka (tanpa spasi & simbol)!",o.style.display="block";return}if(s.value!==r.value){a.textContent="Konfirmasi password tidak cocok!",a.style.display="block";return}try{let d=await fetch("https://pulsa.dpdns.org:5443/api/register",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Basic "+btoa("adminkantor@pulsa.dpdns.org:password123")},body:JSON.stringify({user:i.value,host:_t,password:s.value})}),u;try{u=await d.json()}catch{u=await d.text()}if(console.log("Register response:",u),d.ok&&typeof u=="string"&&u.includes("successfully registered")){let h=i.value;E("Akun berhasil dibuat, silakan login!","success");let f="6282316015252",p=`tambahakun ${h}@${_t}/`;window.open(`https://wa.me/${f}?text=${encodeURIComponent(p)}`,"_blank"),e.reset(),e.style.display="none",t.style.display="block",document.getElementById("akune").value=h}else if(u&&u.status==="error"&&u.message){if(u.message.includes("already registered")){let h=i.value;E(`Username ${h} sudah terdaftar, gunakan username lain`,"error",5e3)}else E(u.message,"error");s.value="",r.value=""}else E("Gagal register, coba lagi!","error")}catch(d){console.error(d),E("Terjadi kesalahan koneksi","error")}})}R();var zn=!1,zt=null;function Lf(){E("Tekan sekali lagi untuk keluar","sukses")}function dc(){window.addEventListener("popstate",t=>{let e=document.getElementById("catatanHutangDisplay"),n=document.getElementById("akunDisplay");if(e&&e.style.display==="block"){e.style.display="none",n.style.display="block";return}if(window.modalTerbuka){let i=document.getElementById("modalHeader");if(i&&i.textContent==="Koneksi Terputus"){console.log("\u26D4 Tombol back diabaikan karena modal Koneksi Terputus"),history.pushState({modal:!0},null,location.href);return}window.modalSumber==="showHargaItem"&&E("Transaksi dibatalkan","error"),window.modalSumber==="Info Tagihan PLN"&&E("Pembayaran dibatalkan","error");let s=document.getElementById("modalOverlay");s&&(s.style.display="none",window.modalTerbuka=!1,window.modalSumber=null);return}if(window.datepickerTerbuka){let i=document.getElementById("datepickerModal"),s=document.getElementById("datepickerBackdrop");i&&i.remove(),s&&s.remove(),window.datepickerTerbuka=!1;return}zn?(zt&&clearTimeout(zt),zn=!1):(Lf(),zn=!0,zt&&clearTimeout(zt),zt=setTimeout(()=>{zn=!1},1500),history.pushState({dummy:!0},null,location.href))}),window.addEventListener("load",()=>{history.pushState({first:!0},null,location.href)})}R();function uc(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("sw.js").then(t=>{t.onupdatefound=()=>{let e=t.installing;e.onstatechange=()=>{e.state==="installed"&&navigator.serviceWorker.controller&&(E(`Versi baru tersedia
silakan keluar lalu masuk lagi!`,"success"),setTimeout(()=>window.location.reload(),1500))}}}).catch(t=>console.log("Service Worker failed:",t))})}var gt=null;function hc(){let t=document.getElementById("installPwaBtn");t&&(window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),gt=e,t.style.display="block"}),t.addEventListener("click",async()=>{if(!gt)return;t.disabled=!0,t.textContent="\u23F3 Memulai...",gt.prompt();let{outcome:e}=await gt.userChoice;gt=null,e==="accepted"?(t.textContent="\u2705 Terinstal",setTimeout(()=>t.style.display="none",2e3)):(t.textContent="\u{1F4F1} Install Aplikasi",t.disabled=!1)}),window.addEventListener("appinstalled",()=>{gt=null,t.style.display="none"}))}ac();lc();Yl();uc();qe();ni();Jn();Pr();wr();Cr();ei();dc();ti();oc();rc();cc();Xn(Qt,g,si);Zn(Qt,si);Qn();hc();ii();})();
/*! Bundled license information:

@firebase/util/dist/index.esm.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2025 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/component/dist/esm/index.esm.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/logger/dist/esm/index.esm.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/app/dist/esm/index.esm.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

firebase/app/dist/esm/index.esm.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/database/dist/index.esm.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
*/
